<ink-var name="x" value="1"></ink-var>
<ink-var name="y" value="5"></ink-var>
<ink-var name="xSquared" :value="x * x" description="The square of x."></ink-var>

<ink-demo>
    <ink-scope name="demoVars">
        <ink-var name="x" value="2"></ink-var>
        <ink-var name="y" value="4"></ink-var>
        <ink-var name="xy" :value="x * y"></ink-var>
        If we have ranges for two variables:<br>
        X: <ink-range name="x"></ink-range>, which is <ink-display name="x"></ink-display><br>
        Y: <ink-range name="y"></ink-range>, which is <ink-display name="y"></ink-display><br>
        Or you can set the value directly in the text for X <ink-dynamic name="x"></ink-dynamic> and Y <ink-dynamic name="y"></ink-dynamic>.<br>
        The product of X and Y is <ink-display name="xy"></ink-display>.
    </ink-scope>
</ink-demo>


<h2>Variables</h2>
<ink-callout class="danger"><strong>TODO:</strong> These should be able to reference a different <code>ink-scope</code></ink-callout>
<ink-callout class="danger"><strong>TODO:</strong> Format should be a default and pulled through to other variables.</ink-callout>


<ink-aside>
    This document has variables:
    <ink-var-list></ink-var-list>
</ink-aside>
<p>
    Variables need to be defined to drive your dynamic document, the <code>ink-var</code> web component can specify a name, description and a value.
</p>

<ink-code language="html" compact>&lt;ink-var name="x" value="1"&gt;&lt;/ink-var&gt;</ink-code>

<p>
    These variables are hidden in the <code>DOM</code>, you can use a <code>ink-var-list</code> to see them all.
</p>

<h2>Reactive Variables</h2>

<p>
    You can also create reactive variables which get execute a user-inputed string in an <code>iframe</code> with access to all other variables. Note here that the <code>:value</code> has a <emph>semi-colon</emph> to show that this should be executed to define the value.
</p>

<ink-code language="html" compact>&lt;ink-var name="xSquared" :value="x * x"&gt;&lt;/ink-var&gt;</ink-code>

<ink-callout class="info">
    Properties of <code>ink-var</code>:
    <dl>
      <dt><code>name</code></dt><dd>The variable to name to in the state, must follow javascript naming conventions for variables.</dd>
      <dt><code>description</code></dt><dd>The variable description, useful for alt-text.</dd>
      <dt><code>value</code></dt><dd>The value of the variable.</dd>
      <dt><code>:value</code></dt><dd>Function to evaluate to update the value. If present, this will update the value anytime the state is changed.</dd>
      <dt><code>format</code></dt><dd>A d3-format string. See the <a href="https://github.com/d3/d3-format" target="_blank">documentation</a>.</dd>
    </dl>
</ink-callout>

<hr class="small">

<h2>Display Variables</h2>

<p>To display an element create an <code>ink-display</code>, which will just render the named variable as text.</p>

<ink-code language="html" compact>&lt;ink-display name="x"&gt;&lt;/ink-display&gt;</ink-code>

<p>
    This is a number that is dynamic: <ink-display name="x"></ink-display>.<br>
    Try setting the value of $x$ with the range input: <ink-range name="x" max="5"></ink-range>
</p>

<p>
    You can also <code>transform</code> the value of a variable before you format it.
    For example, you might want to say that the admission to a park is <code>'free'</code> when the <ink-action bind="{x:0}">value == 0</ink-action>.
</p>
<ink-demo>
    The park admission is
    <ink-display name="x" transform="(value > 0)? value : 'free'" format="$.2f"></ink-display>.
</ink-demo>
<p>
    You can also use this <code>transform</code> to say that the park admission is <strong><ink-dynamic name="x" format="$.2f" transform="['free','real cheap','cheap','costly','expensive','real expensive'][Math.min(Math.max(value,0),5)]" max="5"></ink-dynamic></strong>.<br>
    This is also quite useful if you want to use the transform to index into an array <ink-dynamic name="x" format="$.2f" transform="['&#128525;','&#128516;','&#128522;','&#128528;','&#128530;','&#128532;'][Math.min(Math.max(value,0),5)]" max="5"></ink-dynamic>, in this case emoji array - but it could be numeric too!
</p>

<ink-callout class="info">
    Properties of <code>ink-display</code>:
    <dl>
      <dt><code>name</code></dt><dd>The variable to name to in the state.</dd>
      <dt><code>format</code></dt><dd>A d3-format string. See the <a href="https://github.com/d3/d3-format" target="_blank">documentation</a>.</dd>
      <dt><code>transform</code></dt><dd>Allows you to change or transform the value before formating: <code>format(transform(value))</code>. If the value is a string after transformation, it will not be formatted.</dd>
    </dl>
</ink-callout>

<hr class="small">

<h2>Controlling Variables</h2>

<p>What gets slightly more exciting is when you can bring these together with inputs that can be ranges or dynamic text elements that you can drag.</p>

<ink-code language="html" compact>&lt;ink-dynamic name="x"&gt;&lt;/ink-dynamic&gt;</ink-code>

<p>
    This allows you to set the value of $x$ inline: <ink-dynamic name="x"></ink-dynamic> or $y=$<ink-dynamic name="y"></ink-dynamic>.<br>
    Notice how it is linked to the above <code>ink-range</code> and <code>ink-display</code>.<br>
    You can also add inside of the html tag, to have custom formatting that also is dynamic.<br>
    For example, <ink-dynamic name="y">&deg;C</ink-dynamic>, the <code>&deg;C</code> is inside of the <code>&lt;ink-dynamic&gt;</code> tags, so it is also has a blue underline.
</p>
<p>
    You can also create ranges, as see above, notice that we can create a lot of these and name to different values.
</p>

<ink-code language="html" compact>&lt;ink-range name="x"&gt;&lt;/ink-range&gt;</ink-code>
<p>
    $x_{1.0}:$ <ink-range name="x"></ink-range><br>
    $y_{1.0}:$ <ink-range name="y"></ink-range><br>
    $y_{0.5}:$ <ink-range name="y" step="0.5"></ink-range><br>
</p>


<ink-callout class="info">
    <strong>Properties:</strong>
    <dl>
        <dt><code>name</code></dt><dd>The variable to name to in the state, setting this will set <code>:value="name"</code> and <code>bind="{name:value}"</code>.</dd>
        <dt><code>value</code></dt><dd>The numeric value of the control. Can also be set by <code>:value</code>.</dd>
        <dt><code>bind</code></dt><dd>A dictionary that should set variables: <code>(value) => {x: value}</code>.</dd>
        <dt><code>format</code></dt><dd>A d3-format string. See the <a href="https://github.com/d3/d3-format" target="_blank">documentation</a>.</dd>
        <dt><code>min</code></dt><dd>Minimum of the range.</dd>
        <dt><code>max</code></dt><dd>Maximum of the range.</dd>
        <dt><code>step</code></dt><dd>Step size.</dd>
        <dt><code>sensitivity</code></dt><dd>Multiplier on pixels dragged for the <code>dynamic</code> text input.</dd>
        <dt><code>transform</code></dt><dd>Allows you to change or transform the value before formating: <code>format(transform(value))</code>. If the value is a string after transformation, it will not be formatted.</dd>
        <dt><code>periodic</code></dt><dd>When dragged start past min/max connect the range by cycling through again.</dd>
    </dl>
</ink-callout>

<hr class="small">

<h3><code>name</code>, <code>:value</code> & <code>bind</code></h3>

<p>

    There are times where you want more control over how your data gets displayed, updated or informs other variables.
    There are three properties to consider: <code>name</code>, <code>:value</code>, and <code>bind</code>.
    The most common use is through the <code>name</code> property, which is used to both set the control's value, and bind the change to the named variable.
    This amounts to a <strong>two way connection</strong>:

    <ink-code language="html">
        &lt;ink-dynamic
            name="x"
        &gt;&lt;/ink-dynamic&gt;
    </ink-code>

    When the variable <code>x</code> updates, the <code>value</code> is set, and when the control updates the value, the result updates the variable!
    Under the hood, when <code>name</code> is defined, the <code>:value</code> and the <code>bind</code> functions are automatically set.

    <ink-code language="html">
        &lt;ink-dynamic
            :value="x"
            bind="{x: value}"
        &gt;&lt;/ink-dynamic&gt;
    </ink-code>

    As with other properties, the <code>:</code> syntax for the <code>value</code> property recomputes every time there is a change.
    For example, if you put <code>:value="x"</code> then anytime the variable <code>x</code> changes, the value of the control updates.
    <strong>However, this is not the case in reverse!</strong>
    You have to explicitly <code>bind</code> the control to the variable (or variables) you want to update. This is done using a JSON dictionary of the form <code>{variable: value}</code>.
    Note that you can update multiple variables at a time.

    If you choose to explicitly set these, and not just use the <code>name</code> property, you can do some interesting things!
</p>

<ink-scope>
    <ink-var name="a" value="1"></ink-var>
    <ink-var name="b" value="1"></ink-var>
    <ink-var name="r" :value="Math.sqrt(a*a + b*b)"></ink-var>
    <ink-var name="theta" :value="Math.atan2(b, a) * 180 / Math.PI"></ink-var>

    <h3>Coordinate Transformation</h3>
    <p>
        A good example of this is changing from a radial coordinate system to Cartesian. In this case we will have two variables:
        <ink-chart style="float:right" xlim="[-5, 5]" ylim="[-5, 5]" height="300" width="300" x-axis-location="origin" y-axis-location="origin">
            <ink-chart-node :x="a" :y="b" bind="{a: x, b: y}"></ink-chart-node>
        </ink-chart>
        <br>

        <strong>Cartesian Coordinate System</strong>
        <dl>
            <dt>$x$</dt><dd><ink-dynamic name="a" min="-5" :max="5" step="0.05" sensitivity="5"></ink-dynamic></dd>
            <dt>$y$</dt><dd><ink-dynamic name="b" min="-5" :max="5" step="0.05" sensitivity="5"></ink-dynamic></dd>
        </dl>
        <br>
        <strong>Radial Coordinate System</strong>
        <dl>
            <dt>$r$</dt><dd>
                <ink-dynamic :value="Math.sqrt(a*a + b*b)" bind="{
                    a: value * Math.cos(Math.atan2(b, a)),
                    b: value * Math.sin(Math.atan2(b, a))
                }"
                min="0.1" :max="5" step="0.05" sensitivity="5"></ink-dynamic>
            </dd>
            <dt>$\theta$</dt><dd>
                <ink-dynamic :value="Math.atan2(b, a) * 180 / Math.PI" bind="{
                    a: Math.sqrt(a*a + b*b) * Math.cos(value * Math.PI / 180),
                    b: Math.sqrt(a*a + b*b) * Math.sin(value * Math.PI / 180)
                }"
                min="-180" :max="180" step="1" sensitivity="1" periodic>&deg;</ink-dynamic>
            </dd>
        </dl>
    </p>

    <strong style="text-decoration: underline;">Cartesian Update</strong>
    <p>
        <ink-equation aligned>
            x &= x = <ink-display name="a"></ink-display> \\
            y &= y = <ink-display name="b"></ink-display>
        </ink-equation>
        <ink-code language="html">
            &lt;ink-dynamic name="x"&gt;&lt;/ink-dynamic&gt;
        </ink-code>

        This gets rewritten and is equivalent to:

        <ink-code language="html">
            &lt;ink-dynamic :value="x" bind="{
                x: value
            }"&gt;&lt;/ink-dynamic&gt;
        </ink-code>
    </p>

    <strong style="text-decoration: underline">Radius Update</strong>
    <ink-equation aligned>
        r &= \sqrt{x^2 + y^2} = <ink-display name="r"></ink-display> \\
        x &= r * \cos(\operatorname{atan2}(y, x)) = <ink-display name="a"></ink-display> \\
        y &= r * \sin(\operatorname{atan2}(y, x)) = <ink-display name="b"></ink-display>
    </ink-equation>
    <ink-code>
        &lt;ink-dynamic :value="Math.sqrt(x*x + y*y)" bind="{
            x: value * Math.cos(Math.atan2(y, x)),
            y: value * Math.sin(Math.atan2(y, x))
        }"&gt;&lt;/ink-dynamic&gt;
    </ink-code>

    <strong style="text-decoration: underline">Theta Update</strong>
    <ink-equation aligned>
        \theta &= \operatorname{atan2}(y, x) = <ink-display name="theta"></ink-display> \\
        x &= \sqrt{x^2 + y^2} * \cos( \theta ) = <ink-display name="a"></ink-display> \\
        y &= \sqrt{x^2 + y^2} * \sin( \theta ) = <ink-display name="b"></ink-display>
    </ink-equation>
    <ink-code>
        &lt;ink-dynamic :value="Math.atan2(y, x)" bind="{
            x: Math.sqrt(x*x + y*y) * Math.cos(value),
            y: Math.sqrt(x*x + y*y) * Math.sin(value)
        }"&gt;&lt;/ink-dynamic&gt;
    </ink-code>

    </p>
</ink-scope>

<h2>Scope</h2>

<ink-demo>
    <ink-scope name="demo1">
        <ink-var name="x" value="0"></ink-var>
        <ink-range name="x"></ink-range>
    </ink-scope>
    <ink-scope name="demo2">
        <ink-var name="x" value="0"></ink-var>
        <ink-range name="x"></ink-range>
    </ink-scope>
    <ink-var-list></ink-var-list>
</ink-demo>

<ink-callout class="danger"><strong>TODO:</strong> var-list should be able to reference a different <code>ink-scope</code></ink-callout>
<ink-callout class="danger"><strong>TODO:</strong> You should be able to pull in and/or reference variables from other scopes.</ink-callout>

