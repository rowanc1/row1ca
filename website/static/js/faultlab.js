// FaultLab.js - Rowan Cockett - http://app.visiblegeology.com/

/*
 IntegraXor Web SCADA - JavaScript Number Formatter
 http://www.integraxor.com/
 author: KPL, KHL
 (c)2011 ecava
 Dual licensed under the MIT or GPL Version 2 licenses.
*/
'use strict';
(function(a, b) {
    function c(a) {
        var b = bb[a] = {};
        return m.each(a.split(Ga), function(a, c) {
            b[c] = !0
        }),
        b
    }
    function d(a, c, d) {
        if (d === b && 1 === a.nodeType)
            if (d = "data-" + c.replace(Ta, "-$1").toLowerCase(),
            d = a.getAttribute(d),
            "string" == typeof d) {
                try {
                    d = "true" === d ? !0 : "false" === d ? !1 : "null" === d ? null : +d + "" === d ? +d : da.test(d) ? m.parseJSON(d) : d
                } catch (e) {}
                m.data(a, c, d)
            } else
                d = b;
        return d
    }
    function e(a) {
        for (var b in a)
            if (!("data" === b && m.isEmptyObject(a[b])) && "toJSON" !== b)
                return !1;
        return !0
    }
    function f() {
        return !1
    }
    function g() {
        return !0
    }
    function h(a) {
        return !a || !a.parentNode || 11 === a.parentNode.nodeType
    }
    function i(a, b) {
        do
            a = a[b];
        while (a && 1 !== a.nodeType);return a
    }
    function j(a, b, c) {
        b = b || 0;
        if (m.isFunction(b))
            return m.grep(a, function(a, d) {
                return !!b.call(a, d, a) === c
            });
        if (b.nodeType)
            return m.grep(a, function(a) {
                return a === b === c
            });
        if ("string" == typeof b) {
            var d = m.grep(a, function(a) {
                return 1 === a.nodeType
            });
            if (zb.test(b))
                return m.filter(b, d, !c);
            b = m.filter(b, d)
        }
        return m.grep(a, function(a) {
            return 0 <= m.inArray(a, b) === c
        })
    }
    function k(a) {
        var b = qc.split("|")
          , a = a.createDocumentFragment();
        if (a.createElement)
            for (; b.length; )
                a.createElement(b.pop());
        return a
    }
    function n(a, b) {
        if (1 === b.nodeType && m.hasData(a)) {
            var c, d, e;
            d = m._data(a);
            var f = m._data(b, d)
              , g = d.events;
            if (g)
                for (c in delete f.handle,
                f.events = {},
                g) {
                    d = 0;
                    for (e = g[c].length; d < e; d++)
                        m.event.add(b, c, g[c][d])
                }
            f.data && (f.data = m.extend({}, f.data))
        }
    }
    function p(a, b) {
        var c;
        1 === b.nodeType && (b.clearAttributes && b.clearAttributes(),
        b.mergeAttributes && b.mergeAttributes(a),
        c = b.nodeName.toLowerCase(),
        "object" === c ? (b.parentNode && (b.outerHTML = a.outerHTML),
        m.support.html5Clone && a.innerHTML && !m.trim(b.innerHTML) && (b.innerHTML = a.innerHTML)) : "input" === c && wd.test(a.type) ? (b.defaultChecked = b.checked = a.checked,
        b.value !== a.value && (b.value = a.value)) : "option" === c ? b.selected = a.defaultSelected : "input" === c || "textarea" === c ? b.defaultValue = a.defaultValue : "script" === c && b.text !== a.text && (b.text = a.text),
        b.removeAttribute(m.expando))
    }
    function o(a) {
        return "undefined" != typeof a.getElementsByTagName ? a.getElementsByTagName("*") : "undefined" != typeof a.querySelectorAll ? a.querySelectorAll("*") : []
    }
    function r(a) {
        wd.test(a.type) && (a.defaultChecked = a.checked)
    }
    function q(a, b) {
        if (b in a)
            return b;
        for (var c = b.charAt(0).toUpperCase() + b.slice(1), d = b, e = xd.length; e--; )
            if (b = xd[e] + c,
            b in a)
                return b;
        return d
    }
    function s(a, b) {
        return a = b || a,
        "none" === m.css(a, "display") || !m.contains(a.ownerDocument, a)
    }
    function t(a, b) {
        for (var c, d, e = [], f = 0, g = a.length; f < g; f++)
            c = a[f],
            c.style && (e[f] = m._data(c, "olddisplay"),
            b ? (!e[f] && "none" === c.style.display && (c.style.display = ""),
            "" === c.style.display && s(c) && (e[f] = m._data(c, "olddisplay", y(c.nodeName)))) : (d = db(c, "display"),
            !e[f] && "none" !== d && m._data(c, "olddisplay", d)));
        for (f = 0; f < g; f++)
            if (c = a[f],
            c.style && (!b || "none" === c.style.display || "" === c.style.display))
                c.style.display = b ? e[f] || "" : "none";
        return a
    }
    function v(a, b, c) {
        return (a = Od.exec(b)) ? Math.max(0, a[1] - (c || 0)) + (a[2] || "px") : b
    }
    function x(a, b, c, d) {
        for (var b = c === (d ? "border" : "content") ? 4 : "width" === b ? 1 : 0, e = 0; 4 > b; b += 2)
            "margin" === c && (e += m.css(a, c + rc[b], !0)),
            d ? ("content" === c && (e -= parseFloat(db(a, "padding" + rc[b])) || 0),
            "margin" !== c && (e -= parseFloat(db(a, "border" + rc[b] + "Width")) || 0)) : (e += parseFloat(db(a, "padding" + rc[b])) || 0,
            "padding" !== c && (e += parseFloat(db(a, "border" + rc[b] + "Width")) || 0));
        return e
    }
    function u(a, b, c) {
        var d = "width" === b ? a.offsetWidth : a.offsetHeight
          , e = !0
          , f = m.support.boxSizing && "border-box" === m.css(a, "boxSizing");
        if (0 >= d) {
            d = db(a, b);
            if (0 > d || null == d)
                d = a.style[b];
            if (Vc.test(d))
                return d;
            e = f && (m.support.boxSizingReliable || d === a.style[b]);
            d = parseFloat(d) || 0
        }
        return d + x(a, b, c || (f ? "border" : "content"), e) + "px"
    }
    function y(a) {
        if (kd[a])
            return kd[a];
        var b = m("<" + a + ">").appendTo(D.body)
          , c = b.css("display");
        b.remove();
        if ("none" === c || "" === c) {
            zc = D.body.appendChild(zc || m.extend(D.createElement("iframe"), {
                frameBorder: 0,
                width: 0,
                height: 0
            }));
            if (!Ac || !zc.createElement)
                Ac = (zc.contentWindow || zc.contentDocument).document,
                Ac.write("<!doctype html><html><body>"),
                Ac.close();
            b = Ac.body.appendChild(Ac.createElement(a));
            c = db(b, "display");
            D.body.removeChild(zc)
        }
        return kd[a] = c,
        c
    }
    function E(a, b, c, d) {
        var e;
        if (m.isArray(b))
            m.each(b, function(b, e) {
                c || Pd.test(a) ? d(a, e) : E(a + "[" + ("object" == typeof e ? b : "") + "]", e, c, d)
            });
        else if (!c && "object" === m.type(b))
            for (e in b)
                E(a + "[" + e + "]", b[e], c, d);
        else
            d(a, b)
    }
    function z(a) {
        return function(b, c) {
            "string" != typeof b && (c = b,
            b = "*");
            var d, e, f = b.toLowerCase().split(Ga), g = 0, h = f.length;
            if (m.isFunction(c))
                for (; g < h; g++)
                    d = f[g],
                    (e = /^\+/.test(d)) && (d = d.substr(1) || "*"),
                    d = a[d] = a[d] || [],
                    d[e ? "unshift" : "push"](c)
        }
    }
    function C(a, c, d, e, f, g) {
        f = f || c.dataTypes[0];
        g = g || {};
        g[f] = !0;
        for (var h, f = a[f], i = 0, j = f ? f.length : 0, k = a === sc; i < j && (k || !h); i++)
            h = f[i](c, d, e),
            "string" == typeof h && (!k || g[h] ? h = b : (c.dataTypes.unshift(h),
            h = C(a, c, d, e, h, g)));
        return (k || !h) && !g["*"] && (h = C(a, c, d, e, "*", g)),
        h
    }
    function w(a, c) {
        var d, e, f = m.ajaxSettings.flatOptions || {};
        for (d in c)
            c[d] !== b && ((f[d] ? a : e || (e = {}))[d] = c[d]);
        e && m.extend(!0, a, e)
    }
    function H() {
        try {
            return new a.XMLHttpRequest
        } catch (b) {}
    }
    function L() {
        return setTimeout(function() {
            jb = b
        }, 0),
        jb = m.now()
    }
    function I(a, b) {
        m.each(b, function(b, c) {
            for (var d = (ka[b] || []).concat(ka["*"]), e = 0, f = d.length; e < f && !d[e].call(a, b, c); e++)
                ;
        })
    }
    function P(a, b, c) {
        var d = 0
          , e = W.length
          , f = m.Deferred().always(function() {
            delete g.elem
        })
          , g = function() {
            for (var b = jb || L(), b = Math.max(0, h.startTime + h.duration - b), c = 1 - (b / h.duration || 0), d = 0, e = h.tweens.length; d < e; d++)
                h.tweens[d].run(c);
            return f.notifyWith(a, [h, c, b]),
            1 > c && e ? b : (f.resolveWith(a, [h]),
            !1)
        }
          , h = f.promise({
            elem: a,
            props: m.extend({}, b),
            opts: m.extend(!0, {
                specialEasing: {}
            }, c),
            originalProperties: b,
            originalOptions: c,
            startTime: jb || L(),
            duration: c.duration,
            tweens: [],
            createTween: function(b, c) {
                var d = m.Tween(a, h.opts, b, c, h.opts.specialEasing[b] || h.opts.easing);
                return h.tweens.push(d),
                d
            },
            stop: function(b) {
                for (var c = 0, d = b ? h.tweens.length : 0; c < d; c++)
                    h.tweens[c].run(1);
                return b ? f.resolveWith(a, [h, b]) : f.rejectWith(a, [h, b]),
                this
            }
        })
          , c = h.props;
        for (N(c, h.opts.specialEasing); d < e; d++)
            if (b = W[d].call(h, a, c, h.opts))
                return b;
        return I(h, c),
        m.isFunction(h.opts.start) && h.opts.start.call(a, h),
        m.fx.timer(m.extend(g, {
            anim: h,
            queue: h.opts.queue,
            elem: a
        })),
        h.progress(h.opts.progress).done(h.opts.done, h.opts.complete).fail(h.opts.fail).always(h.opts.always)
    }
    function N(a, b) {
        var c, d, e, f, g;
        for (c in a)
            if (d = m.camelCase(c),
            e = b[d],
            f = a[c],
            m.isArray(f) && (e = f[1],
            f = a[c] = f[0]),
            c !== d && (a[d] = f,
            delete a[c]),
            (g = m.cssHooks[d]) && "expand"in g)
                for (c in f = g.expand(f),
                delete a[d],
                f)
                    c in a || (a[c] = f[c],
                    b[c] = e);
            else
                b[d] = e
    }
    function A(a, b, c, d, e) {
        return new A.prototype.init(a,b,c,d,e)
    }
    function J(a, b) {
        for (var c, d = {
            height: a
        }, e = 0; 4 > e; e += 2 - b)
            c = rc[e],
            d["margin" + c] = d["padding" + c] = a;
        return b && (d.opacity = d.width = a),
        d
    }
    function F(a) {
        return m.isWindow(a) ? a : 9 === a.nodeType ? a.defaultView || a.parentWindow : !1
    }
    var l, Q, D = a.document, B = a.location, T = a.navigator, M = a.jQuery, ea = a.$, ca = Array.prototype.push, ha = Array.prototype.slice, U = Array.prototype.indexOf, X = Object.prototype.toString, aa = Object.prototype.hasOwnProperty, ba = String.prototype.trim, m = function(a, b) {
        return new m.fn.init(a,b,l)
    }, Ha = /[\-+]?(?:\d*\.|)\d+(?:[eE][\-+]?\d+|)/.source, La = /\S/, Ga = /\s+/, Pa = La.test("\u00a0") ? /^[\s\xA0]+|[\s\xA0]+$/g : /^\s+|\s+$/g, Ua = /^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/, Qa = /^<(\w+)\s*\/?>(?:<\/\1>|)$/, Kb = /^[\],:{}\s]*$/, xb = /(?:^|:|,)(?:\s*\[)+/g, ob = /\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g, Lb = /"[^"\\\r\n]*"|true|false|null|-?(?:\d\d*\.|)\d+(?:[eE][\-+]?\d+|)/g, Ab = /^-ms-/, Vb = /-([\da-z])/gi, Va = function(a, b) {
        return (b + "").toUpperCase()
    }, ta = function() {
        D.addEventListener ? (D.removeEventListener("DOMContentLoaded", ta, !1),
        m.ready()) : "complete" === D.readyState && (D.detachEvent("onreadystatechange", ta),
        m.ready())
    }, Ba = {};
    m.fn = m.prototype = {
        constructor: m,
        init: function(a, c, d) {
            var e, f;
            if (!a)
                return this;
            if (a.nodeType)
                return this.context = this[0] = a,
                this.length = 1,
                this;
            if ("string" == typeof a) {
                "<" === a.charAt(0) && ">" === a.charAt(a.length - 1) && 3 <= a.length ? e = [null, a, null] : e = Ua.exec(a);
                if (e && (e[1] || !c)) {
                    if (e[1])
                        return c = c instanceof m ? c[0] : c,
                        f = c && c.nodeType ? c.ownerDocument || c : D,
                        a = m.parseHTML(e[1], f, !0),
                        Qa.test(e[1]) && m.isPlainObject(c) && this.attr.call(a, c, !0),
                        m.merge(this, a);
                    if ((c = D.getElementById(e[2])) && c.parentNode) {
                        if (c.id !== e[2])
                            return d.find(a);
                        this.length = 1;
                        this[0] = c
                    }
                    return this.context = D,
                    this.selector = a,
                    this
                }
                return !c || c.jquery ? (c || d).find(a) : this.constructor(c).find(a)
            }
            return m.isFunction(a) ? d.ready(a) : (a.selector !== b && (this.selector = a.selector,
            this.context = a.context),
            m.makeArray(a, this))
        },
        selector: "",
        jquery: "1.8.0",
        length: 0,
        size: function() {
            return this.length
        },
        toArray: function() {
            return ha.call(this)
        },
        get: function(a) {
            return null == a ? this.toArray() : 0 > a ? this[this.length + a] : this[a]
        },
        pushStack: function(a, b, c) {
            a = m.merge(this.constructor(), a);
            return a.prevObject = this,
            a.context = this.context,
            "find" === b ? a.selector = this.selector + (this.selector ? " " : "") + c : b && (a.selector = this.selector + "." + b + "(" + c + ")"),
            a
        },
        each: function(a, b) {
            return m.each(this, a, b)
        },
        ready: function(a) {
            return m.ready.promise().done(a),
            this
        },
        eq: function(a) {
            return a = +a,
            -1 === a ? this.slice(a) : this.slice(a, a + 1)
        },
        first: function() {
            return this.eq(0)
        },
        last: function() {
            return this.eq(-1)
        },
        slice: function() {
            return this.pushStack(ha.apply(this, arguments), "slice", ha.call(arguments).join(","))
        },
        map: function(a) {
            return this.pushStack(m.map(this, function(b, c) {
                return a.call(b, c, b)
            }))
        },
        end: function() {
            return this.prevObject || this.constructor(null)
        },
        push: ca,
        sort: [].sort,
        splice: [].splice
    };
    m.fn.init.prototype = m.fn;
    m.extend = m.fn.extend = function() {
        var a, c, d, e, f, g, h = arguments[0] || {}, i = 1, j = arguments.length, k = !1;
        "boolean" == typeof h && (k = h,
        h = arguments[1] || {},
        i = 2);
        "object" != typeof h && !m.isFunction(h) && (h = {});
        for (j === i && (h = this,
        --i); i < j; i++)
            if (null != (a = arguments[i]))
                for (c in a)
                    d = h[c],
                    e = a[c],
                    h !== e && (k && e && (m.isPlainObject(e) || (f = m.isArray(e))) ? (f ? (f = !1,
                    g = d && m.isArray(d) ? d : []) : g = d && m.isPlainObject(d) ? d : {},
                    h[c] = m.extend(k, g, e)) : e !== b && (h[c] = e));
        return h
    }
    ;
    m.extend({
        noConflict: function(b) {
            return a.$ === m && (a.$ = ea),
            b && a.jQuery === m && (a.jQuery = M),
            m
        },
        isReady: !1,
        readyWait: 1,
        holdReady: function(a) {
            a ? m.readyWait++ : m.ready(!0)
        },
        ready: function(a) {
            if (!(!0 === a ? --m.readyWait : m.isReady)) {
                if (!D.body)
                    return setTimeout(m.ready, 1);
                m.isReady = !0;
                !0 !== a && 0 < --m.readyWait || (Q.resolveWith(D, [m]),
                m.fn.trigger && m(D).trigger("ready").off("ready"))
            }
        },
        isFunction: function(a) {
            return "function" === m.type(a)
        },
        isArray: Array.isArray || function(a) {
            return "array" === m.type(a)
        }
        ,
        isWindow: function(a) {
            return null != a && a == a.window
        },
        isNumeric: function(a) {
            return !isNaN(parseFloat(a)) && isFinite(a)
        },
        type: function(a) {
            return null == a ? "" + a : Ba[X.call(a)] || "object"
        },
        isPlainObject: function(a) {
            if (!a || "object" !== m.type(a) || a.nodeType || m.isWindow(a))
                return !1;
            try {
                if (a.constructor && !aa.call(a, "constructor") && !aa.call(a.constructor.prototype, "isPrototypeOf"))
                    return !1
            } catch (c) {
                return !1
            }
            for (var d in a)
                ;
            return d === b || aa.call(a, d)
        },
        isEmptyObject: function(a) {
            for (var b in a)
                return !1;
            return !0
        },
        error: function(a) {
            throw Error(a);
        },
        parseHTML: function(a, b, c) {
            var d;
            return !a || "string" != typeof a ? null : ("boolean" == typeof b && (c = b,
            b = 0),
            b = b || D,
            (d = Qa.exec(a)) ? [b.createElement(d[1])] : (d = m.buildFragment([a], b, c ? null : []),
            m.merge([], (d.cacheable ? m.clone(d.fragment) : d.fragment).childNodes)))
        },
        parseJSON: function(b) {
            if (!b || "string" != typeof b)
                return null;
            b = m.trim(b);
            if (a.JSON && a.JSON.parse)
                return a.JSON.parse(b);
            if (Kb.test(b.replace(ob, "@").replace(Lb, "]").replace(xb, "")))
                return (new Function("return " + b))();
            m.error("Invalid JSON: " + b)
        },
        parseXML: function(c) {
            var d, e;
            if (!c || "string" != typeof c)
                return null;
            try {
                a.DOMParser ? (e = new DOMParser,
                d = e.parseFromString(c, "text/xml")) : (d = new ActiveXObject("Microsoft.XMLDOM"),
                d.async = "false",
                d.loadXML(c))
            } catch (f) {
                d = b
            }
            return (!d || !d.documentElement || d.getElementsByTagName("parsererror").length) && m.error("Invalid XML: " + c),
            d
        },
        noop: function() {},
        globalEval: function(b) {
            b && La.test(b) && (a.execScript || function(b) {
                a.eval.call(a, b)
            }
            )(b)
        },
        camelCase: function(a) {
            return a.replace(Ab, "ms-").replace(Vb, Va)
        },
        nodeName: function(a, b) {
            return a.nodeName && a.nodeName.toUpperCase() === b.toUpperCase()
        },
        each: function(a, c, d) {
            var e, f = 0, g = a.length, h = g === b || m.isFunction(a);
            if (d)
                if (h)
                    for (e in a) {
                        if (!1 === c.apply(a[e], d))
                            break
                    }
                else
                    for (; f < g && !1 !== c.apply(a[f++], d); )
                        ;
            else if (h)
                for (e in a) {
                    if (!1 === c.call(a[e], e, a[e]))
                        break
                }
            else
                for (; f < g && !1 !== c.call(a[f], f, a[f++]); )
                    ;
            return a
        },
        trim: ba ? function(a) {
            return null == a ? "" : ba.call(a)
        }
        : function(a) {
            return null == a ? "" : a.toString().replace(Pa, "")
        }
        ,
        makeArray: function(a, b) {
            var c, d = b || [];
            return null != a && (c = m.type(a),
            null == a.length || "string" === c || "function" === c || "regexp" === c || m.isWindow(a) ? ca.call(d, a) : m.merge(d, a)),
            d
        },
        inArray: function(a, b, c) {
            var d;
            if (b) {
                if (U)
                    return U.call(b, a, c);
                d = b.length;
                for (c = c ? 0 > c ? Math.max(0, d + c) : c : 0; c < d; c++)
                    if (c in b && b[c] === a)
                        return c
            }
            return -1
        },
        merge: function(a, c) {
            var d = c.length
              , e = a.length
              , f = 0;
            if ("number" == typeof d)
                for (; f < d; f++)
                    a[e++] = c[f];
            else
                for (; c[f] !== b; )
                    a[e++] = c[f++];
            return a.length = e,
            a
        },
        grep: function(a, b, c) {
            for (var d, e = [], f = 0, g = a.length, c = !!c; f < g; f++)
                d = !!b(a[f], f),
                c !== d && e.push(a[f]);
            return e
        },
        map: function(a, c, d) {
            var e, f, g = [], h = 0, i = a.length;
            if (a instanceof m || i !== b && "number" == typeof i && (0 < i && a[0] && a[i - 1] || 0 === i || m.isArray(a)))
                for (; h < i; h++)
                    e = c(a[h], h, d),
                    null != e && (g[g.length] = e);
            else
                for (f in a)
                    e = c(a[f], f, d),
                    null != e && (g[g.length] = e);
            return g.concat.apply([], g)
        },
        guid: 1,
        proxy: function(a, c) {
            var d, e, f;
            return "string" == typeof c && (d = a[c],
            c = a,
            a = d),
            m.isFunction(a) ? (e = ha.call(arguments, 2),
            f = function() {
                return a.apply(c, e.concat(ha.call(arguments)))
            }
            ,
            f.guid = a.guid = a.guid || f.guid || m.guid++,
            f) : b
        },
        access: function(a, c, d, e, f, g, h) {
            var i, j = null == d, k = 0, n = a.length;
            if (d && "object" == typeof d) {
                for (k in d)
                    m.access(a, c, k, d[k], 1, g, e);
                f = 1
            } else if (e !== b) {
                i = h === b && m.isFunction(e);
                j && (i ? (i = c,
                c = function(a, b, c) {
                    return i.call(m(a), c)
                }
                ) : (c.call(a, e),
                c = null));
                if (c)
                    for (; k < n; k++)
                        c(a[k], d, i ? e.call(a[k], k, c(a[k], d)) : e, h);
                f = 1
            }
            return f ? a : j ? c.call(a) : n ? c(a[0], d) : g
        },
        now: function() {
            return (new Date).getTime()
        }
    });
    m.ready.promise = function(b) {
        if (!Q)
            if (Q = m.Deferred(),
            "complete" === D.readyState || "loading" !== D.readyState && D.addEventListener)
                setTimeout(m.ready, 1);
            else if (D.addEventListener)
                D.addEventListener("DOMContentLoaded", ta, !1),
                a.addEventListener("load", m.ready, !1);
            else {
                D.attachEvent("onreadystatechange", ta);
                a.attachEvent("onload", m.ready);
                var c = !1;
                try {
                    c = null == a.frameElement && D.documentElement
                } catch (d) {}
                c && c.doScroll && function wb() {
                    if (!m.isReady) {
                        try {
                            c.doScroll("left")
                        } catch (a) {
                            return setTimeout(wb, 50)
                        }
                        m.ready()
                    }
                }()
            }
        return Q.promise(b)
    }
    ;
    m.each("Boolean,Number,String,Function,Array,Date,RegExp,Object".split(","), function(a, b) {
        Ba["[object " + b + "]"] = b.toLowerCase()
    });
    l = m(D);
    var bb = {};
    m.Callbacks = function(a) {
        var a = "string" == typeof a ? bb[a] || c(a) : m.extend({}, a), d, e, f, g, h, i, j = [], k = !a.once && [], n = function(b) {
            d = a.memory && b;
            e = !0;
            i = g || 0;
            g = 0;
            h = j.length;
            for (f = !0; j && i < h; i++)
                if (!1 === j[i].apply(b[0], b[1]) && a.stopOnFalse) {
                    d = !1;
                    break
                }
            f = !1;
            j && (k ? k.length && n(k.shift()) : d ? j = [] : l.disable())
        }, l = {
            add: function() {
                if (j) {
                    var b = j.length;
                    (function yb(b) {
                        m.each(b, function(b, c) {
                            m.isFunction(c) && (!a.unique || !l.has(c)) ? j.push(c) : c && c.length && yb(c)
                        })
                    }
                    )(arguments);
                    f ? h = j.length : d && (g = b,
                    n(d))
                }
                return this
            },
            remove: function() {
                return j && m.each(arguments, function(a, b) {
                    for (var c; -1 < (c = m.inArray(b, j, c)); )
                        j.splice(c, 1),
                        f && (c <= h && h--,
                        c <= i && i--)
                }),
                this
            },
            has: function(a) {
                return -1 < m.inArray(a, j)
            },
            empty: function() {
                return j = [],
                this
            },
            disable: function() {
                return j = k = d = b,
                this
            },
            disabled: function() {
                return !j
            },
            lock: function() {
                return k = b,
                d || l.disable(),
                this
            },
            locked: function() {
                return !k
            },
            fireWith: function(a, b) {
                return b = b || [],
                b = [a, b.slice ? b.slice() : b],
                j && (!e || k) && (f ? k.push(b) : n(b)),
                this
            },
            fire: function() {
                return l.fireWith(this, arguments),
                this
            },
            fired: function() {
                return !!e
            }
        };
        return l
    }
    ;
    m.extend({
        Deferred: function(a) {
            var b = [["resolve", "done", m.Callbacks("once memory"), "resolved"], ["reject", "fail", m.Callbacks("once memory"), "rejected"], ["notify", "progress", m.Callbacks("memory")]]
              , c = "pending"
              , d = {
                state: function() {
                    return c
                },
                always: function() {
                    return e.done(arguments).fail(arguments),
                    this
                },
                then: function() {
                    var a = arguments;
                    return m.Deferred(function(c) {
                        m.each(b, function(b, d) {
                            var f = d[0]
                              , g = a[b];
                            e[d[1]](m.isFunction(g) ? function() {
                                var a = g.apply(this, arguments);
                                a && m.isFunction(a.promise) ? a.promise().done(c.resolve).fail(c.reject).progress(c.notify) : c[f + "With"](this === e ? c : this, [a])
                            }
                            : c[f])
                        });
                        a = null
                    }).promise()
                },
                promise: function(a) {
                    return "object" == typeof a ? m.extend(a, d) : d
                }
            }
              , e = {};
            return d.pipe = d.then,
            m.each(b, function(a, f) {
                var g = f[2]
                  , h = f[3];
                d[f[1]] = g.add;
                h && g.add(function() {
                    c = h
                }, b[a ^ 1][2].disable, b[2][2].lock);
                e[f[0]] = g.fire;
                e[f[0] + "With"] = g.fireWith
            }),
            d.promise(e),
            a && a.call(e, e),
            e
        },
        when: function(a) {
            var b = 0, c = ha.call(arguments), d = c.length, e = 1 !== d || a && m.isFunction(a.promise) ? d : 0, f = 1 === e ? a : m.Deferred(), g = function(a, b, c) {
                return function(d) {
                    b[a] = this;
                    c[a] = 1 < arguments.length ? ha.call(arguments) : d;
                    c === h ? f.notifyWith(b, c) : --e || f.resolveWith(b, c)
                }
            }, h, i, j;
            if (1 < d) {
                h = Array(d);
                i = Array(d);
                for (j = Array(d); b < d; b++)
                    c[b] && m.isFunction(c[b].promise) ? c[b].promise().done(g(b, j, c)).fail(f.reject).progress(g(b, i, h)) : --e
            }
            return e || f.resolveWith(j, c),
            f.promise()
        }
    });
    m.support = function() {
        var b, c, d, e, f, g, h, i, j = D.createElement("div");
        j.setAttribute("className", "t");
        j.innerHTML = "  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>";
        c = j.getElementsByTagName("*");
        d = j.getElementsByTagName("a")[0];
        d.style.cssText = "top:1px;float:left;opacity:.5";
        if (!c || !c.length || !d)
            return {};
        e = D.createElement("select");
        f = e.appendChild(D.createElement("option"));
        c = j.getElementsByTagName("input")[0];
        b = {
            leadingWhitespace: 3 === j.firstChild.nodeType,
            tbody: !j.getElementsByTagName("tbody").length,
            htmlSerialize: !!j.getElementsByTagName("link").length,
            style: /top/.test(d.getAttribute("style")),
            hrefNormalized: "/a" === d.getAttribute("href"),
            opacity: /^0.5/.test(d.style.opacity),
            cssFloat: !!d.style.cssFloat,
            checkOn: "on" === c.value,
            optSelected: f.selected,
            getSetAttribute: "t" !== j.className,
            enctype: !!D.createElement("form").enctype,
            html5Clone: "<:nav></:nav>" !== D.createElement("nav").cloneNode(!0).outerHTML,
            boxModel: "CSS1Compat" === D.compatMode,
            submitBubbles: !0,
            changeBubbles: !0,
            focusinBubbles: !1,
            deleteExpando: !0,
            noCloneEvent: !0,
            inlineBlockNeedsLayout: !1,
            shrinkWrapBlocks: !1,
            reliableMarginRight: !0,
            boxSizingReliable: !0,
            pixelPosition: !1
        };
        c.checked = !0;
        b.noCloneChecked = c.cloneNode(!0).checked;
        e.disabled = !0;
        b.optDisabled = !f.disabled;
        try {
            delete j.test
        } catch (k) {
            b.deleteExpando = !1
        }
        !j.addEventListener && j.attachEvent && j.fireEvent && (j.attachEvent("onclick", i = function() {
            b.noCloneEvent = !1
        }
        ),
        j.cloneNode(!0).fireEvent("onclick"),
        j.detachEvent("onclick", i));
        c = D.createElement("input");
        c.value = "t";
        c.setAttribute("type", "radio");
        b.radioValue = "t" === c.value;
        c.setAttribute("checked", "checked");
        c.setAttribute("name", "t");
        j.appendChild(c);
        d = D.createDocumentFragment();
        d.appendChild(j.lastChild);
        b.checkClone = d.cloneNode(!0).cloneNode(!0).lastChild.checked;
        b.appendChecked = c.checked;
        d.removeChild(c);
        d.appendChild(j);
        if (j.attachEvent)
            for (g in {
                submit: !0,
                change: !0,
                focusin: !0
            })
                c = "on" + g,
                (h = c in j) || (j.setAttribute(c, "return;"),
                h = "function" == typeof j[c]),
                b[g + "Bubbles"] = h;
        return m(function() {
            var c, d, e, f, g = D.getElementsByTagName("body")[0];
            g && (c = D.createElement("div"),
            c.style.cssText = "visibility:hidden;border:0;width:0;height:0;position:static;top:0;margin-top:1px",
            g.insertBefore(c, g.firstChild),
            d = D.createElement("div"),
            c.appendChild(d),
            d.innerHTML = "<table><tr><td></td><td>t</td></tr></table>",
            e = d.getElementsByTagName("td"),
            e[0].style.cssText = "padding:0;margin:0;border:0;display:none",
            h = 0 === e[0].offsetHeight,
            e[0].style.display = "",
            e[1].style.display = "none",
            b.reliableHiddenOffsets = h && 0 === e[0].offsetHeight,
            d.innerHTML = "",
            d.style.cssText = "box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;",
            b.boxSizing = 4 === d.offsetWidth,
            b.doesNotIncludeMarginInBodyOffset = 1 !== g.offsetTop,
            a.getComputedStyle && (b.pixelPosition = "1%" !== (a.getComputedStyle(d, null) || {}).top,
            b.boxSizingReliable = "4px" === (a.getComputedStyle(d, null) || {
                width: "4px"
            }).width,
            f = D.createElement("div"),
            f.style.cssText = d.style.cssText = "padding:0;margin:0;border:0;display:block;overflow:hidden;",
            f.style.marginRight = f.style.width = "0",
            d.style.width = "1px",
            d.appendChild(f),
            b.reliableMarginRight = !parseFloat((a.getComputedStyle(f, null) || {}).marginRight)),
            "undefined" != typeof d.style.zoom && (d.innerHTML = "",
            d.style.cssText = "padding:0;margin:0;border:0;display:block;overflow:hidden;width:1px;padding:1px;display:inline;zoom:1",
            b.inlineBlockNeedsLayout = 3 === d.offsetWidth,
            d.style.display = "block",
            d.style.overflow = "visible",
            d.innerHTML = "<div></div>",
            d.firstChild.style.width = "5px",
            b.shrinkWrapBlocks = 3 !== d.offsetWidth,
            c.style.zoom = 1),
            g.removeChild(c))
        }),
        d.removeChild(j),
        c = d = e = f = c = d = j = null,
        b
    }();
    var da = /^(?:\{.*\}|\[.*\])$/
      , Ta = /([A-Z])/g;
    m.extend({
        cache: {},
        deletedIds: [],
        uuid: 0,
        expando: "jQuery" + (m.fn.jquery + Math.random()).replace(/\D/g, ""),
        noData: {
            embed: !0,
            object: "clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",
            applet: !0
        },
        hasData: function(a) {
            return a = a.nodeType ? m.cache[a[m.expando]] : a[m.expando],
            !!a && !e(a)
        },
        data: function(a, c, d, e) {
            if (m.acceptData(a)) {
                var f, g, h = m.expando, i = "string" == typeof c, j = a.nodeType, k = j ? m.cache : a, n = j ? a[h] : a[h] && h;
                if (n && k[n] && (e || k[n].data) || !(i && d === b)) {
                    n || (j ? a[h] = n = m.deletedIds.pop() || ++m.uuid : n = h);
                    k[n] || (k[n] = {},
                    j || (k[n].toJSON = m.noop));
                    if ("object" == typeof c || "function" == typeof c)
                        e ? k[n] = m.extend(k[n], c) : k[n].data = m.extend(k[n].data, c);
                    return f = k[n],
                    e || (f.data || (f.data = {}),
                    f = f.data),
                    d !== b && (f[m.camelCase(c)] = d),
                    i ? (g = f[c],
                    null == g && (g = f[m.camelCase(c)])) : g = f,
                    g
                }
            }
        },
        removeData: function(a, b, c) {
            if (m.acceptData(a)) {
                var d, f, g, h = a.nodeType, i = h ? m.cache : a, j = h ? a[m.expando] : m.expando;
                if (i[j]) {
                    if (b && (d = c ? i[j] : i[j].data)) {
                        m.isArray(b) || (b in d ? b = [b] : (b = m.camelCase(b),
                        b in d ? b = [b] : b = b.split(" ")));
                        f = 0;
                        for (g = b.length; f < g; f++)
                            delete d[b[f]];
                        if (!(c ? e : m.isEmptyObject)(d))
                            return
                    }
                    if (!c && (delete i[j].data,
                    !e(i[j])))
                        return;
                    h ? m.cleanData([a], !0) : m.support.deleteExpando || i != i.window ? delete i[j] : i[j] = null
                }
            }
        },
        _data: function(a, b, c) {
            return m.data(a, b, c, !0)
        },
        acceptData: function(a) {
            var b = a.nodeName && m.noData[a.nodeName.toLowerCase()];
            return !b || !0 !== b && a.getAttribute("classid") === b
        }
    });
    m.fn.extend({
        data: function(a, c) {
            var e, f, g, h, i, j = this[0], k = 0, n = null;
            if (a === b) {
                if (this.length && (n = m.data(j),
                1 === j.nodeType && !m._data(j, "parsedAttrs"))) {
                    g = j.attributes;
                    for (i = g.length; k < i; k++)
                        h = g[k].name,
                        0 === h.indexOf("data-") && (h = m.camelCase(h.substring(5)),
                        d(j, h, n[h]));
                    m._data(j, "parsedAttrs", !0)
                }
                return n
            }
            return "object" == typeof a ? this.each(function() {
                m.data(this, a)
            }) : (e = a.split(".", 2),
            e[1] = e[1] ? "." + e[1] : "",
            f = e[1] + "!",
            m.access(this, function(c) {
                if (c === b)
                    return n = this.triggerHandler("getData" + f, [e[0]]),
                    n === b && j && (n = m.data(j, a),
                    n = d(j, a, n)),
                    n === b && e[1] ? this.data(e[0]) : n;
                e[1] = c;
                this.each(function() {
                    var b = m(this);
                    b.triggerHandler("setData" + f, e);
                    m.data(this, a, c);
                    b.triggerHandler("changeData" + f, e)
                })
            }, null, c, 1 < arguments.length, null, !1))
        },
        removeData: function(a) {
            return this.each(function() {
                m.removeData(this, a)
            })
        }
    });
    m.extend({
        queue: function(a, b, c) {
            var d;
            if (a)
                return b = (b || "fx") + "queue",
                d = m._data(a, b),
                c && (!d || m.isArray(c) ? d = m._data(a, b, m.makeArray(c)) : d.push(c)),
                d || []
        },
        dequeue: function(a, b) {
            var b = b || "fx"
              , c = m.queue(a, b)
              , d = c.shift()
              , e = m._queueHooks(a, b)
              , f = function() {
                m.dequeue(a, b)
            };
            "inprogress" === d && (d = c.shift());
            d && ("fx" === b && c.unshift("inprogress"),
            delete e.stop,
            d.call(a, f, e));
            !c.length && e && e.empty.fire()
        },
        _queueHooks: function(a, b) {
            var c = b + "queueHooks";
            return m._data(a, c) || m._data(a, c, {
                empty: m.Callbacks("once memory").add(function() {
                    m.removeData(a, b + "queue", !0);
                    m.removeData(a, c, !0)
                })
            })
        }
    });
    m.fn.extend({
        queue: function(a, c) {
            var d = 2;
            return "string" != typeof a && (c = a,
            a = "fx",
            d--),
            arguments.length < d ? m.queue(this[0], a) : c === b ? this : this.each(function() {
                var b = m.queue(this, a, c);
                m._queueHooks(this, a);
                "fx" === a && "inprogress" !== b[0] && m.dequeue(this, a)
            })
        },
        dequeue: function(a) {
            return this.each(function() {
                m.dequeue(this, a)
            })
        },
        delay: function(a, b) {
            return a = m.fx ? m.fx.speeds[a] || a : a,
            b = b || "fx",
            this.queue(b, function(b, c) {
                var d = setTimeout(b, a);
                c.stop = function() {
                    clearTimeout(d)
                }
            })
        },
        clearQueue: function(a) {
            return this.queue(a || "fx", [])
        },
        promise: function(a, c) {
            var d, e = 1, f = m.Deferred(), g = this, h = this.length, i = function() {
                --e || f.resolveWith(g, [g])
            };
            "string" != typeof a && (c = a,
            a = b);
            for (a = a || "fx"; h--; )
                (d = m._data(g[h], a + "queueHooks")) && d.empty && (e++,
                d.empty.add(i));
            return i(),
            f.promise(c)
        }
    });
    var Ra, ra, kb, pa = /[\t\r\n]/g, Wb = /\r/g, la = /^(?:button|input)$/i, pb = /^(?:button|input|object|select|textarea)$/i, Pb = /^a(?:rea|)$/i, sa = /^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i, Bc = m.support.getSetAttribute;
    m.fn.extend({
        attr: function(a, b) {
            return m.access(this, m.attr, a, b, 1 < arguments.length)
        },
        removeAttr: function(a) {
            return this.each(function() {
                m.removeAttr(this, a)
            })
        },
        prop: function(a, b) {
            return m.access(this, m.prop, a, b, 1 < arguments.length)
        },
        removeProp: function(a) {
            return a = m.propFix[a] || a,
            this.each(function() {
                try {
                    this[a] = b,
                    delete this[a]
                } catch (c) {}
            })
        },
        addClass: function(a) {
            var b, c, d, e, f, g, h;
            if (m.isFunction(a))
                return this.each(function(b) {
                    m(this).addClass(a.call(this, b, this.className))
                });
            if (a && "string" == typeof a) {
                b = a.split(Ga);
                c = 0;
                for (d = this.length; c < d; c++)
                    if (e = this[c],
                    1 === e.nodeType)
                        if (!e.className && 1 === b.length)
                            e.className = a;
                        else {
                            f = " " + e.className + " ";
                            g = 0;
                            for (h = b.length; g < h; g++)
                                ~f.indexOf(" " + b[g] + " ") || (f += b[g] + " ");
                            e.className = m.trim(f)
                        }
            }
            return this
        },
        removeClass: function(a) {
            var c, d, e, f, g, h, i;
            if (m.isFunction(a))
                return this.each(function(b) {
                    m(this).removeClass(a.call(this, b, this.className))
                });
            if (a && "string" == typeof a || a === b) {
                c = (a || "").split(Ga);
                h = 0;
                for (i = this.length; h < i; h++)
                    if (e = this[h],
                    1 === e.nodeType && e.className) {
                        d = (" " + e.className + " ").replace(pa, " ");
                        f = 0;
                        for (g = c.length; f < g; f++)
                            for (; -1 < d.indexOf(" " + c[f] + " "); )
                                d = d.replace(" " + c[f] + " ", " ");
                        e.className = a ? m.trim(d) : ""
                    }
            }
            return this
        },
        toggleClass: function(a, b) {
            var c = typeof a
              , d = "boolean" == typeof b;
            return m.isFunction(a) ? this.each(function(c) {
                m(this).toggleClass(a.call(this, c, this.className, b), b)
            }) : this.each(function() {
                if ("string" === c)
                    for (var e, f = 0, g = m(this), h = b, i = a.split(Ga); e = i[f++]; )
                        h = d ? h : !g.hasClass(e),
                        g[h ? "addClass" : "removeClass"](e);
                else if ("undefined" === c || "boolean" === c)
                    this.className && m._data(this, "__className__", this.className),
                    this.className = this.className || !1 === a ? "" : m._data(this, "__className__") || ""
            })
        },
        hasClass: function(a) {
            for (var a = " " + a + " ", b = 0, c = this.length; b < c; b++)
                if (1 === this[b].nodeType && -1 < (" " + this[b].className + " ").replace(pa, " ").indexOf(a))
                    return !0;
            return !1
        },
        val: function(a) {
            var c, d, e, f = this[0];
            if (arguments.length)
                return e = m.isFunction(a),
                this.each(function(d) {
                    var f, g = m(this);
                    if (1 === this.nodeType && (e ? f = a.call(this, d, g.val()) : f = a,
                    null == f ? f = "" : "number" == typeof f ? f += "" : m.isArray(f) && (f = m.map(f, function(a) {
                        return a == null ? "" : a + ""
                    })),
                    c = m.valHooks[this.type] || m.valHooks[this.nodeName.toLowerCase()],
                    !c || !("set"in c) || c.set(this, f, "value") === b))
                        this.value = f
                });
            if (f)
                return c = m.valHooks[f.type] || m.valHooks[f.nodeName.toLowerCase()],
                c && "get"in c && (d = c.get(f, "value")) !== b ? d : (d = f.value,
                "string" == typeof d ? d.replace(Wb, "") : null == d ? "" : d)
        }
    });
    m.extend({
        valHooks: {
            option: {
                get: function(a) {
                    var b = a.attributes.value;
                    return !b || b.specified ? a.value : a.text
                }
            },
            select: {
                get: function(a) {
                    var b, c, d = a.selectedIndex, e = [], f = a.options, g = "select-one" === a.type;
                    if (0 > d)
                        return null;
                    a = g ? d : 0;
                    for (c = g ? d + 1 : f.length; a < c; a++)
                        if (b = f[a],
                        b.selected && (m.support.optDisabled ? !b.disabled : null === b.getAttribute("disabled")) && (!b.parentNode.disabled || !m.nodeName(b.parentNode, "optgroup"))) {
                            b = m(b).val();
                            if (g)
                                return b;
                            e.push(b)
                        }
                    return g && !e.length && f.length ? m(f[d]).val() : e
                },
                set: function(a, b) {
                    var c = m.makeArray(b);
                    return m(a).find("option").each(function() {
                        this.selected = 0 <= m.inArray(m(this).val(), c)
                    }),
                    c.length || (a.selectedIndex = -1),
                    c
                }
            }
        },
        attrFn: {},
        attr: function(a, c, d, e) {
            var f, g, h = a.nodeType;
            if (a && !(3 === h || 8 === h || 2 === h)) {
                if (e && m.isFunction(m.fn[c]))
                    return m(a)[c](d);
                if ("undefined" == typeof a.getAttribute)
                    return m.prop(a, c, d);
                (e = 1 !== h || !m.isXMLDoc(a)) && (c = c.toLowerCase(),
                g = m.attrHooks[c] || (sa.test(c) ? ra : Ra));
                if (d !== b) {
                    if (null === d) {
                        m.removeAttr(a, c);
                        return
                    }
                    return g && "set"in g && e && (f = g.set(a, d, c)) !== b ? f : (a.setAttribute(c, "" + d),
                    d)
                }
                return g && "get"in g && e && null !== (f = g.get(a, c)) ? f : (f = a.getAttribute(c),
                null === f ? b : f)
            }
        },
        removeAttr: function(a, b) {
            var c, d, e, f, g = 0;
            if (b && 1 === a.nodeType)
                for (d = b.split(Ga); g < d.length; g++)
                    (e = d[g]) && (c = m.propFix[e] || e,
                    f = sa.test(e),
                    f || m.attr(a, e, ""),
                    a.removeAttribute(Bc ? e : c),
                    f && c in a && (a[c] = !1))
        },
        attrHooks: {
            type: {
                set: function(a, b) {
                    if (la.test(a.nodeName) && a.parentNode)
                        m.error("type property can't be changed");
                    else if (!m.support.radioValue && "radio" === b && m.nodeName(a, "input")) {
                        var c = a.value;
                        return a.setAttribute("type", b),
                        c && (a.value = c),
                        b
                    }
                }
            },
            value: {
                get: function(a, b) {
                    return Ra && m.nodeName(a, "button") ? Ra.get(a, b) : b in a ? a.value : null
                },
                set: function(a, b, c) {
                    if (Ra && m.nodeName(a, "button"))
                        return Ra.set(a, b, c);
                    a.value = b
                }
            }
        },
        propFix: {
            tabindex: "tabIndex",
            readonly: "readOnly",
            "for": "htmlFor",
            "class": "className",
            maxlength: "maxLength",
            cellspacing: "cellSpacing",
            cellpadding: "cellPadding",
            rowspan: "rowSpan",
            colspan: "colSpan",
            usemap: "useMap",
            frameborder: "frameBorder",
            contenteditable: "contentEditable"
        },
        prop: function(a, c, d) {
            var e, f, g, h = a.nodeType;
            return !a || 3 === h || 8 === h || 2 === h ? void 0 : (g = 1 !== h || !m.isXMLDoc(a),
            g && (c = m.propFix[c] || c,
            f = m.propHooks[c]),
            d !== b ? f && "set"in f && (e = f.set(a, d, c)) !== b ? e : a[c] = d : f && "get"in f && null !== (e = f.get(a, c)) ? e : a[c])
        },
        propHooks: {
            tabIndex: {
                get: function(a) {
                    var c = a.getAttributeNode("tabindex");
                    return c && c.specified ? parseInt(c.value, 10) : pb.test(a.nodeName) || Pb.test(a.nodeName) && a.href ? 0 : b
                }
            }
        }
    });
    ra = {
        get: function(a, c) {
            var d, e = m.prop(a, c);
            return !0 === e || "boolean" != typeof e && (d = a.getAttributeNode(c)) && !1 !== d.nodeValue ? c.toLowerCase() : b
        },
        set: function(a, b, c) {
            var d;
            return !1 === b ? m.removeAttr(a, c) : (d = m.propFix[c] || c,
            d in a && (a[d] = !0),
            a.setAttribute(c, c.toLowerCase())),
            c
        }
    };
    Bc || (kb = {
        name: !0,
        id: !0,
        coords: !0
    },
    Ra = m.valHooks.button = {
        get: function(a, c) {
            var d;
            return d = a.getAttributeNode(c),
            d && (kb[c] ? "" !== d.value : d.specified) ? d.value : b
        },
        set: function(a, b, c) {
            var d = a.getAttributeNode(c);
            return d || (d = D.createAttribute(c),
            a.setAttributeNode(d)),
            d.value = b + ""
        }
    },
    m.each(["width", "height"], function(a, b) {
        m.attrHooks[b] = m.extend(m.attrHooks[b], {
            set: function(a, c) {
                if ("" === c)
                    return a.setAttribute(b, "auto"),
                    c
            }
        })
    }),
    m.attrHooks.contenteditable = {
        get: Ra.get,
        set: function(a, b, c) {
            "" === b && (b = "false");
            Ra.set(a, b, c)
        }
    });
    m.support.hrefNormalized || m.each(["href", "src", "width", "height"], function(a, c) {
        m.attrHooks[c] = m.extend(m.attrHooks[c], {
            get: function(a) {
                a = a.getAttribute(c, 2);
                return null === a ? b : a
            }
        })
    });
    m.support.style || (m.attrHooks.style = {
        get: function(a) {
            return a.style.cssText.toLowerCase() || b
        },
        set: function(a, b) {
            return a.style.cssText = "" + b
        }
    });
    m.support.optSelected || (m.propHooks.selected = m.extend(m.propHooks.selected, {
        get: function(a) {
            a = a.parentNode;
            return a && (a.selectedIndex,
            a.parentNode && a.parentNode.selectedIndex),
            null
        }
    }));
    m.support.enctype || (m.propFix.enctype = "encoding");
    m.support.checkOn || m.each(["radio", "checkbox"], function() {
        m.valHooks[this] = {
            get: function(a) {
                return null === a.getAttribute("value") ? "on" : a.value
            }
        }
    });
    m.each(["radio", "checkbox"], function() {
        m.valHooks[this] = m.extend(m.valHooks[this], {
            set: function(a, b) {
                if (m.isArray(b))
                    return a.checked = 0 <= m.inArray(m(a).val(), b)
            }
        })
    });
    var Wc = /^(?:textarea|input|select)$/i
      , Cc = /^([^\.]*|)(?:\.(.+)|)$/
      , Qd = /(?:^|\s)hover(\.\S+|)\b/
      , Rd = /^key/
      , Sd = /^(?:mouse|contextmenu)|click/
      , yd = /^(?:focusinfocus|focusoutblur)$/
      , zd = function(a) {
        return m.event.special.hover ? a : a.replace(Qd, "mouseenter$1 mouseleave$1")
    };
    m.event = {
        add: function(a, c, d, e, f) {
            var g, h, i, j, k, n, l, o, p;
            if (!(3 === a.nodeType || 8 === a.nodeType || !c || !d || !(g = m._data(a)))) {
                d.handler && (l = d,
                d = l.handler,
                f = l.selector);
                d.guid || (d.guid = m.guid++);
                (i = g.events) || (g.events = i = {});
                (h = g.handle) || (g.handle = h = function(a) {
                    return "undefined" != typeof m && (!a || m.event.triggered !== a.type) ? m.event.dispatch.apply(h.elem, arguments) : b
                }
                ,
                h.elem = a);
                c = m.trim(zd(c)).split(" ");
                for (g = 0; g < c.length; g++) {
                    j = Cc.exec(c[g]) || [];
                    k = j[1];
                    n = (j[2] || "").split(".").sort();
                    p = m.event.special[k] || {};
                    k = (f ? p.delegateType : p.bindType) || k;
                    p = m.event.special[k] || {};
                    j = m.extend({
                        type: k,
                        origType: j[1],
                        data: e,
                        handler: d,
                        guid: d.guid,
                        selector: f,
                        namespace: n.join(".")
                    }, l);
                    o = i[k];
                    if (!o && (o = i[k] = [],
                    o.delegateCount = 0,
                    !p.setup || !1 === p.setup.call(a, e, n, h)))
                        a.addEventListener ? a.addEventListener(k, h, !1) : a.attachEvent && a.attachEvent("on" + k, h);
                    p.add && (p.add.call(a, j),
                    j.handler.guid || (j.handler.guid = d.guid));
                    f ? o.splice(o.delegateCount++, 0, j) : o.push(j);
                    m.event.global[k] = !0
                }
                a = null
            }
        },
        global: {},
        remove: function(a, b, c, d, e) {
            var f, g, h, i, j, k, n, l, p, o, q = m.hasData(a) && m._data(a);
            if (q && (n = q.events)) {
                b = m.trim(zd(b || "")).split(" ");
                for (f = 0; f < b.length; f++)
                    if (g = Cc.exec(b[f]) || [],
                    h = i = g[1],
                    g = g[2],
                    h) {
                        l = m.event.special[h] || {};
                        h = (d ? l.delegateType : l.bindType) || h;
                        p = n[h] || [];
                        j = p.length;
                        g = g ? RegExp("(^|\\.)" + g.split(".").sort().join("\\.(?:.*\\.|)") + "(\\.|$)") : null;
                        for (k = 0; k < p.length; k++)
                            o = p[k],
                            (e || i === o.origType) && (!c || c.guid === o.guid) && (!g || g.test(o.namespace)) && (!d || d === o.selector || "**" === d && o.selector) && (p.splice(k--, 1),
                            o.selector && p.delegateCount--,
                            l.remove && l.remove.call(a, o));
                        0 === p.length && j !== p.length && ((!l.teardown || !1 === l.teardown.call(a, g, q.handle)) && m.removeEvent(a, h, q.handle),
                        delete n[h])
                    } else
                        for (h in n)
                            m.event.remove(a, h + b[f], c, d, !0);
                m.isEmptyObject(n) && (delete q.handle,
                m.removeData(a, "events", !0))
            }
        },
        customEvent: {
            getData: !0,
            setData: !0,
            changeData: !0
        },
        trigger: function(c, d, e, f) {
            if (!e || 3 !== e.nodeType && 8 !== e.nodeType) {
                var g, h, i, j, k, n, l, p = c.type || c;
                j = [];
                if (!yd.test(p + m.event.triggered) && (0 <= p.indexOf("!") && (p = p.slice(0, -1),
                g = !0),
                0 <= p.indexOf(".") && (j = p.split("."),
                p = j.shift(),
                j.sort()),
                e && !m.event.customEvent[p] || m.event.global[p]))
                    if (c = "object" == typeof c ? c[m.expando] ? c : new m.Event(p,c) : new m.Event(p),
                    c.type = p,
                    c.isTrigger = !0,
                    c.exclusive = g,
                    c.namespace = j.join("."),
                    c.namespace_re = c.namespace ? RegExp("(^|\\.)" + j.join("\\.(?:.*\\.|)") + "(\\.|$)") : null,
                    j = 0 > p.indexOf(":") ? "on" + p : "",
                    e) {
                        if (c.result = b,
                        c.target || (c.target = e),
                        d = null != d ? m.makeArray(d) : [],
                        d.unshift(c),
                        k = m.event.special[p] || {},
                        !(k.trigger && !1 === k.trigger.apply(e, d))) {
                            l = [[e, k.bindType || p]];
                            if (!f && !k.noBubble && !m.isWindow(e)) {
                                h = k.delegateType || p;
                                g = yd.test(h + p) ? e : e.parentNode;
                                for (i = e; g; g = g.parentNode)
                                    l.push([g, h]),
                                    i = g;
                                i === (e.ownerDocument || D) && l.push([i.defaultView || i.parentWindow || a, h])
                            }
                            for (h = 0; h < l.length && !c.isPropagationStopped(); h++)
                                g = l[h][0],
                                c.type = l[h][1],
                                (n = (m._data(g, "events") || {})[c.type] && m._data(g, "handle")) && n.apply(g, d),
                                (n = j && g[j]) && m.acceptData(g) && !1 === n.apply(g, d) && c.preventDefault();
                            return c.type = p,
                            !f && !c.isDefaultPrevented() && (!k._default || !1 === k._default.apply(e.ownerDocument, d)) && ("click" !== p || !m.nodeName(e, "a")) && m.acceptData(e) && j && e[p] && ("focus" !== p && "blur" !== p || 0 !== c.target.offsetWidth) && !m.isWindow(e) && (i = e[j],
                            i && (e[j] = null),
                            m.event.triggered = p,
                            e[p](),
                            m.event.triggered = b,
                            i && (e[j] = i)),
                            c.result
                        }
                    } else
                        for (h in e = m.cache,
                        e)
                            e[h].events && e[h].events[p] && m.event.trigger(c, d, e[h].handle.elem, !0)
            }
        },
        dispatch: function(c) {
            var c = m.event.fix(c || a.event), d, e, f, g, h, i, j, k = (m._data(this, "events") || {})[c.type] || [], n = k.delegateCount, l = [].slice.call(arguments), p = !c.exclusive && !c.namespace, o = m.event.special[c.type] || {}, q = [];
            l[0] = c;
            c.delegateTarget = this;
            if (!(o.preDispatch && !1 === o.preDispatch.call(this, c))) {
                if (n && (!c.button || "click" !== c.type)) {
                    f = m(this);
                    f.context = this;
                    for (e = c.target; e != this; e = e.parentNode || this)
                        if (!0 !== e.disabled || "click" !== c.type) {
                            h = {};
                            i = [];
                            f[0] = e;
                            for (d = 0; d < n; d++)
                                g = k[d],
                                j = g.selector,
                                h[j] === b && (h[j] = f.is(j)),
                                h[j] && i.push(g);
                            i.length && q.push({
                                elem: e,
                                matches: i
                            })
                        }
                }
                k.length > n && q.push({
                    elem: this,
                    matches: k.slice(n)
                });
                for (d = 0; d < q.length && !c.isPropagationStopped(); d++) {
                    f = q[d];
                    c.currentTarget = f.elem;
                    for (e = 0; e < f.matches.length && !c.isImmediatePropagationStopped(); e++)
                        if (g = f.matches[e],
                        p || !c.namespace && !g.namespace || c.namespace_re && c.namespace_re.test(g.namespace))
                            c.data = g.data,
                            c.handleObj = g,
                            g = ((m.event.special[g.origType] || {}).handle || g.handler).apply(f.elem, l),
                            g !== b && (c.result = g,
                            !1 === g && (c.preventDefault(),
                            c.stopPropagation()))
                }
                return o.postDispatch && o.postDispatch.call(this, c),
                c.result
            }
        },
        props: "attrChange,attrName,relatedNode,srcElement,altKey,bubbles,cancelable,ctrlKey,currentTarget,eventPhase,metaKey,relatedTarget,shiftKey,target,timeStamp,view,which".split(","),
        fixHooks: {},
        keyHooks: {
            props: ["char", "charCode", "key", "keyCode"],
            filter: function(a, b) {
                return null == a.which && (a.which = null != b.charCode ? b.charCode : b.keyCode),
                a
            }
        },
        mouseHooks: {
            props: "button,buttons,clientX,clientY,fromElement,offsetX,offsetY,pageX,pageY,screenX,screenY,toElement".split(","),
            filter: function(a, c) {
                var d, e, f, g = c.button, h = c.fromElement;
                return null == a.pageX && null != c.clientX && (d = a.target.ownerDocument || D,
                e = d.documentElement,
                f = d.body,
                a.pageX = c.clientX + (e && e.scrollLeft || f && f.scrollLeft || 0) - (e && e.clientLeft || f && f.clientLeft || 0),
                a.pageY = c.clientY + (e && e.scrollTop || f && f.scrollTop || 0) - (e && e.clientTop || f && f.clientTop || 0)),
                !a.relatedTarget && h && (a.relatedTarget = h === a.target ? c.toElement : h),
                !a.which && g !== b && (a.which = g & 1 ? 1 : g & 2 ? 3 : g & 4 ? 2 : 0),
                a
            }
        },
        fix: function(a) {
            if (a[m.expando])
                return a;
            var b, c, d = a, e = m.event.fixHooks[a.type] || {}, f = e.props ? this.props.concat(e.props) : this.props, a = m.Event(d);
            for (b = f.length; b; )
                c = f[--b],
                a[c] = d[c];
            return a.target || (a.target = d.srcElement || D),
            3 === a.target.nodeType && (a.target = a.target.parentNode),
            a.metaKey = !!a.metaKey,
            e.filter ? e.filter(a, d) : a
        },
        special: {
            ready: {
                setup: m.bindReady
            },
            load: {
                noBubble: !0
            },
            focus: {
                delegateType: "focusin"
            },
            blur: {
                delegateType: "focusout"
            },
            beforeunload: {
                setup: function(a, b, c) {
                    m.isWindow(this) && (this.onbeforeunload = c)
                },
                teardown: function(a, b) {
                    this.onbeforeunload === b && (this.onbeforeunload = null)
                }
            }
        },
        simulate: function(a, b, c, d) {
            a = m.extend(new m.Event, c, {
                type: a,
                isSimulated: !0,
                originalEvent: {}
            });
            d ? m.event.trigger(a, null, b) : m.event.dispatch.call(b, a);
            a.isDefaultPrevented() && c.preventDefault()
        }
    };
    m.event.handle = m.event.dispatch;
    m.removeEvent = D.removeEventListener ? function(a, b, c) {
        a.removeEventListener && a.removeEventListener(b, c, !1)
    }
    : function(a, b, c) {
        b = "on" + b;
        a.detachEvent && ("undefined" == typeof a[b] && (a[b] = null),
        a.detachEvent(b, c))
    }
    ;
    m.Event = function(a, b) {
        if (this instanceof m.Event)
            a && a.type ? (this.originalEvent = a,
            this.type = a.type,
            this.isDefaultPrevented = a.defaultPrevented || !1 === a.returnValue || a.getPreventDefault && a.getPreventDefault() ? g : f) : this.type = a,
            b && m.extend(this, b),
            this.timeStamp = a && a.timeStamp || m.now(),
            this[m.expando] = !0;
        else
            return new m.Event(a,b)
    }
    ;
    m.Event.prototype = {
        preventDefault: function() {
            this.isDefaultPrevented = g;
            var a = this.originalEvent;
            a && (a.preventDefault ? a.preventDefault() : a.returnValue = !1)
        },
        stopPropagation: function() {
            this.isPropagationStopped = g;
            var a = this.originalEvent;
            a && (a.stopPropagation && a.stopPropagation(),
            a.cancelBubble = !0)
        },
        stopImmediatePropagation: function() {
            this.isImmediatePropagationStopped = g;
            this.stopPropagation()
        },
        isDefaultPrevented: f,
        isPropagationStopped: f,
        isImmediatePropagationStopped: f
    };
    m.each({
        mouseenter: "mouseover",
        mouseleave: "mouseout"
    }, function(a, b) {
        m.event.special[a] = {
            delegateType: b,
            bindType: b,
            handle: function(a) {
                var c, d = a.relatedTarget, e = a.handleObj;
                if (!d || d !== this && !m.contains(this, d))
                    a.type = e.origType,
                    c = e.handler.apply(this, arguments),
                    a.type = b;
                return c
            }
        }
    });
    m.support.submitBubbles || (m.event.special.submit = {
        setup: function() {
            if (m.nodeName(this, "form"))
                return !1;
            m.event.add(this, "click._submit keypress._submit", function(a) {
                a = a.target;
                (a = m.nodeName(a, "input") || m.nodeName(a, "button") ? a.form : b) && !m._data(a, "_submit_attached") && (m.event.add(a, "submit._submit", function(a) {
                    a._submit_bubble = !0
                }),
                m._data(a, "_submit_attached", !0))
            })
        },
        postDispatch: function(a) {
            a._submit_bubble && (delete a._submit_bubble,
            this.parentNode && !a.isTrigger && m.event.simulate("submit", this.parentNode, a, !0))
        },
        teardown: function() {
            if (m.nodeName(this, "form"))
                return !1;
            m.event.remove(this, "._submit")
        }
    });
    m.support.changeBubbles || (m.event.special.change = {
        setup: function() {
            if (Wc.test(this.nodeName)) {
                if ("checkbox" === this.type || "radio" === this.type)
                    m.event.add(this, "propertychange._change", function(a) {
                        "checked" === a.originalEvent.propertyName && (this._just_changed = !0)
                    }),
                    m.event.add(this, "click._change", function(a) {
                        this._just_changed && !a.isTrigger && (this._just_changed = !1);
                        m.event.simulate("change", this, a, !0)
                    });
                return !1
            }
            m.event.add(this, "beforeactivate._change", function(a) {
                a = a.target;
                Wc.test(a.nodeName) && !m._data(a, "_change_attached") && (m.event.add(a, "change._change", function(a) {
                    this.parentNode && !a.isSimulated && !a.isTrigger && m.event.simulate("change", this.parentNode, a, !0)
                }),
                m._data(a, "_change_attached", !0))
            })
        },
        handle: function(a) {
            var b = a.target;
            if (this !== b || a.isSimulated || a.isTrigger || "radio" !== b.type && "checkbox" !== b.type)
                return a.handleObj.handler.apply(this, arguments)
        },
        teardown: function() {
            return m.event.remove(this, "._change"),
            Wc.test(this.nodeName)
        }
    });
    m.support.focusinBubbles || m.each({
        focus: "focusin",
        blur: "focusout"
    }, function(a, b) {
        var c = 0
          , d = function(a) {
            m.event.simulate(b, a.target, m.event.fix(a), !0)
        };
        m.event.special[b] = {
            setup: function() {
                0 === c++ && D.addEventListener(a, d, !0)
            },
            teardown: function() {
                0 === --c && D.removeEventListener(a, d, !0)
            }
        }
    });
    m.fn.extend({
        on: function(a, c, d, e, g) {
            var h, i;
            if ("object" == typeof a) {
                "string" != typeof c && (d = d || c,
                c = b);
                for (i in a)
                    this.on(i, c, d, a[i], g);
                return this
            }
            null == d && null == e ? (e = c,
            d = c = b) : null == e && ("string" == typeof c ? (e = d,
            d = b) : (e = d,
            d = c,
            c = b));
            if (!1 === e)
                e = f;
            else if (!e)
                return this;
            return 1 === g && (h = e,
            e = function(a) {
                return m().off(a),
                h.apply(this, arguments)
            }
            ,
            e.guid = h.guid || (h.guid = m.guid++)),
            this.each(function() {
                m.event.add(this, a, e, d, c)
            })
        },
        one: function(a, b, c, d) {
            return this.on(a, b, c, d, 1)
        },
        off: function(a, c, d) {
            var e, g;
            if (a && a.preventDefault && a.handleObj)
                return e = a.handleObj,
                m(a.delegateTarget).off(e.namespace ? e.origType + "." + e.namespace : e.origType, e.selector, e.handler),
                this;
            if ("object" == typeof a) {
                for (g in a)
                    this.off(g, c, a[g]);
                return this
            }
            if (!1 === c || "function" == typeof c)
                d = c,
                c = b;
            return !1 === d && (d = f),
            this.each(function() {
                m.event.remove(this, a, d, c)
            })
        },
        bind: function(a, b, c) {
            return this.on(a, null, b, c)
        },
        unbind: function(a, b) {
            return this.off(a, null, b)
        },
        live: function(a, b, c) {
            return m(this.context).on(a, this.selector, b, c),
            this
        },
        die: function(a, b) {
            return m(this.context).off(a, this.selector || "**", b),
            this
        },
        delegate: function(a, b, c, d) {
            return this.on(b, a, c, d)
        },
        undelegate: function(a, b, c) {
            return 1 == arguments.length ? this.off(a, "**") : this.off(b, a || "**", c)
        },
        trigger: function(a, b) {
            return this.each(function() {
                m.event.trigger(a, b, this)
            })
        },
        triggerHandler: function(a, b) {
            if (this[0])
                return m.event.trigger(a, b, this[0], !0)
        },
        toggle: function(a) {
            var b = arguments
              , c = a.guid || m.guid++
              , d = 0
              , e = function(c) {
                var e = (m._data(this, "lastToggle" + a.guid) || 0) % d;
                return m._data(this, "lastToggle" + a.guid, e + 1),
                c.preventDefault(),
                b[e].apply(this, arguments) || !1
            };
            for (e.guid = c; d < b.length; )
                b[d++].guid = c;
            return this.click(e)
        },
        hover: function(a, b) {
            return this.mouseenter(a).mouseleave(b || a)
        }
    });
    m.each("blur,focus,focusin,focusout,load,resize,scroll,unload,click,dblclick,mousedown,mouseup,mousemove,mouseover,mouseout,mouseenter,mouseleave,change,select,submit,keydown,keypress,keyup,error,contextmenu".split(","), function(a, b) {
        m.fn[b] = function(a, c) {
            return c == null && (c = a,
            a = null),
            arguments.length > 0 ? this.on(b, null, a, c) : this.trigger(b)
        }
        ;
        Rd.test(b) && (m.event.fixHooks[b] = m.event.keyHooks);
        Sd.test(b) && (m.event.fixHooks[b] = m.event.mouseHooks)
    });
    (function(a, b) {
        function c(a, b, d, e) {
            for (var f = 0, g = b.length; f < g; f++)
                z(a, b[f], d, e)
        }
        function d(a, b, e, f, g, h) {
            var i, j = sa.setFilters[b.toLowerCase()];
            return j || z.error(b),
            (a || !(i = g)) && c(a || "*", f, i = [], g),
            0 < i.length ? j(i, e, h) : []
        }
        function e(a, f, g, h, i) {
            for (var j, k, n, m, l, p, o, q = 0, r = i.length, $a = F.POS, s = RegExp("^" + $a.source + "(?!" + t + ")", "i"), B = function() {
                for (var a = 1, c = arguments.length - 2; a < c; a++)
                    arguments[a] === b && (j[a] = b)
            }; q < r; q++) {
                $a.exec("");
                a = i[q];
                m = [];
                n = 0;
                for (l = h; j = $a.exec(a); )
                    if (k = $a.lastIndex = j.index + j[0].length,
                    k > n) {
                        o = a.slice(n, j.index);
                        n = k;
                        p = [f];
                        D.test(o) && (l && (p = l),
                        l = h);
                        if (k = la.test(o))
                            o = o.slice(0, -5).replace(D, "$&*");
                        1 < j.length && j[0].replace(s, B);
                        l = d(o, j[1], j[2], p, l, k)
                    }
                l ? (m = m.concat(l),
                (o = a.slice(n)) && ")" !== o ? D.test(o) ? c(o, m, g, h) : z(o, f, g, h ? h.concat(l) : l) : u.apply(g, m)) : z(a, f, g, h)
            }
            return 1 === r ? g : z.uniqueSort(g)
        }
        function f(a, b, c) {
            var d = b.dir
              , e = s++;
            return a || (a = function(a) {
                return a === c
            }
            ),
            b.first ? function(b, c) {
                for (; b = b[d]; )
                    if (1 === b.nodeType)
                        return a(b, c) && b
            }
            : function(b, c) {
                for (var f, g = e + "." + j, h = g + "." + i; b = b[d]; )
                    if (1 === b.nodeType) {
                        if ((f = b[pa]) === h)
                            return b.sizset;
                        if ("string" == typeof f && 0 === f.indexOf(g)) {
                            if (b.sizset)
                                return b
                        } else {
                            b[pa] = h;
                            if (a(b, c))
                                return b.sizset = !0,
                                b;
                            b.sizset = !1
                        }
                    }
            }
        }
        function g(a, b) {
            return a ? function(c, d) {
                var e = b(c, d);
                return e && a(!0 === e ? c : e, d)
            }
            : b
        }
        function h(a) {
            return function(b, c) {
                for (var d, e = 0; d = a[e]; e++)
                    if (d(b, c))
                        return !0;
                return !1
            }
        }
        var i, j, k, n, l, p = a.document, o = p.documentElement, q = !1, r = !0, s = 0, B = [].slice, u = [].push, pa = ("sizcache" + Math.random()).replace(".", ""), t = "[\\x20\\t\\r\\n\\f]", w = "(?:\\\\.|[-\\w]|[^\\x00-\\xa0])+".replace("w", "w#"), w = "\\[" + t + "*((?:\\\\.|[-\\w]|[^\\x00-\\xa0])+)" + t + "*(?:([*^$|!~]?=)" + t + "*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|(" + w + ")|)|)" + t + "*\\]", T = t + "*([\\x20\\t\\r\\n\\f>+~])" + t + "*", Q = "(?=[^\\x20\\t\\r\\n\\f])(?:\\\\.|" + w + "|" + ":((?:\\\\.|[-\\w]|[^\\x00-\\xa0])+)(?:\\((?:(['\"])((?:\\\\.|[^\\\\])*?)\\2|((?:[^,]|\\\\,|(?:,(?=[^\\[]*\\]))|(?:,(?=[^\\(]*\\))))*))\\)|)".replace(2, 7) + "|[^\\\\(),])+", v = RegExp("^" + t + "+|((?:^|[^\\\\])(?:\\\\.)*)" + t + "+$", "g"), D = RegExp("^" + T), A = RegExp(Q + "?(?=" + t + "*,|$)", "g"), M = RegExp("^(?:(?!,)(?:(?:^|,)" + t + "*" + Q + ")*?|" + t + "*(.*?))(\\)|$)"), pb = RegExp(Q.slice(19, -6) + "\\x20\\t\\r\\n\\f>+~])+|" + T, "g"), y = /^(?:#([\w\-]+)|(\w+)|\.([\w\-]+))$/, x = /[\x20\t\r\n\f]*[+~]/, la = /:not\($/, U = /h\d/i, ha = /input|select|textarea|button/i, J = /\\(?!\\)/g, F = {
            ID: /^#((?:\\.|[-\w]|[^\x00-\xa0])+)/,
            CLASS: /^\.((?:\\.|[-\w]|[^\x00-\xa0])+)/,
            NAME: /^\[name=['"]?((?:\\.|[-\w]|[^\x00-\xa0])+)['"]?\]/,
            TAG: RegExp("^(" + "(?:\\\\.|[-\\w]|[^\\x00-\\xa0])+".replace("[-", "[-\\*") + ")"),
            ATTR: RegExp("^" + w),
            PSEUDO: RegExp("^:((?:\\\\.|[-\\w]|[^\\x00-\\xa0])+)(?:\\((?:(['\"])((?:\\\\.|[^\\\\])*?)\\2|((?:[^,]|\\\\,|(?:,(?=[^\\[]*\\]))|(?:,(?=[^\\(]*\\))))*))\\)|)"),
            CHILD: RegExp("^:(only|nth|last|first)-child(?:\\(" + t + "*(even|odd|(([+-]|)(\\d*)n|)" + t + "*(?:([+-]|)" + t + "*(\\d+)|))" + t + "*\\)|)", "i"),
            POS: /:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\)|)(?=[^-]|$)/ig,
            needsContext: RegExp("^" + t + "*[>+~]|:(nth|eq|gt|lt|first|last|even|odd)(?:\\((\\d*)\\)|)(?=[^-]|$)", "i")
        }, L = {}, H = [], C = {}, Wb = [], w = function(a) {
            return a.sizzleFilter = !0,
            a
        }, T = function(a) {
            return function(b) {
                return "input" === b.nodeName.toLowerCase() && b.type === a
            }
        }, Q = function(a) {
            return function(b) {
                var c = b.nodeName.toLowerCase();
                return ("input" === c || "button" === c) && b.type === a
            }
        }, X = function(a) {
            var b = !1
              , c = p.createElement("div");
            try {
                b = a(c)
            } catch (d) {}
            return b
        }, N = X(function(a) {
            a.innerHTML = "<select></select>";
            a = typeof a.lastChild.getAttribute("multiple");
            return "boolean" !== a && "string" !== a
        }), I = X(function(a) {
            a.id = pa + 0;
            a.innerHTML = "<a name='" + pa + "'></a><div name='" + pa + "'></div>";
            o.insertBefore(a, o.firstChild);
            var b = p.getElementsByName && p.getElementsByName(pa).length === 2 + p.getElementsByName(pa + 0).length;
            return l = !p.getElementById(pa),
            o.removeChild(a),
            b
        }), E = X(function(a) {
            return a.appendChild(p.createComment("")),
            0 === a.getElementsByTagName("*").length
        }), ea = X(function(a) {
            return a.innerHTML = "<a href='#'></a>",
            a.firstChild && "undefined" !== typeof a.firstChild.getAttribute && "#" === a.firstChild.getAttribute("href")
        }), P = X(function(a) {
            return a.innerHTML = "<div class='hidden e'></div><div class='hidden'></div>",
            !a.getElementsByClassName || 0 === a.getElementsByClassName("e").length ? !1 : (a.lastChild.className = "e",
            1 !== a.getElementsByClassName("e").length)
        }), z = function(a, b, c, d) {
            var c = c || [], b = b || p, e, f, g, h, i = b.nodeType;
            if (1 !== i && 9 !== i)
                return [];
            if (!a || "string" != typeof a)
                return c;
            g = Pb(b);
            if (!g && !d && (e = y.exec(a)))
                if (h = e[1])
                    if (9 === i) {
                        f = b.getElementById(h);
                        if (!f || !f.parentNode)
                            return c;
                        if (f.id === h)
                            return c.push(f),
                            c
                    } else {
                        if (b.ownerDocument && (f = b.ownerDocument.getElementById(h)) && aa(b, f) && f.id === h)
                            return c.push(f),
                            c
                    }
                else {
                    if (e[2])
                        return u.apply(c, B.call(b.getElementsByTagName(a), 0)),
                        c;
                    if ((h = e[3]) && P && b.getElementsByClassName)
                        return u.apply(c, B.call(b.getElementsByClassName(h), 0)),
                        c
                }
            return Cc(a, b, c, d, g)
        }, sa = z.selectors = {
            cacheLength: 50,
            match: F,
            order: ["ID", "TAG"],
            attrHandle: {},
            createPseudo: w,
            find: {
                ID: l ? function(a, b, c) {
                    if ("undefined" !== typeof b.getElementById && !c)
                        return (a = b.getElementById(a)) && a.parentNode ? [a] : []
                }
                : function(a, c, d) {
                    if ("undefined" !== typeof c.getElementById && !d)
                        return (c = c.getElementById(a)) ? c.id === a || "undefined" !== typeof c.getAttributeNode && c.getAttributeNode("id").value === a ? [c] : b : []
                }
                ,
                TAG: E ? function(a, b) {
                    if ("undefined" !== typeof b.getElementsByTagName)
                        return b.getElementsByTagName(a)
                }
                : function(a, b) {
                    var c = b.getElementsByTagName(a);
                    if ("*" === a) {
                        for (var d, e = [], f = 0; d = c[f]; f++)
                            1 === d.nodeType && e.push(d);
                        return e
                    }
                    return c
                }
            },
            relative: {
                ">": {
                    dir: "parentNode",
                    first: !0
                },
                " ": {
                    dir: "parentNode"
                },
                "+": {
                    dir: "previousSibling",
                    first: !0
                },
                "~": {
                    dir: "previousSibling"
                }
            },
            preFilter: {
                ATTR: function(a) {
                    return a[1] = a[1].replace(J, ""),
                    a[3] = (a[4] || a[5] || "").replace(J, ""),
                    "~=" === a[2] && (a[3] = " " + a[3] + " "),
                    a.slice(0, 4)
                },
                CHILD: function(a) {
                    return a[1] = a[1].toLowerCase(),
                    "nth" === a[1] ? (a[2] || z.error(a[0]),
                    a[3] = +(a[3] ? a[4] + (a[5] || 1) : 2 * ("even" === a[2] || "odd" === a[2])),
                    a[4] = +(a[6] + a[7] || "odd" === a[2])) : a[2] && z.error(a[0]),
                    a
                },
                PSEUDO: function(a) {
                    var b, c = a[4];
                    return F.CHILD.test(a[0]) ? null : (c && (b = M.exec(c)) && b.pop() && (a[0] = a[0].slice(0, b[0].length - c.length - 1),
                    c = b[0].slice(0, -1)),
                    a.splice(2, 3, c || a[3]),
                    a)
                }
            },
            filter: {
                ID: l ? function(a) {
                    return a = a.replace(J, ""),
                    function(b) {
                        return b.getAttribute("id") === a
                    }
                }
                : function(a) {
                    return a = a.replace(J, ""),
                    function(b) {
                        return (b = "undefined" !== typeof b.getAttributeNode && b.getAttributeNode("id")) && b.value === a
                    }
                }
                ,
                TAG: function(a) {
                    return "*" === a ? function() {
                        return !0
                    }
                    : (a = a.replace(J, "").toLowerCase(),
                    function(b) {
                        return b.nodeName && b.nodeName.toLowerCase() === a
                    }
                    )
                },
                CLASS: function(a) {
                    var b = L[a];
                    return b || (b = L[a] = RegExp("(^|" + t + ")" + a + "(" + t + "|$)"),
                    H.push(a),
                    H.length > sa.cacheLength && delete L[H.shift()]),
                    function(a) {
                        return b.test(a.className || "undefined" !== typeof a.getAttribute && a.getAttribute("class") || "")
                    }
                },
                ATTR: function(a, b, c) {
                    return b ? function(d) {
                        var d = z.attr(d, a)
                          , e = d + "";
                        if (null == d)
                            return "!=" === b;
                        switch (b) {
                        case "=":
                            return e === c;
                        case "!=":
                            return e !== c;
                        case "^=":
                            return c && 0 === e.indexOf(c);
                        case "*=":
                            return c && -1 < e.indexOf(c);
                        case "$=":
                            return c && e.substr(e.length - c.length) === c;
                        case "~=":
                            return -1 < (" " + e + " ").indexOf(c);
                        case "|=":
                            return e === c || e.substr(0, c.length + 1) === c + "-"
                        }
                    }
                    : function(b) {
                        return null != z.attr(b, a)
                    }
                },
                CHILD: function(a, b, c, d) {
                    if ("nth" === a) {
                        var e = s++;
                        return function(a) {
                            var b, f, g = 0, h = a;
                            if (1 === c && 0 === d)
                                return !0;
                            if ((b = a.parentNode) && (b[pa] !== e || !a.sizset)) {
                                for (h = b.firstChild; h && !(1 === h.nodeType && (h.sizset = ++g,
                                h === a)); h = h.nextSibling)
                                    ;
                                b[pa] = e
                            }
                            return f = a.sizset - d,
                            0 === c ? 0 === f : 0 === f % c && 0 <= f / c
                        }
                    }
                    return function(b) {
                        var c = b;
                        switch (a) {
                        case "only":
                        case "first":
                            for (; c = c.previousSibling; )
                                if (1 === c.nodeType)
                                    return !1;
                            if ("first" === a)
                                return !0;
                            c = b;
                        case "last":
                            for (; c = c.nextSibling; )
                                if (1 === c.nodeType)
                                    return !1;
                            return !0
                        }
                    }
                },
                PSEUDO: function(a, b, c, d) {
                    var e = sa.pseudos[a] || sa.pseudos[a.toLowerCase()];
                    return e || z.error("unsupported pseudo: " + a),
                    e.sizzleFilter ? e(b, c, d) : e
                }
            },
            pseudos: {
                not: w(function(a, b, c) {
                    var d = ca(a.replace(v, "$1"), b, c);
                    return function(a) {
                        return !d(a)
                    }
                }),
                enabled: function(a) {
                    return !1 === a.disabled
                },
                disabled: function(a) {
                    return !0 === a.disabled
                },
                checked: function(a) {
                    var b = a.nodeName.toLowerCase();
                    return "input" === b && !!a.checked || "option" === b && !!a.selected
                },
                selected: function(a) {
                    return a.parentNode && a.parentNode.selectedIndex,
                    !0 === a.selected
                },
                parent: function(a) {
                    return !sa.pseudos.empty(a)
                },
                empty: function(a) {
                    for (var b, a = a.firstChild; a; ) {
                        if ("@" < a.nodeName || 3 === (b = a.nodeType) || 4 === b)
                            return !1;
                        a = a.nextSibling
                    }
                    return !0
                },
                contains: w(function(a) {
                    return function(b) {
                        return -1 < (b.textContent || b.innerText || Bc(b)).indexOf(a)
                    }
                }),
                has: w(function(a) {
                    return function(b) {
                        return 0 < z(a, b).length
                    }
                }),
                header: function(a) {
                    return U.test(a.nodeName)
                },
                text: function(a) {
                    var b, c;
                    return "input" === a.nodeName.toLowerCase() && "text" === (b = a.type) && (null == (c = a.getAttribute("type")) || c.toLowerCase() === b)
                },
                radio: T("radio"),
                checkbox: T("checkbox"),
                file: T("file"),
                password: T("password"),
                image: T("image"),
                submit: Q("submit"),
                reset: Q("reset"),
                button: function(a) {
                    var b = a.nodeName.toLowerCase();
                    return "input" === b && "button" === a.type || "button" === b
                },
                input: function(a) {
                    return ha.test(a.nodeName)
                },
                focus: function(a) {
                    var b = a.ownerDocument;
                    return a === b.activeElement && (!b.hasFocus || b.hasFocus()) && (!!a.type || !!a.href)
                },
                active: function(a) {
                    return a === a.ownerDocument.activeElement
                }
            },
            setFilters: {
                first: function(a, b, c) {
                    return c ? a.slice(1) : [a[0]]
                },
                last: function(a, b, c) {
                    b = a.pop();
                    return c ? a : [b]
                },
                even: function(a, b, c) {
                    for (var b = [], c = c ? 1 : 0, d = a.length; c < d; c += 2)
                        b.push(a[c]);
                    return b
                },
                odd: function(a, b, c) {
                    for (var b = [], c = c ? 0 : 1, d = a.length; c < d; c += 2)
                        b.push(a[c]);
                    return b
                },
                lt: function(a, b, c) {
                    return c ? a.slice(+b) : a.slice(0, +b)
                },
                gt: function(a, b, c) {
                    return c ? a.slice(0, +b + 1) : a.slice(+b + 1)
                },
                eq: function(a, b, c) {
                    b = a.splice(+b, 1);
                    return c ? a : b
                }
            }
        };
        sa.setFilters.nth = sa.setFilters.eq;
        sa.filters = sa.pseudos;
        ea || (sa.attrHandle = {
            href: function(a) {
                return a.getAttribute("href", 2)
            },
            type: function(a) {
                return a.getAttribute("type")
            }
        });
        I && (sa.order.push("NAME"),
        sa.find.NAME = function(a, b) {
            if ("undefined" !== typeof b.getElementsByName)
                return b.getElementsByName(a)
        }
        );
        P && (sa.order.splice(1, 0, "CLASS"),
        sa.find.CLASS = function(a, b, c) {
            if ("undefined" !== typeof b.getElementsByClassName && !c)
                return b.getElementsByClassName(a)
        }
        );
        try {
            B.call(o.childNodes, 0)[0].nodeType
        } catch (Wc) {
            B = function(a) {
                for (var b, c = []; b = this[a]; a++)
                    c.push(b);
                return c
            }
        }
        var Pb = z.isXML = function(a) {
            return (a = a && (a.ownerDocument || a).documentElement) ? "HTML" !== a.nodeName : !1
        }
          , aa = z.contains = o.compareDocumentPosition ? function(a, b) {
            return !!(a.compareDocumentPosition(b) & 16)
        }
        : o.contains ? function(a, b) {
            var c = 9 === a.nodeType ? a.documentElement : a
              , d = b.parentNode;
            return a === d || !(!d || !(1 === d.nodeType && c.contains && c.contains(d)))
        }
        : function(a, b) {
            for (; b = b.parentNode; )
                if (b === a)
                    return !0;
            return !1
        }
          , Bc = z.getText = function(a) {
            var b, c = "", d = 0;
            if (b = a.nodeType)
                if (1 === b || 9 === b || 11 === b) {
                    if ("string" == typeof a.textContent)
                        return a.textContent;
                    for (a = a.firstChild; a; a = a.nextSibling)
                        c += Bc(a)
                } else {
                    if (3 === b || 4 === b)
                        return a.nodeValue
                }
            else
                for (; b = a[d]; d++)
                    c += Bc(b);
            return c
        }
        ;
        z.attr = function(a, b) {
            var c, d = Pb(a);
            return d || (b = b.toLowerCase()),
            sa.attrHandle[b] ? sa.attrHandle[b](a) : N || d ? a.getAttribute(b) : (c = a.getAttributeNode(b),
            c ? "boolean" == typeof a[b] ? a[b] ? b : null : c.specified ? c.value : null : null)
        }
        ;
        z.error = function(a) {
            throw Error("Syntax error, unrecognized expression: " + a);
        }
        ;
        [0, 0].sort(function() {
            return r = 0
        });
        o.compareDocumentPosition ? k = function(a, b) {
            return a === b ? (q = !0,
            0) : (!a.compareDocumentPosition || !b.compareDocumentPosition ? a.compareDocumentPosition : a.compareDocumentPosition(b) & 4) ? -1 : 1
        }
        : (k = function(a, b) {
            if (a === b)
                return q = !0,
                0;
            if (a.sourceIndex && b.sourceIndex)
                return a.sourceIndex - b.sourceIndex;
            var c, d, e = [], f = [];
            c = a.parentNode;
            d = b.parentNode;
            var g = c;
            if (c === d)
                return n(a, b);
            if (!c)
                return -1;
            if (!d)
                return 1;
            for (; g; )
                e.unshift(g),
                g = g.parentNode;
            for (g = d; g; )
                f.unshift(g),
                g = g.parentNode;
            c = e.length;
            d = f.length;
            for (g = 0; g < c && g < d; g++)
                if (e[g] !== f[g])
                    return n(e[g], f[g]);
            return g === c ? n(a, f[g], -1) : n(e[g], b, 1)
        }
        ,
        n = function(a, b, c) {
            if (a === b)
                return c;
            for (a = a.nextSibling; a; ) {
                if (a === b)
                    return -1;
                a = a.nextSibling
            }
            return 1
        }
        );
        z.uniqueSort = function(a) {
            var b, c = 1;
            if (k && (q = r,
            a.sort(k),
            q))
                for (; b = a[c]; c++)
                    b === a[c - 1] && a.splice(c--, 1);
            return a
        }
        ;
        var ca = z.compile = function(a, b, c) {
            var d, e, i, j = C[a];
            if (j && j.context === b)
                return j;
            var k, n = [];
            d = 0;
            for (var m = M.exec(a), l = !m.pop() && !m.pop(), o = l && a.match(A) || [""], q = sa.preFilter, r = sa.filter, $a = !c && b !== p; null != (i = o[d]) && l; d++) {
                n.push(e = []);
                for ($a && (i = " " + i); i; ) {
                    l = !1;
                    if (m = D.exec(i))
                        i = i.slice(m[0].length),
                        l = e.push({
                            part: m.pop().replace(v, " "),
                            captures: m
                        });
                    for (k in r)
                        (m = F[k].exec(i)) && (!q[k] || (m = q[k](m, b, c))) && (i = i.slice(m.shift().length),
                        l = e.push({
                            part: k,
                            captures: m
                        }));
                    if (!l)
                        break
                }
            }
            e = (l || z.error(a),
            n);
            for (i = 0; d = e[i]; i++) {
                k = e;
                n = i;
                m = b;
                l = c;
                q = o = void 0;
                for (r = 0; o = d[r]; r++)
                    sa.relative[o.part] ? q = f(q, sa.relative[o.part], m) : (o.captures.push(m, l),
                    q = g(q, sa.filter[o.part].apply(null, o.captures)));
                k[n] = q
            }
            return j = C[a] = h(e),
            j.context = b,
            j.runs = j.dirruns = 0,
            Wb.push(a),
            Wb.length > sa.cacheLength && delete C[Wb.shift()],
            j
        }
        ;
        z.matches = function(a, b) {
            return z(a, null, null, b)
        }
        ;
        z.matchesSelector = function(a, b) {
            return 0 < z(b, null, null, [a]).length
        }
        ;
        var Cc = function(a, b, c, d, f) {
            var a = a.replace(v, "$1"), g, h, k, n, m, l, p = a.match(A);
            h = a.match(pb);
            k = b.nodeType;
            if (F.POS.test(a))
                return e(a, b, c, d, p);
            if (d)
                g = B.call(d, 0);
            else if (p && 1 === p.length) {
                if (1 < h.length && 9 === k && !f && (p = F.ID.exec(h[0]))) {
                    b = sa.find.ID(p[1], b, f)[0];
                    if (!b)
                        return c;
                    a = a.slice(h.shift().length)
                }
                d = (p = x.exec(h[0])) && !p.index && b.parentNode || b;
                l = h.pop();
                n = l.split(":not")[0];
                h = 0;
                for (k = sa.order.length; h < k; h++)
                    if (m = sa.order[h],
                    p = F[m].exec(n))
                        if (g = sa.find[m]((p[1] || "").replace(J, ""), d, f),
                        null != g) {
                            n === l && (a = a.slice(0, a.length - l.length) + n.replace(F[m], ""),
                            a || u.apply(c, B.call(g, 0)));
                            break
                        }
            }
            if (a) {
                f = ca(a, b, f);
                j = f.dirruns++;
                null == g && (g = sa.find.TAG("*", x.test(a) && b.parentNode || b));
                for (h = 0; a = g[h]; h++)
                    i = f.runs++,
                    f(a, b) && c.push(a)
            }
            return c
        };
        p.querySelectorAll && function() {
            var a, b = Cc, c = /'|\\/g, d = /\=[\x20\t\r\n\f]*([^'"\]]*)[\x20\t\r\n\f]*\]/g, e = [], f = [":active"], g = o.matchesSelector || o.mozMatchesSelector || o.webkitMatchesSelector || o.oMatchesSelector || o.msMatchesSelector;
            X(function(a) {
                a.innerHTML = "<select><option selected></option></select>";
                a.querySelectorAll("[selected]").length || e.push("\\[" + t + "*(?:checked|disabled|ismap|multiple|readonly|selected|value)");
                a.querySelectorAll(":checked").length || e.push(":checked")
            });
            X(function(a) {
                a.innerHTML = "<p test=''></p>";
                a.querySelectorAll("[test^='']").length && e.push("[*^$]=" + t + "*(?:\"\"|'')");
                a.innerHTML = "<input type='hidden'>";
                a.querySelectorAll(":enabled").length || e.push(":enabled", ":disabled")
            });
            e = e.length && RegExp(e.join("|"));
            Cc = function(a, d, f, g, h) {
                if (!g && !h && (!e || !e.test(a)))
                    if (9 === d.nodeType)
                        try {
                            return u.apply(f, B.call(d.querySelectorAll(a), 0)),
                            f
                        } catch (i) {}
                    else if (1 === d.nodeType && "object" !== d.nodeName.toLowerCase()) {
                        var j = d.getAttribute("id")
                          , k = j || pa
                          , n = x.test(a) && d.parentNode || d;
                        j ? k = k.replace(c, "\\$&") : d.setAttribute("id", k);
                        try {
                            return u.apply(f, B.call(n.querySelectorAll(a.replace(A, "[id='" + k + "'] $&")), 0)),
                            f
                        } catch (m) {} finally {
                            j || d.removeAttribute("id")
                        }
                    }
                return b(a, d, f, g, h)
            }
            ;
            g && (X(function(b) {
                a = g.call(b, "div");
                try {
                    g.call(b, "[test!='']:sizzle"),
                    f.push(sa.match.PSEUDO)
                } catch (c) {}
            }),
            f = RegExp(f.join("|")),
            z.matchesSelector = function(b, c) {
                c = c.replace(d, "='$1']");
                if (!Pb(b) && !f.test(c) && (!e || !e.test(c)))
                    try {
                        var h = g.call(b, c);
                        if (h || a || b.document && 11 !== b.document.nodeType)
                            return h
                    } catch (i) {}
                return 0 < z(c, null, null, [b]).length
            }
            )
        }();
        z.attr = m.attr;
        m.find = z;
        m.expr = z.selectors;
        m.expr[":"] = m.expr.pseudos;
        m.unique = z.uniqueSort;
        m.text = z.getText;
        m.isXMLDoc = z.isXML;
        m.contains = z.contains
    }
    )(a);
    var Yd = /Until$/
      , Sb = /^(?:parents|prev(?:Until|All))/
      , zb = /^.[^:#\[\.,]*$/
      , Oc = m.expr.match.needsContext
      , jc = {
        children: !0,
        contents: !0,
        next: !0,
        prev: !0
    };
    m.fn.extend({
        find: function(a) {
            var b, c, d, e, f, g, h = this;
            if ("string" != typeof a)
                return m(a).filter(function() {
                    b = 0;
                    for (c = h.length; b < c; b++)
                        if (m.contains(h[b], this))
                            return !0
                });
            g = this.pushStack("", "find", a);
            b = 0;
            for (c = this.length; b < c; b++)
                if (d = g.length,
                m.find(a, this[b], g),
                0 < b)
                    for (e = d; e < g.length; e++)
                        for (f = 0; f < d; f++)
                            if (g[f] === g[e]) {
                                g.splice(e--, 1);
                                break
                            }
            return g
        },
        has: function(a) {
            var b, c = m(a, this), d = c.length;
            return this.filter(function() {
                for (b = 0; b < d; b++)
                    if (m.contains(this, c[b]))
                        return !0
            })
        },
        not: function(a) {
            return this.pushStack(j(this, a, !1), "not", a)
        },
        filter: function(a) {
            return this.pushStack(j(this, a, !0), "filter", a)
        },
        is: function(a) {
            return !!a && ("string" == typeof a ? Oc.test(a) ? 0 <= m(a, this.context).index(this[0]) : 0 < m.filter(a, this).length : 0 < this.filter(a).length)
        },
        closest: function(a, b) {
            for (var c, d = 0, e = this.length, f = [], g = Oc.test(a) || "string" != typeof a ? m(a, b || this.context) : 0; d < e; d++)
                for (c = this[d]; c && c.ownerDocument && c !== b && 11 !== c.nodeType; ) {
                    if (g ? -1 < g.index(c) : m.find.matchesSelector(c, a)) {
                        f.push(c);
                        break
                    }
                    c = c.parentNode
                }
            return f = 1 < f.length ? m.unique(f) : f,
            this.pushStack(f, "closest", a)
        },
        index: function(a) {
            return a ? "string" == typeof a ? m.inArray(this[0], m(a)) : m.inArray(a.jquery ? a[0] : a, this) : this[0] && this[0].parentNode ? this.prevAll().length : -1
        },
        add: function(a, b) {
            var c = "string" == typeof a ? m(a, b) : m.makeArray(a && a.nodeType ? [a] : a)
              , d = m.merge(this.get(), c);
            return this.pushStack(h(c[0]) || h(d[0]) ? d : m.unique(d))
        },
        addBack: function(a) {
            return this.add(null == a ? this.prevObject : this.prevObject.filter(a))
        }
    });
    m.fn.andSelf = m.fn.addBack;
    m.each({
        parent: function(a) {
            return (a = a.parentNode) && 11 !== a.nodeType ? a : null
        },
        parents: function(a) {
            return m.dir(a, "parentNode")
        },
        parentsUntil: function(a, b, c) {
            return m.dir(a, "parentNode", c)
        },
        next: function(a) {
            return i(a, "nextSibling")
        },
        prev: function(a) {
            return i(a, "previousSibling")
        },
        nextAll: function(a) {
            return m.dir(a, "nextSibling")
        },
        prevAll: function(a) {
            return m.dir(a, "previousSibling")
        },
        nextUntil: function(a, b, c) {
            return m.dir(a, "nextSibling", c)
        },
        prevUntil: function(a, b, c) {
            return m.dir(a, "previousSibling", c)
        },
        siblings: function(a) {
            return m.sibling((a.parentNode || {}).firstChild, a)
        },
        children: function(a) {
            return m.sibling(a.firstChild)
        },
        contents: function(a) {
            return m.nodeName(a, "iframe") ? a.contentDocument || a.contentWindow.document : m.merge([], a.childNodes)
        }
    }, function(a, b) {
        m.fn[a] = function(c, d) {
            var e = m.map(this, b, c);
            return Yd.test(a) || (d = c),
            d && "string" == typeof d && (e = m.filter(d, e)),
            e = 1 < this.length && !jc[a] ? m.unique(e) : e,
            1 < this.length && Sb.test(a) && (e = e.reverse()),
            this.pushStack(e, a, ha.call(arguments).join(","))
        }
    });
    m.extend({
        filter: function(a, b, c) {
            return c && (a = ":not(" + a + ")"),
            1 === b.length ? m.find.matchesSelector(b[0], a) ? [b[0]] : [] : m.find.matches(a, b)
        },
        dir: function(a, c, d) {
            for (var e = [], a = a[c]; a && 9 !== a.nodeType && (d === b || 1 !== a.nodeType || !m(a).is(d)); )
                1 === a.nodeType && e.push(a),
                a = a[c];
            return e
        },
        sibling: function(a, b) {
            for (var c = []; a; a = a.nextSibling)
                1 === a.nodeType && a !== b && c.push(a);
            return c
        }
    });
    var qc = "abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video"
      , $b = / jQuery\d+="(?:null|\d+)"/g
      , Tb = /^\s+/
      , Bb = /<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi
      , tc = /<([\w:]+)/
      , Zc = /<tbody/i
      , Ka = /<|&#?\w+;/
      , lb = /<(?:script|style|link)/i
      , Zd = /<(?:script|object|embed|option|style)/i
      , od = RegExp("<(?:" + qc + ")[\\s/>]", "i")
      , wd = /^(?:checkbox|radio)$/
      , Dd = /checked\s*(?:[^=]|=\s*.checked.)/i
      , $d = /\/(java|ecma)script/i
      , ae = /^\s*<!(?:\[CDATA\[|\-\-)|[\]\-]{2}>\s*$/g
      , sb = {
        option: [1, "<select multiple='multiple'>", "</select>"],
        legend: [1, "<fieldset>", "</fieldset>"],
        thead: [1, "<table>", "</table>"],
        tr: [2, "<table><tbody>", "</tbody></table>"],
        td: [3, "<table><tbody><tr>", "</tr></tbody></table>"],
        col: [2, "<table><tbody></tbody><colgroup>", "</colgroup></table>"],
        area: [1, "<map>", "</map>"],
        _default: [0, "", ""]
    }
      , Ed = k(D)
      , pd = Ed.appendChild(D.createElement("div"));
    sb.optgroup = sb.option;
    sb.tbody = sb.tfoot = sb.colgroup = sb.caption = sb.thead;
    sb.th = sb.td;
    m.support.htmlSerialize || (sb._default = [1, "X<div>", "</div>"]);
    m.fn.extend({
        text: function(a) {
            return m.access(this, function(a) {
                return a === b ? m.text(this) : this.empty().append((this[0] && this[0].ownerDocument || D).createTextNode(a))
            }, null, a, arguments.length)
        },
        wrapAll: function(a) {
            if (m.isFunction(a))
                return this.each(function(b) {
                    m(this).wrapAll(a.call(this, b))
                });
            if (this[0]) {
                var b = m(a, this[0].ownerDocument).eq(0).clone(!0);
                this[0].parentNode && b.insertBefore(this[0]);
                b.map(function() {
                    for (var a = this; a.firstChild && 1 === a.firstChild.nodeType; )
                        a = a.firstChild;
                    return a
                }).append(this)
            }
            return this
        },
        wrapInner: function(a) {
            return m.isFunction(a) ? this.each(function(b) {
                m(this).wrapInner(a.call(this, b))
            }) : this.each(function() {
                var b = m(this)
                  , c = b.contents();
                c.length ? c.wrapAll(a) : b.append(a)
            })
        },
        wrap: function(a) {
            var b = m.isFunction(a);
            return this.each(function(c) {
                m(this).wrapAll(b ? a.call(this, c) : a)
            })
        },
        unwrap: function() {
            return this.parent().each(function() {
                m.nodeName(this, "body") || m(this).replaceWith(this.childNodes)
            }).end()
        },
        append: function() {
            return this.domManip(arguments, !0, function(a) {
                (this.nodeType === 1 || this.nodeType === 11) && this.appendChild(a)
            })
        },
        prepend: function() {
            return this.domManip(arguments, !0, function(a) {
                (this.nodeType === 1 || this.nodeType === 11) && this.insertBefore(a, this.firstChild)
            })
        },
        before: function() {
            if (!h(this[0]))
                return this.domManip(arguments, !1, function(a) {
                    this.parentNode.insertBefore(a, this)
                });
            if (arguments.length) {
                var a = m.clean(arguments);
                return this.pushStack(m.merge(a, this), "before", this.selector)
            }
        },
        after: function() {
            if (!h(this[0]))
                return this.domManip(arguments, !1, function(a) {
                    this.parentNode.insertBefore(a, this.nextSibling)
                });
            if (arguments.length) {
                var a = m.clean(arguments);
                return this.pushStack(m.merge(this, a), "after", this.selector)
            }
        },
        remove: function(a, b) {
            for (var c, d = 0; null != (c = this[d]); d++)
                if (!a || m.filter(a, [c]).length)
                    !b && 1 === c.nodeType && (m.cleanData(c.getElementsByTagName("*")),
                    m.cleanData([c])),
                    c.parentNode && c.parentNode.removeChild(c);
            return this
        },
        empty: function() {
            for (var a, b = 0; null != (a = this[b]); b++)
                for (1 === a.nodeType && m.cleanData(a.getElementsByTagName("*")); a.firstChild; )
                    a.removeChild(a.firstChild);
            return this
        },
        clone: function(a, b) {
            return a = null == a ? !1 : a,
            b = null == b ? a : b,
            this.map(function() {
                return m.clone(this, a, b)
            })
        },
        html: function(a) {
            return m.access(this, function(a) {
                var c = this[0] || {}
                  , d = 0
                  , e = this.length;
                if (a === b)
                    return 1 === c.nodeType ? c.innerHTML.replace($b, "") : b;
                if ("string" == typeof a && !lb.test(a) && (m.support.htmlSerialize || !od.test(a)) && (m.support.leadingWhitespace || !Tb.test(a)) && !sb[(tc.exec(a) || ["", ""])[1].toLowerCase()]) {
                    a = a.replace(Bb, "<$1></$2>");
                    try {
                        for (; d < e; d++)
                            c = this[d] || {},
                            1 === c.nodeType && (m.cleanData(c.getElementsByTagName("*")),
                            c.innerHTML = a);
                        c = 0
                    } catch (f) {}
                }
                c && this.empty().append(a)
            }, null, a, arguments.length)
        },
        replaceWith: function(a) {
            return h(this[0]) ? this.length ? this.pushStack(m(m.isFunction(a) ? a() : a), "replaceWith", a) : this : m.isFunction(a) ? this.each(function(b) {
                var c = m(this)
                  , d = c.html();
                c.replaceWith(a.call(this, b, d))
            }) : ("string" != typeof a && (a = m(a).detach()),
            this.each(function() {
                var b = this.nextSibling
                  , c = this.parentNode;
                m(this).remove();
                b ? m(b).before(a) : m(c).append(a)
            }))
        },
        detach: function(a) {
            return this.remove(a, !0)
        },
        domManip: function(a, c, d) {
            var a = [].concat.apply([], a), e, f, g, h = 0, i = a[0], j = [], k = this.length;
            if (!m.support.checkClone && 1 < k && "string" == typeof i && Dd.test(i))
                return this.each(function() {
                    m(this).domManip(a, c, d)
                });
            if (m.isFunction(i))
                return this.each(function(e) {
                    var f = m(this);
                    a[0] = i.call(this, e, c ? f.html() : b);
                    f.domManip(a, c, d)
                });
            if (this[0]) {
                e = m.buildFragment(a, this, j);
                g = e.fragment;
                f = g.firstChild;
                1 === g.childNodes.length && (g = f);
                if (f) {
                    c = c && m.nodeName(f, "tr");
                    for (e = e.cacheable || k - 1; h < k; h++)
                        d.call(c && m.nodeName(this[h], "table") ? this[h].getElementsByTagName("tbody")[0] || this[h].appendChild(this[h].ownerDocument.createElement("tbody")) : this[h], h === e ? g : m.clone(g, !0, !0))
                }
                g = f = null;
                j.length && m.each(j, function(a, b) {
                    b.src ? m.ajax ? m.ajax({
                        url: b.src,
                        type: "GET",
                        dataType: "script",
                        async: !1,
                        global: !1,
                        "throws": !0
                    }) : m.error("no ajax") : m.globalEval((b.text || b.textContent || b.innerHTML || "").replace(ae, ""));
                    b.parentNode && b.parentNode.removeChild(b)
                })
            }
            return this
        }
    });
    m.buildFragment = function(a, c, d) {
        var e, f, g, h = a[0];
        return c = c || D,
        c = (c[0] || c).ownerDocument || c[0] || c,
        "undefined" == typeof c.createDocumentFragment && (c = D),
        1 === a.length && "string" == typeof h && 512 > h.length && c === D && "<" === h.charAt(0) && !Zd.test(h) && (m.support.checkClone || !Dd.test(h)) && (m.support.html5Clone || !od.test(h)) && (f = !0,
        e = m.fragments[h],
        g = e !== b),
        e || (e = c.createDocumentFragment(),
        m.clean(a, c, e, d),
        f && (m.fragments[h] = g && e)),
        {
            fragment: e,
            cacheable: f
        }
    }
    ;
    m.fragments = {};
    m.each({
        appendTo: "append",
        prependTo: "prepend",
        insertBefore: "before",
        insertAfter: "after",
        replaceAll: "replaceWith"
    }, function(a, b) {
        m.fn[a] = function(c) {
            var d, e = 0, f = [], c = m(c), g = c.length;
            d = 1 === this.length && this[0].parentNode;
            if ((null == d || d && 11 === d.nodeType && 1 === d.childNodes.length) && 1 === g)
                return c[b](this[0]),
                this;
            for (; e < g; e++)
                d = (0 < e ? this.clone(!0) : this).get(),
                m(c[e])[b](d),
                f = f.concat(d);
            return this.pushStack(f, a, c.selector)
        }
    });
    m.extend({
        clone: function(a, b, c) {
            var d, e, f, g;
            m.support.html5Clone || m.isXMLDoc(a) || !od.test("<" + a.nodeName + ">") ? g = a.cloneNode(!0) : (pd.innerHTML = a.outerHTML,
            pd.removeChild(g = pd.firstChild));
            if ((!m.support.noCloneEvent || !m.support.noCloneChecked) && (1 === a.nodeType || 11 === a.nodeType) && !m.isXMLDoc(a)) {
                p(a, g);
                d = o(a);
                e = o(g);
                for (f = 0; d[f]; ++f)
                    e[f] && p(d[f], e[f])
            }
            if (b && (n(a, g),
            c)) {
                d = o(a);
                e = o(g);
                for (f = 0; d[f]; ++f)
                    n(d[f], e[f])
            }
            return g
        },
        clean: function(a, b, c, d) {
            var e, f, g, h, i, j, n, l = 0, p = [];
            if (!b || "undefined" == typeof b.createDocumentFragment)
                b = D;
            for (f = b === D && Ed; null != (g = a[l]); l++)
                if ("number" == typeof g && (g += ""),
                g) {
                    if ("string" == typeof g)
                        if (Ka.test(g)) {
                            f = f || k(b);
                            j = j || f.appendChild(b.createElement("div"));
                            g = g.replace(Bb, "<$1></$2>");
                            e = (tc.exec(g) || ["", ""])[1].toLowerCase();
                            h = sb[e] || sb._default;
                            i = h[0];
                            for (j.innerHTML = h[1] + g + h[2]; i--; )
                                j = j.lastChild;
                            if (!m.support.tbody) {
                                i = Zc.test(g);
                                h = "table" === e && !i ? j.firstChild && j.firstChild.childNodes : "<table>" === h[1] && !i ? j.childNodes : [];
                                for (e = h.length - 1; 0 <= e; --e)
                                    m.nodeName(h[e], "tbody") && !h[e].childNodes.length && h[e].parentNode.removeChild(h[e])
                            }
                            !m.support.leadingWhitespace && Tb.test(g) && j.insertBefore(b.createTextNode(Tb.exec(g)[0]), j.firstChild);
                            g = j.childNodes;
                            j = f.lastChild
                        } else
                            g = b.createTextNode(g);
                    g.nodeType ? p.push(g) : p = m.merge(p, g)
                }
            j && (f.removeChild(j),
            g = j = f = null);
            if (!m.support.appendChecked)
                for (l = 0; null != (g = p[l]); l++)
                    m.nodeName(g, "input") ? r(g) : "undefined" != typeof g.getElementsByTagName && m.grep(g.getElementsByTagName("input"), r);
            if (c) {
                a = function(a) {
                    if (!a.type || $d.test(a.type))
                        return d ? d.push(a.parentNode ? a.parentNode.removeChild(a) : a) : c.appendChild(a)
                }
                ;
                for (l = 0; null != (g = p[l]); l++)
                    if (!m.nodeName(g, "script") || !a(g))
                        c.appendChild(g),
                        "undefined" != typeof g.getElementsByTagName && (n = m.grep(m.merge([], g.getElementsByTagName("script")), a),
                        p.splice.apply(p, [l + 1, 0].concat(n)),
                        l += n.length)
            }
            return p
        },
        cleanData: function(a, b) {
            for (var c, d, e, f, g = 0, h = m.expando, i = m.cache, j = m.support.deleteExpando, k = m.event.special; null != (e = a[g]); g++)
                if (b || m.acceptData(e))
                    if (c = (d = e[h]) && i[d]) {
                        if (c.events)
                            for (f in c.events)
                                k[f] ? m.event.remove(e, f) : m.removeEvent(e, f, c.handle);
                        i[d] && (delete i[d],
                        j ? delete e[h] : e.removeAttribute ? e.removeAttribute(h) : e[h] = null,
                        m.deletedIds.push(d))
                    }
        }
    });
    (function() {
        var a, b;
        m.uaMatch = function(a) {
            a = a.toLowerCase();
            a = /(chrome)[ \/]([\w.]+)/.exec(a) || /(webkit)[ \/]([\w.]+)/.exec(a) || /(opera)(?:.*version|)[ \/]([\w.]+)/.exec(a) || /(msie) ([\w.]+)/.exec(a) || 0 > a.indexOf("compatible") && /(mozilla)(?:.*? rv:([\w.]+)|)/.exec(a) || [];
            return {
                browser: a[1] || "",
                version: a[2] || "0"
            }
        }
        ;
        a = m.uaMatch(T.userAgent);
        b = {};
        a.browser && (b[a.browser] = !0,
        b.version = a.version);
        b.webkit && (b.safari = !0);
        m.browser = b;
        m.sub = function() {
            function a(b, c) {
                return new a.fn.init(b,c)
            }
            m.extend(!0, a, this);
            a.superclass = this;
            a.fn = a.prototype = this();
            a.fn.constructor = a;
            a.sub = this.sub;
            a.fn.init = function(c, d) {
                return d && d instanceof m && !(d instanceof a) && (d = a(d)),
                m.fn.init.call(this, c, d, b)
            }
            ;
            a.fn.init.prototype = a.fn;
            var b = a(D);
            return a
        }
    }
    )();
    var db, zc, Ac, qd = /alpha\([^)]*\)/i, be = /opacity=([^)]*)/, ce = /^(top|right|bottom|left)$/, Fd = /^margin/, Od = RegExp("^(" + Ha + ")(.*)$", "i"), Vc = RegExp("^(" + Ha + ")(?!px)[a-z%]+$", "i"), de = RegExp("^([-+])=(" + Ha + ")", "i"), kd = {}, ee = {
        position: "absolute",
        visibility: "hidden",
        display: "block"
    }, Gd = {
        letterSpacing: 0,
        fontWeight: 400,
        lineHeight: 1
    }, rc = ["Top", "Right", "Bottom", "Left"], xd = ["Webkit", "O", "Moz", "ms"], gb = m.fn.toggle;
    m.fn.extend({
        css: function(a, c) {
            return m.access(this, function(a, c, d) {
                return d !== b ? m.style(a, c, d) : m.css(a, c)
            }, a, c, 1 < arguments.length)
        },
        show: function() {
            return t(this, !0)
        },
        hide: function() {
            return t(this)
        },
        toggle: function(a, b) {
            var c = "boolean" == typeof a;
            return m.isFunction(a) && m.isFunction(b) ? gb.apply(this, arguments) : this.each(function() {
                (c ? a : s(this)) ? m(this).show() : m(this).hide()
            })
        }
    });
    m.extend({
        cssHooks: {
            opacity: {
                get: function(a, b) {
                    if (b) {
                        var c = db(a, "opacity");
                        return "" === c ? "1" : c
                    }
                }
            }
        },
        cssNumber: {
            fillOpacity: !0,
            fontWeight: !0,
            lineHeight: !0,
            opacity: !0,
            orphans: !0,
            widows: !0,
            zIndex: !0,
            zoom: !0
        },
        cssProps: {
            "float": m.support.cssFloat ? "cssFloat" : "styleFloat"
        },
        style: function(a, c, d, e) {
            if (a && !(3 === a.nodeType || 8 === a.nodeType || !a.style)) {
                var f, g, h, i = m.camelCase(c), j = a.style, c = m.cssProps[i] || (m.cssProps[i] = q(j, i));
                h = m.cssHooks[c] || m.cssHooks[i];
                if (d === b)
                    return h && "get"in h && (f = h.get(a, !1, e)) !== b ? f : j[c];
                g = typeof d;
                "string" === g && (f = de.exec(d)) && (d = (f[1] + 1) * f[2] + parseFloat(m.css(a, c)),
                g = "number");
                if (!(null == d || "number" === g && isNaN(d)))
                    if ("number" === g && !m.cssNumber[i] && (d += "px"),
                    !h || !("set"in h) || (d = h.set(a, d, e)) !== b)
                        try {
                            j[c] = d
                        } catch (k) {}
            }
        },
        css: function(a, c, d, e) {
            var f, g, h, i = m.camelCase(c);
            return c = m.cssProps[i] || (m.cssProps[i] = q(a.style, i)),
            h = m.cssHooks[c] || m.cssHooks[i],
            h && "get"in h && (f = h.get(a, !0, e)),
            f === b && (f = db(a, c)),
            "normal" === f && c in Gd && (f = Gd[c]),
            d || e !== b ? (g = parseFloat(f),
            d || m.isNumeric(g) ? g || 0 : f) : f
        },
        swap: function(a, b, c) {
            var d, e = {};
            for (d in b)
                e[d] = a.style[d],
                a.style[d] = b[d];
            c = c.call(a);
            for (d in b)
                a.style[d] = e[d];
            return c
        }
    });
    a.getComputedStyle ? db = function(a, b) {
        var c, d, e, f, g = getComputedStyle(a, null), h = a.style;
        return g && (c = g[b],
        "" === c && !m.contains(a.ownerDocument.documentElement, a) && (c = m.style(a, b)),
        Vc.test(c) && Fd.test(b) && (d = h.width,
        e = h.minWidth,
        f = h.maxWidth,
        h.minWidth = h.maxWidth = h.width = c,
        c = g.width,
        h.width = d,
        h.minWidth = e,
        h.maxWidth = f)),
        c
    }
    : D.documentElement.currentStyle && (db = function(a, b) {
        var c, d, e = a.currentStyle && a.currentStyle[b], f = a.style;
        return null == e && f && f[b] && (e = f[b]),
        Vc.test(e) && !ce.test(b) && (c = f.left,
        d = a.runtimeStyle && a.runtimeStyle.left,
        d && (a.runtimeStyle.left = a.currentStyle.left),
        f.left = "fontSize" === b ? "1em" : e,
        e = f.pixelLeft + "px",
        f.left = c,
        d && (a.runtimeStyle.left = d)),
        "" === e ? "auto" : e
    }
    );
    m.each(["height", "width"], function(a, b) {
        m.cssHooks[b] = {
            get: function(a, c, d) {
                if (c)
                    return 0 !== a.offsetWidth || "none" !== db(a, "display") ? u(a, b, d) : m.swap(a, ee, function() {
                        return u(a, b, d)
                    })
            },
            set: function(a, c, d) {
                return v(a, c, d ? x(a, b, d, m.support.boxSizing && "border-box" === m.css(a, "boxSizing")) : 0)
            }
        }
    });
    m.support.opacity || (m.cssHooks.opacity = {
        get: function(a, b) {
            return be.test((b && a.currentStyle ? a.currentStyle.filter : a.style.filter) || "") ? 0.01 * parseFloat(RegExp.$1) + "" : b ? "1" : ""
        },
        set: function(a, b) {
            var c = a.style
              , d = a.currentStyle
              , e = m.isNumeric(b) ? "alpha(opacity=" + 100 * b + ")" : ""
              , f = d && d.filter || c.filter || "";
            c.zoom = 1;
            if (1 <= b && "" === m.trim(f.replace(qd, "")) && c.removeAttribute && (c.removeAttribute("filter"),
            d && !d.filter))
                return;
            c.filter = qd.test(f) ? f.replace(qd, e) : f + " " + e
        }
    });
    m(function() {
        m.support.reliableMarginRight || (m.cssHooks.marginRight = {
            get: function(a, b) {
                return m.swap(a, {
                    display: "inline-block"
                }, function() {
                    if (b)
                        return db(a, "marginRight")
                })
            }
        });
        !m.support.pixelPosition && m.fn.position && m.each(["top", "left"], function(a, b) {
            m.cssHooks[b] = {
                get: function(a, c) {
                    if (c) {
                        var d = db(a, b);
                        return Vc.test(d) ? m(a).position()[b] + "px" : d
                    }
                }
            }
        })
    });
    m.expr && m.expr.filters && (m.expr.filters.hidden = function(a) {
        return 0 === a.offsetWidth && 0 === a.offsetHeight || !m.support.reliableHiddenOffsets && "none" === (a.style && a.style.display || db(a, "display"))
    }
    ,
    m.expr.filters.visible = function(a) {
        return !m.expr.filters.hidden(a)
    }
    );
    m.each({
        margin: "",
        padding: "",
        border: "Width"
    }, function(a, b) {
        m.cssHooks[a + b] = {
            expand: function(c) {
                for (var d = "string" == typeof c ? c.split(" ") : [c], e = {}, c = 0; 4 > c; c++)
                    e[a + rc[c] + b] = d[c] || d[c - 2] || d[0];
                return e
            }
        };
        Fd.test(a) || (m.cssHooks[a + b].set = v)
    });
    var fe = /%20/g
      , Pd = /\[\]$/
      , Hd = /\r?\n/g
      , tb = /^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i
      , ja = /^(?:select|textarea)/i;
    m.fn.extend({
        serialize: function() {
            return m.param(this.serializeArray())
        },
        serializeArray: function() {
            return this.map(function() {
                return this.elements ? m.makeArray(this.elements) : this
            }).filter(function() {
                return this.name && !this.disabled && (this.checked || ja.test(this.nodeName) || tb.test(this.type))
            }).map(function(a, b) {
                var c = m(this).val();
                return null == c ? null : m.isArray(c) ? m.map(c, function(a) {
                    return {
                        name: b.name,
                        value: a.replace(Hd, "\r\n")
                    }
                }) : {
                    name: b.name,
                    value: c.replace(Hd, "\r\n")
                }
            }).get()
        }
    });
    m.param = function(a, c) {
        var d, e = [], f = function(a, b) {
            b = m.isFunction(b) ? b() : null == b ? "" : b;
            e[e.length] = encodeURIComponent(a) + "=" + encodeURIComponent(b)
        };
        c === b && (c = m.ajaxSettings && m.ajaxSettings.traditional);
        if (m.isArray(a) || a.jquery && !m.isPlainObject(a))
            m.each(a, function() {
                f(this.name, this.value)
            });
        else
            for (d in a)
                E(d, a[d], c, f);
        return e.join("&").replace(fe, "+")
    }
    ;
    var ub, mb, Za = /#.*$/, ge = /^(.*?):[ \t]*([^\r\n]*)\r?$/mg, he = /^(?:GET|HEAD)$/, ga = /^\/\//, $c = /\?/, ab = /<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi, rd = /([?&])_=[^&]*/, Ub = /^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/, Pc = m.fn.load, sc = {}, Qc = {}, uc = ["*/"] + ["*"];
    try {
        ub = B.href
    } catch (O) {
        ub = D.createElement("a"),
        ub.href = "",
        ub = ub.href
    }
    mb = Ub.exec(ub.toLowerCase()) || [];
    m.fn.load = function(a, c, d) {
        if ("string" != typeof a && Pc)
            return Pc.apply(this, arguments);
        if (!this.length)
            return this;
        var e, f, g, h = this, i = a.indexOf(" ");
        return 0 <= i && (e = a.slice(i, a.length),
        a = a.slice(0, i)),
        m.isFunction(c) ? (d = c,
        c = b) : "object" == typeof c && (f = "POST"),
        m.ajax({
            url: a,
            type: f,
            dataType: "html",
            data: c,
            complete: function(a, b) {
                d && h.each(d, g || [a.responseText, b, a])
            }
        }).done(function(a) {
            g = arguments;
            h.html(e ? m("<div>").append(a.replace(ab, "")).find(e) : a)
        }),
        this
    }
    ;
    m.each("ajaxStart,ajaxStop,ajaxComplete,ajaxError,ajaxSuccess,ajaxSend".split(","), function(a, b) {
        m.fn[b] = function(a) {
            return this.on(b, a)
        }
    });
    m.each(["get", "post"], function(a, c) {
        m[c] = function(a, d, e, f) {
            return m.isFunction(d) && (f = f || e,
            e = d,
            d = b),
            m.ajax({
                type: c,
                url: a,
                data: d,
                success: e,
                dataType: f
            })
        }
    });
    m.extend({
        getScript: function(a, c) {
            return m.get(a, b, c, "script")
        },
        getJSON: function(a, b, c) {
            return m.get(a, b, c, "json")
        },
        ajaxSetup: function(a, b) {
            return b ? w(a, m.ajaxSettings) : (b = a,
            a = m.ajaxSettings),
            w(a, b),
            a
        },
        ajaxSettings: {
            url: ub,
            isLocal: /^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/.test(mb[1]),
            global: !0,
            type: "GET",
            contentType: "application/x-www-form-urlencoded; charset=UTF-8",
            processData: !0,
            async: !0,
            accepts: {
                xml: "application/xml, text/xml",
                html: "text/html",
                text: "text/plain",
                json: "application/json, text/javascript",
                "*": uc
            },
            contents: {
                xml: /xml/,
                html: /html/,
                json: /json/
            },
            responseFields: {
                xml: "responseXML",
                text: "responseText"
            },
            converters: {
                "* text": a.String,
                "text html": !0,
                "text json": m.parseJSON,
                "text xml": m.parseXML
            },
            flatOptions: {
                context: !0,
                url: !0
            }
        },
        ajaxPrefilter: z(sc),
        ajaxTransport: z(Qc),
        ajax: function(a, c) {
            function d(a, c, g, j) {
                var n, B, t, u, T, Q = c;
                if (2 !== pa) {
                    pa = 2;
                    i && clearTimeout(i);
                    h = b;
                    f = j || "";
                    w.readyState = 0 < a ? 4 : 0;
                    if (g) {
                        u = l;
                        var j = w, v, D, A, M, pb = u.contents, x = u.dataTypes, y = u.responseFields;
                        for (D in y)
                            D in g && (j[y[D]] = g[D]);
                        for (; "*" === x[0]; )
                            x.shift(),
                            v === b && (v = u.mimeType || j.getResponseHeader("content-type"));
                        if (v)
                            for (D in pb)
                                if (pb[D] && pb[D].test(v)) {
                                    x.unshift(D);
                                    break
                                }
                        if (x[0]in g)
                            A = x[0];
                        else {
                            for (D in g) {
                                if (!x[0] || u.converters[D + " " + x[0]]) {
                                    A = D;
                                    break
                                }
                                M || (M = D)
                            }
                            A = A || M
                        }
                        u = A ? (A !== x[0] && x.unshift(A),
                        g[A]) : void 0
                    }
                    if (200 <= a && 300 > a || 304 === a)
                        if (l.ifModified && (T = w.getResponseHeader("Last-Modified"),
                        T && (m.lastModified[e] = T),
                        T = w.getResponseHeader("Etag"),
                        T && (m.etag[e] = T)),
                        304 === a)
                            Q = "notmodified",
                            n = !0;
                        else {
                            var la;
                            a: {
                                g = l;
                                n = u;
                                var U;
                                T = g.dataTypes.slice();
                                Q = T[0];
                                v = {};
                                D = 0;
                                g.dataFilter && (n = g.dataFilter(n, g.dataType));
                                if (T[1])
                                    for (la in g.converters)
                                        v[la.toLowerCase()] = g.converters[la];
                                for (; B = T[++D]; )
                                    if ("*" !== B) {
                                        if ("*" !== Q && Q !== B) {
                                            la = v[Q + " " + B] || v["* " + B];
                                            if (!la)
                                                for (U in v)
                                                    if (t = U.split(" "),
                                                    t[1] === B && (la = v[Q + " " + t[0]] || v["* " + t[0]])) {
                                                        !0 === la ? la = v[U] : !0 !== v[U] && (B = t[0],
                                                        T.splice(D--, 0, B));
                                                        break
                                                    }
                                            if (!0 !== la)
                                                if (la && g["throws"])
                                                    n = la(n);
                                                else
                                                    try {
                                                        n = la(n)
                                                    } catch (F) {
                                                        la = {
                                                            state: "parsererror",
                                                            error: la ? F : "No conversion from " + Q + " to " + B
                                                        };
                                                        break a
                                                    }
                                        }
                                        Q = B
                                    }
                                la = {
                                    state: "success",
                                    data: n
                                }
                            }
                            n = la;
                            Q = n.state;
                            B = n.data;
                            t = n.error;
                            n = !t
                        }
                    else if (t = Q,
                    !Q || a)
                        Q = "error",
                        0 > a && (a = 0);
                    w.status = a;
                    w.statusText = "" + (c || Q);
                    n ? q.resolveWith(p, [B, Q, w]) : q.rejectWith(p, [w, Q, t]);
                    w.statusCode(s);
                    s = b;
                    k && o.trigger("ajax" + (n ? "Success" : "Error"), [w, l, n ? B : t]);
                    r.fireWith(p, [w, Q]);
                    k && (o.trigger("ajaxComplete", [w, l]),
                    --m.active || m.event.trigger("ajaxStop"))
                }
            }
            "object" == typeof a && (c = a,
            a = b);
            var c = c || {}, e, f, g, h, i, j, k, n, l = m.ajaxSetup({}, c), p = l.context || l, o = p !== l && (p.nodeType || p instanceof m) ? m(p) : m.event, q = m.Deferred(), r = m.Callbacks("once memory"), s = l.statusCode || {}, B = {}, t = {}, pa = 0, u = "canceled", w = {
                readyState: 0,
                setRequestHeader: function(a, b) {
                    if (!pa) {
                        var c = a.toLowerCase()
                          , a = t[c] = t[c] || a;
                        B[a] = b
                    }
                    return this
                },
                getAllResponseHeaders: function() {
                    return 2 === pa ? f : null
                },
                getResponseHeader: function(a) {
                    var c;
                    if (2 === pa) {
                        if (!g)
                            for (g = {}; c = ge.exec(f); )
                                g[c[1].toLowerCase()] = c[2];
                        c = g[a.toLowerCase()]
                    }
                    return c === b ? null : c
                },
                overrideMimeType: function(a) {
                    return pa || (l.mimeType = a),
                    this
                },
                abort: function(a) {
                    return a = a || u,
                    h && h.abort(a),
                    d(0, a),
                    this
                }
            };
            q.promise(w);
            w.success = w.done;
            w.error = w.fail;
            w.complete = r.add;
            w.statusCode = function(a) {
                if (a) {
                    var b;
                    if (2 > pa)
                        for (b in a)
                            s[b] = [s[b], a[b]];
                    else
                        b = a[w.status],
                        w.always(b)
                }
                return this
            }
            ;
            l.url = ((a || l.url) + "").replace(Za, "").replace(ga, mb[1] + "//");
            l.dataTypes = m.trim(l.dataType || "*").toLowerCase().split(Ga);
            null == l.crossDomain && (j = Ub.exec(l.url.toLowerCase()),
            l.crossDomain = !(!j || j[1] == mb[1] && j[2] == mb[2] && (j[3] || ("http:" === j[1] ? 80 : 443)) == (mb[3] || ("http:" === mb[1] ? 80 : 443))));
            l.data && l.processData && "string" != typeof l.data && (l.data = m.param(l.data, l.traditional));
            C(sc, l, c, w);
            if (2 === pa)
                return w;
            k = l.global;
            l.type = l.type.toUpperCase();
            l.hasContent = !he.test(l.type);
            k && 0 === m.active++ && m.event.trigger("ajaxStart");
            if (!l.hasContent && (l.data && (l.url += ($c.test(l.url) ? "&" : "?") + l.data,
            delete l.data),
            e = l.url,
            !1 === l.cache)) {
                j = m.now();
                var T = l.url.replace(rd, "$1_=" + j);
                l.url = T + (T === l.url ? ($c.test(l.url) ? "&" : "?") + "_=" + j : "")
            }
            (l.data && l.hasContent && !1 !== l.contentType || c.contentType) && w.setRequestHeader("Content-Type", l.contentType);
            l.ifModified && (e = e || l.url,
            m.lastModified[e] && w.setRequestHeader("If-Modified-Since", m.lastModified[e]),
            m.etag[e] && w.setRequestHeader("If-None-Match", m.etag[e]));
            w.setRequestHeader("Accept", l.dataTypes[0] && l.accepts[l.dataTypes[0]] ? l.accepts[l.dataTypes[0]] + ("*" !== l.dataTypes[0] ? ", " + uc + "; q=0.01" : "") : l.accepts["*"]);
            for (n in l.headers)
                w.setRequestHeader(n, l.headers[n]);
            if (!l.beforeSend || !1 !== l.beforeSend.call(p, w, l) && 2 !== pa) {
                u = "abort";
                for (n in {
                    success: 1,
                    error: 1,
                    complete: 1
                })
                    w[n](l[n]);
                if (h = C(Qc, l, c, w)) {
                    w.readyState = 1;
                    k && o.trigger("ajaxSend", [w, l]);
                    l.async && 0 < l.timeout && (i = setTimeout(function() {
                        w.abort("timeout")
                    }, l.timeout));
                    try {
                        pa = 1,
                        h.send(B, d)
                    } catch (Q) {
                        if (2 > pa)
                            d(-1, Q);
                        else
                            throw Q;
                    }
                } else
                    d(-1, "No Transport");
                return w
            }
            return w.abort()
        },
        active: 0,
        lastModified: {},
        etag: {}
    });
    var V = []
      , nb = /\?/
      , S = /(=)\?(?=&|$)|\?\?/
      , kc = m.now();
    m.ajaxSetup({
        jsonp: "callback",
        jsonpCallback: function() {
            var a = V.pop() || m.expando + "_" + kc++;
            return this[a] = !0,
            a
        }
    });
    m.ajaxPrefilter("json jsonp", function(c, d, e) {
        var f, g, h, i = c.data, j = c.url, k = !1 !== c.jsonp, l = k && S.test(j), n = k && !l && "string" == typeof i && !(c.contentType || "").indexOf("application/x-www-form-urlencoded") && S.test(i);
        if ("jsonp" === c.dataTypes[0] || l || n)
            return f = c.jsonpCallback = m.isFunction(c.jsonpCallback) ? c.jsonpCallback() : c.jsonpCallback,
            g = a[f],
            l ? c.url = j.replace(S, "$1" + f) : n ? c.data = i.replace(S, "$1" + f) : k && (c.url += (nb.test(j) ? "&" : "?") + c.jsonp + "=" + f),
            c.converters["script json"] = function() {
                return h || m.error(f + " was not called"),
                h[0]
            }
            ,
            c.dataTypes[0] = "json",
            a[f] = function() {
                h = arguments
            }
            ,
            e.always(function() {
                a[f] = g;
                c[f] && (c.jsonpCallback = d.jsonpCallback,
                V.push(f));
                h && m.isFunction(g) && g(h[0]);
                h = g = b
            }),
            "script"
    });
    m.ajaxSetup({
        accepts: {
            script: "text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"
        },
        contents: {
            script: /javascript|ecmascript/
        },
        converters: {
            "text script": function(a) {
                return m.globalEval(a),
                a
            }
        }
    });
    m.ajaxPrefilter("script", function(a) {
        a.cache === b && (a.cache = !1);
        a.crossDomain && (a.type = "GET",
        a.global = !1)
    });
    m.ajaxTransport("script", function(a) {
        if (a.crossDomain) {
            var c, d = D.head || D.getElementsByTagName("head")[0] || D.documentElement;
            return {
                send: function(e, f) {
                    c = D.createElement("script");
                    c.async = "async";
                    a.scriptCharset && (c.charset = a.scriptCharset);
                    c.src = a.url;
                    c.onload = c.onreadystatechange = function(a, e) {
                        if (e || !c.readyState || /loaded|complete/.test(c.readyState))
                            c.onload = c.onreadystatechange = null,
                            d && c.parentNode && d.removeChild(c),
                            c = b,
                            e || f(200, "success")
                    }
                    ;
                    d.insertBefore(c, d.firstChild)
                },
                abort: function() {
                    c && c.onload(0, 1)
                }
            }
        }
    });
    var hb, ib = a.ActiveXObject ? function() {
        for (var a in hb)
            hb[a](0, 1)
    }
    : !1, Fc = 0;
    m.ajaxSettings.xhr = a.ActiveXObject ? function() {
        var b;
        if (!(b = !this.isLocal && H()))
            a: {
                try {
                    b = new a.ActiveXObject("Microsoft.XMLHTTP");
                    break a
                } catch (c) {}
                b = void 0
            }
        return b
    }
    : H;
    (function(a) {
        m.extend(m.support, {
            ajax: !!a,
            cors: !!a && "withCredentials"in a
        })
    }
    )(m.ajaxSettings.xhr());
    m.support.ajax && m.ajaxTransport(function(c) {
        if (!c.crossDomain || m.support.cors) {
            var d;
            return {
                send: function(e, f) {
                    var g, h, i = c.xhr();
                    c.username ? i.open(c.type, c.url, c.async, c.username, c.password) : i.open(c.type, c.url, c.async);
                    if (c.xhrFields)
                        for (h in c.xhrFields)
                            i[h] = c.xhrFields[h];
                    c.mimeType && i.overrideMimeType && i.overrideMimeType(c.mimeType);
                    !c.crossDomain && !e["X-Requested-With"] && (e["X-Requested-With"] = "XMLHttpRequest");
                    try {
                        for (h in e)
                            i.setRequestHeader(h, e[h])
                    } catch (j) {}
                    i.send(c.hasContent && c.data || null);
                    d = function(a, e) {
                        var h, j, k, l, n;
                        try {
                            if (d && (e || 4 === i.readyState))
                                if (d = b,
                                g && (i.onreadystatechange = m.noop,
                                ib && delete hb[g]),
                                e)
                                    4 !== i.readyState && i.abort();
                                else {
                                    h = i.status;
                                    k = i.getAllResponseHeaders();
                                    l = {};
                                    (n = i.responseXML) && n.documentElement && (l.xml = n);
                                    try {
                                        l.text = i.responseText
                                    } catch (p) {}
                                    try {
                                        j = i.statusText
                                    } catch (o) {
                                        j = ""
                                    }
                                    !h && c.isLocal && !c.crossDomain ? h = l.text ? 200 : 404 : 1223 === h && (h = 204)
                                }
                        } catch (q) {
                            e || f(-1, q)
                        }
                        l && f(h, j, l, k)
                    }
                    ;
                    c.async ? 4 === i.readyState ? setTimeout(d, 0) : (g = ++Fc,
                    ib && (hb || (hb = {},
                    m(a).unload(ib)),
                    hb[g] = d),
                    i.onreadystatechange = d) : d()
                },
                abort: function() {
                    d && d(0, 1)
                }
            }
        }
    });
    var jb, Cb, lc = /^(?:toggle|show|hide)$/, Y = RegExp("^(?:([-+])=|)(" + Ha + ")([a-z%]*)$", "i"), Z = /queueHooks$/, W = [function(a, b, c) {
        var d, e, f, g, h, i, j = this, k = a.style, l = {}, n = [], p = a.nodeType && s(a);
        c.queue || (h = m._queueHooks(a, "fx"),
        null == h.unqueued && (h.unqueued = 0,
        i = h.empty.fire,
        h.empty.fire = function() {
            h.unqueued || i()
        }
        ),
        h.unqueued++,
        j.always(function() {
            j.always(function() {
                h.unqueued--;
                m.queue(a, "fx").length || h.empty.fire()
            })
        }));
        1 === a.nodeType && ("height"in b || "width"in b) && (c.overflow = [k.overflow, k.overflowX, k.overflowY],
        "inline" === m.css(a, "display") && "none" === m.css(a, "float") && (!m.support.inlineBlockNeedsLayout || "inline" === y(a.nodeName) ? k.display = "inline-block" : k.zoom = 1));
        c.overflow && (k.overflow = "hidden",
        m.support.shrinkWrapBlocks || j.done(function() {
            k.overflow = c.overflow[0];
            k.overflowX = c.overflow[1];
            k.overflowY = c.overflow[2]
        }));
        for (d in b)
            e = b[d],
            lc.exec(e) && (delete b[d],
            e !== (p ? "hide" : "show") && n.push(d));
        if (e = n.length) {
            f = m._data(a, "fxshow") || m._data(a, "fxshow", {});
            p ? m(a).show() : j.done(function() {
                m(a).hide()
            });
            j.done(function() {
                var b;
                m.removeData(a, "fxshow", !0);
                for (b in l)
                    m.style(a, b, l[b])
            });
            for (d = 0; d < e; d++)
                b = n[d],
                g = j.createTween(b, p ? f[b] : 0),
                l[b] = f[b] || m.style(a, b),
                b in f || (f[b] = g.start,
                p && (g.end = g.start,
                g.start = "width" === b || "height" === b ? 1 : 0))
        }
    }
    ], ka = {
        "*": [function(a, b) {
            var c, d, e, f = this.createTween(a, b), g = Y.exec(b), h = f.cur(), i = +h || 0, j = 1;
            if (g) {
                c = +g[2];
                d = g[3] || (m.cssNumber[a] ? "" : "px");
                if ("px" !== d && i) {
                    i = m.css(f.elem, a, !0) || c || 1;
                    do
                        e = j = j || ".5",
                        i /= j,
                        m.style(f.elem, a, i + d),
                        j = f.cur() / h;
                    while (1 !== j && j !== e)
                }
                f.unit = d;
                f.start = i;
                f.end = g[1] ? i + (g[1] + 1) * c : c
            }
            return f
        }
        ]
    };
    m.Animation = m.extend(P, {
        tweener: function(a, b) {
            m.isFunction(a) ? (b = a,
            a = ["*"]) : a = a.split(" ");
            for (var c, d = 0, e = a.length; d < e; d++)
                c = a[d],
                ka[c] = ka[c] || [],
                ka[c].unshift(b)
        },
        prefilter: function(a, b) {
            b ? W.unshift(a) : W.push(a)
        }
    });
    m.Tween = A;
    A.prototype = {
        constructor: A,
        init: function(a, b, c, d, e, f) {
            this.elem = a;
            this.prop = c;
            this.easing = e || "swing";
            this.options = b;
            this.start = this.now = this.cur();
            this.end = d;
            this.unit = f || (m.cssNumber[c] ? "" : "px")
        },
        cur: function() {
            var a = A.propHooks[this.prop];
            return a && a.get ? a.get(this) : A.propHooks._default.get(this)
        },
        run: function(a) {
            var b, c = A.propHooks[this.prop];
            return this.pos = b = m.easing[this.easing](a, this.options.duration * a, 0, 1, this.options.duration),
            this.now = (this.end - this.start) * b + this.start,
            this.options.step && this.options.step.call(this.elem, this.now, this),
            c && c.set ? c.set(this) : A.propHooks._default.set(this),
            this
        }
    };
    A.prototype.init.prototype = A.prototype;
    A.propHooks = {
        _default: {
            get: function(a) {
                var b;
                return null == a.elem[a.prop] || a.elem.style && null != a.elem.style[a.prop] ? (b = m.css(a.elem, a.prop, !1, ""),
                !b || "auto" === b ? 0 : b) : a.elem[a.prop]
            },
            set: function(a) {
                m.fx.step[a.prop] ? m.fx.step[a.prop](a) : a.elem.style && (null != a.elem.style[m.cssProps[a.prop]] || m.cssHooks[a.prop]) ? m.style(a.elem, a.prop, a.now + a.unit) : a.elem[a.prop] = a.now
            }
        }
    };
    A.propHooks.scrollTop = A.propHooks.scrollLeft = {
        set: function(a) {
            a.elem.nodeType && a.elem.parentNode && (a.elem[a.prop] = a.now)
        }
    };
    m.each(["toggle", "show", "hide"], function(a, b) {
        var c = m.fn[b];
        m.fn[b] = function(d, e, f) {
            return null == d || "boolean" == typeof d || !a && m.isFunction(d) && m.isFunction(e) ? c.apply(this, arguments) : this.animate(J(b, !0), d, e, f)
        }
    });
    m.fn.extend({
        fadeTo: function(a, b, c, d) {
            return this.filter(s).css("opacity", 0).show().end().animate({
                opacity: b
            }, a, c, d)
        },
        animate: function(a, b, c, d) {
            var e = m.isEmptyObject(a)
              , f = m.speed(b, c, d)
              , b = function() {
                var b = P(this, m.extend({}, a), f);
                e && b.stop(!0)
            };
            return e || !1 === f.queue ? this.each(b) : this.queue(f.queue, b)
        },
        stop: function(a, c, d) {
            var e = function(a) {
                var b = a.stop;
                delete a.stop;
                b(d)
            };
            return "string" != typeof a && (d = c,
            c = a,
            a = b),
            c && !1 !== a && this.queue(a || "fx", []),
            this.each(function() {
                var b = !0
                  , c = null != a && a + "queueHooks"
                  , f = m.timers
                  , g = m._data(this);
                if (c)
                    g[c] && g[c].stop && e(g[c]);
                else
                    for (c in g)
                        g[c] && g[c].stop && Z.test(c) && e(g[c]);
                for (c = f.length; c--; )
                    f[c].elem === this && (null == a || f[c].queue === a) && (f[c].anim.stop(d),
                    b = !1,
                    f.splice(c, 1));
                (b || !d) && m.dequeue(this, a)
            })
        }
    });
    m.each({
        slideDown: J("show"),
        slideUp: J("hide"),
        slideToggle: J("toggle"),
        fadeIn: {
            opacity: "show"
        },
        fadeOut: {
            opacity: "hide"
        },
        fadeToggle: {
            opacity: "toggle"
        }
    }, function(a, b) {
        m.fn[a] = function(a, c, d) {
            return this.animate(b, a, c, d)
        }
    });
    m.speed = function(a, b, c) {
        var d = a && "object" == typeof a ? m.extend({}, a) : {
            complete: c || !c && b || m.isFunction(a) && a,
            duration: a,
            easing: c && b || b && !m.isFunction(b) && b
        };
        d.duration = m.fx.off ? 0 : "number" == typeof d.duration ? d.duration : d.duration in m.fx.speeds ? m.fx.speeds[d.duration] : m.fx.speeds._default;
        if (null == d.queue || !0 === d.queue)
            d.queue = "fx";
        return d.old = d.complete,
        d.complete = function() {
            m.isFunction(d.old) && d.old.call(this);
            d.queue && m.dequeue(this, d.queue)
        }
        ,
        d
    }
    ;
    m.easing = {
        linear: function(a) {
            return a
        },
        swing: function(a) {
            return 0.5 - Math.cos(a * Math.PI) / 2
        }
    };
    m.timers = [];
    m.fx = A.prototype.init;
    m.fx.tick = function() {
        for (var a, b = m.timers, c = 0; c < b.length; c++)
            a = b[c],
            !a() && b[c] === a && b.splice(c--, 1);
        b.length || m.fx.stop()
    }
    ;
    m.fx.timer = function(a) {
        a() && m.timers.push(a) && !Cb && (Cb = setInterval(m.fx.tick, m.fx.interval))
    }
    ;
    m.fx.interval = 13;
    m.fx.stop = function() {
        clearInterval(Cb);
        Cb = null
    }
    ;
    m.fx.speeds = {
        slow: 600,
        fast: 200,
        _default: 400
    };
    m.fx.step = {};
    m.expr && m.expr.filters && (m.expr.filters.animated = function(a) {
        return m.grep(m.timers, function(b) {
            return a === b.elem
        }).length
    }
    );
    var vb = /^(?:body|html)$/i;
    m.fn.offset = function(a) {
        if (arguments.length)
            return a === b ? this : this.each(function(b) {
                m.offset.setOffset(this, a, b)
            });
        var c, d, e, f, g, h, i, j, k, l, n = this[0], p = n && n.ownerDocument;
        return !p ? void 0 : (e = p.body) === n ? m.offset.bodyOffset(n) : (d = p.documentElement,
        m.contains(d, n) ? (c = n.getBoundingClientRect(),
        f = F(p),
        g = d.clientTop || e.clientTop || 0,
        h = d.clientLeft || e.clientLeft || 0,
        i = f.pageYOffset || d.scrollTop,
        j = f.pageXOffset || d.scrollLeft,
        k = c.top + i - g,
        l = c.left + j - h,
        {
            top: k,
            left: l
        }) : {
            top: 0,
            left: 0
        })
    }
    ;
    m.offset = {
        bodyOffset: function(a) {
            var b = a.offsetTop
              , c = a.offsetLeft;
            return m.support.doesNotIncludeMarginInBodyOffset && (b += parseFloat(m.css(a, "marginTop")) || 0,
            c += parseFloat(m.css(a, "marginLeft")) || 0),
            {
                top: b,
                left: c
            }
        },
        setOffset: function(a, b, c) {
            var d = m.css(a, "position");
            "static" === d && (a.style.position = "relative");
            var e = m(a), f = e.offset(), g = m.css(a, "top"), h = m.css(a, "left"), i = {}, j = {}, k, l;
            ("absolute" === d || "fixed" === d) && -1 < m.inArray("auto", [g, h]) ? (j = e.position(),
            k = j.top,
            l = j.left) : (k = parseFloat(g) || 0,
            l = parseFloat(h) || 0);
            m.isFunction(b) && (b = b.call(a, c, f));
            null != b.top && (i.top = b.top - f.top + k);
            null != b.left && (i.left = b.left - f.left + l);
            "using"in b ? b.using.call(a, i) : e.css(i)
        }
    };
    m.fn.extend({
        position: function() {
            if (this[0]) {
                var a = this[0]
                  , b = this.offsetParent()
                  , c = this.offset()
                  , d = vb.test(b[0].nodeName) ? {
                    top: 0,
                    left: 0
                } : b.offset();
                return c.top -= parseFloat(m.css(a, "marginTop")) || 0,
                c.left -= parseFloat(m.css(a, "marginLeft")) || 0,
                d.top += parseFloat(m.css(b[0], "borderTopWidth")) || 0,
                d.left += parseFloat(m.css(b[0], "borderLeftWidth")) || 0,
                {
                    top: c.top - d.top,
                    left: c.left - d.left
                }
            }
        },
        offsetParent: function() {
            return this.map(function() {
                for (var a = this.offsetParent || D.body; a && !vb.test(a.nodeName) && "static" === m.css(a, "position"); )
                    a = a.offsetParent;
                return a || D.body
            })
        }
    });
    m.each({
        scrollLeft: "pageXOffset",
        scrollTop: "pageYOffset"
    }, function(a, c) {
        var d = /Y/.test(c);
        m.fn[a] = function(e) {
            return m.access(this, function(a, e, f) {
                var g = F(a);
                if (f === b)
                    return g ? c in g ? g[c] : g.document.documentElement[e] : a[e];
                g ? g.scrollTo(d ? m(g).scrollLeft() : f, d ? f : m(g).scrollTop()) : a[e] = f
            }, a, e, arguments.length, null)
        }
    });
    m.each({
        Height: "height",
        Width: "width"
    }, function(a, c) {
        m.each({
            padding: "inner" + a,
            content: c,
            "": "outer" + a
        }, function(d, e) {
            m.fn[e] = function(e, f) {
                var g = arguments.length && (d || "boolean" != typeof e)
                  , h = d || (!0 === e || !0 === f ? "margin" : "border");
                return m.access(this, function(c, d, e) {
                    var f;
                    return m.isWindow(c) ? c.document.documentElement["client" + a] : 9 === c.nodeType ? (f = c.documentElement,
                    Math.max(c.body["scroll" + a], f["scroll" + a], c.body["offset" + a], f["offset" + a], f["client" + a])) : e === b ? m.css(c, d, e, h) : m.style(c, d, e, h)
                }, c, g ? e : b, g)
            }
        })
    });
    a.jQuery = a.$ = m;
    "function" == typeof define && define.amd && define.amd.jQuery && define("jquery", [], function() {
        return m
    })
}
)(window);
(function(a, b, c) {
    function d(a) {
        return a
    }
    function e(a) {
        return decodeURIComponent(a.replace(f, " "))
    }
    var f = /\+/g
      , g = a.cookie = function(f, i, j) {
        if (i !== c) {
            j = a.extend({}, g.defaults, j);
            null === i && (j.expires = -1);
            if ("number" === typeof j.expires) {
                var k = j.expires
                  , n = j.expires = new Date;
                n.setDate(n.getDate() + k)
            }
            i = g.json ? JSON.stringify(i) : "" + i;
            return b.cookie = [encodeURIComponent(f), "=", g.raw ? i : encodeURIComponent(i), j.expires ? "; expires=" + j.expires.toUTCString() : "", j.path ? "; path=" + j.path : "", j.domain ? "; domain=" + j.domain : "", j.secure ? "; secure" : ""].join("")
        }
        i = g.raw ? d : e;
        j = b.cookie.split("; ");
        for (k = 0; n = j[k] && j[k].split("="); k++)
            if (i(n.shift()) === f)
                return f = i(n.join("=")),
                g.json ? JSON.parse(f) : f;
        return null
    }
    ;
    g.defaults = {};
    a.removeCookie = function(b, c) {
        return null !== a.cookie(b, c) ? (a.cookie(b, null, c),
        !0) : !1
    }
}
)(jQuery, document);
(function(a) {
    function b(b, d) {
        this.$element = a(b);
        this.options = d;
        this.enabled = !0;
        this.fixTitle()
    }
    b.prototype = {
        show: function() {
            var b = this.getTitle();
            if (b && this.enabled) {
                var d = this.tip();
                d.find(".tipsy-inner")[this.options.html ? "html" : "text"](b);
                d[0].className = "tipsy";
                d.remove().css({
                    top: 0,
                    left: 0,
                    visibility: "hidden",
                    display: "block"
                }).prependTo(document.body);
                var b = a.extend({}, this.$element.offset(), {
                    width: this.$element[0].offsetWidth,
                    height: this.$element[0].offsetHeight
                }), e = d[0].offsetWidth, f = d[0].offsetHeight, g = "function" == typeof this.options.gravity ? this.options.gravity.call(this.$element[0]) : this.options.gravity, h;
                switch (g.charAt(0)) {
                case "n":
                    h = {
                        top: b.top + b.height + this.options.offset,
                        left: b.left + b.width / 2 - e / 2
                    };
                    break;
                case "s":
                    h = {
                        top: b.top - f - this.options.offset,
                        left: b.left + b.width / 2 - e / 2
                    };
                    break;
                case "e":
                    h = {
                        top: b.top + b.height / 2 - f / 2,
                        left: b.left - e - this.options.offset
                    };
                    break;
                case "w":
                    h = {
                        top: b.top + b.height / 2 - f / 2,
                        left: b.left + b.width + this.options.offset
                    }
                }
                2 == g.length && (h.left = "w" == g.charAt(1) ? b.left + b.width / 2 - 15 : b.left + b.width / 2 - e + 15);
                d.css(h).addClass("tipsy-" + g);
                d.find(".tipsy-arrow")[0].className = "tipsy-arrow tipsy-arrow-" + g.charAt(0);
                this.options.className && d.addClass("function" == typeof this.options.className ? this.options.className.call(this.$element[0]) : this.options.className);
                this.options.fade ? d.stop().css({
                    opacity: 0,
                    display: "block",
                    visibility: "visible"
                }).animate({
                    opacity: this.options.opacity
                }) : d.css({
                    visibility: "visible",
                    opacity: this.options.opacity
                })
            }
        },
        hide: function() {
            this.options.fade ? this.tip().stop().fadeOut(function() {
                a(this).remove()
            }) : this.tip().remove()
        },
        fixTitle: function() {
            var a = this.$element;
            if (a.attr("title") || "string" != typeof a.attr("original-title"))
                a.attr("original-title", a.attr("title") || "").removeAttr("title")
        },
        getTitle: function() {
            var a, b = this.$element, e = this.options;
            this.fixTitle();
            e = this.options;
            "string" == typeof e.title ? a = b.attr("title" == e.title ? "original-title" : e.title) : "function" == typeof e.title && (a = e.title.call(b[0]));
            return (a = ("" + a).replace(/(^\s*|\s*$)/, "")) || e.fallback
        },
        tip: function() {
            this.$tip || (this.$tip = a('<div class="tipsy"></div>').html('<div class="tipsy-arrow"></div><div class="tipsy-inner"></div>'),
            this.$tip.data("tipsy-pointee", this.$element[0]));
            return this.$tip
        },
        validate: function() {
            this.$element[0].parentNode || (this.hide(),
            this.options = this.$element = null)
        },
        enable: function() {
            this.enabled = !0
        },
        disable: function() {
            this.enabled = !1
        },
        toggleEnabled: function() {
            this.enabled = !this.enabled
        }
    };
    a.fn.tipsy = function(c) {
        function d(d) {
            var e = a.data(d, "tipsy");
            e || (e = new b(d,a.fn.tipsy.elementOptions(d, c)),
            a.data(d, "tipsy", e));
            return e
        }
        function e() {
            var a = d(this);
            a.hoverState = "in";
            0 == c.delayIn ? a.show() : (a.fixTitle(),
            setTimeout(function() {
                "in" == a.hoverState && a.show()
            }, c.delayIn))
        }
        function f() {
            var a = d(this);
            a.hoverState = "out";
            0 == c.delayOut ? a.hide() : setTimeout(function() {
                "out" == a.hoverState && a.hide()
            }, c.delayOut)
        }
        if (!0 === c)
            return this.data("tipsy");
        if ("string" == typeof c) {
            var g = this.data("tipsy");
            if (g)
                g[c]();
            return this
        }
        c = a.extend({}, a.fn.tipsy.defaults, c);
        c.live || this.each(function() {
            d(this)
        });
        if ("manual" != c.trigger) {
            var g = c.live ? "live" : "bind"
              , h = "hover" == c.trigger ? "mouseleave" : "blur";
            this[g]("hover" == c.trigger ? "mouseenter" : "focus", e)[g](h, f)
        }
        return this
    }
    ;
    a.fn.tipsy.defaults = {
        className: null,
        delayIn: 0,
        delayOut: 0,
        fade: !1,
        fallback: "",
        gravity: "n",
        html: !1,
        live: !1,
        offset: 0,
        opacity: 0.8,
        title: "title",
        trigger: "hover"
    };
    a.fn.tipsy.revalidate = function() {
        a(".tipsy").each(function() {
            var b = a.data(this, "tipsy-pointee"), d;
            if (!(d = !b)) {
                a: {
                    for (; b = b.parentNode; )
                        if (b == document) {
                            b = !0;
                            break a
                        }
                    b = !1
                }
                d = !b
            }
            d && a(this).remove()
        })
    }
    ;
    a.fn.tipsy.elementOptions = function(b, d) {
        return a.metadata ? a.extend({}, d, a(b).metadata()) : d
    }
    ;
    a.fn.tipsy.autoNS = function() {
        return a(this).offset().top > a(document).scrollTop() + a(window).height() / 2 ? "s" : "n"
    }
    ;
    a.fn.tipsy.autoWE = function() {
        return a(this).offset().left > a(document).scrollLeft() + a(window).width() / 2 ? "e" : "w"
    }
    ;
    a.fn.tipsy.autoBounds = function(b, d) {
        return function() {
            var e = d[0]
              , f = 1 < d.length ? d[1] : !1
              , g = a(document).scrollTop() + b
              , h = a(document).scrollLeft() + b
              , i = a(this);
            i.offset().top < g && (e = "n");
            i.offset().left < h && (f = "w");
            a(window).width() + a(document).scrollLeft() - i.offset().left < b && (f = "e");
            a(window).height() + a(document).scrollTop() - i.offset().top < b && (e = "s");
            return e + (f ? f : "")
        }
    }
}
)(jQuery);
function Hammer(a, b, c) {
    var d, e, f, g, h, i;
    function j(a) {
        return a.touches ? a.touches.length : 1
    }
    function k(a) {
        var b = document
          , c = b.body;
        return [{
            x: a.pageX || a.clientX + (b && b.scrollLeft || c && c.scrollLeft || 0) - (b && b.clientLeft || c && b.clientLeft || 0),
            y: a.pageY || a.clientY + (b && b.scrollTop || c && c.scrollTop || 0) - (b && b.clientTop || c && b.clientTop || 0)
        }]
    }
    function n(a) {
        for (var c = [], d, e = 0, f = b.two_touch_max ? Math.min(2, a.touches.length) : a.touches.length; e < f; e++)
            d = a.touches[e],
            c.push({
                x: d.pageX,
                y: d.pageY
            });
        return c
    }
    function p(a) {
        var d = k
          , a = a || window.event;
        M ? d = n : b.allow_touch_and_mouse && a.touches !== c && 0 < a.touches.length && (d = n);
        return d(a)
    }
    function o(a, b) {
        return 180 * Math.atan2(b.y - a.y, b.x - a.x) / Math.PI
    }
    function r(a, b) {
        var c = b.x - a.x
          , d = b.y - a.y;
        return Math.sqrt(c * c + d * d)
    }
    function q(a, b) {
        if (2 == a.length && 2 == b.length) {
            var c = r(a[0], a[1]);
            return r(b[0], b[1]) / c
        }
        return 0
    }
    function s(a, b) {
        if (2 == a.length && 2 == b.length) {
            var c = o(a[1], a[0]);
            return o(b[1], b[0]) - c
        }
        return 0
    }
    function t(a, b) {
        b.touches = p(b.originalEvent);
        b.type = a;
        "[object Function]" == Object.prototype.toString.call(w["on" + a]) && w["on" + a].call(w, b)
    }
    function v(a) {
        a = a || window.event;
        a.preventDefault ? (a.preventDefault(),
        a.stopPropagation()) : (a.returnValue = !1,
        a.cancelBubble = !0)
    }
    function x() {
        i = h = g = f = void 0;
        N = !1;
        I = L = 0;
        A = null
    }
    function u(c) {
        function k() {
            f = p(c);
            F = (new Date).getTime();
            j(c);
            N = !0;
            T = c;
            var b = a.getBoundingClientRect()
              , g = a.clientLeft || document.body.clientLeft || 0
              , h = window.pageXOffset || a.scrollLeft || document.body.scrollLeft;
            d = b.top + (window.pageYOffset || a.scrollTop || document.body.scrollTop) - (a.clientTop || document.body.clientTop || 0);
            e = b.left + h - g;
            B = !0;
            ca.hold(c)
        }
        var l;
        switch (c.type) {
        case "mousedown":
        case "touchstart":
            l = j(c);
            ea = 1 === l;
            2 === l && "drag" === A && t("dragend", {
                originalEvent: c,
                direction: P,
                distance: L,
                angle: I
            });
            k();
            b.prevent_default && v(c);
            break;
        case "mousemove":
        case "touchmove":
            l = j(c);
            if (!B && 1 === l)
                return !1;
            !B && 2 === l && (ea = !1,
            x(),
            k());
            g = p(c);
            ca.transform(c) || ca.drag(c);
            break;
        case "mouseup":
        case "mouseout":
        case "touchcancel":
        case "touchend":
            l = !0;
            B = !1;
            ca.swipe(c);
            if ("drag" == A)
                t("dragend", {
                    originalEvent: c,
                    direction: P,
                    distance: L,
                    angle: I
                });
            else if ("transform" == A) {
                var n = h.x - i.x
                  , o = h.y - i.y;
                t("transformend", {
                    originalEvent: c,
                    position: h,
                    scale: q(f, g),
                    rotation: s(f, g),
                    distance: L,
                    distanceX: n,
                    distanceY: o
                });
                1 === j(c) && (x(),
                k(),
                l = !1)
            } else
                ea && "mouseout" != c.type && ca.tap(T);
            null !== A && (J = A,
            t("release", {
                originalEvent: c,
                gesture: A,
                position: g || f
            }));
            l && x()
        }
    }
    function y(b) {
        var c;
        a: if (c = b.relatedTarget,
        !c && window.event && window.event.toElement && (c = window.event.toElement),
        a === c)
            c = !0;
        else {
            if (c)
                for (c = c.parentNode; null !== c; ) {
                    if (c === a) {
                        c = !0;
                        break a
                    }
                    c = c.parentNode
                }
            c = !1
        }
        c || u(b)
    }
    function E(a, b) {
        var c = {};
        if (!b)
            return a;
        for (var d in a)
            c[d] = d in b ? b[d] : a[d];
        return c
    }
    function z(a, b, c) {
        for (var b = b.split(" "), d = 0, e = b.length; d < e; d++)
            a.addEventListener ? a.addEventListener(b[d], c, !1) : document.attachEvent && a.attachEvent("on" + b[d], c)
    }
    function C(a, b, c) {
        for (var b = b.split(" "), d = 0, e = b.length; d < e; d++)
            a.removeEventListener ? a.removeEventListener(b[d], c, !1) : document.detachEvent && a.detachEvent("on" + b[d], c)
    }
    var w = this
      , H = E({
        prevent_default: !1,
        css_hacks: !0,
        swipe: !0,
        swipe_time: 500,
        swipe_min_distance: 20,
        drag: !0,
        drag_vertical: !0,
        drag_horizontal: !0,
        drag_min_distance: 20,
        transform: !0,
        scale_treshold: 0.1,
        rotation_treshold: 15,
        tap: !0,
        tap_double: !0,
        tap_max_interval: 300,
        tap_max_distance: 10,
        tap_double_distance: 20,
        hold: !0,
        hold_timeout: 500,
        allow_touch_and_mouse: !1
    }, Hammer.defaults || {})
      , b = E(H, b);
    (function() {
        if (!b.css_hacks)
            return !1;
        for (var c = ["webkit", "moz", "ms", "o", ""], d = {
            userSelect: "none",
            touchCallout: "none",
            touchAction: "none",
            userDrag: "none",
            tapHighlightColor: "rgba(0,0,0,0)"
        }, e = "", f = 0; f < c.length; f++)
            for (var g in d)
                e = g,
                c[f] && (e = c[f] + e.substring(0, 1).toUpperCase() + e.substring(1)),
                a.style[e] = d[g]
    }
    )();
    var L = 0
      , I = 0
      , P = 0;
    i = h = g = f = void 0;
    var N = !1
      , A = null
      , J = null
      , F = null
      , l = {
        x: 0,
        y: 0
    }
      , Q = null
      , D = null;
    e = d = void 0;
    var B = !1, T, M = "ontouchstart"in window, ea = !1;
    this.option = function(a, d) {
        d !== c && (b[a] = d);
        return b[a]
    }
    ;
    this.getDirectionFromAngle = function(a) {
        var a = {
            down: 45 <= a && 135 > a,
            left: 135 <= a || -135 >= a,
            up: -45 > a && -135 < a,
            right: -45 <= a && 45 >= a
        }, b, c;
        for (c in a)
            if (a[c]) {
                b = c;
                break
            }
        return b
    }
    ;
    this.destroy = function() {
        (M || b.allow_touch_and_mouse) && C(a, "touchstart touchmove touchend touchcancel", u);
        if (!M || b.allow_touch_and_mouse)
            C(a, "mouseup mousedown mousemove", u),
            C(a, "mouseout", y)
    }
    ;
    var ca = {
        hold: function(a) {
            b.hold && (A = "hold",
            clearTimeout(D),
            D = setTimeout(function() {
                "hold" == A && t("hold", {
                    originalEvent: a,
                    position: f
                })
            }, b.hold_timeout))
        },
        swipe: function(a) {
            if (g && "transform" !== A) {
                var c = g[0].x - f[0].x
                  , h = g[0].y - f[0].y;
                L = Math.sqrt(c * c + h * h);
                var i = (new Date).getTime() - F;
                b.swipe && b.swipe_time >= i && L >= b.swipe_min_distance && (I = o(f[0], g[0]),
                P = w.getDirectionFromAngle(I),
                A = "swipe",
                t("swipe", {
                    originalEvent: a,
                    position: {
                        x: g[0].x - e,
                        y: g[0].y - d
                    },
                    direction: P,
                    distance: L,
                    distanceX: c,
                    distanceY: h,
                    angle: I
                }))
            }
        },
        drag: function(a) {
            var c = g[0].x - f[0].x
              , h = g[0].y - f[0].y;
            L = Math.sqrt(c * c + h * h);
            if (b.drag && L > b.drag_min_distance || "drag" == A) {
                I = o(f[0], g[0]);
                P = w.getDirectionFromAngle(I);
                var i = "up" == P || "down" == P;
                (i && !b.drag_vertical || !i && !b.drag_horizontal) && L > b.drag_min_distance || (A = "drag",
                c = {
                    originalEvent: a,
                    position: {
                        x: g[0].x - e,
                        y: g[0].y - d
                    },
                    direction: P,
                    distance: L,
                    distanceX: c,
                    distanceY: h,
                    angle: I
                },
                N && (t("dragstart", c),
                N = !1),
                t("drag", c),
                v(a))
            }
        },
        transform: function(a) {
            if (b.transform) {
                if (2 !== j(a))
                    return !1;
                var c = s(f, g)
                  , k = q(f, g);
                if ("transform" === A || Math.abs(1 - k) > b.scale_treshold || Math.abs(c) > b.rotation_treshold) {
                    A = "transform";
                    h = {
                        x: (g[0].x + g[1].x) / 2 - e,
                        y: (g[0].y + g[1].y) / 2 - d
                    };
                    N && (i = h);
                    var l = h.x - i.x
                      , n = h.y - i.y;
                    L = Math.sqrt(l * l + n * n);
                    c = {
                        originalEvent: a,
                        position: h,
                        scale: k,
                        rotation: c,
                        distance: L,
                        distanceX: l,
                        distanceY: n
                    };
                    N && (t("transformstart", c),
                    N = !1);
                    t("transform", c);
                    v(a);
                    return !0
                }
            }
            return !1
        },
        tap: function(a) {
            var c = (new Date).getTime()
              , d = c - F;
            if (!b.hold || b.hold && b.hold_timeout > d) {
                if (l && b.tap_double && "tap" == J && f && F - Q < b.tap_max_interval)
                    var d = Math.abs(l[0].x - f[0].x)
                      , e = Math.abs(l[0].y - f[0].y)
                      , d = l && f && Math.max(d, e) < b.tap_double_distance;
                else
                    d = !1;
                d ? (A = "double_tap",
                Q = null,
                t("doubletap", {
                    originalEvent: a,
                    position: f
                }),
                v(a)) : (d = g ? Math.abs(g[0].x - f[0].x) : 0,
                e = g ? Math.abs(g[0].y - f[0].y) : 0,
                L = Math.max(d, e),
                L < b.tap_max_distance && (A = "tap",
                Q = c,
                l = f,
                b.tap && (t("tap", {
                    originalEvent: a,
                    position: f
                }),
                v(a))))
            }
        }
    };
    (M || b.allow_touch_and_mouse) && z(a, "touchstart touchmove touchend touchcancel", u);
    if (!M || b.allow_touch_and_mouse)
        z(a, "mouseup mousedown mousemove", u),
        z(a, "mouseout", y)
}
(function(a) {
    function b(b, d) {
        this._delegateGuids = [];
        this._fn = function(e) {
            d.trigger(a.Event(b, e))
        }
        ;
        this._delegateFn = function(d) {
            d = a.Event(b, d);
            a(d.originalEvent.target).trigger(d)
        }
    }
    b.prototype = {
        addDelegate: function(a) {
            this._delegateGuids.push(a);
            return this
        },
        removeDelegate: function(a) {
            a = this._delegateGuids.indexOf(a);
            0 <= a && this._delegateGuids.splice(a);
            return this
        },
        getFn: function() {
            return 0 < this._delegateGuids.length ? this._delegateFn : this._fn
        },
        destroy: function() {
            this._delegateGuids = this._delegateFn = this._fn = null;
            delete this._fn;
            delete this._delegateFn;
            delete this._delegateGuids
        }
    };
    a.each("hold,tap,doubletap,transformstart,transform,transformend,dragstart,drag,dragend,swipe,release".split(","), function(c, d) {
        a.event.special[d] = {
            setup: function(c) {
                var f = a(this)
                  , g = f.data("hammerjs");
                if (!g) {
                    g = new Hammer(this,c);
                    g.__Fns = {};
                    f.data("hammerjs", g)
                }
                g.__Fns[d] = new b(d,f)
            },
            add: function(b) {
                var c = a(this).data("hammerjs");
                b.selector && c.__Fns[d].addDelegate(b.guid);
                c["on" + d] = c.__Fns[d].getFn()
            },
            remove: function(b) {
                var c = a(this).data("hammerjs");
                b.selector && c.__Fns[d].removeDelegate(b.guid);
                c["on" + d] = c.__Fns[d].getFn()
            },
            teardown: function() {
                var b = a(this).data("hammerjs");
                b.__Fns[d].destroy();
                delete b.__Fns[d]
            }
        }
    })
}
)(jQuery);
jQuery.fn.hammer = function(a) {
    return this.each(function() {
        var b = new Hammer(this,a)
          , c = jQuery(this);
        c.data("hammer", b);
        for (var d = "hold,tap,doubletap,transformstart,transform,transformend,dragstart,drag,dragend,swipe,release".split(","), e = 0; e < d.length; e++)
            b["on" + d[e]] = function(a, b) {
                return function(c) {
                    a.trigger(jQuery.Event(b, c))
                }
            }(c, d[e])
    })
}
;
"use strict";
var THREE = THREE || {
    REVISION: "49"
};
self.Int32Array || (self.Int32Array = Array,
self.Float32Array = Array);
(function() {
    for (var a = 0, b = ["ms", "moz", "webkit", "o"], c = 0; c < b.length && !window.requestAnimationFrame; ++c)
        window.requestAnimationFrame = window[b[c] + "RequestAnimationFrame"],
        window.cancelAnimationFrame = window[b[c] + "CancelAnimationFrame"] || window[b[c] + "CancelRequestAnimationFrame"];
    window.requestAnimationFrame || (window.requestAnimationFrame = function(b) {
        var c = Date.now()
          , f = Math.max(0, 16 - (c - a))
          , g = window.setTimeout(function() {
            b(c + f)
        }, f);
        a = c + f;
        return g
    }
    );
    window.cancelAnimationFrame || (window.cancelAnimationFrame = function(a) {
        clearTimeout(a)
    }
    )
}
)();
THREE.Clock = function(a) {
    this.autoStart = void 0 !== a ? a : !0;
    this.elapsedTime = this.oldTime = this.startTime = 0;
    this.running = !1
}
;
THREE.Clock.prototype.start = function() {
    this.oldTime = this.startTime = Date.now();
    this.running = !0
}
;
THREE.Clock.prototype.stop = function() {
    this.getElapsedTime();
    this.running = !1
}
;
THREE.Clock.prototype.getElapsedTime = function() {
    return this.elapsedTime += this.getDelta()
}
;
THREE.Clock.prototype.getDelta = function() {
    var a = 0;
    this.autoStart && !this.running && this.start();
    if (this.running) {
        var b = Date.now()
          , a = 0.0010 * (b - this.oldTime);
        this.oldTime = b;
        this.elapsedTime += a
    }
    return a
}
;
THREE.Color = function(a) {
    void 0 !== a && this.setHex(a);
    return this
}
;
THREE.Color.prototype = {
    constructor: THREE.Color,
    r: 1,
    g: 1,
    b: 1,
    copy: function(a) {
        this.r = a.r;
        this.g = a.g;
        this.b = a.b;
        return this
    },
    copyGammaToLinear: function(a) {
        this.r = a.r * a.r;
        this.g = a.g * a.g;
        this.b = a.b * a.b;
        return this
    },
    copyLinearToGamma: function(a) {
        this.r = Math.sqrt(a.r);
        this.g = Math.sqrt(a.g);
        this.b = Math.sqrt(a.b);
        return this
    },
    convertGammaToLinear: function() {
        var a = this.r
          , b = this.g
          , c = this.b;
        this.r = a * a;
        this.g = b * b;
        this.b = c * c;
        return this
    },
    convertLinearToGamma: function() {
        this.r = Math.sqrt(this.r);
        this.g = Math.sqrt(this.g);
        this.b = Math.sqrt(this.b);
        return this
    },
    setRGB: function(a, b, c) {
        this.r = a;
        this.g = b;
        this.b = c;
        return this
    },
    setHSV: function(a, b, c) {
        var d, e, f;
        if (0 === c)
            this.r = this.g = this.b = 0;
        else
            switch (d = Math.floor(6 * a),
            e = 6 * a - d,
            a = c * (1 - b),
            f = c * (1 - b * e),
            b = c * (1 - b * (1 - e)),
            d) {
            case 1:
                this.r = f;
                this.g = c;
                this.b = a;
                break;
            case 2:
                this.r = a;
                this.g = c;
                this.b = b;
                break;
            case 3:
                this.r = a;
                this.g = f;
                this.b = c;
                break;
            case 4:
                this.r = b;
                this.g = a;
                this.b = c;
                break;
            case 5:
                this.r = c;
                this.g = a;
                this.b = f;
                break;
            case 6:
            case 0:
                this.r = c,
                this.g = b,
                this.b = a
            }
        return this
    },
    setHex: function(a) {
        a = Math.floor(a);
        this.r = (a >> 16 & 255) / 255;
        this.g = (a >> 8 & 255) / 255;
        this.b = (a & 255) / 255;
        return this
    },
    lerpSelf: function(a, b) {
        this.r += (a.r - this.r) * b;
        this.g += (a.g - this.g) * b;
        this.b += (a.b - this.b) * b;
        return this
    },
    getHex: function() {
        return Math.floor(255 * this.r) << 16 ^ Math.floor(255 * this.g) << 8 ^ Math.floor(255 * this.b)
    },
    getContextStyle: function() {
        return "rgb(" + Math.floor(255 * this.r) + "," + Math.floor(255 * this.g) + "," + Math.floor(255 * this.b) + ")"
    },
    clone: function() {
        return (new THREE.Color).setRGB(this.r, this.g, this.b)
    }
};
THREE.Vector2 = function(a, b) {
    this.x = a || 0;
    this.y = b || 0
}
;
THREE.Vector2.prototype = {
    constructor: THREE.Vector2,
    set: function(a, b) {
        this.x = a;
        this.y = b;
        return this
    },
    copy: function(a) {
        this.x = a.x;
        this.y = a.y;
        return this
    },
    add: function(a, b) {
        this.x = a.x + b.x;
        this.y = a.y + b.y;
        return this
    },
    addSelf: function(a) {
        this.x += a.x;
        this.y += a.y;
        return this
    },
    sub: function(a, b) {
        this.x = a.x - b.x;
        this.y = a.y - b.y;
        return this
    },
    subSelf: function(a) {
        this.x -= a.x;
        this.y -= a.y;
        return this
    },
    multiplyScalar: function(a) {
        this.x *= a;
        this.y *= a;
        return this
    },
    divideScalar: function(a) {
        a ? (this.x /= a,
        this.y /= a) : this.set(0, 0);
        return this
    },
    negate: function() {
        return this.multiplyScalar(-1)
    },
    dot: function(a) {
        return this.x * a.x + this.y * a.y
    },
    lengthSq: function() {
        return this.x * this.x + this.y * this.y
    },
    length: function() {
        return Math.sqrt(this.lengthSq())
    },
    normalize: function() {
        return this.divideScalar(this.length())
    },
    distanceTo: function(a) {
        return Math.sqrt(this.distanceToSquared(a))
    },
    distanceToSquared: function(a) {
        var b = this.x - a.x
          , a = this.y - a.y;
        return b * b + a * a
    },
    setLength: function(a) {
        return this.normalize().multiplyScalar(a)
    },
    lerpSelf: function(a, b) {
        this.x += (a.x - this.x) * b;
        this.y += (a.y - this.y) * b;
        return this
    },
    equals: function(a) {
        return a.x === this.x && a.y === this.y
    },
    isZero: function() {
        return 1.0E-4 > this.lengthSq()
    },
    clone: function() {
        return new THREE.Vector2(this.x,this.y)
    }
};
THREE.Vector3 = function(a, b, c) {
    this.x = a || 0;
    this.y = b || 0;
    this.z = c || 0
}
;
THREE.Vector3.prototype = {
    constructor: THREE.Vector3,
    set: function(a, b, c) {
        this.x = a;
        this.y = b;
        this.z = c;
        return this
    },
    setX: function(a) {
        this.x = a;
        return this
    },
    setY: function(a) {
        this.y = a;
        return this
    },
    setZ: function(a) {
        this.z = a;
        return this
    },
    copy: function(a) {
        this.x = a.x;
        this.y = a.y;
        this.z = a.z;
        return this
    },
    add: function(a, b) {
        this.x = a.x + b.x;
        this.y = a.y + b.y;
        this.z = a.z + b.z;
        return this
    },
    addSelf: function(a) {
        this.x += a.x;
        this.y += a.y;
        this.z += a.z;
        return this
    },
    addScalar: function(a) {
        this.x += a;
        this.y += a;
        this.z += a;
        return this
    },
    sub: function(a, b) {
        this.x = a.x - b.x;
        this.y = a.y - b.y;
        this.z = a.z - b.z;
        return this
    },
    subSelf: function(a) {
        this.x -= a.x;
        this.y -= a.y;
        this.z -= a.z;
        return this
    },
    multiply: function(a, b) {
        this.x = a.x * b.x;
        this.y = a.y * b.y;
        this.z = a.z * b.z;
        return this
    },
    multiplySelf: function(a) {
        this.x *= a.x;
        this.y *= a.y;
        this.z *= a.z;
        return this
    },
    multiplyScalar: function(a) {
        this.x *= a;
        this.y *= a;
        this.z *= a;
        return this
    },
    divideSelf: function(a) {
        this.x /= a.x;
        this.y /= a.y;
        this.z /= a.z;
        return this
    },
    divideScalar: function(a) {
        a ? (this.x /= a,
        this.y /= a,
        this.z /= a) : this.z = this.y = this.x = 0;
        return this
    },
    negate: function() {
        return this.multiplyScalar(-1)
    },
    dot: function(a) {
        return this.x * a.x + this.y * a.y + this.z * a.z
    },
    lengthSq: function() {
        return this.x * this.x + this.y * this.y + this.z * this.z
    },
    length: function() {
        return Math.sqrt(this.lengthSq())
    },
    lengthManhattan: function() {
        return Math.abs(this.x) + Math.abs(this.y) + Math.abs(this.z)
    },
    normalize: function() {
        return this.divideScalar(this.length())
    },
    setLength: function(a) {
        return this.normalize().multiplyScalar(a)
    },
    lerpSelf: function(a, b) {
        this.x += (a.x - this.x) * b;
        this.y += (a.y - this.y) * b;
        this.z += (a.z - this.z) * b;
        return this
    },
    cross: function(a, b) {
        this.x = a.y * b.z - a.z * b.y;
        this.y = a.z * b.x - a.x * b.z;
        this.z = a.x * b.y - a.y * b.x;
        return this
    },
    crossSelf: function(a) {
        var b = this.x
          , c = this.y
          , d = this.z;
        this.x = c * a.z - d * a.y;
        this.y = d * a.x - b * a.z;
        this.z = b * a.y - c * a.x;
        return this
    },
    distanceTo: function(a) {
        return Math.sqrt(this.distanceToSquared(a))
    },
    distanceToSquared: function(a) {
        return (new THREE.Vector3).sub(this, a).lengthSq()
    },
    getPositionFromMatrix: function(a) {
        this.x = a.elements[12];
        this.y = a.elements[13];
        this.z = a.elements[14];
        return this
    },
    getRotationFromMatrix: function(a, b) {
        var c = b ? b.x : 1
          , d = b ? b.y : 1
          , e = b ? b.z : 1
          , f = a.elements[0] / c
          , g = a.elements[4] / d
          , c = a.elements[1] / c
          , d = a.elements[5] / d
          , h = a.elements[9] / e
          , i = a.elements[10] / e;
        this.y = Math.asin(a.elements[8] / e);
        e = Math.cos(this.y);
        1.0E-5 < Math.abs(e) ? (this.x = Math.atan2(-h / e, i / e),
        this.z = Math.atan2(-g / e, f / e)) : (this.x = 0,
        this.z = Math.atan2(c, d));
        return this
    },
    getScaleFromMatrix: function(a) {
        var b = this.set(a.elements[0], a.elements[1], a.elements[2]).length()
          , c = this.set(a.elements[4], a.elements[5], a.elements[6]).length()
          , a = this.set(a.elements[8], a.elements[9], a.elements[10]).length();
        this.x = b;
        this.y = c;
        this.z = a
    },
    equals: function(a) {
        return a.x === this.x && a.y === this.y && a.z === this.z
    },
    isZero: function() {
        return 1.0E-4 > this.lengthSq()
    },
    clone: function() {
        return new THREE.Vector3(this.x,this.y,this.z)
    }
};
THREE.Vector4 = function(a, b, c, d) {
    this.x = a || 0;
    this.y = b || 0;
    this.z = c || 0;
    this.w = void 0 !== d ? d : 1
}
;
THREE.Vector4.prototype = {
    constructor: THREE.Vector4,
    set: function(a, b, c, d) {
        this.x = a;
        this.y = b;
        this.z = c;
        this.w = d;
        return this
    },
    copy: function(a) {
        this.x = a.x;
        this.y = a.y;
        this.z = a.z;
        this.w = void 0 !== a.w ? a.w : 1;
        return this
    },
    add: function(a, b) {
        this.x = a.x + b.x;
        this.y = a.y + b.y;
        this.z = a.z + b.z;
        this.w = a.w + b.w;
        return this
    },
    addSelf: function(a) {
        this.x += a.x;
        this.y += a.y;
        this.z += a.z;
        this.w += a.w;
        return this
    },
    sub: function(a, b) {
        this.x = a.x - b.x;
        this.y = a.y - b.y;
        this.z = a.z - b.z;
        this.w = a.w - b.w;
        return this
    },
    subSelf: function(a) {
        this.x -= a.x;
        this.y -= a.y;
        this.z -= a.z;
        this.w -= a.w;
        return this
    },
    multiplyScalar: function(a) {
        this.x *= a;
        this.y *= a;
        this.z *= a;
        this.w *= a;
        return this
    },
    divideScalar: function(a) {
        a ? (this.x /= a,
        this.y /= a,
        this.z /= a,
        this.w /= a) : (this.z = this.y = this.x = 0,
        this.w = 1);
        return this
    },
    negate: function() {
        return this.multiplyScalar(-1)
    },
    dot: function(a) {
        return this.x * a.x + this.y * a.y + this.z * a.z + this.w * a.w
    },
    lengthSq: function() {
        return this.dot(this)
    },
    length: function() {
        return Math.sqrt(this.lengthSq())
    },
    normalize: function() {
        return this.divideScalar(this.length())
    },
    setLength: function(a) {
        return this.normalize().multiplyScalar(a)
    },
    lerpSelf: function(a, b) {
        this.x += (a.x - this.x) * b;
        this.y += (a.y - this.y) * b;
        this.z += (a.z - this.z) * b;
        this.w += (a.w - this.w) * b;
        return this
    },
    clone: function() {
        return new THREE.Vector4(this.x,this.y,this.z,this.w)
    }
};
THREE.Frustum = function() {
    this.planes = [new THREE.Vector4, new THREE.Vector4, new THREE.Vector4, new THREE.Vector4, new THREE.Vector4, new THREE.Vector4]
}
;
THREE.Frustum.prototype.setFromMatrix = function(a) {
    var b, c = this.planes, d = a.elements, a = d[0];
    b = d[1];
    var e = d[2]
      , f = d[3]
      , g = d[4]
      , h = d[5]
      , i = d[6]
      , j = d[7]
      , k = d[8]
      , n = d[9]
      , p = d[10]
      , o = d[11]
      , r = d[12]
      , q = d[13]
      , s = d[14]
      , d = d[15];
    c[0].set(f - a, j - g, o - k, d - r);
    c[1].set(f + a, j + g, o + k, d + r);
    c[2].set(f + b, j + h, o + n, d + q);
    c[3].set(f - b, j - h, o - n, d - q);
    c[4].set(f - e, j - i, o - p, d - s);
    c[5].set(f + e, j + i, o + p, d + s);
    for (a = 0; 6 > a; a++)
        b = c[a],
        b.divideScalar(Math.sqrt(b.x * b.x + b.y * b.y + b.z * b.z))
}
;
THREE.Frustum.prototype.contains = function(a) {
    for (var b = this.planes, c = a.matrixWorld, d = c.elements, c = -a.geometry.boundingSphere.radius * c.getMaxScaleOnAxis(), e = 0; 6 > e; e++)
        if (a = b[e].x * d[12] + b[e].y * d[13] + b[e].z * d[14] + b[e].w,
        a <= c)
            return !1;
    return !0
}
;
THREE.Frustum.__v1 = new THREE.Vector3;
THREE.Ray = function(a, b) {
    function c(a, b, c) {
        r.sub(c, a);
        t = r.dot(b);
        v = q.add(a, s.copy(b).multiplyScalar(t));
        return c.distanceTo(v)
    }
    function d(a, b, c, d) {
        r.sub(d, b);
        q.sub(c, b);
        s.sub(a, b);
        x = r.dot(r);
        u = r.dot(q);
        y = r.dot(s);
        E = q.dot(q);
        z = q.dot(s);
        C = 1 / (x * E - u * u);
        w = (E * y - u * z) * C;
        H = (x * z - u * y) * C;
        return 0 <= w && 0 <= H && 1 > w + H
    }
    this.origin = a || new THREE.Vector3;
    this.direction = b || new THREE.Vector3;
    var e = 1.0E-4;
    this.setPrecision = function(a) {
        e = a
    }
    ;
    var f = new THREE.Vector3
      , g = new THREE.Vector3
      , h = new THREE.Vector3
      , i = new THREE.Vector3
      , j = new THREE.Vector3
      , k = new THREE.Vector3
      , n = new THREE.Vector3
      , p = new THREE.Vector3
      , o = new THREE.Vector3;
    this.intersectObject = function(a) {
        var b, q = [];
        if (a instanceof THREE.Particle) {
            var r = c(this.origin, this.direction, a.matrixWorld.getPosition());
            if (r > a.scale.x)
                return [];
            b = {
                distance: r,
                point: a.position,
                face: null,
                object: a
            };
            q.push(b)
        } else if (a instanceof THREE.Mesh) {
            var r = c(this.origin, this.direction, a.matrixWorld.getPosition())
              , s = THREE.Frustum.__v1.set(a.matrixWorld.getColumnX().length(), a.matrixWorld.getColumnY().length(), a.matrixWorld.getColumnZ().length());
            if (r > a.geometry.boundingSphere.radius * Math.max(s.x, Math.max(s.y, s.z)))
                return q;
            var w, t, l = a.geometry, u = l.vertices, v;
            a.matrixRotationWorld.extractRotation(a.matrixWorld);
            r = 0;
            for (s = l.faces.length; r < s; r++)
                if (b = l.faces[r],
                j.copy(this.origin),
                k.copy(this.direction),
                v = a.matrixWorld,
                n = v.multiplyVector3(n.copy(b.centroid)).subSelf(j),
                p = a.matrixRotationWorld.multiplyVector3(p.copy(b.normal)),
                w = k.dot(p),
                !(Math.abs(w) < e) && (t = p.dot(n) / w,
                !(0 > t) && (a.doubleSided || (a.flipSided ? 0 < w : 0 > w))))
                    if (o.add(j, k.multiplyScalar(t)),
                    b instanceof THREE.Face3)
                        f = v.multiplyVector3(f.copy(u[b.a])),
                        g = v.multiplyVector3(g.copy(u[b.b])),
                        h = v.multiplyVector3(h.copy(u[b.c])),
                        d(o, f, g, h) && (b = {
                            distance: j.distanceTo(o),
                            point: o.clone(),
                            face: b,
                            object: a
                        },
                        q.push(b));
                    else if (b instanceof THREE.Face4 && (f = v.multiplyVector3(f.copy(u[b.a])),
                    g = v.multiplyVector3(g.copy(u[b.b])),
                    h = v.multiplyVector3(h.copy(u[b.c])),
                    i = v.multiplyVector3(i.copy(u[b.d])),
                    d(o, f, g, i) || d(o, g, h, i)))
                        b = {
                            distance: j.distanceTo(o),
                            point: o.clone(),
                            face: b,
                            object: a
                        },
                        q.push(b)
        }
        return q
    }
    ;
    this.intersectObjects = function(a) {
        for (var b = [], c = 0, d = a.length; c < d; c++)
            Array.prototype.push.apply(b, this.intersectObject(a[c]));
        b.sort(function(a, b) {
            return a.distance - b.distance
        });
        return b
    }
    ;
    var r = new THREE.Vector3, q = new THREE.Vector3, s = new THREE.Vector3, t, v, x, u, y, E, z, C, w, H
}
;
THREE.Rectangle = function() {
    function a() {
        f = d - b;
        g = e - c
    }
    var b, c, d, e, f, g, h = !0;
    this.getX = function() {
        return b
    }
    ;
    this.getY = function() {
        return c
    }
    ;
    this.getWidth = function() {
        return f
    }
    ;
    this.getHeight = function() {
        return g
    }
    ;
    this.getLeft = function() {
        return b
    }
    ;
    this.getTop = function() {
        return c
    }
    ;
    this.getRight = function() {
        return d
    }
    ;
    this.getBottom = function() {
        return e
    }
    ;
    this.set = function(f, g, k, n) {
        h = !1;
        b = f;
        c = g;
        d = k;
        e = n;
        a()
    }
    ;
    this.addPoint = function(f, g) {
        h ? (h = !1,
        b = f,
        c = g,
        d = f,
        e = g) : (b = b < f ? b : f,
        c = c < g ? c : g,
        d = d > f ? d : f,
        e = e > g ? e : g);
        a()
    }
    ;
    this.add3Points = function(f, g, k, n, p, o) {
        h ? (h = !1,
        b = f < k ? f < p ? f : p : k < p ? k : p,
        c = g < n ? g < o ? g : o : n < o ? n : o,
        d = f > k ? f > p ? f : p : k > p ? k : p,
        e = g > n ? g > o ? g : o : n > o ? n : o) : (b = f < k ? f < p ? f < b ? f : b : p < b ? p : b : k < p ? k < b ? k : b : p < b ? p : b,
        c = g < n ? g < o ? g < c ? g : c : o < c ? o : c : n < o ? n < c ? n : c : o < c ? o : c,
        d = f > k ? f > p ? f > d ? f : d : p > d ? p : d : k > p ? k > d ? k : d : p > d ? p : d,
        e = g > n ? g > o ? g > e ? g : e : o > e ? o : e : n > o ? n > e ? n : e : o > e ? o : e);
        a()
    }
    ;
    this.addRectangle = function(f) {
        h ? (h = !1,
        b = f.getLeft(),
        c = f.getTop(),
        d = f.getRight(),
        e = f.getBottom()) : (b = b < f.getLeft() ? b : f.getLeft(),
        c = c < f.getTop() ? c : f.getTop(),
        d = d > f.getRight() ? d : f.getRight(),
        e = e > f.getBottom() ? e : f.getBottom());
        a()
    }
    ;
    this.inflate = function(f) {
        b -= f;
        c -= f;
        d += f;
        e += f;
        a()
    }
    ;
    this.minSelf = function(f) {
        b = b > f.getLeft() ? b : f.getLeft();
        c = c > f.getTop() ? c : f.getTop();
        d = d < f.getRight() ? d : f.getRight();
        e = e < f.getBottom() ? e : f.getBottom();
        a()
    }
    ;
    this.intersects = function(a) {
        return d < a.getLeft() || b > a.getRight() || e < a.getTop() || c > a.getBottom() ? !1 : !0
    }
    ;
    this.empty = function() {
        h = !0;
        e = d = c = b = 0;
        a()
    }
    ;
    this.isEmpty = function() {
        return h
    }
}
;
THREE.Math = {
    clamp: function(a, b, c) {
        return a < b ? b : a > c ? c : a
    },
    clampBottom: function(a, b) {
        return a < b ? b : a
    },
    mapLinear: function(a, b, c, d, e) {
        return d + (a - b) * (e - d) / (c - b)
    },
    random16: function() {
        return (65280 * Math.random() + 255 * Math.random()) / 65535
    },
    randInt: function(a, b) {
        return a + Math.floor(Math.random() * (b - a + 1))
    },
    randFloat: function(a, b) {
        return a + Math.random() * (b - a)
    },
    randFloatSpread: function(a) {
        return a * (0.5 - Math.random())
    },
    sign: function(a) {
        return 0 > a ? -1 : 0 < a ? 1 : 0
    }
};
THREE.Matrix3 = function() {
    this.elements = new Float32Array(9)
}
;
THREE.Matrix3.prototype = {
    constructor: THREE.Matrix3,
    getInverse: function(a) {
        var b = a.elements
          , a = b[10] * b[5] - b[6] * b[9]
          , c = -b[10] * b[1] + b[2] * b[9]
          , d = b[6] * b[1] - b[2] * b[5]
          , e = -b[10] * b[4] + b[6] * b[8]
          , f = b[10] * b[0] - b[2] * b[8]
          , g = -b[6] * b[0] + b[2] * b[4]
          , h = b[9] * b[4] - b[5] * b[8]
          , i = -b[9] * b[0] + b[1] * b[8]
          , j = b[5] * b[0] - b[1] * b[4]
          , b = b[0] * a + b[1] * e + b[2] * h;
        0 === b && console.warn("Matrix3.getInverse(): determinant == 0");
        var b = 1 / b
          , k = this.elements;
        k[0] = b * a;
        k[1] = b * c;
        k[2] = b * d;
        k[3] = b * e;
        k[4] = b * f;
        k[5] = b * g;
        k[6] = b * h;
        k[7] = b * i;
        k[8] = b * j;
        return this
    },
    transpose: function() {
        var a, b = this.elements;
        a = b[1];
        b[1] = b[3];
        b[3] = a;
        a = b[2];
        b[2] = b[6];
        b[6] = a;
        a = b[5];
        b[5] = b[7];
        b[7] = a;
        return this
    },
    transposeIntoArray: function(a) {
        var b = this.m;
        a[0] = b[0];
        a[1] = b[3];
        a[2] = b[6];
        a[3] = b[1];
        a[4] = b[4];
        a[5] = b[7];
        a[6] = b[2];
        a[7] = b[5];
        a[8] = b[8];
        return this
    }
};
THREE.Matrix4 = function(a, b, c, d, e, f, g, h, i, j, k, n, p, o, r, q) {
    this.elements = new Float32Array(16);
    this.set(void 0 !== a ? a : 1, b || 0, c || 0, d || 0, e || 0, void 0 !== f ? f : 1, g || 0, h || 0, i || 0, j || 0, void 0 !== k ? k : 1, n || 0, p || 0, o || 0, r || 0, void 0 !== q ? q : 1)
}
;
THREE.Matrix4.prototype = {
    constructor: THREE.Matrix4,
    set: function(a, b, c, d, e, f, g, h, i, j, k, n, p, o, r, q) {
        var s = this.elements;
        s[0] = a;
        s[4] = b;
        s[8] = c;
        s[12] = d;
        s[1] = e;
        s[5] = f;
        s[9] = g;
        s[13] = h;
        s[2] = i;
        s[6] = j;
        s[10] = k;
        s[14] = n;
        s[3] = p;
        s[7] = o;
        s[11] = r;
        s[15] = q;
        return this
    },
    identity: function() {
        this.set(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1);
        return this
    },
    copy: function(a) {
        a = a.elements;
        this.set(a[0], a[4], a[8], a[12], a[1], a[5], a[9], a[13], a[2], a[6], a[10], a[14], a[3], a[7], a[11], a[15]);
        return this
    },
    lookAt: function(a, b, c) {
        var d = this.elements
          , e = THREE.Matrix4.__v1
          , f = THREE.Matrix4.__v2
          , g = THREE.Matrix4.__v3;
        g.sub(a, b).normalize();
        0 === g.length() && (g.z = 1);
        e.cross(c, g).normalize();
        0 === e.length() && (g.x += 1.0E-4,
        e.cross(c, g).normalize());
        f.cross(g, e);
        d[0] = e.x;
        d[4] = f.x;
        d[8] = g.x;
        d[1] = e.y;
        d[5] = f.y;
        d[9] = g.y;
        d[2] = e.z;
        d[6] = f.z;
        d[10] = g.z;
        return this
    },
    multiply: function(a, b) {
        var c = a.elements
          , d = b.elements
          , e = this.elements
          , f = c[0]
          , g = c[4]
          , h = c[8]
          , i = c[12]
          , j = c[1]
          , k = c[5]
          , n = c[9]
          , p = c[13]
          , o = c[2]
          , r = c[6]
          , q = c[10]
          , s = c[14]
          , t = c[3]
          , v = c[7]
          , x = c[11]
          , c = c[15]
          , u = d[0]
          , y = d[4]
          , E = d[8]
          , z = d[12]
          , C = d[1]
          , w = d[5]
          , H = d[9]
          , L = d[13]
          , I = d[2]
          , P = d[6]
          , N = d[10]
          , A = d[14]
          , J = d[3]
          , F = d[7]
          , l = d[11]
          , d = d[15];
        e[0] = f * u + g * C + h * I + i * J;
        e[4] = f * y + g * w + h * P + i * F;
        e[8] = f * E + g * H + h * N + i * l;
        e[12] = f * z + g * L + h * A + i * d;
        e[1] = j * u + k * C + n * I + p * J;
        e[5] = j * y + k * w + n * P + p * F;
        e[9] = j * E + k * H + n * N + p * l;
        e[13] = j * z + k * L + n * A + p * d;
        e[2] = o * u + r * C + q * I + s * J;
        e[6] = o * y + r * w + q * P + s * F;
        e[10] = o * E + r * H + q * N + s * l;
        e[14] = o * z + r * L + q * A + s * d;
        e[3] = t * u + v * C + x * I + c * J;
        e[7] = t * y + v * w + x * P + c * F;
        e[11] = t * E + v * H + x * N + c * l;
        e[15] = t * z + v * L + x * A + c * d;
        return this
    },
    multiplySelf: function(a) {
        return this.multiply(this, a)
    },
    multiplyToArray: function(a, b, c) {
        var d = this.elements;
        this.multiply(a, b);
        c[0] = d[0];
        c[1] = d[1];
        c[2] = d[2];
        c[3] = d[3];
        c[4] = d[4];
        c[5] = d[5];
        c[6] = d[6];
        c[7] = d[7];
        c[8] = d[8];
        c[9] = d[9];
        c[10] = d[10];
        c[11] = d[11];
        c[12] = d[12];
        c[13] = d[13];
        c[14] = d[14];
        c[15] = d[15];
        return this
    },
    multiplyScalar: function(a) {
        var b = this.elements;
        b[0] *= a;
        b[4] *= a;
        b[8] *= a;
        b[12] *= a;
        b[1] *= a;
        b[5] *= a;
        b[9] *= a;
        b[13] *= a;
        b[2] *= a;
        b[6] *= a;
        b[10] *= a;
        b[14] *= a;
        b[3] *= a;
        b[7] *= a;
        b[11] *= a;
        b[15] *= a;
        return this
    },
    multiplyVector3: function(a) {
        var b = this.elements
          , c = a.x
          , d = a.y
          , e = a.z
          , f = 1 / (b[3] * c + b[7] * d + b[11] * e + b[15]);
        a.x = (b[0] * c + b[4] * d + b[8] * e + b[12]) * f;
        a.y = (b[1] * c + b[5] * d + b[9] * e + b[13]) * f;
        a.z = (b[2] * c + b[6] * d + b[10] * e + b[14]) * f;
        return a
    },
    multiplyVector4: function(a) {
        var b = this.elements
          , c = a.x
          , d = a.y
          , e = a.z
          , f = a.w;
        a.x = b[0] * c + b[4] * d + b[8] * e + b[12] * f;
        a.y = b[1] * c + b[5] * d + b[9] * e + b[13] * f;
        a.z = b[2] * c + b[6] * d + b[10] * e + b[14] * f;
        a.w = b[3] * c + b[7] * d + b[11] * e + b[15] * f;
        return a
    },
    rotateAxis: function(a) {
        var b = this.elements
          , c = a.x
          , d = a.y
          , e = a.z;
        a.x = c * b[0] + d * b[4] + e * b[8];
        a.y = c * b[1] + d * b[5] + e * b[9];
        a.z = c * b[2] + d * b[6] + e * b[10];
        a.normalize();
        return a
    },
    crossVector: function(a) {
        var b = this.elements
          , c = new THREE.Vector4;
        c.x = b[0] * a.x + b[4] * a.y + b[8] * a.z + b[12] * a.w;
        c.y = b[1] * a.x + b[5] * a.y + b[9] * a.z + b[13] * a.w;
        c.z = b[2] * a.x + b[6] * a.y + b[10] * a.z + b[14] * a.w;
        c.w = a.w ? b[3] * a.x + b[7] * a.y + b[11] * a.z + b[15] * a.w : 1;
        return c
    },
    determinant: function() {
        var a = this.elements
          , b = a[0]
          , c = a[4]
          , d = a[8]
          , e = a[12]
          , f = a[1]
          , g = a[5]
          , h = a[9]
          , i = a[13]
          , j = a[2]
          , k = a[6]
          , n = a[10]
          , p = a[14]
          , o = a[3]
          , r = a[7]
          , q = a[11]
          , a = a[15];
        return e * h * k * o - d * i * k * o - e * g * n * o + c * i * n * o + d * g * p * o - c * h * p * o - e * h * j * r + d * i * j * r + e * f * n * r - b * i * n * r - d * f * p * r + b * h * p * r + e * g * j * q - c * i * j * q - e * f * k * q + b * i * k * q + c * f * p * q - b * g * p * q - d * g * j * a + c * h * j * a + d * f * k * a - b * h * k * a - c * f * n * a + b * g * n * a
    },
    transpose: function() {
        var a = this.elements, b;
        b = a[1];
        a[1] = a[4];
        a[4] = b;
        b = a[2];
        a[2] = a[8];
        a[8] = b;
        b = a[6];
        a[6] = a[9];
        a[9] = b;
        b = a[3];
        a[3] = a[12];
        a[12] = b;
        b = a[7];
        a[7] = a[13];
        a[13] = b;
        b = a[11];
        a[11] = a[14];
        a[14] = b;
        return this
    },
    flattenToArray: function(a) {
        var b = this.elements;
        a[0] = b[0];
        a[1] = b[1];
        a[2] = b[2];
        a[3] = b[3];
        a[4] = b[4];
        a[5] = b[5];
        a[6] = b[6];
        a[7] = b[7];
        a[8] = b[8];
        a[9] = b[9];
        a[10] = b[10];
        a[11] = b[11];
        a[12] = b[12];
        a[13] = b[13];
        a[14] = b[14];
        a[15] = b[15];
        return a
    },
    flattenToArrayOffset: function(a, b) {
        var c = this.elements;
        a[b] = c[0];
        a[b + 1] = c[1];
        a[b + 2] = c[2];
        a[b + 3] = c[3];
        a[b + 4] = c[4];
        a[b + 5] = c[5];
        a[b + 6] = c[6];
        a[b + 7] = c[7];
        a[b + 8] = c[8];
        a[b + 9] = c[9];
        a[b + 10] = c[10];
        a[b + 11] = c[11];
        a[b + 12] = c[12];
        a[b + 13] = c[13];
        a[b + 14] = c[14];
        a[b + 15] = c[15];
        return a
    },
    getPosition: function() {
        var a = this.elements;
        return THREE.Matrix4.__v1.set(a[12], a[13], a[14])
    },
    setPosition: function(a) {
        var b = this.elements;
        b[12] = a.x;
        b[13] = a.y;
        b[14] = a.z;
        return this
    },
    getColumnX: function() {
        var a = this.elements;
        return THREE.Matrix4.__v1.set(a[0], a[1], a[2])
    },
    getColumnY: function() {
        var a = this.elements;
        return THREE.Matrix4.__v1.set(a[4], a[5], a[6])
    },
    getColumnZ: function() {
        var a = this.elements;
        return THREE.Matrix4.__v1.set(a[8], a[9], a[10])
    },
    getInverse: function(a) {
        var b = this.elements
          , c = a.elements
          , d = c[0]
          , e = c[4]
          , f = c[8]
          , g = c[12]
          , h = c[1]
          , i = c[5]
          , j = c[9]
          , k = c[13]
          , n = c[2]
          , p = c[6]
          , o = c[10]
          , r = c[14]
          , q = c[3]
          , s = c[7]
          , t = c[11]
          , c = c[15];
        b[0] = j * r * s - k * o * s + k * p * t - i * r * t - j * p * c + i * o * c;
        b[4] = g * o * s - f * r * s - g * p * t + e * r * t + f * p * c - e * o * c;
        b[8] = f * k * s - g * j * s + g * i * t - e * k * t - f * i * c + e * j * c;
        b[12] = g * j * p - f * k * p - g * i * o + e * k * o + f * i * r - e * j * r;
        b[1] = k * o * q - j * r * q - k * n * t + h * r * t + j * n * c - h * o * c;
        b[5] = f * r * q - g * o * q + g * n * t - d * r * t - f * n * c + d * o * c;
        b[9] = g * j * q - f * k * q - g * h * t + d * k * t + f * h * c - d * j * c;
        b[13] = f * k * n - g * j * n + g * h * o - d * k * o - f * h * r + d * j * r;
        b[2] = i * r * q - k * p * q + k * n * s - h * r * s - i * n * c + h * p * c;
        b[6] = g * p * q - e * r * q - g * n * s + d * r * s + e * n * c - d * p * c;
        b[10] = e * k * q - g * i * q + g * h * s - d * k * s - e * h * c + d * i * c;
        b[14] = g * i * n - e * k * n - g * h * p + d * k * p + e * h * r - d * i * r;
        b[3] = j * p * q - i * o * q - j * n * s + h * o * s + i * n * t - h * p * t;
        b[7] = e * o * q - f * p * q + f * n * s - d * o * s - e * n * t + d * p * t;
        b[11] = f * i * q - e * j * q - f * h * s + d * j * s + e * h * t - d * i * t;
        b[15] = e * j * n - f * i * n + f * h * p - d * j * p - e * h * o + d * i * o;
        this.multiplyScalar(1 / a.determinant());
        return this
    },
    setRotationFromEuler: function(a, b) {
        var c = this.elements
          , d = a.x
          , e = a.y
          , f = a.z
          , g = Math.cos(d)
          , d = Math.sin(d)
          , h = Math.cos(e)
          , e = Math.sin(e)
          , i = Math.cos(f)
          , f = Math.sin(f);
        switch (b) {
        case "YXZ":
            var j = h * i
              , k = h * f
              , n = e * i
              , p = e * f;
            c[0] = j + p * d;
            c[4] = n * d - k;
            c[8] = g * e;
            c[1] = g * f;
            c[5] = g * i;
            c[9] = -d;
            c[2] = k * d - n;
            c[6] = p + j * d;
            c[10] = g * h;
            break;
        case "ZXY":
            j = h * i;
            k = h * f;
            n = e * i;
            p = e * f;
            c[0] = j - p * d;
            c[4] = -g * f;
            c[8] = n + k * d;
            c[1] = k + n * d;
            c[5] = g * i;
            c[9] = p - j * d;
            c[2] = -g * e;
            c[6] = d;
            c[10] = g * h;
            break;
        case "ZYX":
            j = g * i;
            k = g * f;
            n = d * i;
            p = d * f;
            c[0] = h * i;
            c[4] = n * e - k;
            c[8] = j * e + p;
            c[1] = h * f;
            c[5] = p * e + j;
            c[9] = k * e - n;
            c[2] = -e;
            c[6] = d * h;
            c[10] = g * h;
            break;
        case "YZX":
            j = g * h;
            k = g * e;
            n = d * h;
            p = d * e;
            c[0] = h * i;
            c[4] = p - j * f;
            c[8] = n * f + k;
            c[1] = f;
            c[5] = g * i;
            c[9] = -d * i;
            c[2] = -e * i;
            c[6] = k * f + n;
            c[10] = j - p * f;
            break;
        case "XZY":
            j = g * h;
            k = g * e;
            n = d * h;
            p = d * e;
            c[0] = h * i;
            c[4] = -f;
            c[8] = e * i;
            c[1] = j * f + p;
            c[5] = g * i;
            c[9] = k * f - n;
            c[2] = n * f - k;
            c[6] = d * i;
            c[10] = p * f + j;
            break;
        default:
            j = g * i,
            k = g * f,
            n = d * i,
            p = d * f,
            c[0] = h * i,
            c[4] = -h * f,
            c[8] = e,
            c[1] = k + n * e,
            c[5] = j - p * e,
            c[9] = -d * h,
            c[2] = p - j * e,
            c[6] = n + k * e,
            c[10] = g * h
        }
        return this
    },
    setRotationFromQuaternion: function(a) {
        var b = this.elements
          , c = a.x
          , d = a.y
          , e = a.z
          , f = a.w
          , g = c + c
          , h = d + d
          , i = e + e
          , a = c * g
          , j = c * h
          , c = c * i
          , k = d * h
          , d = d * i
          , e = e * i
          , g = f * g
          , h = f * h
          , f = f * i;
        b[0] = 1 - (k + e);
        b[4] = j - f;
        b[8] = c + h;
        b[1] = j + f;
        b[5] = 1 - (a + e);
        b[9] = d - g;
        b[2] = c - h;
        b[6] = d + g;
        b[10] = 1 - (a + k);
        return this
    },
    compose: function(a, b, c) {
        var d = this.elements
          , e = THREE.Matrix4.__m1
          , f = THREE.Matrix4.__m2;
        e.identity();
        e.setRotationFromQuaternion(b);
        f.makeScale(c.x, c.y, c.z);
        this.multiply(e, f);
        d[12] = a.x;
        d[13] = a.y;
        d[14] = a.z;
        return this
    },
    decompose: function(a, b, c) {
        var d = this.elements
          , e = THREE.Matrix4.__v1
          , f = THREE.Matrix4.__v2
          , g = THREE.Matrix4.__v3;
        e.set(d[0], d[1], d[2]);
        f.set(d[4], d[5], d[6]);
        g.set(d[8], d[9], d[10]);
        a = a instanceof THREE.Vector3 ? a : new THREE.Vector3;
        b = b instanceof THREE.Quaternion ? b : new THREE.Quaternion;
        c = c instanceof THREE.Vector3 ? c : new THREE.Vector3;
        c.x = e.length();
        c.y = f.length();
        c.z = g.length();
        a.x = d[12];
        a.y = d[13];
        a.z = d[14];
        d = THREE.Matrix4.__m1;
        d.copy(this);
        d.elements[0] /= c.x;
        d.elements[1] /= c.x;
        d.elements[2] /= c.x;
        d.elements[4] /= c.y;
        d.elements[5] /= c.y;
        d.elements[6] /= c.y;
        d.elements[8] /= c.z;
        d.elements[9] /= c.z;
        d.elements[10] /= c.z;
        b.setFromRotationMatrix(d);
        return [a, b, c]
    },
    extractPosition: function(a) {
        var b = this.elements
          , a = a.elements;
        b[12] = a[12];
        b[13] = a[13];
        b[14] = a[14];
        return this
    },
    extractRotation: function(a) {
        var b = this.elements
          , a = a.elements
          , c = THREE.Matrix4.__v1
          , d = 1 / c.set(a[0], a[1], a[2]).length()
          , e = 1 / c.set(a[4], a[5], a[6]).length()
          , c = 1 / c.set(a[8], a[9], a[10]).length();
        b[0] = a[0] * d;
        b[1] = a[1] * d;
        b[2] = a[2] * d;
        b[4] = a[4] * e;
        b[5] = a[5] * e;
        b[6] = a[6] * e;
        b[8] = a[8] * c;
        b[9] = a[9] * c;
        b[10] = a[10] * c;
        return this
    },
    translate: function(a) {
        var b = this.elements
          , c = a.x
          , d = a.y
          , a = a.z;
        b[12] = b[0] * c + b[4] * d + b[8] * a + b[12];
        b[13] = b[1] * c + b[5] * d + b[9] * a + b[13];
        b[14] = b[2] * c + b[6] * d + b[10] * a + b[14];
        b[15] = b[3] * c + b[7] * d + b[11] * a + b[15];
        return this
    },
    rotateX: function(a) {
        var b = this.elements
          , c = b[4]
          , d = b[5]
          , e = b[6]
          , f = b[7]
          , g = b[8]
          , h = b[9]
          , i = b[10]
          , j = b[11]
          , k = Math.cos(a)
          , a = Math.sin(a);
        b[4] = k * c + a * g;
        b[5] = k * d + a * h;
        b[6] = k * e + a * i;
        b[7] = k * f + a * j;
        b[8] = k * g - a * c;
        b[9] = k * h - a * d;
        b[10] = k * i - a * e;
        b[11] = k * j - a * f;
        return this
    },
    rotateY: function(a) {
        var b = this.elements
          , c = b[0]
          , d = b[1]
          , e = b[2]
          , f = b[3]
          , g = b[8]
          , h = b[9]
          , i = b[10]
          , j = b[11]
          , k = Math.cos(a)
          , a = Math.sin(a);
        b[0] = k * c - a * g;
        b[1] = k * d - a * h;
        b[2] = k * e - a * i;
        b[3] = k * f - a * j;
        b[8] = k * g + a * c;
        b[9] = k * h + a * d;
        b[10] = k * i + a * e;
        b[11] = k * j + a * f;
        return this
    },
    rotateZ: function(a) {
        var b = this.elements
          , c = b[0]
          , d = b[1]
          , e = b[2]
          , f = b[3]
          , g = b[4]
          , h = b[5]
          , i = b[6]
          , j = b[7]
          , k = Math.cos(a)
          , a = Math.sin(a);
        b[0] = k * c + a * g;
        b[1] = k * d + a * h;
        b[2] = k * e + a * i;
        b[3] = k * f + a * j;
        b[4] = k * g - a * c;
        b[5] = k * h - a * d;
        b[6] = k * i - a * e;
        b[7] = k * j - a * f;
        return this
    },
    rotateByAxis: function(a, b) {
        var c = this.elements;
        if (1 === a.x && 0 === a.y && 0 === a.z)
            return this.rotateX(b);
        if (0 === a.x && 1 === a.y && 0 === a.z)
            return this.rotateY(b);
        if (0 === a.x && 0 === a.y && 1 === a.z)
            return this.rotateZ(b);
        var d = a.x
          , e = a.y
          , f = a.z
          , g = Math.sqrt(d * d + e * e + f * f)
          , d = d / g
          , e = e / g
          , f = f / g
          , g = d * d
          , h = e * e
          , i = f * f
          , j = Math.cos(b)
          , k = Math.sin(b)
          , n = 1 - j
          , p = d * e * n
          , o = d * f * n
          , n = e * f * n
          , d = d * k
          , r = e * k
          , k = f * k
          , f = g + (1 - g) * j
          , g = p + k
          , e = o - r
          , p = p - k
          , h = h + (1 - h) * j
          , k = n + d
          , o = o + r
          , n = n - d
          , i = i + (1 - i) * j
          , j = c[0]
          , d = c[1]
          , r = c[2]
          , q = c[3]
          , s = c[4]
          , t = c[5]
          , v = c[6]
          , x = c[7]
          , u = c[8]
          , y = c[9]
          , E = c[10]
          , z = c[11];
        c[0] = f * j + g * s + e * u;
        c[1] = f * d + g * t + e * y;
        c[2] = f * r + g * v + e * E;
        c[3] = f * q + g * x + e * z;
        c[4] = p * j + h * s + k * u;
        c[5] = p * d + h * t + k * y;
        c[6] = p * r + h * v + k * E;
        c[7] = p * q + h * x + k * z;
        c[8] = o * j + n * s + i * u;
        c[9] = o * d + n * t + i * y;
        c[10] = o * r + n * v + i * E;
        c[11] = o * q + n * x + i * z;
        return this
    },
    scale: function(a) {
        var b = this.elements
          , c = a.x
          , d = a.y
          , a = a.z;
        b[0] *= c;
        b[4] *= d;
        b[8] *= a;
        b[1] *= c;
        b[5] *= d;
        b[9] *= a;
        b[2] *= c;
        b[6] *= d;
        b[10] *= a;
        b[3] *= c;
        b[7] *= d;
        b[11] *= a;
        return this
    },
    getMaxScaleOnAxis: function() {
        var a = this.elements;
        return Math.sqrt(Math.max(a[0] * a[0] + a[1] * a[1] + a[2] * a[2], Math.max(a[4] * a[4] + a[5] * a[5] + a[6] * a[6], a[8] * a[8] + a[9] * a[9] + a[10] * a[10])))
    },
    makeTranslation: function(a, b, c) {
        this.set(1, 0, 0, a, 0, 1, 0, b, 0, 0, 1, c, 0, 0, 0, 1);
        return this
    },
    makeRotationX: function(a) {
        var b = Math.cos(a)
          , a = Math.sin(a);
        this.set(1, 0, 0, 0, 0, b, -a, 0, 0, a, b, 0, 0, 0, 0, 1);
        return this
    },
    makeRotationY: function(a) {
        var b = Math.cos(a)
          , a = Math.sin(a);
        this.set(b, 0, a, 0, 0, 1, 0, 0, -a, 0, b, 0, 0, 0, 0, 1);
        return this
    },
    makeRotationZ: function(a) {
        var b = Math.cos(a)
          , a = Math.sin(a);
        this.set(b, -a, 0, 0, a, b, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1);
        return this
    },
    makeRotationAxis: function(a, b) {
        var c = Math.cos(b)
          , d = Math.sin(b)
          , e = 1 - c
          , f = a.x
          , g = a.y
          , h = a.z
          , i = e * f
          , j = e * g;
        this.set(i * f + c, i * g - d * h, i * h + d * g, 0, i * g + d * h, j * g + c, j * h - d * f, 0, i * h - d * g, j * h + d * f, e * h * h + c, 0, 0, 0, 0, 1);
        return this
    },
    makeScale: function(a, b, c) {
        this.set(a, 0, 0, 0, 0, b, 0, 0, 0, 0, c, 0, 0, 0, 0, 1);
        return this
    },
    makeFrustum: function(a, b, c, d, e, f) {
        var g = this.elements;
        g[0] = 2 * e / (b - a);
        g[4] = 0;
        g[8] = (b + a) / (b - a);
        g[12] = 0;
        g[1] = 0;
        g[5] = 2 * e / (d - c);
        g[9] = (d + c) / (d - c);
        g[13] = 0;
        g[2] = 0;
        g[6] = 0;
        g[10] = -(f + e) / (f - e);
        g[14] = -2 * f * e / (f - e);
        g[3] = 0;
        g[7] = 0;
        g[11] = -1;
        g[15] = 0;
        return this
    },
    makePerspective: function(a, b, c, d) {
        var a = c * Math.tan(a * Math.PI / 360)
          , e = -a;
        return this.makeFrustum(e * b, a * b, e, a, c, d)
    },
    makeOrthographic: function(a, b, c, d, e, f) {
        var g = this.elements
          , h = b - a
          , i = c - d
          , j = f - e;
        g[0] = 2 / h;
        g[4] = 0;
        g[8] = 0;
        g[12] = -((b + a) / h);
        g[1] = 0;
        g[5] = 2 / i;
        g[9] = 0;
        g[13] = -((c + d) / i);
        g[2] = 0;
        g[6] = 0;
        g[10] = -2 / j;
        g[14] = -((f + e) / j);
        g[3] = 0;
        g[7] = 0;
        g[11] = 0;
        g[15] = 1;
        return this
    },
    clone: function() {
        var a = this.elements;
        return new THREE.Matrix4(a[0],a[4],a[8],a[12],a[1],a[5],a[9],a[13],a[2],a[6],a[10],a[14],a[3],a[7],a[11],a[15])
    }
};
THREE.Matrix4.__v1 = new THREE.Vector3;
THREE.Matrix4.__v2 = new THREE.Vector3;
THREE.Matrix4.__v3 = new THREE.Vector3;
THREE.Matrix4.__m1 = new THREE.Matrix4;
THREE.Matrix4.__m2 = new THREE.Matrix4;
THREE.Object3D = function() {
    this.id = THREE.Object3DCount++;
    this.name = "";
    this.parent = void 0;
    this.children = [];
    this.up = new THREE.Vector3(0,1,0);
    this.position = new THREE.Vector3;
    this.rotation = new THREE.Vector3;
    this.eulerOrder = "XYZ";
    this.scale = new THREE.Vector3(1,1,1);
    this.flipSided = this.doubleSided = !1;
    this.renderDepth = null;
    this.rotationAutoUpdate = !0;
    this.matrix = new THREE.Matrix4;
    this.matrixWorld = new THREE.Matrix4;
    this.matrixRotationWorld = new THREE.Matrix4;
    this.matrixWorldNeedsUpdate = this.matrixAutoUpdate = !0;
    this.quaternion = new THREE.Quaternion;
    this.useQuaternion = !1;
    this.boundRadius = 0;
    this.boundRadiusScale = 1;
    this.visible = !0;
    this.receiveShadow = this.castShadow = !1;
    this.frustumCulled = !0;
    this._vector = new THREE.Vector3
}
;
THREE.Object3D.prototype = {
    constructor: THREE.Object3D,
    applyMatrix: function(a) {
        this.matrix.multiply(a, this.matrix);
        this.scale.getScaleFromMatrix(this.matrix);
        this.rotation.getRotationFromMatrix(this.matrix, this.scale);
        this.position.getPositionFromMatrix(this.matrix)
    },
    translate: function(a, b) {
        this.matrix.rotateAxis(b);
        this.position.addSelf(b.multiplyScalar(a))
    },
    translateX: function(a) {
        this.translate(a, this._vector.set(1, 0, 0))
    },
    translateY: function(a) {
        this.translate(a, this._vector.set(0, 1, 0))
    },
    translateZ: function(a) {
        this.translate(a, this._vector.set(0, 0, 1))
    },
    lookAt: function(a) {
        this.matrix.lookAt(a, this.position, this.up);
        this.rotationAutoUpdate && this.rotation.getRotationFromMatrix(this.matrix)
    },
    add: function(a) {
        if (a === this)
            console.warn("THREE.Object3D.add: An object can't be added as a child of itself.");
        else if (a instanceof THREE.Object3D) {
            void 0 !== a.parent && a.parent.remove(a);
            a.parent = this;
            this.children.push(a);
            for (var b = this; void 0 !== b.parent; )
                b = b.parent;
            void 0 !== b && b instanceof THREE.Scene && b.__addObject(a)
        }
    },
    remove: function(a) {
        var b = this.children.indexOf(a);
        if (-1 !== b) {
            a.parent = void 0;
            this.children.splice(b, 1);
            for (b = this; void 0 !== b.parent; )
                b = b.parent;
            void 0 !== b && b instanceof THREE.Scene && b.__removeObject(a)
        }
    },
    getChildByName: function(a, b) {
        var c, d, e;
        c = 0;
        for (d = this.children.length; c < d; c++)
            if (e = this.children[c],
            e.name === a || b && (e = e.getChildByName(a, b),
            void 0 !== e))
                return e
    },
    updateMatrix: function() {
        this.matrix.setPosition(this.position);
        this.useQuaternion ? this.matrix.setRotationFromQuaternion(this.quaternion) : this.matrix.setRotationFromEuler(this.rotation, this.eulerOrder);
        if (1 !== this.scale.x || 1 !== this.scale.y || 1 !== this.scale.z)
            this.matrix.scale(this.scale),
            this.boundRadiusScale = Math.max(this.scale.x, Math.max(this.scale.y, this.scale.z));
        this.matrixWorldNeedsUpdate = !0
    },
    updateMatrixWorld: function(a) {
        this.matrixAutoUpdate && this.updateMatrix();
        if (this.matrixWorldNeedsUpdate || a)
            this.parent ? this.matrixWorld.multiply(this.parent.matrixWorld, this.matrix) : this.matrixWorld.copy(this.matrix),
            this.matrixWorldNeedsUpdate = !1,
            a = !0;
        for (var b = 0, c = this.children.length; b < c; b++)
            this.children[b].updateMatrixWorld(a)
    }
};
THREE.Object3DCount = 0;
THREE.Projector = function() {
    function a() {
        var a = g[f] = g[f] || new THREE.RenderableObject;
        f++;
        return a
    }
    function b() {
        var a = j[i] = j[i] || new THREE.RenderableVertex;
        i++;
        return a
    }
    function c(a, b) {
        return b.z - a.z
    }
    function d(a, b) {
        var c = 0
          , d = 1
          , e = a.z + a.w
          , f = b.z + b.w
          , g = -a.z + a.w
          , h = -b.z + b.w;
        if (0 <= e && 0 <= f && 0 <= g && 0 <= h)
            return !0;
        if (0 > e && 0 > f || 0 > g && 0 > h)
            return !1;
        0 > e ? c = Math.max(c, e / (e - f)) : 0 > f && (d = Math.min(d, e / (e - f)));
        0 > g ? c = Math.max(c, g / (g - h)) : 0 > h && (d = Math.min(d, g / (g - h)));
        if (d < c)
            return !1;
        a.lerpSelf(b, c);
        b.lerpSelf(a, 1 - d);
        return !0
    }
    var e, f, g = [], h, i, j = [], k, n, p = [], o, r = [], q, s, t = [], v, x, u = [], y = {
        objects: [],
        sprites: [],
        lights: [],
        elements: []
    }, E = new THREE.Vector3, z = new THREE.Vector4, C = new THREE.Matrix4, w = new THREE.Matrix4, H = new THREE.Frustum, L = new THREE.Vector4, I = new THREE.Vector4;
    this.projectVector = function(a, b) {
        b.matrixWorldInverse.getInverse(b.matrixWorld);
        C.multiply(b.projectionMatrix, b.matrixWorldInverse);
        C.multiplyVector3(a);
        return a
    }
    ;
    this.unprojectVector = function(a, b) {
        b.projectionMatrixInverse.getInverse(b.projectionMatrix);
        C.multiply(b.matrixWorld, b.projectionMatrixInverse);
        C.multiplyVector3(a);
        return a
    }
    ;
    this.pickingRay = function(a, b) {
        var c;
        a.z = -1;
        c = new THREE.Vector3(a.x,a.y,1);
        this.unprojectVector(a, b);
        this.unprojectVector(c, b);
        c.subSelf(a).normalize();
        return new THREE.Ray(a,c)
    }
    ;
    this.projectGraph = function(b, d) {
        f = 0;
        y.objects.length = 0;
        y.sprites.length = 0;
        y.lights.length = 0;
        var g = function(b) {
            if (!1 !== b.visible) {
                (b instanceof THREE.Mesh || b instanceof THREE.Line) && (!1 === b.frustumCulled || H.contains(b)) ? (E.copy(b.matrixWorld.getPosition()),
                C.multiplyVector3(E),
                e = a(),
                e.object = b,
                e.z = E.z,
                y.objects.push(e)) : b instanceof THREE.Sprite || b instanceof THREE.Particle ? (E.copy(b.matrixWorld.getPosition()),
                C.multiplyVector3(E),
                e = a(),
                e.object = b,
                e.z = E.z,
                y.sprites.push(e)) : b instanceof THREE.Light && y.lights.push(b);
                for (var c = 0, d = b.children.length; c < d; c++)
                    g(b.children[c])
            }
        };
        g(b);
        d && y.objects.sort(c);
        return y
    }
    ;
    this.projectScene = function(a, e, f) {
        var g = e.near, F = e.far, l = !1, Q, D, B, T, M, E, ca, ha, U, X, aa, ba, m, Ha, La;
        x = s = o = n = 0;
        y.elements.length = 0;
        void 0 === e.parent && (console.warn("DEPRECATED: Camera hasn't been added to a Scene. Adding it..."),
        a.add(e));
        a.updateMatrixWorld();
        e.matrixWorldInverse.getInverse(e.matrixWorld);
        C.multiply(e.projectionMatrix, e.matrixWorldInverse);
        H.setFromMatrix(C);
        y = this.projectGraph(a, !1);
        a = 0;
        for (Q = y.objects.length; a < Q; a++)
            if (U = y.objects[a].object,
            X = U.matrixWorld,
            i = 0,
            U instanceof THREE.Mesh) {
                aa = U.geometry;
                ba = U.geometry.materials;
                T = aa.vertices;
                m = aa.faces;
                Ha = aa.faceVertexUvs;
                aa = U.matrixRotationWorld.extractRotation(X);
                D = 0;
                for (B = T.length; D < B; D++)
                    h = b(),
                    h.positionWorld.copy(T[D]),
                    X.multiplyVector3(h.positionWorld),
                    h.positionScreen.copy(h.positionWorld),
                    C.multiplyVector4(h.positionScreen),
                    h.positionScreen.x /= h.positionScreen.w,
                    h.positionScreen.y /= h.positionScreen.w,
                    h.visible = h.positionScreen.z > g && h.positionScreen.z < F;
                T = 0;
                for (D = m.length; T < D; T++) {
                    B = m[T];
                    if (B instanceof THREE.Face3)
                        if (M = j[B.a],
                        E = j[B.b],
                        ca = j[B.c],
                        M.visible && E.visible && ca.visible)
                            if (l = 0 > (ca.positionScreen.x - M.positionScreen.x) * (E.positionScreen.y - M.positionScreen.y) - (ca.positionScreen.y - M.positionScreen.y) * (E.positionScreen.x - M.positionScreen.x),
                            U.doubleSided || l != U.flipSided)
                                ha = p[n] = p[n] || new THREE.RenderableFace3,
                                n++,
                                k = ha,
                                k.v1.copy(M),
                                k.v2.copy(E),
                                k.v3.copy(ca);
                            else
                                continue;
                        else
                            continue;
                    else if (B instanceof THREE.Face4)
                        if (M = j[B.a],
                        E = j[B.b],
                        ca = j[B.c],
                        ha = j[B.d],
                        M.visible && E.visible && ca.visible && ha.visible)
                            if (l = 0 > (ha.positionScreen.x - M.positionScreen.x) * (E.positionScreen.y - M.positionScreen.y) - (ha.positionScreen.y - M.positionScreen.y) * (E.positionScreen.x - M.positionScreen.x) || 0 > (E.positionScreen.x - ca.positionScreen.x) * (ha.positionScreen.y - ca.positionScreen.y) - (E.positionScreen.y - ca.positionScreen.y) * (ha.positionScreen.x - ca.positionScreen.x),
                            U.doubleSided || l != U.flipSided)
                                La = r[o] = r[o] || new THREE.RenderableFace4,
                                o++,
                                k = La,
                                k.v1.copy(M),
                                k.v2.copy(E),
                                k.v3.copy(ca),
                                k.v4.copy(ha);
                            else
                                continue;
                        else
                            continue;
                    k.normalWorld.copy(B.normal);
                    !l && (U.flipSided || U.doubleSided) && k.normalWorld.negate();
                    aa.multiplyVector3(k.normalWorld);
                    k.centroidWorld.copy(B.centroid);
                    X.multiplyVector3(k.centroidWorld);
                    k.centroidScreen.copy(k.centroidWorld);
                    C.multiplyVector3(k.centroidScreen);
                    ca = B.vertexNormals;
                    M = 0;
                    for (E = ca.length; M < E; M++)
                        ha = k.vertexNormalsWorld[M],
                        ha.copy(ca[M]),
                        !l && (U.flipSided || U.doubleSided) && ha.negate(),
                        aa.multiplyVector3(ha);
                    M = 0;
                    for (E = Ha.length; M < E; M++)
                        if (La = Ha[M][T]) {
                            ca = 0;
                            for (ha = La.length; ca < ha; ca++)
                                k.uvs[M][ca] = La[ca]
                        }
                    k.material = U.material;
                    k.faceMaterial = null !== B.materialIndex ? ba[B.materialIndex] : null;
                    k.z = k.centroidScreen.z;
                    y.elements.push(k)
                }
            } else if (U instanceof THREE.Line) {
                w.multiply(C, X);
                T = U.geometry.vertices;
                M = b();
                M.positionScreen.copy(T[0]);
                w.multiplyVector4(M.positionScreen);
                X = U.type === THREE.LinePieces ? 2 : 1;
                D = 1;
                for (B = T.length; D < B; D++)
                    M = b(),
                    M.positionScreen.copy(T[D]),
                    w.multiplyVector4(M.positionScreen),
                    0 < (D + 1) % X || (E = j[i - 2],
                    L.copy(M.positionScreen),
                    I.copy(E.positionScreen),
                    d(L, I) && (L.multiplyScalar(1 / L.w),
                    I.multiplyScalar(1 / I.w),
                    ba = t[s] = t[s] || new THREE.RenderableLine,
                    s++,
                    q = ba,
                    q.v1.positionScreen.copy(L),
                    q.v2.positionScreen.copy(I),
                    q.z = Math.max(L.z, I.z),
                    q.material = U.material,
                    y.elements.push(q)))
            }
        a = 0;
        for (Q = y.sprites.length; a < Q; a++)
            U = y.sprites[a].object,
            X = U.matrixWorld,
            U instanceof THREE.Particle && (z.set(X.elements[12], X.elements[13], X.elements[14], 1),
            C.multiplyVector4(z),
            z.z /= z.w,
            0 < z.z && 1 > z.z && (g = u[x] = u[x] || new THREE.RenderableParticle,
            x++,
            v = g,
            v.x = z.x / z.w,
            v.y = z.y / z.w,
            v.z = z.z,
            v.rotation = U.rotation.z,
            v.scale.x = U.scale.x * Math.abs(v.x - (z.x + e.projectionMatrix.elements[0]) / (z.w + e.projectionMatrix.elements[12])),
            v.scale.y = U.scale.y * Math.abs(v.y - (z.y + e.projectionMatrix.elements[5]) / (z.w + e.projectionMatrix.elements[13])),
            v.material = U.material,
            y.elements.push(v)));
        f && y.elements.sort(c);
        return y
    }
}
;
THREE.Quaternion = function(a, b, c, d) {
    this.x = a || 0;
    this.y = b || 0;
    this.z = c || 0;
    this.w = void 0 !== d ? d : 1
}
;
THREE.Quaternion.prototype = {
    constructor: THREE.Quaternion,
    set: function(a, b, c, d) {
        this.x = a;
        this.y = b;
        this.z = c;
        this.w = d;
        return this
    },
    copy: function(a) {
        this.x = a.x;
        this.y = a.y;
        this.z = a.z;
        this.w = a.w;
        return this
    },
    setFromEuler: function(a) {
        var b = Math.PI / 360
          , c = a.x * b
          , d = a.y * b
          , e = a.z * b
          , a = Math.cos(d)
          , d = Math.sin(d)
          , b = Math.cos(-e)
          , e = Math.sin(-e)
          , f = Math.cos(c)
          , c = Math.sin(c)
          , g = a * b
          , h = d * e;
        this.w = g * f - h * c;
        this.x = g * c + h * f;
        this.y = d * b * f + a * e * c;
        this.z = a * e * f - d * b * c;
        return this
    },
    setFromAxisAngle: function(a, b) {
        var c = b / 2
          , d = Math.sin(c);
        this.x = a.x * d;
        this.y = a.y * d;
        this.z = a.z * d;
        this.w = Math.cos(c);
        return this
    },
    setFromRotationMatrix: function(a) {
        var b = Math.pow(a.determinant(), 1 / 3);
        this.w = Math.sqrt(Math.max(0, b + a.elements[0] + a.elements[5] + a.elements[10])) / 2;
        this.x = Math.sqrt(Math.max(0, b + a.elements[0] - a.elements[5] - a.elements[10])) / 2;
        this.y = Math.sqrt(Math.max(0, b - a.elements[0] + a.elements[5] - a.elements[10])) / 2;
        this.z = Math.sqrt(Math.max(0, b - a.elements[0] - a.elements[5] + a.elements[10])) / 2;
        this.x = 0 > a.elements[6] - a.elements[9] ? -Math.abs(this.x) : Math.abs(this.x);
        this.y = 0 > a.elements[8] - a.elements[2] ? -Math.abs(this.y) : Math.abs(this.y);
        this.z = 0 > a.elements[1] - a.elements[4] ? -Math.abs(this.z) : Math.abs(this.z);
        this.normalize();
        return this
    },
    calculateW: function() {
        this.w = -Math.sqrt(Math.abs(1 - this.x * this.x - this.y * this.y - this.z * this.z));
        return this
    },
    inverse: function() {
        this.x *= -1;
        this.y *= -1;
        this.z *= -1;
        return this
    },
    length: function() {
        return Math.sqrt(this.x * this.x + this.y * this.y + this.z * this.z + this.w * this.w)
    },
    normalize: function() {
        var a = Math.sqrt(this.x * this.x + this.y * this.y + this.z * this.z + this.w * this.w);
        0 === a ? this.w = this.z = this.y = this.x = 0 : (a = 1 / a,
        this.x *= a,
        this.y *= a,
        this.z *= a,
        this.w *= a);
        return this
    },
    multiply: function(a, b) {
        this.x = a.x * b.w + a.y * b.z - a.z * b.y + a.w * b.x;
        this.y = -a.x * b.z + a.y * b.w + a.z * b.x + a.w * b.y;
        this.z = a.x * b.y - a.y * b.x + a.z * b.w + a.w * b.z;
        this.w = -a.x * b.x - a.y * b.y - a.z * b.z + a.w * b.w;
        return this
    },
    multiplySelf: function(a) {
        var b = this.x
          , c = this.y
          , d = this.z
          , e = this.w
          , f = a.x
          , g = a.y
          , h = a.z
          , a = a.w;
        this.x = b * a + e * f + c * h - d * g;
        this.y = c * a + e * g + d * f - b * h;
        this.z = d * a + e * h + b * g - c * f;
        this.w = e * a - b * f - c * g - d * h;
        return this
    },
    multiplyVector3: function(a, b) {
        b || (b = a);
        var c = a.x
          , d = a.y
          , e = a.z
          , f = this.x
          , g = this.y
          , h = this.z
          , i = this.w
          , j = i * c + g * e - h * d
          , k = i * d + h * c - f * e
          , n = i * e + f * d - g * c
          , c = -f * c - g * d - h * e;
        b.x = j * i + c * -f + k * -h - n * -g;
        b.y = k * i + c * -g + n * -f - j * -h;
        b.z = n * i + c * -h + j * -g - k * -f;
        return b
    },
    clone: function() {
        return new THREE.Quaternion(this.x,this.y,this.z,this.w)
    }
};
THREE.Quaternion.slerp = function(a, b, c, d) {
    var e = a.w * b.w + a.x * b.x + a.y * b.y + a.z * b.z;
    0 > e ? (c.w = -b.w,
    c.x = -b.x,
    c.y = -b.y,
    c.z = -b.z,
    e = -e) : c.copy(b);
    if (1 <= Math.abs(e))
        return c.w = a.w,
        c.x = a.x,
        c.y = a.y,
        c.z = a.z,
        c;
    var f = Math.acos(e)
      , e = Math.sqrt(1 - e * e);
    if (0.0010 > Math.abs(e))
        return c.w = 0.5 * (a.w + b.w),
        c.x = 0.5 * (a.x + b.x),
        c.y = 0.5 * (a.y + b.y),
        c.z = 0.5 * (a.z + b.z),
        c;
    b = Math.sin((1 - d) * f) / e;
    d = Math.sin(d * f) / e;
    c.w = a.w * b + c.w * d;
    c.x = a.x * b + c.x * d;
    c.y = a.y * b + c.y * d;
    c.z = a.z * b + c.z * d;
    return c
}
;
THREE.Vertex = function() {
    console.warn("THREE.Vertex has been DEPRECATED. Use THREE.Vector3 instead.")
}
;
THREE.Face3 = function(a, b, c, d, e, f) {
    this.a = a;
    this.b = b;
    this.c = c;
    this.normal = d instanceof THREE.Vector3 ? d : new THREE.Vector3;
    this.vertexNormals = d instanceof Array ? d : [];
    this.color = e instanceof THREE.Color ? e : new THREE.Color;
    this.vertexColors = e instanceof Array ? e : [];
    this.vertexTangents = [];
    this.materialIndex = f;
    this.centroid = new THREE.Vector3
}
;
THREE.Face3.prototype = {
    constructor: THREE.Face3,
    clone: function() {
        var a = new THREE.Face3(this.a,this.b,this.c);
        a.normal.copy(this.normal);
        a.color.copy(this.color);
        a.centroid.copy(this.centroid);
        a.materialIndex = this.materialIndex;
        var b, c;
        b = 0;
        for (c = this.vertexNormals.length; b < c; b++)
            a.vertexNormals[b] = this.vertexNormals[b].clone();
        b = 0;
        for (c = this.vertexColors.length; b < c; b++)
            a.vertexColors[b] = this.vertexColors[b].clone();
        b = 0;
        for (c = this.vertexTangents.length; b < c; b++)
            a.vertexTangents[b] = this.vertexTangents[b].clone();
        return a
    }
};
THREE.Face4 = function(a, b, c, d, e, f, g) {
    this.a = a;
    this.b = b;
    this.c = c;
    this.d = d;
    this.normal = e instanceof THREE.Vector3 ? e : new THREE.Vector3;
    this.vertexNormals = e instanceof Array ? e : [];
    this.color = f instanceof THREE.Color ? f : new THREE.Color;
    this.vertexColors = f instanceof Array ? f : [];
    this.vertexTangents = [];
    this.materialIndex = g;
    this.centroid = new THREE.Vector3
}
;
THREE.Face4.prototype = {
    constructor: THREE.Face4,
    clone: function() {
        var a = new THREE.Face4(this.a,this.b,this.c,this.d);
        a.normal.copy(this.normal);
        a.color.copy(this.color);
        a.centroid.copy(this.centroid);
        a.materialIndex = this.materialIndex;
        var b, c;
        b = 0;
        for (c = this.vertexNormals.length; b < c; b++)
            a.vertexNormals[b] = this.vertexNormals[b].clone();
        b = 0;
        for (c = this.vertexColors.length; b < c; b++)
            a.vertexColors[b] = this.vertexColors[b].clone();
        b = 0;
        for (c = this.vertexTangents.length; b < c; b++)
            a.vertexTangents[b] = this.vertexTangents[b].clone();
        return a
    }
};
THREE.UV = function(a, b) {
    this.u = a || 0;
    this.v = b || 0
}
;
THREE.UV.prototype = {
    constructor: THREE.UV,
    set: function(a, b) {
        this.u = a;
        this.v = b;
        return this
    },
    copy: function(a) {
        this.u = a.u;
        this.v = a.v;
        return this
    },
    lerpSelf: function(a, b) {
        this.u += (a.u - this.u) * b;
        this.v += (a.v - this.v) * b;
        return this
    },
    clone: function() {
        return new THREE.UV(this.u,this.v)
    }
};
THREE.Geometry = function() {
    this.id = THREE.GeometryCount++;
    this.vertices = [];
    this.colors = [];
    this.materials = [];
    this.faces = [];
    this.faceUvs = [[]];
    this.faceVertexUvs = [[]];
    this.morphTargets = [];
    this.morphColors = [];
    this.morphNormals = [];
    this.skinWeights = [];
    this.skinIndices = [];
    this.boundingSphere = this.boundingBox = null;
    this.dynamic = this.hasTangents = !1
}
;
THREE.Geometry.prototype = {
    constructor: THREE.Geometry,
    applyMatrix: function(a) {
        var b = new THREE.Matrix4;
        b.extractRotation(a);
        for (var c = 0, d = this.vertices.length; c < d; c++)
            a.multiplyVector3(this.vertices[c]);
        c = 0;
        for (d = this.faces.length; c < d; c++) {
            var e = this.faces[c];
            b.multiplyVector3(e.normal);
            for (var f = 0, g = e.vertexNormals.length; f < g; f++)
                b.multiplyVector3(e.vertexNormals[f]);
            a.multiplyVector3(e.centroid)
        }
    },
    computeCentroids: function() {
        var a, b, c;
        a = 0;
        for (b = this.faces.length; a < b; a++)
            c = this.faces[a],
            c.centroid.set(0, 0, 0),
            c instanceof THREE.Face3 ? (c.centroid.addSelf(this.vertices[c.a]),
            c.centroid.addSelf(this.vertices[c.b]),
            c.centroid.addSelf(this.vertices[c.c]),
            c.centroid.divideScalar(3)) : c instanceof THREE.Face4 && (c.centroid.addSelf(this.vertices[c.a]),
            c.centroid.addSelf(this.vertices[c.b]),
            c.centroid.addSelf(this.vertices[c.c]),
            c.centroid.addSelf(this.vertices[c.d]),
            c.centroid.divideScalar(4))
    },
    computeFaceNormals: function() {
        var a, b, c, d, e, f, g = new THREE.Vector3, h = new THREE.Vector3;
        a = 0;
        for (b = this.faces.length; a < b; a++)
            c = this.faces[a],
            d = this.vertices[c.a],
            e = this.vertices[c.b],
            f = this.vertices[c.c],
            g.sub(f, e),
            h.sub(d, e),
            g.crossSelf(h),
            g.isZero() || g.normalize(),
            c.normal.copy(g)
    },
    computeVertexNormals: function() {
        var a, b, c, d;
        if (void 0 === this.__tmpVertices) {
            d = this.__tmpVertices = Array(this.vertices.length);
            a = 0;
            for (b = this.vertices.length; a < b; a++)
                d[a] = new THREE.Vector3;
            a = 0;
            for (b = this.faces.length; a < b; a++)
                c = this.faces[a],
                c instanceof THREE.Face3 ? c.vertexNormals = [new THREE.Vector3, new THREE.Vector3, new THREE.Vector3] : c instanceof THREE.Face4 && (c.vertexNormals = [new THREE.Vector3, new THREE.Vector3, new THREE.Vector3, new THREE.Vector3])
        } else {
            d = this.__tmpVertices;
            a = 0;
            for (b = this.vertices.length; a < b; a++)
                d[a].set(0, 0, 0)
        }
        a = 0;
        for (b = this.faces.length; a < b; a++)
            c = this.faces[a],
            c instanceof THREE.Face3 ? (d[c.a].addSelf(c.normal),
            d[c.b].addSelf(c.normal),
            d[c.c].addSelf(c.normal)) : c instanceof THREE.Face4 && (d[c.a].addSelf(c.normal),
            d[c.b].addSelf(c.normal),
            d[c.c].addSelf(c.normal),
            d[c.d].addSelf(c.normal));
        a = 0;
        for (b = this.vertices.length; a < b; a++)
            d[a].normalize();
        a = 0;
        for (b = this.faces.length; a < b; a++)
            c = this.faces[a],
            c instanceof THREE.Face3 ? (c.vertexNormals[0].copy(d[c.a]),
            c.vertexNormals[1].copy(d[c.b]),
            c.vertexNormals[2].copy(d[c.c])) : c instanceof THREE.Face4 && (c.vertexNormals[0].copy(d[c.a]),
            c.vertexNormals[1].copy(d[c.b]),
            c.vertexNormals[2].copy(d[c.c]),
            c.vertexNormals[3].copy(d[c.d]))
    },
    computeMorphNormals: function() {
        var a, b, c, d, e;
        c = 0;
        for (d = this.faces.length; c < d; c++) {
            e = this.faces[c];
            e.__originalFaceNormal ? e.__originalFaceNormal.copy(e.normal) : e.__originalFaceNormal = e.normal.clone();
            e.__originalVertexNormals || (e.__originalVertexNormals = []);
            a = 0;
            for (b = e.vertexNormals.length; a < b; a++)
                e.__originalVertexNormals[a] ? e.__originalVertexNormals[a].copy(e.vertexNormals[a]) : e.__originalVertexNormals[a] = e.vertexNormals[a].clone()
        }
        var f = new THREE.Geometry;
        f.faces = this.faces;
        a = 0;
        for (b = this.morphTargets.length; a < b; a++) {
            if (!this.morphNormals[a]) {
                this.morphNormals[a] = {};
                this.morphNormals[a].faceNormals = [];
                this.morphNormals[a].vertexNormals = [];
                var g = this.morphNormals[a].faceNormals, h = this.morphNormals[a].vertexNormals, i, j;
                c = 0;
                for (d = this.faces.length; c < d; c++)
                    e = this.faces[c],
                    i = new THREE.Vector3,
                    j = e instanceof THREE.Face3 ? {
                        a: new THREE.Vector3,
                        b: new THREE.Vector3,
                        c: new THREE.Vector3
                    } : {
                        a: new THREE.Vector3,
                        b: new THREE.Vector3,
                        c: new THREE.Vector3,
                        d: new THREE.Vector3
                    },
                    g.push(i),
                    h.push(j)
            }
            g = this.morphNormals[a];
            f.vertices = this.morphTargets[a].vertices;
            f.computeFaceNormals();
            f.computeVertexNormals();
            c = 0;
            for (d = this.faces.length; c < d; c++)
                e = this.faces[c],
                i = g.faceNormals[c],
                j = g.vertexNormals[c],
                i.copy(e.normal),
                e instanceof THREE.Face3 ? (j.a.copy(e.vertexNormals[0]),
                j.b.copy(e.vertexNormals[1]),
                j.c.copy(e.vertexNormals[2])) : (j.a.copy(e.vertexNormals[0]),
                j.b.copy(e.vertexNormals[1]),
                j.c.copy(e.vertexNormals[2]),
                j.d.copy(e.vertexNormals[3]))
        }
        c = 0;
        for (d = this.faces.length; c < d; c++)
            e = this.faces[c],
            e.normal = e.__originalFaceNormal,
            e.vertexNormals = e.__originalVertexNormals
    },
    computeTangents: function() {
        function a(a, b, c, d, e, f, M) {
            h = a.vertices[b];
            i = a.vertices[c];
            j = a.vertices[d];
            k = g[e];
            n = g[f];
            p = g[M];
            o = i.x - h.x;
            r = j.x - h.x;
            q = i.y - h.y;
            s = j.y - h.y;
            t = i.z - h.z;
            v = j.z - h.z;
            x = n.u - k.u;
            u = p.u - k.u;
            y = n.v - k.v;
            E = p.v - k.v;
            z = 1 / (x * E - u * y);
            L.set((E * o - y * r) * z, (E * q - y * s) * z, (E * t - y * v) * z);
            I.set((x * r - u * o) * z, (x * s - u * q) * z, (x * v - u * t) * z);
            w[b].addSelf(L);
            w[c].addSelf(L);
            w[d].addSelf(L);
            H[b].addSelf(I);
            H[c].addSelf(I);
            H[d].addSelf(I)
        }
        var b, c, d, e, f, g, h, i, j, k, n, p, o, r, q, s, t, v, x, u, y, E, z, C, w = [], H = [], L = new THREE.Vector3, I = new THREE.Vector3, P = new THREE.Vector3, N = new THREE.Vector3, A = new THREE.Vector3;
        b = 0;
        for (c = this.vertices.length; b < c; b++)
            w[b] = new THREE.Vector3,
            H[b] = new THREE.Vector3;
        b = 0;
        for (c = this.faces.length; b < c; b++)
            f = this.faces[b],
            g = this.faceVertexUvs[0][b],
            f instanceof THREE.Face3 ? a(this, f.a, f.b, f.c, 0, 1, 2) : f instanceof THREE.Face4 && (a(this, f.a, f.b, f.d, 0, 1, 3),
            a(this, f.b, f.c, f.d, 1, 2, 3));
        var J = ["a", "b", "c", "d"];
        b = 0;
        for (c = this.faces.length; b < c; b++) {
            f = this.faces[b];
            for (d = 0; d < f.vertexNormals.length; d++)
                A.copy(f.vertexNormals[d]),
                e = f[J[d]],
                C = w[e],
                P.copy(C),
                P.subSelf(A.multiplyScalar(A.dot(C))).normalize(),
                N.cross(f.vertexNormals[d], C),
                e = N.dot(H[e]),
                e = 0 > e ? -1 : 1,
                f.vertexTangents[d] = new THREE.Vector4(P.x,P.y,P.z,e)
        }
        this.hasTangents = !0
    },
    computeBoundingBox: function() {
        this.boundingBox || (this.boundingBox = {
            min: new THREE.Vector3,
            max: new THREE.Vector3
        });
        if (0 < this.vertices.length) {
            var a;
            a = this.vertices[0];
            this.boundingBox.min.copy(a);
            this.boundingBox.max.copy(a);
            for (var b = this.boundingBox.min, c = this.boundingBox.max, d = 1, e = this.vertices.length; d < e; d++)
                (a = this.vertices[d],
                a.x < b.x ? b.x = a.x : a.x > c.x && (c.x = a.x),
                a.y < b.y ? b.y = a.y : a.y > c.y && (c.y = a.y),
                a.z < b.z) ? b.z = a.z : a.z > c.z && (c.z = a.z)
        } else
            this.boundingBox.min.set(0, 0, 0),
            this.boundingBox.max.set(0, 0, 0)
    },
    computeBoundingSphere: function() {
        this.boundingSphere || (this.boundingSphere = {
            radius: 0
        });
        for (var a, b = 0, c = 0, d = this.vertices.length; c < d; c++)
            a = this.vertices[c].length(),
            a > b && (b = a);
        this.boundingSphere.radius = b
    },
    mergeVertices: function() {
        var a = {}, b = [], c = [], d, e = Math.pow(10, 4), f, g, h;
        f = 0;
        for (g = this.vertices.length; f < g; f++)
            d = this.vertices[f],
            d = [Math.round(d.x * e), Math.round(d.y * e), Math.round(d.z * e)].join("_"),
            void 0 === a[d] ? (a[d] = f,
            b.push(this.vertices[f]),
            c[f] = b.length - 1) : c[f] = c[a[d]];
        f = 0;
        for (g = this.faces.length; f < g; f++)
            if (e = this.faces[f],
            e instanceof THREE.Face3)
                e.a = c[e.a],
                e.b = c[e.b],
                e.c = c[e.c];
            else if (e instanceof THREE.Face4) {
                e.a = c[e.a];
                e.b = c[e.b];
                e.c = c[e.c];
                e.d = c[e.d];
                d = [e.a, e.b, e.c, e.d];
                for (a = 3; 0 < a; a--)
                    if (d.indexOf(e["abcd"[a]]) != a) {
                        d.splice(a, 1);
                        this.faces[f] = new THREE.Face3(d[0],d[1],d[2]);
                        e = 0;
                        for (d = this.faceVertexUvs.length; e < d; e++)
                            (h = this.faceVertexUvs[e][f]) && h.splice(a, 1);
                        break
                    }
            }
        c = this.vertices.length - b.length;
        this.vertices = b;
        return c
    }
};
THREE.GeometryCount = 0;
THREE.Spline = function(a) {
    function b(a, b, c, d, e, f, g) {
        a = 0.5 * (c - a);
        d = 0.5 * (d - b);
        return (2 * (b - c) + a + d) * g + (-3 * (b - c) - 2 * a - d) * f + a * e + b
    }
    this.points = a;
    var c = [], d = {
        x: 0,
        y: 0,
        z: 0
    }, e, f, g, h, i, j, k, n, p;
    this.initFromArray = function(a) {
        this.points = [];
        for (var b = 0; b < a.length; b++)
            this.points[b] = {
                x: a[b][0],
                y: a[b][1],
                z: a[b][2]
            }
    }
    ;
    this.getPoint = function(a) {
        e = (this.points.length - 1) * a;
        f = Math.floor(e);
        g = e - f;
        c[0] = 0 === f ? f : f - 1;
        c[1] = f;
        c[2] = f > this.points.length - 2 ? this.points.length - 1 : f + 1;
        c[3] = f > this.points.length - 3 ? this.points.length - 1 : f + 2;
        j = this.points[c[0]];
        k = this.points[c[1]];
        n = this.points[c[2]];
        p = this.points[c[3]];
        h = g * g;
        i = g * h;
        d.x = b(j.x, k.x, n.x, p.x, g, h, i);
        d.y = b(j.y, k.y, n.y, p.y, g, h, i);
        d.z = b(j.z, k.z, n.z, p.z, g, h, i);
        return d
    }
    ;
    this.getControlPointsArray = function() {
        var a, b, c = this.points.length, d = [];
        for (a = 0; a < c; a++)
            b = this.points[a],
            d[a] = [b.x, b.y, b.z];
        return d
    }
    ;
    this.getLength = function(a) {
        var b, c, d, e = 0, f = new THREE.Vector3, g = new THREE.Vector3, h = [], i = 0;
        h[0] = 0;
        a || (a = 100);
        c = this.points.length * a;
        f.copy(this.points[0]);
        for (a = 1; a < c; a++)
            b = a / c,
            d = this.getPoint(b),
            g.copy(d),
            i += g.distanceTo(f),
            f.copy(d),
            b *= this.points.length - 1,
            b = Math.floor(b),
            b != e && (h[b] = i,
            e = b);
        h[h.length] = i;
        return {
            chunks: h,
            total: i
        }
    }
    ;
    this.reparametrizeByArcLength = function(a) {
        var b, c, d, e, f, g, h = [], i = new THREE.Vector3, j = this.getLength();
        h.push(i.copy(this.points[0]).clone());
        for (b = 1; b < this.points.length; b++) {
            c = j.chunks[b] - j.chunks[b - 1];
            g = Math.ceil(a * c / j.total);
            e = (b - 1) / (this.points.length - 1);
            f = b / (this.points.length - 1);
            for (c = 1; c < g - 1; c++)
                d = e + c * (1 / g) * (f - e),
                d = this.getPoint(d),
                h.push(i.copy(d).clone());
            h.push(i.copy(this.points[b]).clone())
        }
        this.points = h
    }
}
;
THREE.Camera = function() {
    THREE.Object3D.call(this);
    this.matrixWorldInverse = new THREE.Matrix4;
    this.projectionMatrix = new THREE.Matrix4;
    this.projectionMatrixInverse = new THREE.Matrix4
}
;
THREE.Camera.prototype = new THREE.Object3D;
THREE.Camera.prototype.constructor = THREE.Camera;
THREE.Camera.prototype.lookAt = function(a) {
    this.matrix.lookAt(this.position, a, this.up);
    this.rotationAutoUpdate && this.rotation.getRotationFromMatrix(this.matrix)
}
;
THREE.OrthographicCamera = function(a, b, c, d, e, f) {
    THREE.Camera.call(this);
    this.left = a;
    this.right = b;
    this.top = c;
    this.bottom = d;
    this.near = void 0 !== e ? e : 0.1;
    this.far = void 0 !== f ? f : 2E3;
    this.updateProjectionMatrix()
}
;
THREE.OrthographicCamera.prototype = new THREE.Camera;
THREE.OrthographicCamera.prototype.constructor = THREE.OrthographicCamera;
THREE.OrthographicCamera.prototype.updateProjectionMatrix = function() {
    this.projectionMatrix.makeOrthographic(this.left, this.right, this.top, this.bottom, this.near, this.far)
}
;
THREE.PerspectiveCamera = function(a, b, c, d) {
    THREE.Camera.call(this);
    this.fov = void 0 !== a ? a : 50;
    this.aspect = void 0 !== b ? b : 1;
    this.near = void 0 !== c ? c : 0.1;
    this.far = void 0 !== d ? d : 2E3;
    this.updateProjectionMatrix()
}
;
THREE.PerspectiveCamera.prototype = new THREE.Camera;
THREE.PerspectiveCamera.prototype.constructor = THREE.PerspectiveCamera;
THREE.PerspectiveCamera.prototype.setLens = function(a, b) {
    this.fov = 2 * Math.atan((void 0 !== b ? b : 24) / (2 * a)) * (180 / Math.PI);
    this.updateProjectionMatrix()
}
;
THREE.PerspectiveCamera.prototype.setViewOffset = function(a, b, c, d, e, f) {
    this.fullWidth = a;
    this.fullHeight = b;
    this.x = c;
    this.y = d;
    this.width = e;
    this.height = f;
    this.updateProjectionMatrix()
}
;
THREE.PerspectiveCamera.prototype.updateProjectionMatrix = function() {
    if (this.fullWidth) {
        var a = this.fullWidth / this.fullHeight
          , b = Math.tan(this.fov * Math.PI / 360) * this.near
          , c = -b
          , d = a * c
          , a = Math.abs(a * b - d)
          , c = Math.abs(b - c);
        this.projectionMatrix.makeFrustum(d + this.x * a / this.fullWidth, d + (this.x + this.width) * a / this.fullWidth, b - (this.y + this.height) * c / this.fullHeight, b - this.y * c / this.fullHeight, this.near, this.far)
    } else
        this.projectionMatrix.makePerspective(this.fov, this.aspect, this.near, this.far)
}
;
THREE.Light = function(a) {
    THREE.Object3D.call(this);
    this.color = new THREE.Color(a)
}
;
THREE.Light.prototype = new THREE.Object3D;
THREE.Light.prototype.constructor = THREE.Light;
THREE.Light.prototype.supr = THREE.Object3D.prototype;
THREE.AmbientLight = function(a) {
    THREE.Light.call(this, a)
}
;
THREE.AmbientLight.prototype = new THREE.Light;
THREE.AmbientLight.prototype.constructor = THREE.AmbientLight;
THREE.DirectionalLight = function(a, b, c) {
    THREE.Light.call(this, a);
    this.position = new THREE.Vector3(0,1,0);
    this.target = new THREE.Object3D;
    this.intensity = void 0 !== b ? b : 1;
    this.distance = void 0 !== c ? c : 0;
    this.onlyShadow = this.castShadow = !1;
    this.shadowCameraNear = 50;
    this.shadowCameraFar = 5E3;
    this.shadowCameraLeft = -500;
    this.shadowCameraTop = this.shadowCameraRight = 500;
    this.shadowCameraBottom = -500;
    this.shadowCameraVisible = !1;
    this.shadowBias = 0;
    this.shadowDarkness = 0.5;
    this.shadowMapHeight = this.shadowMapWidth = 512;
    this.shadowCascade = !1;
    this.shadowCascadeOffset = new THREE.Vector3(0,0,-1E3);
    this.shadowCascadeCount = 2;
    this.shadowCascadeBias = [0, 0, 0];
    this.shadowCascadeWidth = [512, 512, 512];
    this.shadowCascadeHeight = [512, 512, 512];
    this.shadowCascadeNearZ = [-1, 0.99, 0.998];
    this.shadowCascadeFarZ = [0.99, 0.998, 1];
    this.shadowCascadeArray = [];
    this.shadowMatrix = this.shadowCamera = this.shadowMapSize = this.shadowMap = null
}
;
THREE.DirectionalLight.prototype = new THREE.Light;
THREE.DirectionalLight.prototype.constructor = THREE.DirectionalLight;
THREE.PointLight = function(a, b, c) {
    THREE.Light.call(this, a);
    this.position = new THREE.Vector3(0,0,0);
    this.intensity = void 0 !== b ? b : 1;
    this.distance = void 0 !== c ? c : 0
}
;
THREE.PointLight.prototype = new THREE.Light;
THREE.PointLight.prototype.constructor = THREE.PointLight;
THREE.SpotLight = function(a, b, c, d, e) {
    THREE.Light.call(this, a);
    this.position = new THREE.Vector3(0,1,0);
    this.target = new THREE.Object3D;
    this.intensity = void 0 !== b ? b : 1;
    this.distance = void 0 !== c ? c : 0;
    this.angle = void 0 !== d ? d : Math.PI / 2;
    this.exponent = void 0 !== e ? e : 10;
    this.onlyShadow = this.castShadow = !1;
    this.shadowCameraNear = 50;
    this.shadowCameraFar = 5E3;
    this.shadowCameraFov = 50;
    this.shadowCameraVisible = !1;
    this.shadowBias = 0;
    this.shadowDarkness = 0.5;
    this.shadowMapHeight = this.shadowMapWidth = 512;
    this.shadowMatrix = this.shadowCamera = this.shadowMapSize = this.shadowMap = null
}
;
THREE.SpotLight.prototype = new THREE.Light;
THREE.SpotLight.prototype.constructor = THREE.SpotLight;
THREE.Loader = function(a) {
    this.statusDomElement = (this.showStatus = a) ? THREE.Loader.prototype.addStatusElement() : null;
    this.onLoadStart = function() {}
    ;
    this.onLoadProgress = function() {}
    ;
    this.onLoadComplete = function() {}
}
;
THREE.Loader.prototype = {
    constructor: THREE.Loader,
    crossOrigin: "anonymous",
    addStatusElement: function() {
        var a = document.createElement("div");
        a.style.position = "absolute";
        a.style.right = "0px";
        a.style.top = "0px";
        a.style.fontSize = "0.8em";
        a.style.textAlign = "left";
        a.style.background = "rgba(0,0,0,0.25)";
        a.style.color = "#fff";
        a.style.width = "120px";
        a.style.padding = "0.5em 0.5em 0.5em 0.5em";
        a.style.zIndex = 1E3;
        a.innerHTML = "Loading ...";
        return a
    },
    updateProgress: function(a) {
        var b = "Loaded "
          , b = a.total ? b + ((100 * a.loaded / a.total).toFixed(0) + "%") : b + ((a.loaded / 1E3).toFixed(2) + " KB");
        this.statusDomElement.innerHTML = b
    },
    extractUrlBase: function(a) {
        a = a.split("/");
        a.pop();
        return (1 > a.length ? "." : a.join("/")) + "/"
    },
    initMaterials: function(a, b, c) {
        a.materials = [];
        for (var d = 0; d < b.length; ++d)
            a.materials[d] = THREE.Loader.prototype.createMaterial(b[d], c)
    },
    hasNormals: function(a) {
        var b, c, d = a.materials.length;
        for (c = 0; c < d; c++)
            if (b = a.materials[c],
            b instanceof THREE.ShaderMaterial)
                return !0;
        return !1
    },
    createMaterial: function(a, b) {
        function c(a) {
            a = Math.log(a) / Math.LN2;
            return Math.floor(a) == a
        }
        function d(a) {
            a = Math.log(a) / Math.LN2;
            return Math.pow(2, Math.round(a))
        }
        function e(a, b) {
            var e = new Image;
            e.onload = function() {
                if (!c(this.width) || !c(this.height)) {
                    var b = d(this.width)
                      , e = d(this.height);
                    a.image.width = b;
                    a.image.height = e;
                    a.image.getContext("2d").drawImage(this, 0, 0, b, e)
                } else
                    a.image = this;
                a.needsUpdate = !0
            }
            ;
            e.crossOrigin = h.crossOrigin;
            e.src = b
        }
        function f(a, c, d, f, g, h) {
            var i = document.createElement("canvas");
            a[c] = new THREE.Texture(i);
            a[c].sourceFile = d;
            if (f && (a[c].repeat.set(f[0], f[1]),
            1 != f[0] && (a[c].wrapS = THREE.RepeatWrapping),
            1 != f[1]))
                a[c].wrapT = THREE.RepeatWrapping;
            g && a[c].offset.set(g[0], g[1]);
            if (h && (f = {
                repeat: THREE.RepeatWrapping,
                mirror: THREE.MirroredRepeatWrapping
            },
            void 0 !== f[h[0]] && (a[c].wrapS = f[h[0]]),
            void 0 !== f[h[1]]))
                a[c].wrapT = f[h[1]];
            e(a[c], b + "/" + d)
        }
        function g(a) {
            return (255 * a[0] << 16) + (255 * a[1] << 8) + 255 * a[2]
        }
        var h = this
          , i = "MeshLambertMaterial"
          , j = {
            color: 15658734,
            opacity: 1,
            map: null,
            lightMap: null,
            normalMap: null,
            wireframe: a.wireframe
        };
        if (a.shading) {
            var k = a.shading.toLowerCase();
            "phong" === k ? i = "MeshPhongMaterial" : "basic" === k && (i = "MeshBasicMaterial")
        }
        void 0 !== a.blending && void 0 !== THREE[a.blending] && (j.blending = THREE[a.blending]);
        if (void 0 !== a.transparent || 1 > a.opacity)
            j.transparent = a.transparent;
        void 0 !== a.depthTest && (j.depthTest = a.depthTest);
        void 0 !== a.depthWrite && (j.depthWrite = a.depthWrite);
        void 0 !== a.vertexColors && ("face" == a.vertexColors ? j.vertexColors = THREE.FaceColors : a.vertexColors && (j.vertexColors = THREE.VertexColors));
        a.colorDiffuse ? j.color = g(a.colorDiffuse) : a.DbgColor && (j.color = a.DbgColor);
        a.colorSpecular && (j.specular = g(a.colorSpecular));
        a.colorAmbient && (j.ambient = g(a.colorAmbient));
        a.transparency && (j.opacity = a.transparency);
        a.specularCoef && (j.shininess = a.specularCoef);
        a.mapDiffuse && b && f(j, "map", a.mapDiffuse, a.mapDiffuseRepeat, a.mapDiffuseOffset, a.mapDiffuseWrap);
        a.mapLight && b && f(j, "lightMap", a.mapLight, a.mapLightRepeat, a.mapLightOffset, a.mapLightWrap);
        a.mapNormal && b && f(j, "normalMap", a.mapNormal, a.mapNormalRepeat, a.mapNormalOffset, a.mapNormalWrap);
        a.mapSpecular && b && f(j, "specularMap", a.mapSpecular, a.mapSpecularRepeat, a.mapSpecularOffset, a.mapSpecularWrap);
        a.mapNormal ? (i = THREE.ShaderUtils.lib.normal,
        k = THREE.UniformsUtils.clone(i.uniforms),
        k.tNormal.texture = j.normalMap,
        a.mapNormalFactor && (k.uNormalScale.value = a.mapNormalFactor),
        j.map && (k.tDiffuse.texture = j.map,
        k.enableDiffuse.value = !0),
        j.specularMap && (k.tSpecular.texture = j.specularMap,
        k.enableSpecular.value = !0),
        j.lightMap && (k.tAO.texture = j.lightMap,
        k.enableAO.value = !0),
        k.uDiffuseColor.value.setHex(j.color),
        k.uSpecularColor.value.setHex(j.specular),
        k.uAmbientColor.value.setHex(j.ambient),
        k.uShininess.value = j.shininess,
        void 0 !== j.opacity && (k.uOpacity.value = j.opacity),
        j = new THREE.ShaderMaterial({
            fragmentShader: i.fragmentShader,
            vertexShader: i.vertexShader,
            uniforms: k,
            lights: !0,
            fog: !0
        })) : j = new THREE[i](j);
        void 0 !== a.DbgName && (j.name = a.DbgName);
        return j
    }
};
THREE.BinaryLoader = function(a) {
    THREE.Loader.call(this, a)
}
;
THREE.BinaryLoader.prototype = new THREE.Loader;
THREE.BinaryLoader.prototype.constructor = THREE.BinaryLoader;
THREE.BinaryLoader.prototype.load = function(a, b, c, d) {
    var c = c ? c : this.extractUrlBase(a)
      , d = d ? d : this.extractUrlBase(a)
      , e = this.showProgress ? THREE.Loader.prototype.updateProgress : null;
    this.onLoadStart();
    this.loadAjaxJSON(this, a, b, c, d, e)
}
;
THREE.BinaryLoader.prototype.loadAjaxJSON = function(a, b, c, d, e, f) {
    var g = new XMLHttpRequest;
    g.onreadystatechange = function() {
        if (4 == g.readyState)
            if (200 == g.status || 0 == g.status) {
                var h = JSON.parse(g.responseText);
                a.loadAjaxBuffers(h, c, e, d, f)
            } else
                console.error("THREE.BinaryLoader: Couldn't load [" + b + "] [" + g.status + "]")
    }
    ;
    g.open("GET", b, !0);
    g.overrideMimeType && g.overrideMimeType("text/plain; charset=x-user-defined");
    g.setRequestHeader("Content-Type", "text/plain");
    g.send(null)
}
;
THREE.BinaryLoader.prototype.loadAjaxBuffers = function(a, b, c, d, e) {
    var f = new XMLHttpRequest
      , g = c + "/" + a.buffers
      , h = 0;
    f.onreadystatechange = function() {
        4 == f.readyState ? 200 == f.status || 0 == f.status ? THREE.BinaryLoader.prototype.createBinModel(f.response, b, d, a.materials) : console.error("THREE.BinaryLoader: Couldn't load [" + g + "] [" + f.status + "]") : 3 == f.readyState ? e && (0 == h && (h = f.getResponseHeader("Content-Length")),
        e({
            total: h,
            loaded: f.responseText.length
        })) : 2 == f.readyState && (h = f.getResponseHeader("Content-Length"))
    }
    ;
    f.open("GET", g, !0);
    f.responseType = "arraybuffer";
    f.send(null)
}
;
THREE.BinaryLoader.prototype.createBinModel = function(a, b, c, d) {
    var e = function(b) {
        function c(a) {
            return a % 4 ? 4 - a % 4 : 0
        }
        function e(a, b) {
            return (new Uint8Array(a,b,1))[0]
        }
        function i(a, b) {
            return (new Uint32Array(a,b,1))[0]
        }
        function j(b, c) {
            var d, e, f, g, h, i, j, k, l = new Uint32Array(a,c,3 * b);
            for (d = 0; d < b; d++) {
                e = l[3 * d];
                f = l[3 * d + 1];
                g = l[3 * d + 2];
                h = F[2 * e];
                e = F[2 * e + 1];
                i = F[2 * f];
                j = F[2 * f + 1];
                f = F[2 * g];
                k = F[2 * g + 1];
                g = N.faceVertexUvs[0];
                var n = [];
                n.push(new THREE.UV(h,e));
                n.push(new THREE.UV(i,j));
                n.push(new THREE.UV(f,k));
                g.push(n)
            }
        }
        function k(b, c) {
            var d, e, f, g, h, i, j, k, l, n, p = new Uint32Array(a,c,4 * b);
            for (d = 0; d < b; d++) {
                e = p[4 * d];
                f = p[4 * d + 1];
                g = p[4 * d + 2];
                h = p[4 * d + 3];
                i = F[2 * e];
                e = F[2 * e + 1];
                j = F[2 * f];
                l = F[2 * f + 1];
                k = F[2 * g];
                n = F[2 * g + 1];
                g = F[2 * h];
                f = F[2 * h + 1];
                h = N.faceVertexUvs[0];
                var o = [];
                o.push(new THREE.UV(i,e));
                o.push(new THREE.UV(j,l));
                o.push(new THREE.UV(k,n));
                o.push(new THREE.UV(g,f));
                h.push(o)
            }
        }
        function n(b, c, d) {
            for (var e, f, g, h, c = new Uint32Array(a,c,3 * b), i = new Uint16Array(a,d,b), d = 0; d < b; d++)
                e = c[3 * d],
                f = c[3 * d + 1],
                g = c[3 * d + 2],
                h = i[d],
                N.faces.push(new THREE.Face3(e,f,g,null,null,h))
        }
        function p(b, c, d) {
            for (var e, f, g, h, i, c = new Uint32Array(a,c,4 * b), j = new Uint16Array(a,d,b), d = 0; d < b; d++)
                e = c[4 * d],
                f = c[4 * d + 1],
                g = c[4 * d + 2],
                h = c[4 * d + 3],
                i = j[d],
                N.faces.push(new THREE.Face4(e,f,g,h,null,null,i))
        }
        function o(b, c, d, e) {
            for (var f, g, h, i, j, k, l, c = new Uint32Array(a,c,3 * b), d = new Uint32Array(a,d,3 * b), n = new Uint16Array(a,e,b), e = 0; e < b; e++) {
                f = c[3 * e];
                g = c[3 * e + 1];
                h = c[3 * e + 2];
                j = d[3 * e];
                k = d[3 * e + 1];
                l = d[3 * e + 2];
                i = n[e];
                var p = J[3 * k]
                  , o = J[3 * k + 1];
                k = J[3 * k + 2];
                var q = J[3 * l]
                  , r = J[3 * l + 1];
                l = J[3 * l + 2];
                N.faces.push(new THREE.Face3(f,g,h,[new THREE.Vector3(J[3 * j],J[3 * j + 1],J[3 * j + 2]), new THREE.Vector3(p,o,k), new THREE.Vector3(q,r,l)],null,i))
            }
        }
        function r(b, c, d, e) {
            for (var f, g, h, i, j, k, l, n, p, c = new Uint32Array(a,c,4 * b), d = new Uint32Array(a,d,4 * b), o = new Uint16Array(a,e,b), e = 0; e < b; e++) {
                f = c[4 * e];
                g = c[4 * e + 1];
                h = c[4 * e + 2];
                i = c[4 * e + 3];
                k = d[4 * e];
                l = d[4 * e + 1];
                n = d[4 * e + 2];
                p = d[4 * e + 3];
                j = o[e];
                var q = J[3 * l]
                  , r = J[3 * l + 1];
                l = J[3 * l + 2];
                var s = J[3 * n]
                  , w = J[3 * n + 1];
                n = J[3 * n + 2];
                var t = J[3 * p]
                  , u = J[3 * p + 1];
                p = J[3 * p + 2];
                N.faces.push(new THREE.Face4(f,g,h,i,[new THREE.Vector3(J[3 * k],J[3 * k + 1],J[3 * k + 2]), new THREE.Vector3(q,r,l), new THREE.Vector3(s,w,n), new THREE.Vector3(t,u,p)],null,j))
            }
        }
        var q, s, t, v, x, u, y, E, z, C, w, H, L, I, P, N = this, A = 0, J = [], F = [], l, Q, D;
        THREE.Geometry.call(this);
        THREE.Loader.prototype.initMaterials(N, d, b);
        (function(a, b, c) {
            for (var a = new Uint8Array(a,b,c), d = "", e = 0; e < c; e++)
                d += String.fromCharCode(a[b + e]);
            return d
        }
        )(a, A, 12);
        q = e(a, A + 12);
        e(a, A + 13);
        e(a, A + 14);
        e(a, A + 15);
        s = e(a, A + 16);
        t = e(a, A + 17);
        v = e(a, A + 18);
        x = e(a, A + 19);
        u = i(a, A + 20);
        y = i(a, A + 20 + 4);
        E = i(a, A + 20 + 8);
        b = i(a, A + 20 + 12);
        z = i(a, A + 20 + 16);
        C = i(a, A + 20 + 20);
        w = i(a, A + 20 + 24);
        H = i(a, A + 20 + 28);
        L = i(a, A + 20 + 32);
        I = i(a, A + 20 + 36);
        P = i(a, A + 20 + 40);
        A += q;
        q = 3 * s + x;
        D = 4 * s + x;
        l = b * q;
        Q = z * (q + 3 * t);
        s = C * (q + 3 * v);
        x = w * (q + 3 * t + 3 * v);
        q = H * D;
        t = L * (D + 4 * t);
        v = I * (D + 4 * v);
        A += function(b) {
            var b = new Float32Array(a,b,3 * u), c, d, e, f;
            for (c = 0; c < u; c++)
                d = b[3 * c],
                e = b[3 * c + 1],
                f = b[3 * c + 2],
                N.vertices.push(new THREE.Vector3(d,e,f));
            return 3 * u * Float32Array.BYTES_PER_ELEMENT
        }(A);
        A += function(b) {
            if (y) {
                var b = new Int8Array(a,b,3 * y), c, d, e, f;
                for (c = 0; c < y; c++)
                    d = b[3 * c],
                    e = b[3 * c + 1],
                    f = b[3 * c + 2],
                    J.push(d / 127, e / 127, f / 127)
            }
            return 3 * y * Int8Array.BYTES_PER_ELEMENT
        }(A);
        A += c(3 * y);
        A += function(b) {
            if (E) {
                var b = new Float32Array(a,b,2 * E), c, d, e;
                for (c = 0; c < E; c++)
                    d = b[2 * c],
                    e = b[2 * c + 1],
                    F.push(d, e)
            }
            return 2 * E * Float32Array.BYTES_PER_ELEMENT
        }(A);
        l = A + l + c(2 * b);
        Q = l + Q + c(2 * z);
        s = Q + s + c(2 * C);
        x = s + x + c(2 * w);
        q = x + q + c(2 * H);
        t = q + t + c(2 * L);
        v = t + v + c(2 * I);
        (function(a) {
            if (C) {
                var b = a + 3 * C * Uint32Array.BYTES_PER_ELEMENT;
                n(C, a, b + 3 * C * Uint32Array.BYTES_PER_ELEMENT);
                j(C, b)
            }
        }
        )(Q);
        (function(a) {
            if (w) {
                var b = a + 3 * w * Uint32Array.BYTES_PER_ELEMENT
                  , c = b + 3 * w * Uint32Array.BYTES_PER_ELEMENT;
                o(w, a, b, c + 3 * w * Uint32Array.BYTES_PER_ELEMENT);
                j(w, c)
            }
        }
        )(s);
        (function(a) {
            if (I) {
                var b = a + 4 * I * Uint32Array.BYTES_PER_ELEMENT;
                p(I, a, b + 4 * I * Uint32Array.BYTES_PER_ELEMENT);
                k(I, b)
            }
        }
        )(t);
        (function(a) {
            if (P) {
                var b = a + 4 * P * Uint32Array.BYTES_PER_ELEMENT
                  , c = b + 4 * P * Uint32Array.BYTES_PER_ELEMENT;
                r(P, a, b, c + 4 * P * Uint32Array.BYTES_PER_ELEMENT);
                k(P, c)
            }
        }
        )(v);
        b && n(b, A, A + 3 * b * Uint32Array.BYTES_PER_ELEMENT);
        (function(a) {
            if (z) {
                var b = a + 3 * z * Uint32Array.BYTES_PER_ELEMENT;
                o(z, a, b, b + 3 * z * Uint32Array.BYTES_PER_ELEMENT)
            }
        }
        )(l);
        H && p(H, x, x + 4 * H * Uint32Array.BYTES_PER_ELEMENT);
        (function(a) {
            if (L) {
                var b = a + 4 * L * Uint32Array.BYTES_PER_ELEMENT;
                r(L, a, b, b + 4 * L * Uint32Array.BYTES_PER_ELEMENT)
            }
        }
        )(q);
        this.computeCentroids();
        this.computeFaceNormals();
        THREE.Loader.prototype.hasNormals(this) && this.computeTangents()
    };
    e.prototype = new THREE.Geometry;
    e.prototype.constructor = e;
    b(new e(c))
}
;
THREE.JSONLoader = function(a) {
    THREE.Loader.call(this, a)
}
;
THREE.JSONLoader.prototype = new THREE.Loader;
THREE.JSONLoader.prototype.constructor = THREE.JSONLoader;
THREE.JSONLoader.prototype.load = function(a, b, c) {
    c = c ? c : this.extractUrlBase(a);
    this.onLoadStart();
    this.loadAjaxJSON(this, a, b, c)
}
;
THREE.JSONLoader.prototype.loadAjaxJSON = function(a, b, c, d, e) {
    var f = new XMLHttpRequest
      , g = 0;
    f.onreadystatechange = function() {
        if (f.readyState === f.DONE)
            if (200 === f.status || 0 === f.status) {
                if (f.responseText) {
                    var h = JSON.parse(f.responseText);
                    a.createModel(h, c, d)
                } else
                    console.warn("THREE.JSONLoader: [" + b + "] seems to be unreachable or file there is empty");
                a.onLoadComplete()
            } else
                console.error("THREE.JSONLoader: Couldn't load [" + b + "] [" + f.status + "]");
        else
            f.readyState === f.LOADING ? e && (0 === g && (g = f.getResponseHeader("Content-Length")),
            e({
                total: g,
                loaded: f.responseText.length
            })) : f.readyState === f.HEADERS_RECEIVED && (g = f.getResponseHeader("Content-Length"))
    }
    ;
    f.open("GET", b, !0);
    f.overrideMimeType && f.overrideMimeType("text/plain; charset=x-user-defined");
    f.setRequestHeader("Content-Type", "text/plain");
    f.send(null)
}
;
THREE.JSONLoader.prototype.createModel = function(a, b, c) {
    var d = new THREE.Geometry
      , e = void 0 !== a.scale ? 1 / a.scale : 1;
    this.initMaterials(d, a.materials, c);
    (function(b) {
        var c, e, i, j, k, n, p, o, r, q, s, t, v, x, u = a.faces;
        n = a.vertices;
        var y = a.normals
          , E = a.colors
          , z = 0;
        for (c = 0; c < a.uvs.length; c++)
            a.uvs[c].length && z++;
        for (c = 0; c < z; c++)
            d.faceUvs[c] = [],
            d.faceVertexUvs[c] = [];
        j = 0;
        for (k = n.length; j < k; )
            p = new THREE.Vector3,
            p.x = n[j++] * b,
            p.y = n[j++] * b,
            p.z = n[j++] * b,
            d.vertices.push(p);
        j = 0;
        for (k = u.length; j < k; ) {
            b = u[j++];
            n = b & 1;
            i = b & 2;
            c = b & 4;
            e = b & 8;
            o = b & 16;
            p = b & 32;
            q = b & 64;
            b &= 128;
            n ? (s = new THREE.Face4,
            s.a = u[j++],
            s.b = u[j++],
            s.c = u[j++],
            s.d = u[j++],
            n = 4) : (s = new THREE.Face3,
            s.a = u[j++],
            s.b = u[j++],
            s.c = u[j++],
            n = 3);
            i && (i = u[j++],
            s.materialIndex = i);
            i = d.faces.length;
            if (c)
                for (c = 0; c < z; c++)
                    t = a.uvs[c],
                    r = u[j++],
                    x = t[2 * r],
                    r = t[2 * r + 1],
                    d.faceUvs[c][i] = new THREE.UV(x,r);
            if (e)
                for (c = 0; c < z; c++) {
                    t = a.uvs[c];
                    v = [];
                    for (e = 0; e < n; e++)
                        r = u[j++],
                        x = t[2 * r],
                        r = t[2 * r + 1],
                        v[e] = new THREE.UV(x,r);
                    d.faceVertexUvs[c][i] = v
                }
            o && (o = 3 * u[j++],
            e = new THREE.Vector3,
            e.x = y[o++],
            e.y = y[o++],
            e.z = y[o],
            s.normal = e);
            if (p)
                for (c = 0; c < n; c++)
                    o = 3 * u[j++],
                    e = new THREE.Vector3,
                    e.x = y[o++],
                    e.y = y[o++],
                    e.z = y[o],
                    s.vertexNormals.push(e);
            q && (p = u[j++],
            p = new THREE.Color(E[p]),
            s.color = p);
            if (b)
                for (c = 0; c < n; c++)
                    p = u[j++],
                    p = new THREE.Color(E[p]),
                    s.vertexColors.push(p);
            d.faces.push(s)
        }
    }
    )(e);
    (function() {
        var b, c, e, i;
        if (a.skinWeights) {
            b = 0;
            for (c = a.skinWeights.length; b < c; b += 2)
                e = a.skinWeights[b],
                i = a.skinWeights[b + 1],
                d.skinWeights.push(new THREE.Vector4(e,i,0,0))
        }
        if (a.skinIndices) {
            b = 0;
            for (c = a.skinIndices.length; b < c; b += 2)
                e = a.skinIndices[b],
                i = a.skinIndices[b + 1],
                d.skinIndices.push(new THREE.Vector4(e,i,0,0))
        }
        d.bones = a.bones;
        d.animation = a.animation
    }
    )();
    (function(b) {
        if (void 0 !== a.morphTargets) {
            var c, e, i, j, k, n;
            c = 0;
            for (e = a.morphTargets.length; c < e; c++) {
                d.morphTargets[c] = {};
                d.morphTargets[c].name = a.morphTargets[c].name;
                d.morphTargets[c].vertices = [];
                k = d.morphTargets[c].vertices;
                n = a.morphTargets[c].vertices;
                i = 0;
                for (j = n.length; i < j; i += 3) {
                    var p = new THREE.Vector3;
                    p.x = n[i] * b;
                    p.y = n[i + 1] * b;
                    p.z = n[i + 2] * b;
                    k.push(p)
                }
            }
        }
        if (void 0 !== a.morphColors) {
            c = 0;
            for (e = a.morphColors.length; c < e; c++) {
                d.morphColors[c] = {};
                d.morphColors[c].name = a.morphColors[c].name;
                d.morphColors[c].colors = [];
                j = d.morphColors[c].colors;
                k = a.morphColors[c].colors;
                b = 0;
                for (i = k.length; b < i; b += 3)
                    n = new THREE.Color(16755200),
                    n.setRGB(k[b], k[b + 1], k[b + 2]),
                    j.push(n)
            }
        }
    }
    )(e);
    d.computeCentroids();
    d.computeFaceNormals();
    this.hasNormals(d) && d.computeTangents();
    b(d)
}
;
THREE.SceneLoader = function() {
    this.onLoadStart = function() {}
    ;
    this.onLoadProgress = function() {}
    ;
    this.onLoadComplete = function() {}
    ;
    this.callbackSync = function() {}
    ;
    this.callbackProgress = function() {}
}
;
THREE.SceneLoader.prototype.constructor = THREE.SceneLoader;
THREE.SceneLoader.prototype.load = function(a, b) {
    var c = this
      , d = new XMLHttpRequest;
    d.onreadystatechange = function() {
        if (4 == d.readyState)
            if (200 == d.status || 0 == d.status) {
                var e = JSON.parse(d.responseText);
                c.createScene(e, b, a)
            } else
                console.error("THREE.SceneLoader: Couldn't load [" + a + "] [" + d.status + "]")
    }
    ;
    d.open("GET", a, !0);
    d.overrideMimeType && d.overrideMimeType("text/plain; charset=x-user-defined");
    d.setRequestHeader("Content-Type", "text/plain");
    d.send(null)
}
;
THREE.SceneLoader.prototype.createScene = function(a, b, c) {
    function d(a, b) {
        return "relativeToHTML" == b ? a : j + "/" + a
    }
    function e() {
        var a;
        for (p in A.objects)
            if (!B.objects[p])
                if (t = A.objects[p],
                void 0 !== t.geometry) {
                    if (L = B.geometries[t.geometry])
                        I = B.materials[t.materials[0]],
                        I instanceof THREE.ShaderMaterial && L.computeTangents(),
                        y = t.position,
                        E = t.rotation,
                        z = t.quaternion,
                        C = t.scale,
                        v = t.matrix,
                        z = 0,
                        0 == t.materials.length && (I = new THREE.MeshFaceMaterial),
                        1 < t.materials.length && (I = new THREE.MeshFaceMaterial),
                        a = new THREE.Mesh(L,I),
                        a.name = p,
                        v ? (a.matrixAutoUpdate = !1,
                        a.matrix.set(v[0], v[1], v[2], v[3], v[4], v[5], v[6], v[7], v[8], v[9], v[10], v[11], v[12], v[13], v[14], v[15])) : (a.position.set(y[0], y[1], y[2]),
                        z ? (a.quaternion.set(z[0], z[1], z[2], z[3]),
                        a.useQuaternion = !0) : a.rotation.set(E[0], E[1], E[2]),
                        a.scale.set(C[0], C[1], C[2])),
                        a.visible = t.visible,
                        a.doubleSided = t.doubleSided,
                        a.castShadow = t.castShadow,
                        a.receiveShadow = t.receiveShadow,
                        B.scene.add(a),
                        B.objects[p] = a
                } else
                    y = t.position,
                    E = t.rotation,
                    z = t.quaternion,
                    C = t.scale,
                    z = 0,
                    a = new THREE.Object3D,
                    a.name = p,
                    a.position.set(y[0], y[1], y[2]),
                    z ? (a.quaternion.set(z[0], z[1], z[2], z[3]),
                    a.useQuaternion = !0) : a.rotation.set(E[0], E[1], E[2]),
                    a.scale.set(C[0], C[1], C[2]),
                    a.visible = void 0 !== t.visible ? t.visible : !1,
                    B.scene.add(a),
                    B.objects[p] = a,
                    B.empties[p] = a
    }
    function f(a) {
        return function(b) {
            B.geometries[a] = b;
            e();
            F -= 1;
            i.onLoadComplete();
            h()
        }
    }
    function g(a) {
        return function(b) {
            B.geometries[a] = b
        }
    }
    function h() {
        i.callbackProgress({
            totalModels: Q,
            totalTextures: D,
            loadedModels: Q - F,
            loadedTextures: D - l
        }, B);
        i.onLoadProgress();
        0 == F && 0 == l && b(B)
    }
    var i = this, j = THREE.Loader.prototype.extractUrlBase(c), k, n, p, o, r, q, s, t, v, x, u, y, E, z, C, w, H, L, I, P, N, A, J, F, l, Q, D, B;
    A = a;
    c = new THREE.BinaryLoader;
    J = new THREE.JSONLoader;
    l = F = 0;
    B = {
        scene: new THREE.Scene,
        geometries: {},
        materials: {},
        textures: {},
        objects: {},
        cameras: {},
        lights: {},
        fogs: {},
        empties: {}
    };
    if (A.transform && (a = A.transform.position,
    x = A.transform.rotation,
    w = A.transform.scale,
    a && B.scene.position.set(a[0], a[1], a[2]),
    x && B.scene.rotation.set(x[0], x[1], x[2]),
    w && B.scene.scale.set(w[0], w[1], w[2]),
    a || x || w))
        B.scene.updateMatrix(),
        B.scene.updateMatrixWorld();
    a = function() {
        l -= 1;
        h();
        i.onLoadComplete()
    }
    ;
    for (r in A.cameras)
        w = A.cameras[r],
        "perspective" == w.type ? P = new THREE.PerspectiveCamera(w.fov,w.aspect,w.near,w.far) : "ortho" == w.type && (P = new THREE.OrthographicCamera(w.left,w.right,w.top,w.bottom,w.near,w.far)),
        y = w.position,
        x = w.target,
        w = w.up,
        P.position.set(y[0], y[1], y[2]),
        P.target = new THREE.Vector3(x[0],x[1],x[2]),
        w && P.up.set(w[0], w[1], w[2]),
        B.cameras[r] = P;
    for (o in A.lights)
        x = A.lights[o],
        r = void 0 !== x.color ? x.color : 16777215,
        P = void 0 !== x.intensity ? x.intensity : 1,
        "directional" == x.type ? (y = x.direction,
        u = new THREE.DirectionalLight(r,P),
        u.position.set(y[0], y[1], y[2]),
        u.position.normalize()) : "point" == x.type ? (y = x.position,
        u = x.distance,
        u = new THREE.PointLight(r,P,u),
        u.position.set(y[0], y[1], y[2])) : "ambient" == x.type && (u = new THREE.AmbientLight(r)),
        B.scene.add(u),
        B.lights[o] = u;
    for (q in A.fogs)
        o = A.fogs[q],
        "linear" == o.type ? N = new THREE.Fog(0,o.near,o.far) : "exp2" == o.type && (N = new THREE.FogExp2(0,o.density)),
        w = o.color,
        N.color.setRGB(w[0], w[1], w[2]),
        B.fogs[q] = N;
    B.cameras && A.defaults.camera && (B.currentCamera = B.cameras[A.defaults.camera]);
    B.fogs && A.defaults.fog && (B.scene.fog = B.fogs[A.defaults.fog]);
    w = A.defaults.bgcolor;
    B.bgColor = new THREE.Color;
    B.bgColor.setRGB(w[0], w[1], w[2]);
    B.bgColorAlpha = A.defaults.bgalpha;
    for (k in A.geometries)
        if (q = A.geometries[k],
        "bin_mesh" == q.type || "ascii_mesh" == q.type)
            F += 1,
            i.onLoadStart();
    Q = F;
    for (k in A.geometries)
        q = A.geometries[k],
        "cube" == q.type ? (L = new THREE.CubeGeometry(q.width,q.height,q.depth,q.segmentsWidth,q.segmentsHeight,q.segmentsDepth,null,q.flipped,q.sides),
        B.geometries[k] = L) : "plane" == q.type ? (L = new THREE.PlaneGeometry(q.width,q.height,q.segmentsWidth,q.segmentsHeight),
        B.geometries[k] = L) : "sphere" == q.type ? (L = new THREE.SphereGeometry(q.radius,q.segmentsWidth,q.segmentsHeight),
        B.geometries[k] = L) : "cylinder" == q.type ? (L = new THREE.CylinderGeometry(q.topRad,q.botRad,q.height,q.radSegs,q.heightSegs),
        B.geometries[k] = L) : "torus" == q.type ? (L = new THREE.TorusGeometry(q.radius,q.tube,q.segmentsR,q.segmentsT),
        B.geometries[k] = L) : "icosahedron" == q.type ? (L = new THREE.IcosahedronGeometry(q.radius,q.subdivisions),
        B.geometries[k] = L) : "bin_mesh" == q.type ? c.load(d(q.url, A.urlBaseType), f(k)) : "ascii_mesh" == q.type ? J.load(d(q.url, A.urlBaseType), f(k)) : "embedded_mesh" == q.type && (q = A.embeds[q.id],
        q.metadata = A.metadata,
        q && J.createModel(q, g(k), ""));
    for (s in A.textures)
        if (k = A.textures[s],
        k.url instanceof Array) {
            l += k.url.length;
            for (q = 0; q < k.url.length; q++)
                i.onLoadStart()
        } else
            l += 1,
            i.onLoadStart();
    D = l;
    for (s in A.textures) {
        k = A.textures[s];
        void 0 != k.mapping && void 0 != THREE[k.mapping] && (k.mapping = new THREE[k.mapping]);
        if (k.url instanceof Array) {
            q = [];
            for (N = 0; N < k.url.length; N++)
                q[N] = d(k.url[N], A.urlBaseType);
            q = THREE.ImageUtils.loadTextureCube(q, k.mapping, a)
        } else {
            q = THREE.ImageUtils.loadTexture(d(k.url, A.urlBaseType), k.mapping, a);
            void 0 != THREE[k.minFilter] && (q.minFilter = THREE[k.minFilter]);
            void 0 != THREE[k.magFilter] && (q.magFilter = THREE[k.magFilter]);
            if (k.repeat && (q.repeat.set(k.repeat[0], k.repeat[1]),
            1 != k.repeat[0] && (q.wrapS = THREE.RepeatWrapping),
            1 != k.repeat[1]))
                q.wrapT = THREE.RepeatWrapping;
            k.offset && q.offset.set(k.offset[0], k.offset[1]);
            if (k.wrap && (N = {
                repeat: THREE.RepeatWrapping,
                mirror: THREE.MirroredRepeatWrapping
            },
            void 0 !== N[k.wrap[0]] && (q.wrapS = N[k.wrap[0]]),
            void 0 !== N[k.wrap[1]]))
                q.wrapT = N[k.wrap[1]]
        }
        B.textures[s] = q
    }
    for (n in A.materials) {
        v = A.materials[n];
        for (H in v.parameters)
            "envMap" == H || "map" == H || "lightMap" == H ? v.parameters[H] = B.textures[v.parameters[H]] : "shading" == H ? v.parameters[H] = "flat" == v.parameters[H] ? THREE.FlatShading : THREE.SmoothShading : "blending" == H ? v.parameters[H] = THREE[v.parameters[H]] ? THREE[v.parameters[H]] : THREE.NormalBlending : "combine" == H ? v.parameters[H] = "MixOperation" == v.parameters[H] ? THREE.MixOperation : THREE.MultiplyOperation : "vertexColors" == H && ("face" == v.parameters[H] ? v.parameters[H] = THREE.FaceColors : v.parameters[H] && (v.parameters[H] = THREE.VertexColors));
        void 0 !== v.parameters.opacity && 1 > v.parameters.opacity && (v.parameters.transparent = !0);
        v.parameters.normalMap ? (s = THREE.ShaderUtils.lib.normal,
        a = THREE.UniformsUtils.clone(s.uniforms),
        k = v.parameters.color,
        q = v.parameters.specular,
        N = v.parameters.ambient,
        c = v.parameters.shininess,
        a.tNormal.texture = B.textures[v.parameters.normalMap],
        v.parameters.normalMapFactor && (a.uNormalScale.value = v.parameters.normalMapFactor),
        v.parameters.map && (a.tDiffuse.texture = v.parameters.map,
        a.enableDiffuse.value = !0),
        v.parameters.lightMap && (a.tAO.texture = v.parameters.lightMap,
        a.enableAO.value = !0),
        v.parameters.specularMap && (a.tSpecular.texture = B.textures[v.parameters.specularMap],
        a.enableSpecular.value = !0),
        a.uDiffuseColor.value.setHex(k),
        a.uSpecularColor.value.setHex(q),
        a.uAmbientColor.value.setHex(N),
        a.uShininess.value = c,
        v.parameters.opacity && (a.uOpacity.value = v.parameters.opacity),
        I = new THREE.ShaderMaterial({
            fragmentShader: s.fragmentShader,
            vertexShader: s.vertexShader,
            uniforms: a,
            lights: !0,
            fog: !0
        })) : I = new THREE[v.type](v.parameters);
        B.materials[n] = I
    }
    e();
    i.callbackSync(B);
    h()
}
;
THREE.Material = function(a) {
    a = a || {};
    this.id = THREE.MaterialCount++;
    this.name = "";
    this.opacity = void 0 !== a.opacity ? a.opacity : 1;
    this.transparent = void 0 !== a.transparent ? a.transparent : !1;
    this.blending = void 0 !== a.blending ? a.blending : THREE.NormalBlending;
    this.blendSrc = void 0 !== a.blendSrc ? a.blendSrc : THREE.SrcAlphaFactor;
    this.blendDst = void 0 !== a.blendDst ? a.blendDst : THREE.OneMinusSrcAlphaFactor;
    this.blendEquation = void 0 !== a.blendEquation ? a.blendEquation : THREE.AddEquation;
    this.depthTest = void 0 !== a.depthTest ? a.depthTest : !0;
    this.depthWrite = void 0 !== a.depthWrite ? a.depthWrite : !0;
    this.polygonOffset = void 0 !== a.polygonOffset ? a.polygonOffset : !1;
    this.polygonOffsetFactor = void 0 !== a.polygonOffsetFactor ? a.polygonOffsetFactor : 0;
    this.polygonOffsetUnits = void 0 !== a.polygonOffsetUnits ? a.polygonOffsetUnits : 0;
    this.alphaTest = void 0 !== a.alphaTest ? a.alphaTest : 0;
    this.overdraw = void 0 !== a.overdraw ? a.overdraw : !1;
    this.needsUpdate = this.visible = !0
}
;
THREE.MaterialCount = 0;
THREE.NoShading = 0;
THREE.FlatShading = 1;
THREE.SmoothShading = 2;
THREE.NoColors = 0;
THREE.FaceColors = 1;
THREE.VertexColors = 2;
THREE.NoBlending = 0;
THREE.NormalBlending = 1;
THREE.AdditiveBlending = 2;
THREE.SubtractiveBlending = 3;
THREE.MultiplyBlending = 4;
THREE.AdditiveAlphaBlending = 5;
THREE.CustomBlending = 6;
THREE.AddEquation = 100;
THREE.SubtractEquation = 101;
THREE.ReverseSubtractEquation = 102;
THREE.ZeroFactor = 200;
THREE.OneFactor = 201;
THREE.SrcColorFactor = 202;
THREE.OneMinusSrcColorFactor = 203;
THREE.SrcAlphaFactor = 204;
THREE.OneMinusSrcAlphaFactor = 205;
THREE.DstAlphaFactor = 206;
THREE.OneMinusDstAlphaFactor = 207;
THREE.DstColorFactor = 208;
THREE.OneMinusDstColorFactor = 209;
THREE.SrcAlphaSaturateFactor = 210;
THREE.LineBasicMaterial = function(a) {
    THREE.Material.call(this, a);
    a = a || {};
    this.color = void 0 !== a.color ? new THREE.Color(a.color) : new THREE.Color(16777215);
    this.linewidth = void 0 !== a.linewidth ? a.linewidth : 1;
    this.linecap = void 0 !== a.linecap ? a.linecap : "round";
    this.linejoin = void 0 !== a.linejoin ? a.linejoin : "round";
    this.vertexColors = a.vertexColors ? a.vertexColors : !1;
    this.fog = void 0 !== a.fog ? a.fog : !0
}
;
THREE.LineBasicMaterial.prototype = new THREE.Material;
THREE.LineBasicMaterial.prototype.constructor = THREE.LineBasicMaterial;
THREE.MeshBasicMaterial = function(a) {
    THREE.Material.call(this, a);
    a = a || {};
    this.color = void 0 !== a.color ? new THREE.Color(a.color) : new THREE.Color(16777215);
    this.map = void 0 !== a.map ? a.map : null;
    this.lightMap = void 0 !== a.lightMap ? a.lightMap : null;
    this.envMap = void 0 !== a.envMap ? a.envMap : null;
    this.combine = void 0 !== a.combine ? a.combine : THREE.MultiplyOperation;
    this.reflectivity = void 0 !== a.reflectivity ? a.reflectivity : 1;
    this.refractionRatio = void 0 !== a.refractionRatio ? a.refractionRatio : 0.98;
    this.fog = void 0 !== a.fog ? a.fog : !0;
    this.shading = void 0 !== a.shading ? a.shading : THREE.SmoothShading;
    this.wireframe = void 0 !== a.wireframe ? a.wireframe : !1;
    this.wireframeLinewidth = void 0 !== a.wireframeLinewidth ? a.wireframeLinewidth : 1;
    this.wireframeLinecap = void 0 !== a.wireframeLinecap ? a.wireframeLinecap : "round";
    this.wireframeLinejoin = void 0 !== a.wireframeLinejoin ? a.wireframeLinejoin : "round";
    this.vertexColors = void 0 !== a.vertexColors ? a.vertexColors : THREE.NoColors;
    this.skinning = void 0 !== a.skinning ? a.skinning : !1;
    this.morphTargets = void 0 !== a.morphTargets ? a.morphTargets : !1
}
;
THREE.MeshBasicMaterial.prototype = new THREE.Material;
THREE.MeshBasicMaterial.prototype.constructor = THREE.MeshBasicMaterial;
THREE.MeshLambertMaterial = function(a) {
    THREE.Material.call(this, a);
    a = a || {};
    this.color = void 0 !== a.color ? new THREE.Color(a.color) : new THREE.Color(16777215);
    this.ambient = void 0 !== a.ambient ? new THREE.Color(a.ambient) : new THREE.Color(16777215);
    this.emissive = void 0 !== a.emissive ? new THREE.Color(a.emissive) : new THREE.Color(0);
    this.wrapAround = void 0 !== a.wrapAround ? a.wrapAround : !1;
    this.wrapRGB = new THREE.Vector3(1,1,1);
    this.map = void 0 !== a.map ? a.map : null;
    this.lightMap = void 0 !== a.lightMap ? a.lightMap : null;
    this.envMap = void 0 !== a.envMap ? a.envMap : null;
    this.combine = void 0 !== a.combine ? a.combine : THREE.MultiplyOperation;
    this.reflectivity = void 0 !== a.reflectivity ? a.reflectivity : 1;
    this.refractionRatio = void 0 !== a.refractionRatio ? a.refractionRatio : 0.98;
    this.fog = void 0 !== a.fog ? a.fog : !0;
    this.shading = void 0 !== a.shading ? a.shading : THREE.SmoothShading;
    this.wireframe = void 0 !== a.wireframe ? a.wireframe : !1;
    this.wireframeLinewidth = void 0 !== a.wireframeLinewidth ? a.wireframeLinewidth : 1;
    this.wireframeLinecap = void 0 !== a.wireframeLinecap ? a.wireframeLinecap : "round";
    this.wireframeLinejoin = void 0 !== a.wireframeLinejoin ? a.wireframeLinejoin : "round";
    this.vertexColors = void 0 !== a.vertexColors ? a.vertexColors : THREE.NoColors;
    this.skinning = void 0 !== a.skinning ? a.skinning : !1;
    this.morphTargets = void 0 !== a.morphTargets ? a.morphTargets : !1;
    this.morphNormals = void 0 !== a.morphNormals ? a.morphNormals : !1
}
;
THREE.MeshLambertMaterial.prototype = new THREE.Material;
THREE.MeshLambertMaterial.prototype.constructor = THREE.MeshLambertMaterial;
THREE.MeshPhongMaterial = function(a) {
    THREE.Material.call(this, a);
    a = a || {};
    this.color = void 0 !== a.color ? new THREE.Color(a.color) : new THREE.Color(16777215);
    this.ambient = void 0 !== a.ambient ? new THREE.Color(a.ambient) : new THREE.Color(16777215);
    this.emissive = void 0 !== a.emissive ? new THREE.Color(a.emissive) : new THREE.Color(0);
    this.specular = void 0 !== a.specular ? new THREE.Color(a.specular) : new THREE.Color(1118481);
    this.shininess = void 0 !== a.shininess ? a.shininess : 30;
    this.metal = void 0 !== a.metal ? a.metal : !1;
    this.perPixel = void 0 !== a.perPixel ? a.perPixel : !1;
    this.wrapAround = void 0 !== a.wrapAround ? a.wrapAround : !1;
    this.wrapRGB = new THREE.Vector3(1,1,1);
    this.map = void 0 !== a.map ? a.map : null;
    this.lightMap = void 0 !== a.lightMap ? a.lightMap : null;
    this.envMap = void 0 !== a.envMap ? a.envMap : null;
    this.combine = void 0 !== a.combine ? a.combine : THREE.MultiplyOperation;
    this.reflectivity = void 0 !== a.reflectivity ? a.reflectivity : 1;
    this.refractionRatio = void 0 !== a.refractionRatio ? a.refractionRatio : 0.98;
    this.fog = void 0 !== a.fog ? a.fog : !0;
    this.shading = void 0 !== a.shading ? a.shading : THREE.SmoothShading;
    this.wireframe = void 0 !== a.wireframe ? a.wireframe : !1;
    this.wireframeLinewidth = void 0 !== a.wireframeLinewidth ? a.wireframeLinewidth : 1;
    this.wireframeLinecap = void 0 !== a.wireframeLinecap ? a.wireframeLinecap : "round";
    this.wireframeLinejoin = void 0 !== a.wireframeLinejoin ? a.wireframeLinejoin : "round";
    this.vertexColors = void 0 !== a.vertexColors ? a.vertexColors : THREE.NoColors;
    this.skinning = void 0 !== a.skinning ? a.skinning : !1;
    this.morphTargets = void 0 !== a.morphTargets ? a.morphTargets : !1;
    this.morphNormals = void 0 !== a.morphNormals ? a.morphNormals : !1
}
;
THREE.MeshPhongMaterial.prototype = new THREE.Material;
THREE.MeshPhongMaterial.prototype.constructor = THREE.MeshPhongMaterial;
THREE.MeshDepthMaterial = function(a) {
    THREE.Material.call(this, a);
    a = a || {};
    this.shading = void 0 !== a.shading ? a.shading : THREE.SmoothShading;
    this.wireframe = void 0 !== a.wireframe ? a.wireframe : !1;
    this.wireframeLinewidth = void 0 !== a.wireframeLinewidth ? a.wireframeLinewidth : 1
}
;
THREE.MeshDepthMaterial.prototype = new THREE.Material;
THREE.MeshDepthMaterial.prototype.constructor = THREE.MeshDepthMaterial;
THREE.MeshNormalMaterial = function(a) {
    THREE.Material.call(this, a);
    a = a || {};
    this.shading = a.shading ? a.shading : THREE.FlatShading;
    this.wireframe = a.wireframe ? a.wireframe : !1;
    this.wireframeLinewidth = a.wireframeLinewidth ? a.wireframeLinewidth : 1
}
;
THREE.MeshNormalMaterial.prototype = new THREE.Material;
THREE.MeshNormalMaterial.prototype.constructor = THREE.MeshNormalMaterial;
THREE.MeshFaceMaterial = function() {}
;
THREE.ParticleBasicMaterial = function(a) {
    THREE.Material.call(this, a);
    a = a || {};
    this.color = void 0 !== a.color ? new THREE.Color(a.color) : new THREE.Color(16777215);
    this.map = void 0 !== a.map ? a.map : null;
    this.size = void 0 !== a.size ? a.size : 1;
    this.sizeAttenuation = void 0 !== a.sizeAttenuation ? a.sizeAttenuation : !0;
    this.vertexColors = void 0 !== a.vertexColors ? a.vertexColors : !1;
    this.fog = void 0 !== a.fog ? a.fog : !0
}
;
THREE.ParticleBasicMaterial.prototype = new THREE.Material;
THREE.ParticleBasicMaterial.prototype.constructor = THREE.ParticleBasicMaterial;
THREE.ParticleCanvasMaterial = function(a) {
    THREE.Material.call(this, a);
    a = a || {};
    this.color = void 0 !== a.color ? new THREE.Color(a.color) : new THREE.Color(16777215);
    this.program = void 0 !== a.program ? a.program : function() {}
}
;
THREE.ParticleCanvasMaterial.prototype = new THREE.Material;
THREE.ParticleCanvasMaterial.prototype.constructor = THREE.ParticleCanvasMaterial;
THREE.ParticleDOMMaterial = function(a) {
    THREE.Material.call(this);
    this.domElement = a
}
;
THREE.ShaderMaterial = function(a) {
    THREE.Material.call(this, a);
    a = a || {};
    this.fragmentShader = void 0 !== a.fragmentShader ? a.fragmentShader : "void main() {}";
    this.vertexShader = void 0 !== a.vertexShader ? a.vertexShader : "void main() {}";
    this.uniforms = void 0 !== a.uniforms ? a.uniforms : {};
    this.attributes = a.attributes;
    this.shading = void 0 !== a.shading ? a.shading : THREE.SmoothShading;
    this.wireframe = void 0 !== a.wireframe ? a.wireframe : !1;
    this.wireframeLinewidth = void 0 !== a.wireframeLinewidth ? a.wireframeLinewidth : 1;
    this.fog = void 0 !== a.fog ? a.fog : !1;
    this.lights = void 0 !== a.lights ? a.lights : !1;
    this.vertexColors = void 0 !== a.vertexColors ? a.vertexColors : THREE.NoColors;
    this.skinning = void 0 !== a.skinning ? a.skinning : !1;
    this.morphTargets = void 0 !== a.morphTargets ? a.morphTargets : !1;
    this.morphNormals = void 0 !== a.morphNormals ? a.morphNormals : !1
}
;
THREE.ShaderMaterial.prototype = new THREE.Material;
THREE.ShaderMaterial.prototype.constructor = THREE.ShaderMaterial;
THREE.Texture = function(a, b, c, d, e, f, g, h) {
    this.id = THREE.TextureCount++;
    this.image = a;
    this.mapping = void 0 !== b ? b : new THREE.UVMapping;
    this.wrapS = void 0 !== c ? c : THREE.ClampToEdgeWrapping;
    this.wrapT = void 0 !== d ? d : THREE.ClampToEdgeWrapping;
    this.magFilter = void 0 !== e ? e : THREE.LinearFilter;
    this.minFilter = void 0 !== f ? f : THREE.LinearMipMapLinearFilter;
    this.format = void 0 !== g ? g : THREE.RGBAFormat;
    this.type = void 0 !== h ? h : THREE.UnsignedByteType;
    this.offset = new THREE.Vector2(0,0);
    this.repeat = new THREE.Vector2(1,1);
    this.generateMipmaps = !0;
    this.needsUpdate = this.premultiplyAlpha = !1;
    this.onUpdate = null
}
;
THREE.Texture.prototype = {
    constructor: THREE.Texture,
    clone: function() {
        var a = new THREE.Texture(this.image,this.mapping,this.wrapS,this.wrapT,this.magFilter,this.minFilter,this.format,this.type);
        a.offset.copy(this.offset);
        a.repeat.copy(this.repeat);
        return a
    }
};
THREE.TextureCount = 0;
THREE.MultiplyOperation = 0;
THREE.MixOperation = 1;
THREE.UVMapping = function() {}
;
THREE.CubeReflectionMapping = function() {}
;
THREE.CubeRefractionMapping = function() {}
;
THREE.SphericalReflectionMapping = function() {}
;
THREE.SphericalRefractionMapping = function() {}
;
THREE.RepeatWrapping = 0;
THREE.ClampToEdgeWrapping = 1;
THREE.MirroredRepeatWrapping = 2;
THREE.NearestFilter = 3;
THREE.NearestMipMapNearestFilter = 4;
THREE.NearestMipMapLinearFilter = 5;
THREE.LinearFilter = 6;
THREE.LinearMipMapNearestFilter = 7;
THREE.LinearMipMapLinearFilter = 8;
THREE.ByteType = 9;
THREE.UnsignedByteType = 10;
THREE.ShortType = 11;
THREE.UnsignedShortType = 12;
THREE.IntType = 13;
THREE.UnsignedIntType = 14;
THREE.FloatType = 15;
THREE.AlphaFormat = 16;
THREE.RGBFormat = 17;
THREE.RGBAFormat = 18;
THREE.LuminanceFormat = 19;
THREE.LuminanceAlphaFormat = 20;
THREE.DataTexture = function(a, b, c, d, e, f, g, h, i, j) {
    THREE.Texture.call(this, null, f, g, h, i, j, d, e);
    this.image = {
        data: a,
        width: b,
        height: c
    }
}
;
THREE.DataTexture.prototype = new THREE.Texture;
THREE.DataTexture.prototype.constructor = THREE.DataTexture;
THREE.DataTexture.prototype.clone = function() {
    var a = new THREE.DataTexture(this.image.data,this.image.width,this.image.height,this.format,this.type,this.mapping,this.wrapS,this.wrapT,this.magFilter,this.minFilter);
    a.offset.copy(this.offset);
    a.repeat.copy(this.repeat);
    return a
}
;
THREE.Particle = function(a) {
    THREE.Object3D.call(this);
    this.material = a
}
;
THREE.Particle.prototype = new THREE.Object3D;
THREE.Particle.prototype.constructor = THREE.Particle;
THREE.ParticleSystem = function(a, b) {
    THREE.Object3D.call(this);
    this.geometry = a;
    this.material = void 0 !== b ? b : new THREE.ParticleBasicMaterial({
        color: 16777215 * Math.random()
    });
    this.sortParticles = !1;
    this.geometry && (this.geometry.boundingSphere || this.geometry.computeBoundingSphere(),
    this.boundRadius = a.boundingSphere.radius);
    this.frustumCulled = !1
}
;
THREE.ParticleSystem.prototype = new THREE.Object3D;
THREE.ParticleSystem.prototype.constructor = THREE.ParticleSystem;
THREE.Line = function(a, b, c) {
    THREE.Object3D.call(this);
    this.geometry = a;
    this.material = void 0 !== b ? b : new THREE.LineBasicMaterial({
        color: 16777215 * Math.random()
    });
    this.type = void 0 !== c ? c : THREE.LineStrip;
    this.geometry && (this.geometry.boundingSphere || this.geometry.computeBoundingSphere())
}
;
THREE.LineStrip = 0;
THREE.LinePieces = 1;
THREE.Line.prototype = new THREE.Object3D;
THREE.Line.prototype.constructor = THREE.Line;
THREE.Mesh = function(a, b) {
    THREE.Object3D.call(this);
    this.geometry = a;
    this.material = void 0 !== b ? b : new THREE.MeshBasicMaterial({
        color: 16777215 * Math.random(),
        wireframe: !0
    });
    if (this.geometry && (this.geometry.boundingSphere || this.geometry.computeBoundingSphere(),
    this.boundRadius = a.boundingSphere.radius,
    this.geometry.morphTargets.length)) {
        this.morphTargetBase = -1;
        this.morphTargetForcedOrder = [];
        this.morphTargetInfluences = [];
        this.morphTargetDictionary = {};
        for (var c = 0; c < this.geometry.morphTargets.length; c++)
            this.morphTargetInfluences.push(0),
            this.morphTargetDictionary[this.geometry.morphTargets[c].name] = c
    }
}
;
THREE.Mesh.prototype = new THREE.Object3D;
THREE.Mesh.prototype.constructor = THREE.Mesh;
THREE.Mesh.prototype.supr = THREE.Object3D.prototype;
THREE.Mesh.prototype.getMorphTargetIndexByName = function(a) {
    if (void 0 !== this.morphTargetDictionary[a])
        return this.morphTargetDictionary[a];
    console.log("THREE.Mesh.getMorphTargetIndexByName: morph target " + a + " does not exist. Returning 0.");
    return 0
}
;
THREE.Bone = function(a) {
    THREE.Object3D.call(this);
    this.skin = a;
    this.skinMatrix = new THREE.Matrix4
}
;
THREE.Bone.prototype = new THREE.Object3D;
THREE.Bone.prototype.constructor = THREE.Bone;
THREE.Bone.prototype.supr = THREE.Object3D.prototype;
THREE.Bone.prototype.update = function(a, b) {
    this.matrixAutoUpdate && (b |= this.updateMatrix());
    if (b || this.matrixWorldNeedsUpdate)
        a ? this.skinMatrix.multiply(a, this.matrix) : this.skinMatrix.copy(this.matrix),
        this.matrixWorldNeedsUpdate = !1,
        b = !0;
    var c, d = this.children.length;
    for (c = 0; c < d; c++)
        this.children[c].update(this.skinMatrix, b)
}
;
THREE.SkinnedMesh = function(a, b) {
    THREE.Mesh.call(this, a, b);
    this.identityMatrix = new THREE.Matrix4;
    this.bones = [];
    this.boneMatrices = [];
    var c, d, e, f, g, h;
    if (void 0 !== this.geometry.bones) {
        for (c = 0; c < this.geometry.bones.length; c++)
            e = this.geometry.bones[c],
            f = e.pos,
            g = e.rotq,
            h = e.scl,
            d = this.addBone(),
            d.name = e.name,
            d.position.set(f[0], f[1], f[2]),
            d.quaternion.set(g[0], g[1], g[2], g[3]),
            d.useQuaternion = !0,
            void 0 !== h ? d.scale.set(h[0], h[1], h[2]) : d.scale.set(1, 1, 1);
        for (c = 0; c < this.bones.length; c++)
            e = this.geometry.bones[c],
            d = this.bones[c],
            -1 === e.parent ? this.add(d) : this.bones[e.parent].add(d);
        this.boneMatrices = new Float32Array(16 * this.bones.length);
        this.pose()
    }
}
;
THREE.SkinnedMesh.prototype = new THREE.Mesh;
THREE.SkinnedMesh.prototype.constructor = THREE.SkinnedMesh;
THREE.SkinnedMesh.prototype.addBone = function(a) {
    void 0 === a && (a = new THREE.Bone(this));
    this.bones.push(a);
    return a
}
;
THREE.SkinnedMesh.prototype.updateMatrixWorld = function(a) {
    this.matrixAutoUpdate && this.updateMatrix();
    if (this.matrixWorldNeedsUpdate || a)
        this.parent ? this.matrixWorld.multiply(this.parent.matrixWorld, this.matrix) : this.matrixWorld.copy(this.matrix),
        this.matrixWorldNeedsUpdate = !1;
    for (var a = 0, b = this.children.length; a < b; a++) {
        var c = this.children[a];
        c instanceof THREE.Bone ? c.update(this.identityMatrix, !1) : c.updateMatrixWorld(!0)
    }
    for (var b = this.bones.length, c = this.bones, d = this.boneMatrices, a = 0; a < b; a++)
        c[a].skinMatrix.flattenToArrayOffset(d, 16 * a)
}
;
THREE.SkinnedMesh.prototype.pose = function() {
    this.updateMatrixWorld(!0);
    for (var a, b = [], c = 0; c < this.bones.length; c++) {
        a = this.bones[c];
        var d = new THREE.Matrix4;
        d.getInverse(a.skinMatrix);
        b.push(d);
        a.skinMatrix.flattenToArrayOffset(this.boneMatrices, 16 * c)
    }
    if (void 0 === this.geometry.skinVerticesA) {
        this.geometry.skinVerticesA = [];
        this.geometry.skinVerticesB = [];
        for (a = 0; a < this.geometry.skinIndices.length; a++) {
            var c = this.geometry.vertices[a]
              , e = this.geometry.skinIndices[a].x
              , f = this.geometry.skinIndices[a].y
              , d = new THREE.Vector3(c.x,c.y,c.z);
            this.geometry.skinVerticesA.push(b[e].multiplyVector3(d));
            d = new THREE.Vector3(c.x,c.y,c.z);
            this.geometry.skinVerticesB.push(b[f].multiplyVector3(d));
            1 !== this.geometry.skinWeights[a].x + this.geometry.skinWeights[a].y && (c = 0.5 * (1 - (this.geometry.skinWeights[a].x + this.geometry.skinWeights[a].y)),
            this.geometry.skinWeights[a].x += c,
            this.geometry.skinWeights[a].y += c)
        }
    }
}
;
THREE.MorphAnimMesh = function(a, b) {
    THREE.Mesh.call(this, a, b);
    this.duration = 1E3;
    this.mirroredLoop = !1;
    this.currentKeyframe = this.lastKeyframe = this.time = 0;
    this.direction = 1;
    this.directionBackwards = !1;
    this.setFrameRange(0, this.geometry.morphTargets.length - 1)
}
;
THREE.MorphAnimMesh.prototype = new THREE.Mesh;
THREE.MorphAnimMesh.prototype.constructor = THREE.MorphAnimMesh;
THREE.MorphAnimMesh.prototype.setFrameRange = function(a, b) {
    this.startKeyframe = a;
    this.endKeyframe = b;
    this.length = this.endKeyframe - this.startKeyframe + 1
}
;
THREE.MorphAnimMesh.prototype.setDirectionForward = function() {
    this.direction = 1;
    this.directionBackwards = !1
}
;
THREE.MorphAnimMesh.prototype.setDirectionBackward = function() {
    this.direction = -1;
    this.directionBackwards = !0
}
;
THREE.MorphAnimMesh.prototype.parseAnimations = function() {
    var a = this.geometry;
    a.animations || (a.animations = {});
    for (var b, c = a.animations, d = /([a-z]+)(\d+)/, e = 0, f = a.morphTargets.length; e < f; e++) {
        var g = a.morphTargets[e].name.match(d);
        if (g && 1 < g.length) {
            g = g[1];
            c[g] || (c[g] = {
                start: Infinity,
                end: -Infinity
            });
            var h = c[g];
            e < h.start && (h.start = e);
            e > h.end && (h.end = e);
            b || (b = g)
        }
    }
    a.firstAnimation = b
}
;
THREE.MorphAnimMesh.prototype.setAnimationLabel = function(a, b, c) {
    this.geometry.animations || (this.geometry.animations = {});
    this.geometry.animations[a] = {
        start: b,
        end: c
    }
}
;
THREE.MorphAnimMesh.prototype.playAnimation = function(a, b) {
    var c = this.geometry.animations[a];
    c ? (this.setFrameRange(c.start, c.end),
    this.duration = 1E3 * ((c.end - c.start) / b),
    this.time = 0) : console.warn("animation[" + a + "] undefined")
}
;
THREE.MorphAnimMesh.prototype.updateAnimation = function(a) {
    var b = this.duration / this.length;
    this.time += this.direction * a;
    if (this.mirroredLoop) {
        if (this.time > this.duration || 0 > this.time)
            if (this.direction *= -1,
            this.time > this.duration && (this.time = this.duration,
            this.directionBackwards = !0),
            0 > this.time)
                this.time = 0,
                this.directionBackwards = !1
    } else
        this.time %= this.duration,
        0 > this.time && (this.time += this.duration);
    a = this.startKeyframe + THREE.Math.clamp(Math.floor(this.time / b), 0, this.length - 1);
    a !== this.currentKeyframe && (this.morphTargetInfluences[this.lastKeyframe] = 0,
    this.morphTargetInfluences[this.currentKeyframe] = 1,
    this.morphTargetInfluences[a] = 0,
    this.lastKeyframe = this.currentKeyframe,
    this.currentKeyframe = a);
    b = this.time % b / b;
    this.directionBackwards && (b = 1 - b);
    this.morphTargetInfluences[this.currentKeyframe] = b;
    this.morphTargetInfluences[this.lastKeyframe] = 1 - b
}
;
THREE.Ribbon = function(a, b) {
    THREE.Object3D.call(this);
    this.geometry = a;
    this.material = b
}
;
THREE.Ribbon.prototype = new THREE.Object3D;
THREE.Ribbon.prototype.constructor = THREE.Ribbon;
THREE.LOD = function() {
    THREE.Object3D.call(this);
    this.LODs = []
}
;
THREE.LOD.prototype = new THREE.Object3D;
THREE.LOD.prototype.constructor = THREE.LOD;
THREE.LOD.prototype.supr = THREE.Object3D.prototype;
THREE.LOD.prototype.addLevel = function(a, b) {
    void 0 === b && (b = 0);
    for (var b = Math.abs(b), c = 0; c < this.LODs.length && !(b < this.LODs[c].visibleAtDistance); c++)
        ;
    this.LODs.splice(c, 0, {
        visibleAtDistance: b,
        object3D: a
    });
    this.add(a)
}
;
THREE.LOD.prototype.update = function(a) {
    if (1 < this.LODs.length) {
        a.matrixWorldInverse.getInverse(a.matrixWorld);
        a = a.matrixWorldInverse;
        a = -(a.elements[2] * this.matrixWorld.elements[12] + a.elements[6] * this.matrixWorld.elements[13] + a.elements[10] * this.matrixWorld.elements[14] + a.elements[14]);
        this.LODs[0].object3D.visible = !0;
        for (var b = 1; b < this.LODs.length; b++)
            if (a >= this.LODs[b].visibleAtDistance)
                this.LODs[b - 1].object3D.visible = !1,
                this.LODs[b].object3D.visible = !0;
            else
                break;
        for (; b < this.LODs.length; b++)
            this.LODs[b].object3D.visible = !1
    }
}
;
THREE.Sprite = function(a) {
    THREE.Object3D.call(this);
    this.color = void 0 !== a.color ? new THREE.Color(a.color) : new THREE.Color(16777215);
    this.map = void 0 !== a.map ? a.map : new THREE.Texture;
    this.blending = void 0 !== a.blending ? a.blending : THREE.NormalBlending;
    this.blendSrc = void 0 !== a.blendSrc ? a.blendSrc : THREE.SrcAlphaFactor;
    this.blendDst = void 0 !== a.blendDst ? a.blendDst : THREE.OneMinusSrcAlphaFactor;
    this.blendEquation = void 0 !== a.blendEquation ? a.blendEquation : THREE.AddEquation;
    this.useScreenCoordinates = void 0 !== a.useScreenCoordinates ? a.useScreenCoordinates : !0;
    this.mergeWith3D = void 0 !== a.mergeWith3D ? a.mergeWith3D : !this.useScreenCoordinates;
    this.affectedByDistance = void 0 !== a.affectedByDistance ? a.affectedByDistance : !this.useScreenCoordinates;
    this.scaleByViewport = void 0 !== a.scaleByViewport ? a.scaleByViewport : !this.affectedByDistance;
    this.alignment = a.alignment instanceof THREE.Vector2 ? a.alignment : THREE.SpriteAlignment.center;
    this.rotation3d = this.rotation;
    this.rotation = 0;
    this.opacity = 1;
    this.uvOffset = new THREE.Vector2(0,0);
    this.uvScale = new THREE.Vector2(1,1)
}
;
THREE.Sprite.prototype = new THREE.Object3D;
THREE.Sprite.prototype.constructor = THREE.Sprite;
THREE.Sprite.prototype.updateMatrix = function() {
    this.matrix.setPosition(this.position);
    this.rotation3d.set(0, 0, this.rotation);
    this.matrix.setRotationFromEuler(this.rotation3d);
    if (1 !== this.scale.x || 1 !== this.scale.y)
        this.matrix.scale(this.scale),
        this.boundRadiusScale = Math.max(this.scale.x, this.scale.y);
    this.matrixWorldNeedsUpdate = !0
}
;
THREE.SpriteAlignment = {};
THREE.SpriteAlignment.topLeft = new THREE.Vector2(1,-1);
THREE.SpriteAlignment.topCenter = new THREE.Vector2(0,-1);
THREE.SpriteAlignment.topRight = new THREE.Vector2(-1,-1);
THREE.SpriteAlignment.centerLeft = new THREE.Vector2(1,0);
THREE.SpriteAlignment.center = new THREE.Vector2(0,0);
THREE.SpriteAlignment.centerRight = new THREE.Vector2(-1,0);
THREE.SpriteAlignment.bottomLeft = new THREE.Vector2(1,1);
THREE.SpriteAlignment.bottomCenter = new THREE.Vector2(0,1);
THREE.SpriteAlignment.bottomRight = new THREE.Vector2(-1,1);
THREE.Scene = function() {
    THREE.Object3D.call(this);
    this.overrideMaterial = this.fog = null;
    this.matrixAutoUpdate = !1;
    this.__objects = [];
    this.__lights = [];
    this.__objectsAdded = [];
    this.__objectsRemoved = []
}
;
THREE.Scene.prototype = new THREE.Object3D;
THREE.Scene.prototype.constructor = THREE.Scene;
THREE.Scene.prototype.__addObject = function(a) {
    if (a instanceof THREE.Light)
        -1 === this.__lights.indexOf(a) && this.__lights.push(a);
    else if (!(a instanceof THREE.Camera || a instanceof THREE.Bone) && -1 === this.__objects.indexOf(a)) {
        this.__objects.push(a);
        this.__objectsAdded.push(a);
        var b = this.__objectsRemoved.indexOf(a);
        -1 !== b && this.__objectsRemoved.splice(b, 1)
    }
    for (b = 0; b < a.children.length; b++)
        this.__addObject(a.children[b])
}
;
THREE.Scene.prototype.__removeObject = function(a) {
    if (a instanceof THREE.Light) {
        var b = this.__lights.indexOf(a);
        -1 !== b && this.__lights.splice(b, 1)
    } else
        a instanceof THREE.Camera || (b = this.__objects.indexOf(a),
        -1 !== b && (this.__objects.splice(b, 1),
        this.__objectsRemoved.push(a),
        b = this.__objectsAdded.indexOf(a),
        -1 !== b && this.__objectsAdded.splice(b, 1)));
    for (b = 0; b < a.children.length; b++)
        this.__removeObject(a.children[b])
}
;
THREE.Fog = function(a, b, c) {
    this.color = new THREE.Color(a);
    this.near = void 0 !== b ? b : 1;
    this.far = void 0 !== c ? c : 1E3
}
;
THREE.FogExp2 = function(a, b) {
    this.color = new THREE.Color(a);
    this.density = void 0 !== b ? b : 2.5E-4
}
;
THREE.DOMRenderer = function() {
    console.log("THREE.DOMRenderer", THREE.REVISION);
    var a, b, c, d, e, f, g, h = new THREE.Projector;
    g = function(a) {
        for (var b = document.documentElement, c = 0; c < a.length; c++)
            if ("string" === typeof b.style[a[c]])
                return a[c];
        return null
    }(["transform", "MozTransform", "WebkitTransform", "msTransform", "OTransform"]);
    this.domElement = document.createElement("div");
    this.setSize = function(a, b) {
        c = a;
        d = b;
        e = c / 2;
        f = d / 2
    }
    ;
    this.render = function(c, d) {
        var k, n, p, o, r, q;
        a = h.projectScene(c, d);
        b = a.elements;
        k = 0;
        for (n = b.length; k < n; k++)
            p = b[k],
            p instanceof THREE.RenderableParticle && p.material instanceof THREE.ParticleDOMMaterial && (o = p.material.domElement,
            r = p.x * e + e - (o.offsetWidth >> 1),
            q = p.y * f + f - (o.offsetHeight >> 1),
            o.style.left = r + "px",
            o.style.top = q + "px",
            o.style.zIndex = Math.abs(Math.floor((1 - p.z) * d.far / d.near)),
            g && (o.style[g] = "scale(" + p.scale.x * e + "," + p.scale.y * f + ")"))
    }
}
;
THREE.CanvasRenderer = function(a) {
    function b(a) {
        v != a && (q.globalAlpha = v = a)
    }
    function c(a) {
        if (x != a) {
            switch (a) {
            case THREE.NormalBlending:
                q.globalCompositeOperation = "source-over";
                break;
            case THREE.AdditiveBlending:
                q.globalCompositeOperation = "lighter"
            }
            x = a
        }
    }
    function d(a) {
        u != a && (q.strokeStyle = u = a)
    }
    function e(a) {
        y != a && (q.fillStyle = y = a)
    }
    console.log("THREE.CanvasRenderer", THREE.REVISION);
    var a = a || {}, f = this, g, h, i, j = new THREE.Projector, k = void 0 !== a.canvas ? a.canvas : document.createElement("canvas"), n, p, o, r, q = k.getContext("2d"), s = new THREE.Color(0), t = 0, v = 1, x = 0, u = null, y = null, E = null, z = null, C = null, w, H, L, I, P = new THREE.RenderableVertex, N = new THREE.RenderableVertex, A, J, F, l, Q, D, B, T, M, ea, ca, ha, U = new THREE.Color, X = new THREE.Color, aa = new THREE.Color, ba = new THREE.Color, m = new THREE.Color, Ha = [], La = [], Ga, Pa, Ua, Qa, Kb, xb, ob, Lb, Ab, Vb, Va = new THREE.Rectangle, ta = new THREE.Rectangle, Ba = new THREE.Rectangle, bb = !1, da = new THREE.Color, Ta = new THREE.Color, Ra = new THREE.Color, ra = new THREE.Vector3, kb, pa, Wb, la, pb, Pb, a = 16;
    kb = document.createElement("canvas");
    kb.width = kb.height = 2;
    pa = kb.getContext("2d");
    pa.fillStyle = "rgba(0,0,0,1)";
    pa.fillRect(0, 0, 2, 2);
    Wb = pa.getImageData(0, 0, 2, 2);
    la = Wb.data;
    pb = document.createElement("canvas");
    pb.width = pb.height = a;
    Pb = pb.getContext("2d");
    Pb.translate(-a / 2, -a / 2);
    Pb.scale(a, a);
    a--;
    this.domElement = k;
    this.sortElements = this.sortObjects = this.autoClear = !0;
    this.info = {
        render: {
            vertices: 0,
            faces: 0
        }
    };
    this.setSize = function(a, b) {
        n = a;
        p = b;
        o = Math.floor(n / 2);
        r = Math.floor(p / 2);
        k.width = n;
        k.height = p;
        Va.set(-o, -r, o, r);
        ta.set(-o, -r, o, r);
        v = 1;
        x = 0;
        C = z = E = y = u = null
    }
    ;
    this.setClearColor = function(a, b) {
        s.copy(a);
        t = void 0 !== b ? b : 1;
        ta.set(-o, -r, o, r)
    }
    ;
    this.setClearColorHex = function(a, b) {
        s.setHex(a);
        t = void 0 !== b ? b : 1;
        ta.set(-o, -r, o, r)
    }
    ;
    this.clear = function() {
        q.setTransform(1, 0, 0, -1, o, r);
        ta.isEmpty() || (ta.minSelf(Va),
        ta.inflate(2),
        1 > t && q.clearRect(Math.floor(ta.getX()), Math.floor(ta.getY()), Math.floor(ta.getWidth()), Math.floor(ta.getHeight())),
        0 < t && (c(THREE.NormalBlending),
        b(1),
        e("rgba(" + Math.floor(255 * s.r) + "," + Math.floor(255 * s.g) + "," + Math.floor(255 * s.b) + "," + t + ")"),
        q.fillRect(Math.floor(ta.getX()), Math.floor(ta.getY()), Math.floor(ta.getWidth()), Math.floor(ta.getHeight()))),
        ta.empty())
    }
    ;
    this.render = function(a, k) {
        function n(a) {
            var b, c, d, e;
            da.setRGB(0, 0, 0);
            Ta.setRGB(0, 0, 0);
            Ra.setRGB(0, 0, 0);
            b = 0;
            for (c = a.length; b < c; b++)
                d = a[b],
                e = d.color,
                d instanceof THREE.AmbientLight ? (da.r += e.r,
                da.g += e.g,
                da.b += e.b) : d instanceof THREE.DirectionalLight ? (Ta.r += e.r,
                Ta.g += e.g,
                Ta.b += e.b) : d instanceof THREE.PointLight && (Ra.r += e.r,
                Ra.g += e.g,
                Ra.b += e.b)
        }
        function p(a, b, c, d) {
            var e, f, g, h, i, j;
            e = 0;
            for (f = a.length; e < f; e++)
                g = a[e],
                h = g.color,
                g instanceof THREE.DirectionalLight ? (i = g.matrixWorld.getPosition(),
                j = c.dot(i),
                0 >= j || (j *= g.intensity,
                d.r += h.r * j,
                d.g += h.g * j,
                d.b += h.b * j)) : g instanceof THREE.PointLight && (i = g.matrixWorld.getPosition(),
                j = c.dot(ra.sub(i, b).normalize()),
                0 >= j || (j *= 0 == g.distance ? 1 : 1 - Math.min(b.distanceTo(i) / g.distance, 1),
                0 != j && (j *= g.intensity,
                d.r += h.r * j,
                d.g += h.g * j,
                d.b += h.b * j)))
        }
        function s(a, f, g) {
            b(g.opacity);
            c(g.blending);
            var h, i, j, k, l, n;
            g instanceof THREE.ParticleBasicMaterial ? g.map && (k = g.map.image,
            l = k.width >> 1,
            n = k.height >> 1,
            g = f.scale.x * o,
            j = f.scale.y * r,
            h = g * l,
            i = j * n,
            Ba.set(a.x - h, a.y - i, a.x + h, a.y + i),
            Va.intersects(Ba) && (q.save(),
            q.translate(a.x, a.y),
            q.rotate(-f.rotation),
            q.scale(g, -j),
            q.translate(-l, -n),
            q.drawImage(k, 0, 0),
            q.restore())) : g instanceof THREE.ParticleCanvasMaterial && (h = f.scale.x * o,
            i = f.scale.y * r,
            Ba.set(a.x - h, a.y - i, a.x + h, a.y + i),
            Va.intersects(Ba) && (d(g.color.getContextStyle()),
            e(g.color.getContextStyle()),
            q.save(),
            q.translate(a.x, a.y),
            q.rotate(-f.rotation),
            q.scale(h, i),
            g.program(q),
            q.restore()))
        }
        function t(a, e, f, g) {
            b(g.opacity);
            c(g.blending);
            q.beginPath();
            q.moveTo(a.positionScreen.x, a.positionScreen.y);
            q.lineTo(e.positionScreen.x, e.positionScreen.y);
            q.closePath();
            g instanceof THREE.LineBasicMaterial && (a = g.linewidth,
            E != a && (q.lineWidth = E = a),
            a = g.linecap,
            z != a && (q.lineCap = z = a),
            a = g.linejoin,
            C != a && (q.lineJoin = C = a),
            d(g.color.getContextStyle()),
            q.stroke(),
            Ba.inflate(2 * g.linewidth))
        }
        function u(a, d, e, g, h, j, n, o) {
            f.info.render.vertices += 3;
            f.info.render.faces++;
            b(o.opacity);
            c(o.blending);
            A = a.positionScreen.x;
            J = a.positionScreen.y;
            F = d.positionScreen.x;
            l = d.positionScreen.y;
            Q = e.positionScreen.x;
            D = e.positionScreen.y;
            x(A, J, F, l, Q, D);
            o instanceof THREE.MeshBasicMaterial ? o.map ? o.map.mapping instanceof THREE.UVMapping && (Qa = n.uvs[0],
            Oc(A, J, F, l, Q, D, Qa[g].u, Qa[g].v, Qa[h].u, Qa[h].v, Qa[j].u, Qa[j].v, o.map)) : o.envMap ? o.envMap.mapping instanceof THREE.SphericalReflectionMapping && (a = k.matrixWorldInverse,
            ra.copy(n.vertexNormalsWorld[g]),
            Kb = 0.5 * (ra.x * a.elements[0] + ra.y * a.elements[4] + ra.z * a.elements[8]) + 0.5,
            xb = 0.5 * -(ra.x * a.elements[1] + ra.y * a.elements[5] + ra.z * a.elements[9]) + 0.5,
            ra.copy(n.vertexNormalsWorld[h]),
            ob = 0.5 * (ra.x * a.elements[0] + ra.y * a.elements[4] + ra.z * a.elements[8]) + 0.5,
            Lb = 0.5 * -(ra.x * a.elements[1] + ra.y * a.elements[5] + ra.z * a.elements[9]) + 0.5,
            ra.copy(n.vertexNormalsWorld[j]),
            Ab = 0.5 * (ra.x * a.elements[0] + ra.y * a.elements[4] + ra.z * a.elements[8]) + 0.5,
            Vb = 0.5 * -(ra.x * a.elements[1] + ra.y * a.elements[5] + ra.z * a.elements[9]) + 0.5,
            Oc(A, J, F, l, Q, D, Kb, xb, ob, Lb, Ab, Vb, o.envMap)) : o.wireframe ? Sb(o.color, o.wireframeLinewidth, o.wireframeLinecap, o.wireframeLinejoin) : zb(o.color) : o instanceof THREE.MeshLambertMaterial ? bb ? !o.wireframe && o.shading == THREE.SmoothShading && 3 == n.vertexNormalsWorld.length ? (X.r = aa.r = ba.r = da.r,
            X.g = aa.g = ba.g = da.g,
            X.b = aa.b = ba.b = da.b,
            p(i, n.v1.positionWorld, n.vertexNormalsWorld[0], X),
            p(i, n.v2.positionWorld, n.vertexNormalsWorld[1], aa),
            p(i, n.v3.positionWorld, n.vertexNormalsWorld[2], ba),
            X.r = Math.max(0, Math.min(o.color.r * X.r, 1)),
            X.g = Math.max(0, Math.min(o.color.g * X.g, 1)),
            X.b = Math.max(0, Math.min(o.color.b * X.b, 1)),
            aa.r = Math.max(0, Math.min(o.color.r * aa.r, 1)),
            aa.g = Math.max(0, Math.min(o.color.g * aa.g, 1)),
            aa.b = Math.max(0, Math.min(o.color.b * aa.b, 1)),
            ba.r = Math.max(0, Math.min(o.color.r * ba.r, 1)),
            ba.g = Math.max(0, Math.min(o.color.g * ba.g, 1)),
            ba.b = Math.max(0, Math.min(o.color.b * ba.b, 1)),
            m.r = 0.5 * (aa.r + ba.r),
            m.g = 0.5 * (aa.g + ba.g),
            m.b = 0.5 * (aa.b + ba.b),
            Ua = qc(X, aa, ba, m),
            jc(A, J, F, l, Q, D, 0, 0, 1, 0, 0, 1, Ua)) : (U.r = da.r,
            U.g = da.g,
            U.b = da.b,
            p(i, n.centroidWorld, n.normalWorld, U),
            U.r = Math.max(0, Math.min(o.color.r * U.r, 1)),
            U.g = Math.max(0, Math.min(o.color.g * U.g, 1)),
            U.b = Math.max(0, Math.min(o.color.b * U.b, 1)),
            o.wireframe ? Sb(U, o.wireframeLinewidth, o.wireframeLinecap, o.wireframeLinejoin) : zb(U)) : o.wireframe ? Sb(o.color, o.wireframeLinewidth, o.wireframeLinecap, o.wireframeLinejoin) : zb(o.color) : o instanceof THREE.MeshDepthMaterial ? (Ga = k.near,
            Pa = k.far,
            X.r = X.g = X.b = 1 - $b(a.positionScreen.z, Ga, Pa),
            aa.r = aa.g = aa.b = 1 - $b(d.positionScreen.z, Ga, Pa),
            ba.r = ba.g = ba.b = 1 - $b(e.positionScreen.z, Ga, Pa),
            m.r = 0.5 * (aa.r + ba.r),
            m.g = 0.5 * (aa.g + ba.g),
            m.b = 0.5 * (aa.b + ba.b),
            Ua = qc(X, aa, ba, m),
            jc(A, J, F, l, Q, D, 0, 0, 1, 0, 0, 1, Ua)) : o instanceof THREE.MeshNormalMaterial && (U.r = Tb(n.normalWorld.x),
            U.g = Tb(n.normalWorld.y),
            U.b = Tb(n.normalWorld.z),
            o.wireframe ? Sb(U, o.wireframeLinewidth, o.wireframeLinecap, o.wireframeLinejoin) : zb(U))
        }
        function v(a, d, e, g, h, j, n, o, q) {
            f.info.render.vertices += 4;
            f.info.render.faces++;
            b(o.opacity);
            c(o.blending);
            o.map || o.envMap ? (u(a, d, g, 0, 1, 3, n, o, q),
            u(h, e, j, 1, 2, 3, n, o, q)) : (A = a.positionScreen.x,
            J = a.positionScreen.y,
            F = d.positionScreen.x,
            l = d.positionScreen.y,
            Q = e.positionScreen.x,
            D = e.positionScreen.y,
            B = g.positionScreen.x,
            T = g.positionScreen.y,
            M = h.positionScreen.x,
            ea = h.positionScreen.y,
            ca = j.positionScreen.x,
            ha = j.positionScreen.y,
            o instanceof THREE.MeshBasicMaterial ? (y(A, J, F, l, Q, D, B, T),
            o.wireframe ? Sb(o.color, o.wireframeLinewidth, o.wireframeLinecap, o.wireframeLinejoin) : zb(o.color)) : o instanceof THREE.MeshLambertMaterial ? bb ? !o.wireframe && o.shading == THREE.SmoothShading && 4 == n.vertexNormalsWorld.length ? (X.r = aa.r = ba.r = m.r = da.r,
            X.g = aa.g = ba.g = m.g = da.g,
            X.b = aa.b = ba.b = m.b = da.b,
            p(i, n.v1.positionWorld, n.vertexNormalsWorld[0], X),
            p(i, n.v2.positionWorld, n.vertexNormalsWorld[1], aa),
            p(i, n.v4.positionWorld, n.vertexNormalsWorld[3], ba),
            p(i, n.v3.positionWorld, n.vertexNormalsWorld[2], m),
            X.r = Math.max(0, Math.min(o.color.r * X.r, 1)),
            X.g = Math.max(0, Math.min(o.color.g * X.g, 1)),
            X.b = Math.max(0, Math.min(o.color.b * X.b, 1)),
            aa.r = Math.max(0, Math.min(o.color.r * aa.r, 1)),
            aa.g = Math.max(0, Math.min(o.color.g * aa.g, 1)),
            aa.b = Math.max(0, Math.min(o.color.b * aa.b, 1)),
            ba.r = Math.max(0, Math.min(o.color.r * ba.r, 1)),
            ba.g = Math.max(0, Math.min(o.color.g * ba.g, 1)),
            ba.b = Math.max(0, Math.min(o.color.b * ba.b, 1)),
            m.r = Math.max(0, Math.min(o.color.r * m.r, 1)),
            m.g = Math.max(0, Math.min(o.color.g * m.g, 1)),
            m.b = Math.max(0, Math.min(o.color.b * m.b, 1)),
            Ua = qc(X, aa, ba, m),
            x(A, J, F, l, B, T),
            jc(A, J, F, l, B, T, 0, 0, 1, 0, 0, 1, Ua),
            x(M, ea, Q, D, ca, ha),
            jc(M, ea, Q, D, ca, ha, 1, 0, 1, 1, 0, 1, Ua)) : (U.r = da.r,
            U.g = da.g,
            U.b = da.b,
            p(i, n.centroidWorld, n.normalWorld, U),
            U.r = Math.max(0, Math.min(o.color.r * U.r, 1)),
            U.g = Math.max(0, Math.min(o.color.g * U.g, 1)),
            U.b = Math.max(0, Math.min(o.color.b * U.b, 1)),
            y(A, J, F, l, Q, D, B, T),
            o.wireframe ? Sb(U, o.wireframeLinewidth, o.wireframeLinecap, o.wireframeLinejoin) : zb(U)) : (y(A, J, F, l, Q, D, B, T),
            o.wireframe ? Sb(o.color, o.wireframeLinewidth, o.wireframeLinecap, o.wireframeLinejoin) : zb(o.color)) : o instanceof THREE.MeshNormalMaterial ? (U.r = Tb(n.normalWorld.x),
            U.g = Tb(n.normalWorld.y),
            U.b = Tb(n.normalWorld.z),
            y(A, J, F, l, Q, D, B, T),
            o.wireframe ? Sb(U, o.wireframeLinewidth, o.wireframeLinecap, o.wireframeLinejoin) : zb(U)) : o instanceof THREE.MeshDepthMaterial && (Ga = k.near,
            Pa = k.far,
            X.r = X.g = X.b = 1 - $b(a.positionScreen.z, Ga, Pa),
            aa.r = aa.g = aa.b = 1 - $b(d.positionScreen.z, Ga, Pa),
            ba.r = ba.g = ba.b = 1 - $b(g.positionScreen.z, Ga, Pa),
            m.r = m.g = m.b = 1 - $b(e.positionScreen.z, Ga, Pa),
            Ua = qc(X, aa, ba, m),
            x(A, J, F, l, B, T),
            jc(A, J, F, l, B, T, 0, 0, 1, 0, 0, 1, Ua),
            x(M, ea, Q, D, ca, ha),
            jc(M, ea, Q, D, ca, ha, 1, 0, 1, 1, 0, 1, Ua)))
        }
        function x(a, b, c, d, e, f) {
            q.beginPath();
            q.moveTo(a, b);
            q.lineTo(c, d);
            q.lineTo(e, f);
            q.lineTo(a, b);
            q.closePath()
        }
        function y(a, b, c, d, e, f, g, h) {
            q.beginPath();
            q.moveTo(a, b);
            q.lineTo(c, d);
            q.lineTo(e, f);
            q.lineTo(g, h);
            q.lineTo(a, b);
            q.closePath()
        }
        function Sb(a, b, c, e) {
            E != b && (q.lineWidth = E = b);
            z != c && (q.lineCap = z = c);
            C != e && (q.lineJoin = C = e);
            d(a.getContextStyle());
            q.stroke();
            Ba.inflate(2 * b)
        }
        function zb(a) {
            e(a.getContextStyle());
            q.fill()
        }
        function Oc(a, b, c, d, f, g, h, i, j, k, l, n, m) {
            if (0 != m.image.width) {
                if (!0 == m.needsUpdate || void 0 == Ha[m.id]) {
                    var o = m.wrapS == THREE.RepeatWrapping
                      , p = m.wrapT == THREE.RepeatWrapping;
                    Ha[m.id] = q.createPattern(m.image, o && p ? "repeat" : o && !p ? "repeat-x" : !o && p ? "repeat-y" : "no-repeat");
                    m.needsUpdate = !1
                }
                e(Ha[m.id]);
                var o = m.offset.x / m.repeat.x
                  , p = m.offset.y / m.repeat.y
                  , r = m.image.width * m.repeat.x
                  , s = m.image.height * m.repeat.y
                  , h = (h + o) * r
                  , i = (i + p) * s
                  , c = c - a
                  , d = d - b
                  , f = f - a
                  , g = g - b
                  , j = (j + o) * r - h
                  , k = (k + p) * s - i
                  , l = (l + o) * r - h
                  , n = (n + p) * s - i
                  , o = j * n - l * k;
                0 == o ? (void 0 === La[m.id] && (b = document.createElement("canvas"),
                b.width = m.image.width,
                b.height = m.image.height,
                b = b.getContext("2d"),
                b.drawImage(m.image, 0, 0),
                La[m.id] = b.getImageData(0, 0, m.image.width, m.image.height).data),
                b = La[m.id],
                h = 4 * (Math.floor(h) + Math.floor(i) * m.image.width),
                U.setRGB(b[h] / 255, b[h + 1] / 255, b[h + 2] / 255),
                zb(U)) : (o = 1 / o,
                m = (n * c - k * f) * o,
                k = (n * d - k * g) * o,
                c = (j * f - l * c) * o,
                d = (j * g - l * d) * o,
                a = a - m * h - c * i,
                h = b - k * h - d * i,
                q.save(),
                q.transform(m, k, c, d, a, h),
                q.fill(),
                q.restore())
            }
        }
        function jc(a, b, c, d, e, f, g, h, i, j, k, l, n) {
            var m, o;
            m = n.width - 1;
            o = n.height - 1;
            g *= m;
            h *= o;
            c -= a;
            d -= b;
            e -= a;
            f -= b;
            i = i * m - g;
            j = j * o - h;
            k = k * m - g;
            l = l * o - h;
            o = 1 / (i * l - k * j);
            m = (l * c - j * e) * o;
            j = (l * d - j * f) * o;
            c = (i * e - k * c) * o;
            d = (i * f - k * d) * o;
            a = a - m * g - c * h;
            b = b - j * g - d * h;
            q.save();
            q.transform(m, j, c, d, a, b);
            q.clip();
            q.drawImage(n, 0, 0);
            q.restore()
        }
        function qc(a, b, c, d) {
            var e = ~~(255 * a.r)
              , f = ~~(255 * a.g)
              , a = ~~(255 * a.b)
              , g = ~~(255 * b.r)
              , h = ~~(255 * b.g)
              , b = ~~(255 * b.b)
              , i = ~~(255 * c.r)
              , j = ~~(255 * c.g)
              , c = ~~(255 * c.b)
              , k = ~~(255 * d.r)
              , l = ~~(255 * d.g)
              , d = ~~(255 * d.b);
            la[0] = 0 > e ? 0 : 255 < e ? 255 : e;
            la[1] = 0 > f ? 0 : 255 < f ? 255 : f;
            la[2] = 0 > a ? 0 : 255 < a ? 255 : a;
            la[4] = 0 > g ? 0 : 255 < g ? 255 : g;
            la[5] = 0 > h ? 0 : 255 < h ? 255 : h;
            la[6] = 0 > b ? 0 : 255 < b ? 255 : b;
            la[8] = 0 > i ? 0 : 255 < i ? 255 : i;
            la[9] = 0 > j ? 0 : 255 < j ? 255 : j;
            la[10] = 0 > c ? 0 : 255 < c ? 255 : c;
            la[12] = 0 > k ? 0 : 255 < k ? 255 : k;
            la[13] = 0 > l ? 0 : 255 < l ? 255 : l;
            la[14] = 0 > d ? 0 : 255 < d ? 255 : d;
            pa.putImageData(Wb, 0, 0);
            Pb.drawImage(kb, 0, 0);
            return pb
        }
        function $b(a, b, c) {
            a = (a - b) / (c - b);
            return a * a * (3 - 2 * a)
        }
        function Tb(a) {
            a = 0.5 * (a + 1);
            return 0 > a ? 0 : 1 < a ? 1 : a
        }
        function Bb(a, b) {
            var c = b.x - a.x
              , d = b.y - a.y
              , e = c * c + d * d;
            0 != e && (e = 1 / Math.sqrt(e),
            c *= e,
            d *= e,
            b.x += c,
            b.y += d,
            a.x -= c,
            a.y -= d)
        }
        var tc, Zc, Ka, lb;
        this.autoClear ? this.clear() : q.setTransform(1, 0, 0, -1, o, r);
        f.info.render.vertices = 0;
        f.info.render.faces = 0;
        g = j.projectScene(a, k, this.sortElements);
        h = g.elements;
        i = g.lights;
        (bb = 0 < i.length) && n(i);
        tc = 0;
        for (Zc = h.length; tc < Zc; tc++)
            Ka = h[tc],
            lb = Ka.material,
            lb = lb instanceof THREE.MeshFaceMaterial ? Ka.faceMaterial : lb,
            void 0 === lb || !1 === lb.visible || (Ba.empty(),
            Ka instanceof THREE.RenderableParticle ? (w = Ka,
            w.x *= o,
            w.y *= r,
            s(w, Ka, lb, a)) : Ka instanceof THREE.RenderableLine ? (w = Ka.v1,
            H = Ka.v2,
            w.positionScreen.x *= o,
            w.positionScreen.y *= r,
            H.positionScreen.x *= o,
            H.positionScreen.y *= r,
            Ba.addPoint(w.positionScreen.x, w.positionScreen.y),
            Ba.addPoint(H.positionScreen.x, H.positionScreen.y),
            Va.intersects(Ba) && t(w, H, Ka, lb, a)) : Ka instanceof THREE.RenderableFace3 ? (w = Ka.v1,
            H = Ka.v2,
            L = Ka.v3,
            w.positionScreen.x *= o,
            w.positionScreen.y *= r,
            H.positionScreen.x *= o,
            H.positionScreen.y *= r,
            L.positionScreen.x *= o,
            L.positionScreen.y *= r,
            lb.overdraw && (Bb(w.positionScreen, H.positionScreen),
            Bb(H.positionScreen, L.positionScreen),
            Bb(L.positionScreen, w.positionScreen)),
            Ba.add3Points(w.positionScreen.x, w.positionScreen.y, H.positionScreen.x, H.positionScreen.y, L.positionScreen.x, L.positionScreen.y),
            Va.intersects(Ba) && u(w, H, L, 0, 1, 2, Ka, lb, a)) : Ka instanceof THREE.RenderableFace4 && (w = Ka.v1,
            H = Ka.v2,
            L = Ka.v3,
            I = Ka.v4,
            w.positionScreen.x *= o,
            w.positionScreen.y *= r,
            H.positionScreen.x *= o,
            H.positionScreen.y *= r,
            L.positionScreen.x *= o,
            L.positionScreen.y *= r,
            I.positionScreen.x *= o,
            I.positionScreen.y *= r,
            P.positionScreen.copy(H.positionScreen),
            N.positionScreen.copy(I.positionScreen),
            lb.overdraw && (Bb(w.positionScreen, H.positionScreen),
            Bb(H.positionScreen, I.positionScreen),
            Bb(I.positionScreen, w.positionScreen),
            Bb(L.positionScreen, P.positionScreen),
            Bb(L.positionScreen, N.positionScreen)),
            Ba.addPoint(w.positionScreen.x, w.positionScreen.y),
            Ba.addPoint(H.positionScreen.x, H.positionScreen.y),
            Ba.addPoint(L.positionScreen.x, L.positionScreen.y),
            Ba.addPoint(I.positionScreen.x, I.positionScreen.y),
            Va.intersects(Ba) && v(w, H, L, I, P, N, Ka, lb, a)),
            ta.addRectangle(Ba));
        q.setTransform(1, 0, 0, 1, 0, 0)
    }
}
;
THREE.SVGRenderer = function() {
    function a(a, b, c, d) {
        var e, f, g, h, i, j;
        e = 0;
        for (f = a.length; e < f; e++)
            g = a[e],
            h = g.color,
            g instanceof THREE.DirectionalLight ? (i = g.matrixWorld.getPosition(),
            j = c.dot(i),
            0 >= j || (j *= g.intensity,
            d.r += h.r * j,
            d.g += h.g * j,
            d.b += h.b * j)) : g instanceof THREE.PointLight && (i = g.matrixWorld.getPosition(),
            j = c.dot(w.sub(i, b).normalize()),
            0 >= j || (j *= 0 == g.distance ? 1 : 1 - Math.min(b.distanceTo(i) / g.distance, 1),
            0 != j && (j *= g.intensity,
            d.r += h.r * j,
            d.g += h.g * j,
            d.b += h.b * j)))
    }
    function b(a) {
        null == H[a] && (H[a] = document.createElementNS("http://www.w3.org/2000/svg", "path"),
        0 == A && H[a].setAttribute("shape-rendering", "crispEdges"));
        return H[a]
    }
    function c(a) {
        a = 0.5 * (a + 1);
        return 0 > a ? 0 : 1 < a ? 1 : a
    }
    console.log("THREE.SVGRenderer", THREE.REVISION);
    var d = this, e, f, g, h = new THREE.Projector, i = document.createElementNS("http://www.w3.org/2000/svg", "svg"), j, k, n, p, o, r, q, s, t = new THREE.Rectangle, v = new THREE.Rectangle, x = !1, u = new THREE.Color, y = new THREE.Color, E = new THREE.Color, z = new THREE.Color, C, w = new THREE.Vector3, H = [], L = [], I, P, N, A = 1;
    this.domElement = i;
    this.sortElements = this.sortObjects = this.autoClear = !0;
    this.info = {
        render: {
            vertices: 0,
            faces: 0
        }
    };
    this.setQuality = function(a) {
        switch (a) {
        case "high":
            A = 1;
            break;
        case "low":
            A = 0
        }
    }
    ;
    this.setSize = function(a, b) {
        j = a;
        k = b;
        n = j / 2;
        p = k / 2;
        i.setAttribute("viewBox", -n + " " + -p + " " + j + " " + k);
        i.setAttribute("width", j);
        i.setAttribute("height", k);
        t.set(-n, -p, n, p)
    }
    ;
    this.clear = function() {
        for (; 0 < i.childNodes.length; )
            i.removeChild(i.childNodes[0])
    }
    ;
    this.render = function(j, k) {
        var l, w, D, B;
        this.autoClear && this.clear();
        d.info.render.vertices = 0;
        d.info.render.faces = 0;
        e = h.projectScene(j, k, this.sortElements);
        f = e.elements;
        g = e.lights;
        N = P = 0;
        if (x = 0 < g.length) {
            y.setRGB(0, 0, 0);
            E.setRGB(0, 0, 0);
            z.setRGB(0, 0, 0);
            l = 0;
            for (w = g.length; l < w; l++)
                B = g[l],
                D = B.color,
                B instanceof THREE.AmbientLight ? (y.r += D.r,
                y.g += D.g,
                y.b += D.b) : B instanceof THREE.DirectionalLight ? (E.r += D.r,
                E.g += D.g,
                E.b += D.b) : B instanceof THREE.PointLight && (z.r += D.r,
                z.g += D.g,
                z.b += D.b)
        }
        l = 0;
        for (w = f.length; l < w; l++)
            if (D = f[l],
            B = D.material,
            B = B instanceof THREE.MeshFaceMaterial ? D.faceMaterial : B,
            !(void 0 === B || !1 === B.visible))
                if (v.empty(),
                D instanceof THREE.RenderableParticle)
                    o = D,
                    o.x *= n,
                    o.y *= -p;
                else if (D instanceof THREE.RenderableLine) {
                    if (o = D.v1,
                    r = D.v2,
                    o.positionScreen.x *= n,
                    o.positionScreen.y *= -p,
                    r.positionScreen.x *= n,
                    r.positionScreen.y *= -p,
                    v.addPoint(o.positionScreen.x, o.positionScreen.y),
                    v.addPoint(r.positionScreen.x, r.positionScreen.y),
                    t.intersects(v)) {
                        D = o;
                        var H = r
                          , M = N++;
                        null == L[M] && (L[M] = document.createElementNS("http://www.w3.org/2000/svg", "line"),
                        0 == A && L[M].setAttribute("shape-rendering", "crispEdges"));
                        I = L[M];
                        I.setAttribute("x1", D.positionScreen.x);
                        I.setAttribute("y1", D.positionScreen.y);
                        I.setAttribute("x2", H.positionScreen.x);
                        I.setAttribute("y2", H.positionScreen.y);
                        B instanceof THREE.LineBasicMaterial && (I.setAttribute("style", "fill: none; stroke: " + B.color.getContextStyle() + "; stroke-width: " + B.linewidth + "; stroke-opacity: " + B.opacity + "; stroke-linecap: " + B.linecap + "; stroke-linejoin: " + B.linejoin),
                        i.appendChild(I))
                    }
                } else if (D instanceof THREE.RenderableFace3) {
                    if (o = D.v1,
                    r = D.v2,
                    q = D.v3,
                    o.positionScreen.x *= n,
                    o.positionScreen.y *= -p,
                    r.positionScreen.x *= n,
                    r.positionScreen.y *= -p,
                    q.positionScreen.x *= n,
                    q.positionScreen.y *= -p,
                    v.addPoint(o.positionScreen.x, o.positionScreen.y),
                    v.addPoint(r.positionScreen.x, r.positionScreen.y),
                    v.addPoint(q.positionScreen.x, q.positionScreen.y),
                    t.intersects(v)) {
                        var H = o
                          , M = r
                          , ea = q;
                        d.info.render.vertices += 3;
                        d.info.render.faces++;
                        I = b(P++);
                        I.setAttribute("d", "M " + H.positionScreen.x + " " + H.positionScreen.y + " L " + M.positionScreen.x + " " + M.positionScreen.y + " L " + ea.positionScreen.x + "," + ea.positionScreen.y + "z");
                        B instanceof THREE.MeshBasicMaterial ? u.copy(B.color) : B instanceof THREE.MeshLambertMaterial ? x ? (u.r = y.r,
                        u.g = y.g,
                        u.b = y.b,
                        a(g, D.centroidWorld, D.normalWorld, u),
                        u.r = Math.max(0, Math.min(B.color.r * u.r, 1)),
                        u.g = Math.max(0, Math.min(B.color.g * u.g, 1)),
                        u.b = Math.max(0, Math.min(B.color.b * u.b, 1))) : u.copy(B.color) : B instanceof THREE.MeshDepthMaterial ? (C = 1 - B.__2near / (B.__farPlusNear - D.z * B.__farMinusNear),
                        u.setRGB(C, C, C)) : B instanceof THREE.MeshNormalMaterial && u.setRGB(c(D.normalWorld.x), c(D.normalWorld.y), c(D.normalWorld.z));
                        B.wireframe ? I.setAttribute("style", "fill: none; stroke: " + u.getContextStyle() + "; stroke-width: " + B.wireframeLinewidth + "; stroke-opacity: " + B.opacity + "; stroke-linecap: " + B.wireframeLinecap + "; stroke-linejoin: " + B.wireframeLinejoin) : I.setAttribute("style", "fill: " + u.getContextStyle() + "; fill-opacity: " + B.opacity);
                        i.appendChild(I)
                    }
                } else if (D instanceof THREE.RenderableFace4 && (o = D.v1,
                r = D.v2,
                q = D.v3,
                s = D.v4,
                o.positionScreen.x *= n,
                o.positionScreen.y *= -p,
                r.positionScreen.x *= n,
                r.positionScreen.y *= -p,
                q.positionScreen.x *= n,
                q.positionScreen.y *= -p,
                s.positionScreen.x *= n,
                s.positionScreen.y *= -p,
                v.addPoint(o.positionScreen.x, o.positionScreen.y),
                v.addPoint(r.positionScreen.x, r.positionScreen.y),
                v.addPoint(q.positionScreen.x, q.positionScreen.y),
                v.addPoint(s.positionScreen.x, s.positionScreen.y),
                t.intersects(v))) {
                    var H = o
                      , M = r
                      , ea = q
                      , ca = s;
                    d.info.render.vertices += 4;
                    d.info.render.faces++;
                    I = b(P++);
                    I.setAttribute("d", "M " + H.positionScreen.x + " " + H.positionScreen.y + " L " + M.positionScreen.x + " " + M.positionScreen.y + " L " + ea.positionScreen.x + "," + ea.positionScreen.y + " L " + ca.positionScreen.x + "," + ca.positionScreen.y + "z");
                    B instanceof THREE.MeshBasicMaterial ? u.copy(B.color) : B instanceof THREE.MeshLambertMaterial ? x ? (u.r = y.r,
                    u.g = y.g,
                    u.b = y.b,
                    a(g, D.centroidWorld, D.normalWorld, u),
                    u.r = Math.max(0, Math.min(B.color.r * u.r, 1)),
                    u.g = Math.max(0, Math.min(B.color.g * u.g, 1)),
                    u.b = Math.max(0, Math.min(B.color.b * u.b, 1))) : u.copy(B.color) : B instanceof THREE.MeshDepthMaterial ? (C = 1 - B.__2near / (B.__farPlusNear - D.z * B.__farMinusNear),
                    u.setRGB(C, C, C)) : B instanceof THREE.MeshNormalMaterial && u.setRGB(c(D.normalWorld.x), c(D.normalWorld.y), c(D.normalWorld.z));
                    B.wireframe ? I.setAttribute("style", "fill: none; stroke: " + u.getContextStyle() + "; stroke-width: " + B.wireframeLinewidth + "; stroke-opacity: " + B.opacity + "; stroke-linecap: " + B.wireframeLinecap + "; stroke-linejoin: " + B.wireframeLinejoin) : I.setAttribute("style", "fill: " + u.getContextStyle() + "; fill-opacity: " + B.opacity);
                    i.appendChild(I)
                }
    }
}
;
THREE.ShaderChunk = {
    fog_pars_fragment: "#ifdef USE_FOG\nuniform vec3 fogColor;\n#ifdef FOG_EXP2\nuniform float fogDensity;\n#else\nuniform float fogNear;\nuniform float fogFar;\n#endif\n#endif",
    fog_fragment: "#ifdef USE_FOG\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n#ifdef FOG_EXP2\nconst float LOG2 = 1.442695;\nfloat fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n#else\nfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n#endif\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n#endif",
    envmap_pars_fragment: "#ifdef USE_ENVMAP\nvarying vec3 vReflect;\nuniform float reflectivity;\nuniform samplerCube envMap;\nuniform float flipEnvMap;\nuniform int combine;\n#endif",
    envmap_fragment: "#ifdef USE_ENVMAP\n#ifdef DOUBLE_SIDED\nfloat flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );\nvec4 cubeColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * vReflect.x, vReflect.yz ) );\n#else\nvec4 cubeColor = textureCube( envMap, vec3( flipEnvMap * vReflect.x, vReflect.yz ) );\n#endif\n#ifdef GAMMA_INPUT\ncubeColor.xyz *= cubeColor.xyz;\n#endif\nif ( combine == 1 ) {\ngl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, reflectivity );\n} else {\ngl_FragColor.xyz = gl_FragColor.xyz * cubeColor.xyz;\n}\n#endif",
    envmap_pars_vertex: "#ifdef USE_ENVMAP\nvarying vec3 vReflect;\nuniform float refractionRatio;\nuniform bool useRefract;\n#endif",
    envmap_vertex: "#ifdef USE_ENVMAP\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvec3 nWorld = mat3( objectMatrix[ 0 ].xyz, objectMatrix[ 1 ].xyz, objectMatrix[ 2 ].xyz ) * normal;\nif ( useRefract ) {\nvReflect = refract( normalize( mPosition.xyz - cameraPosition ), normalize( nWorld.xyz ), refractionRatio );\n} else {\nvReflect = reflect( normalize( mPosition.xyz - cameraPosition ), normalize( nWorld.xyz ) );\n}\n#endif",
    map_particle_pars_fragment: "#ifdef USE_MAP\nuniform sampler2D map;\n#endif",
    map_particle_fragment: "#ifdef USE_MAP\ngl_FragColor = gl_FragColor * texture2D( map, gl_PointCoord );\n#endif",
    map_pars_vertex: "#ifdef USE_MAP\nvarying vec2 vUv;\nuniform vec4 offsetRepeat;\n#endif",
    map_pars_fragment: "#ifdef USE_MAP\nvarying vec2 vUv;\nuniform sampler2D map;\n#endif",
    map_vertex: "#ifdef USE_MAP\nvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n#endif",
    map_fragment: "#ifdef USE_MAP\n#ifdef GAMMA_INPUT\nvec4 texelColor = texture2D( map, vUv );\ntexelColor.xyz *= texelColor.xyz;\ngl_FragColor = gl_FragColor * texelColor;\n#else\ngl_FragColor = gl_FragColor * texture2D( map, vUv );\n#endif\n#endif",
    lightmap_pars_fragment: "#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\nuniform sampler2D lightMap;\n#endif",
    lightmap_pars_vertex: "#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\n#endif",
    lightmap_fragment: "#ifdef USE_LIGHTMAP\ngl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );\n#endif",
    lightmap_vertex: "#ifdef USE_LIGHTMAP\nvUv2 = uv2;\n#endif",
    lights_lambert_pars_vertex: "uniform vec3 ambient;\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#endif\n#if MAX_SPOT_LIGHTS > 0\nuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\nuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\nuniform float spotLightAngle[ MAX_SPOT_LIGHTS ];\nuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n#endif\n#ifdef WRAP_AROUND\nuniform vec3 wrapRGB;\n#endif",
    lights_lambert_vertex: "vLightFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\nvLightBack = vec3( 0.0 );\n#endif\ntransformedNormal = normalize( transformedNormal );\n#if MAX_DIR_LIGHTS > 0\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\nfloat dotProduct = dot( transformedNormal, dirVector );\nvec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );\n#ifdef DOUBLE_SIDED\nvec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n#ifdef WRAP_AROUND\nvec3 directionalLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n#endif\n#endif\n#ifdef WRAP_AROUND\nvec3 directionalLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\ndirectionalLightWeighting = mix( directionalLightWeighting, directionalLightWeightingHalf, wrapRGB );\n#ifdef DOUBLE_SIDED\ndirectionalLightWeightingBack = mix( directionalLightWeightingBack, directionalLightWeightingHalfBack, wrapRGB );\n#endif\n#endif\nvLightFront += directionalLightColor[ i ] * directionalLightWeighting;\n#ifdef DOUBLE_SIDED\nvLightBack += directionalLightColor[ i ] * directionalLightWeightingBack;\n#endif\n}\n#endif\n#if MAX_POINT_LIGHTS > 0\nfor( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\nfloat dotProduct = dot( transformedNormal, lVector );\nvec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );\n#ifdef DOUBLE_SIDED\nvec3 pointLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n#ifdef WRAP_AROUND\nvec3 pointLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n#endif\n#endif\n#ifdef WRAP_AROUND\nvec3 pointLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\npointLightWeighting = mix( pointLightWeighting, pointLightWeightingHalf, wrapRGB );\n#ifdef DOUBLE_SIDED\npointLightWeightingBack = mix( pointLightWeightingBack, pointLightWeightingHalfBack, wrapRGB );\n#endif\n#endif\nvLightFront += pointLightColor[ i ] * pointLightWeighting * lDistance;\n#ifdef DOUBLE_SIDED\nvLightBack += pointLightColor[ i ] * pointLightWeightingBack * lDistance;\n#endif\n}\n#endif\n#if MAX_SPOT_LIGHTS > 0\nfor( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nlVector = normalize( lVector );\nfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - mPosition.xyz ) );\nif ( spotEffect > spotLightAngle[ i ] ) {\nspotEffect = pow( spotEffect, spotLightExponent[ i ] );\nfloat lDistance = 1.0;\nif ( spotLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\nfloat dotProduct = dot( transformedNormal, lVector );\nvec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );\n#ifdef DOUBLE_SIDED\nvec3 spotLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n#ifdef WRAP_AROUND\nvec3 spotLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n#endif\n#endif\n#ifdef WRAP_AROUND\nvec3 spotLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\nspotLightWeighting = mix( spotLightWeighting, spotLightWeightingHalf, wrapRGB );\n#ifdef DOUBLE_SIDED\nspotLightWeightingBack = mix( spotLightWeightingBack, spotLightWeightingHalfBack, wrapRGB );\n#endif\n#endif\nvLightFront += spotLightColor[ i ] * spotLightWeighting * lDistance * spotEffect;\n#ifdef DOUBLE_SIDED\nvLightBack += spotLightColor[ i ] * spotLightWeightingBack * lDistance * spotEffect;\n#endif\n}\n}\n#endif\nvLightFront = vLightFront * diffuse + ambient * ambientLightColor + emissive;\n#ifdef DOUBLE_SIDED\nvLightBack = vLightBack * diffuse + ambient * ambientLightColor + emissive;\n#endif",
    lights_phong_pars_vertex: "#ifndef PHONG_PER_PIXEL\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\n#if MAX_SPOT_LIGHTS > 0\nuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\nuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\nvarying vec4 vSpotLight[ MAX_SPOT_LIGHTS ];\n#endif\n#endif\n#if MAX_SPOT_LIGHTS > 0\nvarying vec3 vWorldPosition;\n#endif",
    lights_phong_vertex: "#ifndef PHONG_PER_PIXEL\n#if MAX_POINT_LIGHTS > 0\nfor( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nvPointLight[ i ] = vec4( lVector, lDistance );\n}\n#endif\n#if MAX_SPOT_LIGHTS > 0\nfor( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( spotLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\nvSpotLight[ i ] = vec4( lVector, lDistance );\n}\n#endif\n#endif\n#if MAX_SPOT_LIGHTS > 0\nvWorldPosition = mPosition.xyz;\n#endif",
    lights_phong_pars_fragment: "uniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n#ifdef PHONG_PER_PIXEL\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#else\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\n#endif\n#if MAX_SPOT_LIGHTS > 0\nuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\nuniform float spotLightAngle[ MAX_SPOT_LIGHTS ];\nuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n#ifdef PHONG_PER_PIXEL\nuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n#else\nvarying vec4 vSpotLight[ MAX_SPOT_LIGHTS ];\n#endif\nvarying vec3 vWorldPosition;\n#endif\n#ifdef WRAP_AROUND\nuniform vec3 wrapRGB;\n#endif\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",
    lights_phong_fragment: "vec3 normal = normalize( vNormal );\nvec3 viewPosition = normalize( vViewPosition );\n#ifdef DOUBLE_SIDED\nnormal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n#endif\n#if MAX_POINT_LIGHTS > 0\nvec3 pointDiffuse  = vec3( 0.0 );\nvec3 pointSpecular = vec3( 0.0 );\nfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n#ifdef PHONG_PER_PIXEL\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz + vViewPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\n#else\nvec3 lVector = normalize( vPointLight[ i ].xyz );\nfloat lDistance = vPointLight[ i ].w;\n#endif\nfloat dotProduct = dot( normal, lVector );\n#ifdef WRAP_AROUND\nfloat pointDiffuseWeightFull = max( dotProduct, 0.0 );\nfloat pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\nvec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );\n#else\nfloat pointDiffuseWeight = max( dotProduct, 0.0 );\n#endif\npointDiffuse  += diffuse * pointLightColor[ i ] * pointDiffuseWeight * lDistance;\nvec3 pointHalfVector = normalize( lVector + viewPosition );\nfloat pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\nfloat pointSpecularWeight = max( pow( pointDotNormalHalf, shininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( shininess + 2.0001 ) / 8.0;\nvec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, pointHalfVector ), 5.0 );\npointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization;\n#else\npointSpecular += specular * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance;\n#endif\n}\n#endif\n#if MAX_SPOT_LIGHTS > 0\nvec3 spotDiffuse  = vec3( 0.0 );\nvec3 spotSpecular = vec3( 0.0 );\nfor ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n#ifdef PHONG_PER_PIXEL\nvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz + vViewPosition.xyz;\nfloat lDistance = 1.0;\nif ( spotLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\n#else\nvec3 lVector = normalize( vSpotLight[ i ].xyz );\nfloat lDistance = vSpotLight[ i ].w;\n#endif\nfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );\nif ( spotEffect > spotLightAngle[ i ] ) {\nspotEffect = pow( spotEffect, spotLightExponent[ i ] );\nfloat dotProduct = dot( normal, lVector );\n#ifdef WRAP_AROUND\nfloat spotDiffuseWeightFull = max( dotProduct, 0.0 );\nfloat spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\nvec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );\n#else\nfloat spotDiffuseWeight = max( dotProduct, 0.0 );\n#endif\nspotDiffuse += diffuse * spotLightColor[ i ] * spotDiffuseWeight * lDistance * spotEffect;\nvec3 spotHalfVector = normalize( lVector + viewPosition );\nfloat spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );\nfloat spotSpecularWeight = max( pow( spotDotNormalHalf, shininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( shininess + 2.0001 ) / 8.0;\nvec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, spotHalfVector ), 5.0 );\nspotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * specularNormalization * spotEffect;\n#else\nspotSpecular += specular * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * spotEffect;\n#endif\n}\n}\n#endif\n#if MAX_DIR_LIGHTS > 0\nvec3 dirDiffuse  = vec3( 0.0 );\nvec3 dirSpecular = vec3( 0.0 );\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\nfloat dotProduct = dot( normal, dirVector );\n#ifdef WRAP_AROUND\nfloat dirDiffuseWeightFull = max( dotProduct, 0.0 );\nfloat dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\nvec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );\n#else\nfloat dirDiffuseWeight = max( dotProduct, 0.0 );\n#endif\ndirDiffuse  += diffuse * directionalLightColor[ i ] * dirDiffuseWeight;\nvec3 dirHalfVector = normalize( dirVector + viewPosition );\nfloat dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\nfloat dirSpecularWeight = max( pow( dirDotNormalHalf, shininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( shininess + 2.0001 ) / 8.0;\nvec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );\ndirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\n#else\ndirSpecular += specular * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight;\n#endif\n}\n#endif\nvec3 totalDiffuse = vec3( 0.0 );\nvec3 totalSpecular = vec3( 0.0 );\n#if MAX_DIR_LIGHTS > 0\ntotalDiffuse += dirDiffuse;\ntotalSpecular += dirSpecular;\n#endif\n#if MAX_POINT_LIGHTS > 0\ntotalDiffuse += pointDiffuse;\ntotalSpecular += pointSpecular;\n#endif\n#if MAX_SPOT_LIGHTS > 0\ntotalDiffuse += spotDiffuse;\ntotalSpecular += spotSpecular;\n#endif\n#ifdef METAL\ngl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient + totalSpecular );\n#else\ngl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient ) + totalSpecular;\n#endif",
    color_pars_fragment: "#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif",
    color_fragment: "#ifdef USE_COLOR\ngl_FragColor = gl_FragColor * vec4( vColor, opacity );\n#endif",
    color_pars_vertex: "#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif",
    color_vertex: "#ifdef USE_COLOR\n#ifdef GAMMA_INPUT\nvColor = color * color;\n#else\nvColor = color;\n#endif\n#endif",
    skinning_pars_vertex: "#ifdef USE_SKINNING\nuniform mat4 boneGlobalMatrices[ MAX_BONES ];\n#endif",
    skinning_vertex: "#ifdef USE_SKINNING\ngl_Position  = ( boneGlobalMatrices[ int( skinIndex.x ) ] * skinVertexA ) * skinWeight.x;\ngl_Position += ( boneGlobalMatrices[ int( skinIndex.y ) ] * skinVertexB ) * skinWeight.y;\ngl_Position  = projectionMatrix * modelViewMatrix * gl_Position;\n#endif",
    morphtarget_pars_vertex: "#ifdef USE_MORPHTARGETS\n#ifndef USE_MORPHNORMALS\nuniform float morphTargetInfluences[ 8 ];\n#else\nuniform float morphTargetInfluences[ 4 ];\n#endif\n#endif",
    morphtarget_vertex: "#ifdef USE_MORPHTARGETS\nvec3 morphed = vec3( 0.0 );\nmorphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\nmorphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\nmorphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\nmorphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n#ifndef USE_MORPHNORMALS\nmorphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\nmorphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\nmorphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\nmorphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n#endif\nmorphed += position;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( morphed, 1.0 );\n#endif",
    default_vertex: "#ifndef USE_MORPHTARGETS\n#ifndef USE_SKINNING\ngl_Position = projectionMatrix * mvPosition;\n#endif\n#endif",
    morphnormal_vertex: "#ifdef USE_MORPHNORMALS\nvec3 morphedNormal = vec3( 0.0 );\nmorphedNormal +=  ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\nmorphedNormal +=  ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\nmorphedNormal +=  ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\nmorphedNormal +=  ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\nmorphedNormal += normal;\nvec3 transformedNormal = normalMatrix * morphedNormal;\n#else\nvec3 transformedNormal = normalMatrix * normal;\n#endif",
    shadowmap_pars_fragment: "#ifdef USE_SHADOWMAP\nuniform sampler2D shadowMap[ MAX_SHADOWS ];\nuniform vec2 shadowMapSize[ MAX_SHADOWS ];\nuniform float shadowDarkness[ MAX_SHADOWS ];\nuniform float shadowBias[ MAX_SHADOWS ];\nvarying vec4 vShadowCoord[ MAX_SHADOWS ];\nfloat unpackDepth( const in vec4 rgba_depth ) {\nconst vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\nfloat depth = dot( rgba_depth, bit_shift );\nreturn depth;\n}\n#endif",
    shadowmap_fragment: "#ifdef USE_SHADOWMAP\n#ifdef SHADOWMAP_DEBUG\nvec3 frustumColors[3];\nfrustumColors[0] = vec3( 1.0, 0.5, 0.0 );\nfrustumColors[1] = vec3( 0.0, 1.0, 0.8 );\nfrustumColors[2] = vec3( 0.0, 0.5, 1.0 );\n#endif\n#ifdef SHADOWMAP_CASCADE\nint inFrustumCount = 0;\n#endif\nfloat fDepth;\nvec3 shadowColor = vec3( 1.0 );\nfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\nvec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;\nbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\nbool inFrustum = all( inFrustumVec );\n#ifdef SHADOWMAP_CASCADE\ninFrustumCount += int( inFrustum );\nbvec3 frustumTestVec = bvec3( inFrustum, inFrustumCount == 1, shadowCoord.z <= 1.0 );\n#else\nbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n#endif\nbool frustumTest = all( frustumTestVec );\nif ( frustumTest ) {\nshadowCoord.z += shadowBias[ i ];\n#ifdef SHADOWMAP_SOFT\nfloat shadow = 0.0;\nconst float shadowDelta = 1.0 / 9.0;\nfloat xPixelOffset = 1.0 / shadowMapSize[ i ].x;\nfloat yPixelOffset = 1.0 / shadowMapSize[ i ].y;\nfloat dx0 = -1.25 * xPixelOffset;\nfloat dy0 = -1.25 * yPixelOffset;\nfloat dx1 = 1.25 * xPixelOffset;\nfloat dy1 = 1.25 * yPixelOffset;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nshadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n#else\nvec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );\nfloat fDepth = unpackDepth( rgbaDepth );\nif ( fDepth < shadowCoord.z )\nshadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );\n#endif\n}\n#ifdef SHADOWMAP_DEBUG\n#ifdef SHADOWMAP_CASCADE\nif ( inFrustum && inFrustumCount == 1 ) gl_FragColor.xyz *= frustumColors[ i ];\n#else\nif ( inFrustum ) gl_FragColor.xyz *= frustumColors[ i ];\n#endif\n#endif\n}\n#ifdef GAMMA_OUTPUT\nshadowColor *= shadowColor;\n#endif\ngl_FragColor.xyz = gl_FragColor.xyz * shadowColor;\n#endif",
    shadowmap_pars_vertex: "#ifdef USE_SHADOWMAP\nvarying vec4 vShadowCoord[ MAX_SHADOWS ];\nuniform mat4 shadowMatrix[ MAX_SHADOWS ];\n#endif",
    shadowmap_vertex: "#ifdef USE_SHADOWMAP\nfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\n#ifdef USE_MORPHTARGETS\nvShadowCoord[ i ] = shadowMatrix[ i ] * objectMatrix * vec4( morphed, 1.0 );\n#else\nvShadowCoord[ i ] = shadowMatrix[ i ] * objectMatrix * vec4( position, 1.0 );\n#endif\n}\n#endif",
    alphatest_fragment: "#ifdef ALPHATEST\nif ( gl_FragColor.a < ALPHATEST ) discard;\n#endif",
    linear_to_gamma_fragment: "#ifdef GAMMA_OUTPUT\ngl_FragColor.xyz = sqrt( gl_FragColor.xyz );\n#endif"
};
THREE.UniformsUtils = {
    merge: function(a) {
        var b, c, d, e = {};
        for (b = 0; b < a.length; b++)
            for (c in d = this.clone(a[b]),
            d)
                e[c] = d[c];
        return e
    },
    clone: function(a) {
        var b, c, d, e = {};
        for (b in a)
            for (c in e[b] = {},
            a[b])
                d = a[b][c],
                e[b][c] = d instanceof THREE.Color || d instanceof THREE.Vector2 || d instanceof THREE.Vector3 || d instanceof THREE.Vector4 || d instanceof THREE.Matrix4 || d instanceof THREE.Texture ? d.clone() : d instanceof Array ? d.slice() : d;
        return e
    }
};
THREE.UniformsLib = {
    common: {
        diffuse: {
            type: "c",
            value: new THREE.Color(15658734)
        },
        opacity: {
            type: "f",
            value: 1
        },
        map: {
            type: "t",
            value: 0,
            texture: null
        },
        offsetRepeat: {
            type: "v4",
            value: new THREE.Vector4(0,0,1,1)
        },
        lightMap: {
            type: "t",
            value: 2,
            texture: null
        },
        envMap: {
            type: "t",
            value: 1,
            texture: null
        },
        flipEnvMap: {
            type: "f",
            value: -1
        },
        useRefract: {
            type: "i",
            value: 0
        },
        reflectivity: {
            type: "f",
            value: 1
        },
        refractionRatio: {
            type: "f",
            value: 0.98
        },
        combine: {
            type: "i",
            value: 0
        },
        morphTargetInfluences: {
            type: "f",
            value: 0
        }
    },
    fog: {
        fogDensity: {
            type: "f",
            value: 2.5E-4
        },
        fogNear: {
            type: "f",
            value: 1
        },
        fogFar: {
            type: "f",
            value: 2E3
        },
        fogColor: {
            type: "c",
            value: new THREE.Color(16777215)
        }
    },
    lights: {
        ambientLightColor: {
            type: "fv",
            value: []
        },
        directionalLightDirection: {
            type: "fv",
            value: []
        },
        directionalLightColor: {
            type: "fv",
            value: []
        },
        pointLightColor: {
            type: "fv",
            value: []
        },
        pointLightPosition: {
            type: "fv",
            value: []
        },
        pointLightDistance: {
            type: "fv1",
            value: []
        },
        spotLightColor: {
            type: "fv",
            value: []
        },
        spotLightPosition: {
            type: "fv",
            value: []
        },
        spotLightDirection: {
            type: "fv",
            value: []
        },
        spotLightDistance: {
            type: "fv1",
            value: []
        },
        spotLightAngle: {
            type: "fv1",
            value: []
        },
        spotLightExponent: {
            type: "fv1",
            value: []
        }
    },
    particle: {
        psColor: {
            type: "c",
            value: new THREE.Color(15658734)
        },
        opacity: {
            type: "f",
            value: 1
        },
        size: {
            type: "f",
            value: 1
        },
        scale: {
            type: "f",
            value: 1
        },
        map: {
            type: "t",
            value: 0,
            texture: null
        },
        fogDensity: {
            type: "f",
            value: 2.5E-4
        },
        fogNear: {
            type: "f",
            value: 1
        },
        fogFar: {
            type: "f",
            value: 2E3
        },
        fogColor: {
            type: "c",
            value: new THREE.Color(16777215)
        }
    },
    shadowmap: {
        shadowMap: {
            type: "tv",
            value: 6,
            texture: []
        },
        shadowMapSize: {
            type: "v2v",
            value: []
        },
        shadowBias: {
            type: "fv1",
            value: []
        },
        shadowDarkness: {
            type: "fv1",
            value: []
        },
        shadowMatrix: {
            type: "m4v",
            value: []
        }
    }
};
THREE.ShaderLib = {
    depth: {
        uniforms: {
            mNear: {
                type: "f",
                value: 1
            },
            mFar: {
                type: "f",
                value: 2E3
            },
            opacity: {
                type: "f",
                value: 1
            }
        },
        vertexShader: "void main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
        fragmentShader: "uniform float mNear;\nuniform float mFar;\nuniform float opacity;\nvoid main() {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat color = 1.0 - smoothstep( mNear, mFar, depth );\ngl_FragColor = vec4( vec3( color ), opacity );\n}"
    },
    normal: {
        uniforms: {
            opacity: {
                type: "f",
                value: 1
            }
        },
        vertexShader: "varying vec3 vNormal;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvNormal = normalMatrix * normal;\ngl_Position = projectionMatrix * mvPosition;\n}",
        fragmentShader: "uniform float opacity;\nvarying vec3 vNormal;\nvoid main() {\ngl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );\n}"
    },
    basic: {
        uniforms: THREE.UniformsUtils.merge([THREE.UniformsLib.common, THREE.UniformsLib.fog, THREE.UniformsLib.shadowmap]),
        vertexShader: [THREE.ShaderChunk.map_pars_vertex, THREE.ShaderChunk.lightmap_pars_vertex, THREE.ShaderChunk.envmap_pars_vertex, THREE.ShaderChunk.color_pars_vertex, THREE.ShaderChunk.skinning_pars_vertex, THREE.ShaderChunk.morphtarget_pars_vertex, THREE.ShaderChunk.shadowmap_pars_vertex, "void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );", THREE.ShaderChunk.map_vertex, THREE.ShaderChunk.lightmap_vertex, THREE.ShaderChunk.envmap_vertex, THREE.ShaderChunk.color_vertex, THREE.ShaderChunk.skinning_vertex, THREE.ShaderChunk.morphtarget_vertex, THREE.ShaderChunk.default_vertex, THREE.ShaderChunk.shadowmap_vertex, "}"].join("\n"),
        fragmentShader: ["uniform vec3 diffuse;\nuniform float opacity;", THREE.ShaderChunk.color_pars_fragment, THREE.ShaderChunk.map_pars_fragment, THREE.ShaderChunk.lightmap_pars_fragment, THREE.ShaderChunk.envmap_pars_fragment, THREE.ShaderChunk.fog_pars_fragment, THREE.ShaderChunk.shadowmap_pars_fragment, "void main() {\ngl_FragColor = vec4( diffuse, opacity );", THREE.ShaderChunk.map_fragment, THREE.ShaderChunk.alphatest_fragment, THREE.ShaderChunk.lightmap_fragment, THREE.ShaderChunk.color_fragment, THREE.ShaderChunk.envmap_fragment, THREE.ShaderChunk.shadowmap_fragment, THREE.ShaderChunk.linear_to_gamma_fragment, THREE.ShaderChunk.fog_fragment, "}"].join("\n")
    },
    lambert: {
        uniforms: THREE.UniformsUtils.merge([THREE.UniformsLib.common, THREE.UniformsLib.fog, THREE.UniformsLib.lights, THREE.UniformsLib.shadowmap, {
            ambient: {
                type: "c",
                value: new THREE.Color(16777215)
            },
            emissive: {
                type: "c",
                value: new THREE.Color(0)
            },
            wrapRGB: {
                type: "v3",
                value: new THREE.Vector3(1,1,1)
            }
        }]),
        vertexShader: ["varying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\nvarying vec3 vLightBack;\n#endif", THREE.ShaderChunk.map_pars_vertex, THREE.ShaderChunk.lightmap_pars_vertex, THREE.ShaderChunk.envmap_pars_vertex, THREE.ShaderChunk.lights_lambert_pars_vertex, THREE.ShaderChunk.color_pars_vertex, THREE.ShaderChunk.skinning_pars_vertex, THREE.ShaderChunk.morphtarget_pars_vertex, THREE.ShaderChunk.shadowmap_pars_vertex, "void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );", THREE.ShaderChunk.map_vertex, THREE.ShaderChunk.lightmap_vertex, THREE.ShaderChunk.envmap_vertex, THREE.ShaderChunk.color_vertex, THREE.ShaderChunk.morphnormal_vertex, "#ifndef USE_ENVMAP\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\n#endif", THREE.ShaderChunk.lights_lambert_vertex, THREE.ShaderChunk.skinning_vertex, THREE.ShaderChunk.morphtarget_vertex, THREE.ShaderChunk.default_vertex, THREE.ShaderChunk.shadowmap_vertex, "}"].join("\n"),
        fragmentShader: ["uniform float opacity;\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\nvarying vec3 vLightBack;\n#endif", THREE.ShaderChunk.color_pars_fragment, THREE.ShaderChunk.map_pars_fragment, THREE.ShaderChunk.lightmap_pars_fragment, THREE.ShaderChunk.envmap_pars_fragment, THREE.ShaderChunk.fog_pars_fragment, THREE.ShaderChunk.shadowmap_pars_fragment, "void main() {\ngl_FragColor = vec4( vec3 ( 1.0 ), opacity );", THREE.ShaderChunk.map_fragment, THREE.ShaderChunk.alphatest_fragment, "#ifdef DOUBLE_SIDED\nif ( gl_FrontFacing )\ngl_FragColor.xyz *= vLightFront;\nelse\ngl_FragColor.xyz *= vLightBack;\n#else\ngl_FragColor.xyz *= vLightFront;\n#endif", THREE.ShaderChunk.lightmap_fragment, THREE.ShaderChunk.color_fragment, THREE.ShaderChunk.envmap_fragment, THREE.ShaderChunk.shadowmap_fragment, THREE.ShaderChunk.linear_to_gamma_fragment, THREE.ShaderChunk.fog_fragment, "}"].join("\n")
    },
    phong: {
        uniforms: THREE.UniformsUtils.merge([THREE.UniformsLib.common, THREE.UniformsLib.fog, THREE.UniformsLib.lights, THREE.UniformsLib.shadowmap, {
            ambient: {
                type: "c",
                value: new THREE.Color(16777215)
            },
            emissive: {
                type: "c",
                value: new THREE.Color(0)
            },
            specular: {
                type: "c",
                value: new THREE.Color(1118481)
            },
            shininess: {
                type: "f",
                value: 30
            },
            wrapRGB: {
                type: "v3",
                value: new THREE.Vector3(1,1,1)
            }
        }]),
        vertexShader: ["varying vec3 vViewPosition;\nvarying vec3 vNormal;", THREE.ShaderChunk.map_pars_vertex, THREE.ShaderChunk.lightmap_pars_vertex, THREE.ShaderChunk.envmap_pars_vertex, THREE.ShaderChunk.lights_phong_pars_vertex, THREE.ShaderChunk.color_pars_vertex, THREE.ShaderChunk.skinning_pars_vertex, THREE.ShaderChunk.morphtarget_pars_vertex, THREE.ShaderChunk.shadowmap_pars_vertex, "void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );", THREE.ShaderChunk.map_vertex, THREE.ShaderChunk.lightmap_vertex, THREE.ShaderChunk.envmap_vertex, THREE.ShaderChunk.color_vertex, "#ifndef USE_ENVMAP\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\n#endif\nvViewPosition = -mvPosition.xyz;", THREE.ShaderChunk.morphnormal_vertex, "vNormal = transformedNormal;", THREE.ShaderChunk.lights_phong_vertex, THREE.ShaderChunk.skinning_vertex, THREE.ShaderChunk.morphtarget_vertex, THREE.ShaderChunk.default_vertex, THREE.ShaderChunk.shadowmap_vertex, "}"].join("\n"),
        fragmentShader: ["uniform vec3 diffuse;\nuniform float opacity;\nuniform vec3 ambient;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;", THREE.ShaderChunk.color_pars_fragment, THREE.ShaderChunk.map_pars_fragment, THREE.ShaderChunk.lightmap_pars_fragment, THREE.ShaderChunk.envmap_pars_fragment, THREE.ShaderChunk.fog_pars_fragment, THREE.ShaderChunk.lights_phong_pars_fragment, THREE.ShaderChunk.shadowmap_pars_fragment, "void main() {\ngl_FragColor = vec4( vec3 ( 1.0 ), opacity );", THREE.ShaderChunk.map_fragment, THREE.ShaderChunk.alphatest_fragment, THREE.ShaderChunk.lights_phong_fragment, THREE.ShaderChunk.lightmap_fragment, THREE.ShaderChunk.color_fragment, THREE.ShaderChunk.envmap_fragment, THREE.ShaderChunk.shadowmap_fragment, THREE.ShaderChunk.linear_to_gamma_fragment, THREE.ShaderChunk.fog_fragment, "}"].join("\n")
    },
    particle_basic: {
        uniforms: THREE.UniformsUtils.merge([THREE.UniformsLib.particle, THREE.UniformsLib.shadowmap]),
        vertexShader: ["uniform float size;\nuniform float scale;", THREE.ShaderChunk.color_pars_vertex, THREE.ShaderChunk.shadowmap_pars_vertex, "void main() {", THREE.ShaderChunk.color_vertex, "vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n#ifdef USE_SIZEATTENUATION\ngl_PointSize = size * ( scale / length( mvPosition.xyz ) );\n#else\ngl_PointSize = size;\n#endif\ngl_Position = projectionMatrix * mvPosition;", THREE.ShaderChunk.shadowmap_vertex, "}"].join("\n"),
        fragmentShader: ["uniform vec3 psColor;\nuniform float opacity;", THREE.ShaderChunk.color_pars_fragment, THREE.ShaderChunk.map_particle_pars_fragment, THREE.ShaderChunk.fog_pars_fragment, THREE.ShaderChunk.shadowmap_pars_fragment, "void main() {\ngl_FragColor = vec4( psColor, opacity );", THREE.ShaderChunk.map_particle_fragment, THREE.ShaderChunk.alphatest_fragment, THREE.ShaderChunk.color_fragment, THREE.ShaderChunk.shadowmap_fragment, THREE.ShaderChunk.fog_fragment, "}"].join("\n")
    },
    depthRGBA: {
        uniforms: {},
        vertexShader: [THREE.ShaderChunk.morphtarget_pars_vertex, "void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );", THREE.ShaderChunk.morphtarget_vertex, THREE.ShaderChunk.default_vertex, "}"].join("\n"),
        fragmentShader: "vec4 pack_depth( const in float depth ) {\nconst vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );\nconst vec4 bit_mask  = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );\nvec4 res = fract( depth * bit_shift );\nres -= res.xxyz * bit_mask;\nreturn res;\n}\nvoid main() {\ngl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );\n}"
    }
};
THREE.WebGLRenderer = function(a) {
    function b(a, b) {
        var c = a.vertices.length
          , d = b.material;
        if (d.attributes) {
            void 0 === a.__webglCustomAttributesList && (a.__webglCustomAttributesList = []);
            for (var e in d.attributes) {
                var f = d.attributes[e];
                if (!f.__webglInitialized || f.createUniqueBuffers) {
                    f.__webglInitialized = !0;
                    var g = 1;
                    "v2" === f.type ? g = 2 : "v3" === f.type ? g = 3 : "v4" === f.type ? g = 4 : "c" === f.type && (g = 3);
                    f.size = g;
                    f.array = new Float32Array(c * g);
                    f.buffer = l.createBuffer();
                    f.buffer.belongsToAttribute = e;
                    f.needsUpdate = !0
                }
                a.__webglCustomAttributesList.push(f)
            }
        }
    }
    function c(a, b) {
        if (a.material && !(a.material instanceof THREE.MeshFaceMaterial))
            return a.material;
        if (0 <= b.materialIndex)
            return a.geometry.materials[b.materialIndex]
    }
    function d(a) {
        return a instanceof THREE.MeshBasicMaterial && !a.envMap || a instanceof THREE.MeshDepthMaterial ? !1 : a && void 0 !== a.shading && a.shading === THREE.SmoothShading ? THREE.SmoothShading : THREE.FlatShading
    }
    function e(a) {
        return a.map || a.lightMap || a instanceof THREE.ShaderMaterial ? !0 : !1
    }
    function f(a, b, c) {
        var d, e, f, g, h = a.vertices;
        g = h.length;
        var i = a.colors
          , j = i.length
          , k = a.__vertexArray
          , n = a.__colorArray
          , m = a.__sortArray
          , o = a.verticesNeedUpdate
          , p = a.colorsNeedUpdate
          , q = a.__webglCustomAttributesList;
        if (c.sortParticles) {
            Ba.copy(ta);
            Ba.multiplySelf(c.matrixWorld);
            for (d = 0; d < g; d++)
                e = h[d],
                bb.copy(e),
                Ba.multiplyVector3(bb),
                m[d] = [bb.z, d];
            m.sort(function(a, b) {
                return b[0] - a[0]
            });
            for (d = 0; d < g; d++)
                e = h[m[d][1]],
                f = 3 * d,
                k[f] = e.x,
                k[f + 1] = e.y,
                k[f + 2] = e.z;
            for (d = 0; d < j; d++)
                f = 3 * d,
                e = i[m[d][1]],
                n[f] = e.r,
                n[f + 1] = e.g,
                n[f + 2] = e.b;
            if (q) {
                i = 0;
                for (j = q.length; i < j; i++)
                    if (h = q[i],
                    void 0 === h.boundTo || "vertices" === h.boundTo)
                        if (f = 0,
                        e = h.value.length,
                        1 === h.size)
                            for (d = 0; d < e; d++)
                                g = m[d][1],
                                h.array[d] = h.value[g];
                        else if (2 === h.size)
                            for (d = 0; d < e; d++)
                                g = m[d][1],
                                g = h.value[g],
                                h.array[f] = g.x,
                                h.array[f + 1] = g.y,
                                f += 2;
                        else if (3 === h.size)
                            if ("c" === h.type)
                                for (d = 0; d < e; d++)
                                    g = m[d][1],
                                    g = h.value[g],
                                    h.array[f] = g.r,
                                    h.array[f + 1] = g.g,
                                    h.array[f + 2] = g.b,
                                    f += 3;
                            else
                                for (d = 0; d < e; d++)
                                    g = m[d][1],
                                    g = h.value[g],
                                    h.array[f] = g.x,
                                    h.array[f + 1] = g.y,
                                    h.array[f + 2] = g.z,
                                    f += 3;
                        else if (4 === h.size)
                            for (d = 0; d < e; d++)
                                g = m[d][1],
                                g = h.value[g],
                                h.array[f] = g.x,
                                h.array[f + 1] = g.y,
                                h.array[f + 2] = g.z,
                                h.array[f + 3] = g.w,
                                f += 4
            }
        } else {
            if (o)
                for (d = 0; d < g; d++)
                    e = h[d],
                    f = 3 * d,
                    k[f] = e.x,
                    k[f + 1] = e.y,
                    k[f + 2] = e.z;
            if (p)
                for (d = 0; d < j; d++)
                    e = i[d],
                    f = 3 * d,
                    n[f] = e.r,
                    n[f + 1] = e.g,
                    n[f + 2] = e.b;
            if (q) {
                i = 0;
                for (j = q.length; i < j; i++)
                    if (h = q[i],
                    h.needsUpdate && (void 0 === h.boundTo || "vertices" === h.boundTo))
                        if (e = h.value.length,
                        f = 0,
                        1 === h.size)
                            for (d = 0; d < e; d++)
                                h.array[d] = h.value[d];
                        else if (2 === h.size)
                            for (d = 0; d < e; d++)
                                g = h.value[d],
                                h.array[f] = g.x,
                                h.array[f + 1] = g.y,
                                f += 2;
                        else if (3 === h.size)
                            if ("c" === h.type)
                                for (d = 0; d < e; d++)
                                    g = h.value[d],
                                    h.array[f] = g.r,
                                    h.array[f + 1] = g.g,
                                    h.array[f + 2] = g.b,
                                    f += 3;
                            else
                                for (d = 0; d < e; d++)
                                    g = h.value[d],
                                    h.array[f] = g.x,
                                    h.array[f + 1] = g.y,
                                    h.array[f + 2] = g.z,
                                    f += 3;
                        else if (4 === h.size)
                            for (d = 0; d < e; d++)
                                g = h.value[d],
                                h.array[f] = g.x,
                                h.array[f + 1] = g.y,
                                h.array[f + 2] = g.z,
                                h.array[f + 3] = g.w,
                                f += 4
            }
        }
        if (o || c.sortParticles)
            l.bindBuffer(l.ARRAY_BUFFER, a.__webglVertexBuffer),
            l.bufferData(l.ARRAY_BUFFER, k, b);
        if (p || c.sortParticles)
            l.bindBuffer(l.ARRAY_BUFFER, a.__webglColorBuffer),
            l.bufferData(l.ARRAY_BUFFER, n, b);
        if (q) {
            i = 0;
            for (j = q.length; i < j; i++)
                if (h = q[i],
                h.needsUpdate || c.sortParticles)
                    l.bindBuffer(l.ARRAY_BUFFER, h.buffer),
                    l.bufferData(l.ARRAY_BUFFER, h.array, b)
        }
    }
    function g(a, b) {
        return b.z - a.z
    }
    function h(a, b, c) {
        if (a.length)
            for (var d = 0, e = a.length; d < e; d++)
                ea = D = null,
                T = M = U = ha = La = Ha = X = -1,
                Ta = !0,
                a[d].render(b, c, Ab, Vb),
                ea = D = null,
                T = M = U = ha = La = Ha = X = -1,
                Ta = !0
    }
    function i(a, b, c, d, e, f, g, h) {
        var i, j, k, l;
        b ? (j = a.length - 1,
        l = b = -1) : (j = 0,
        b = a.length,
        l = 1);
        for (var n = j; n !== b; n += l)
            if (i = a[n],
            i.render) {
                j = i.object;
                k = i.buffer;
                if (h)
                    i = h;
                else {
                    i = i[c];
                    if (!i)
                        continue;
                    g && F.setBlending(i.blending, i.blendEquation, i.blendSrc, i.blendDst);
                    F.setDepthTest(i.depthTest);
                    F.setDepthWrite(i.depthWrite);
                    t(i.polygonOffset, i.polygonOffsetFactor, i.polygonOffsetUnits)
                }
                F.setObjectFaces(j);
                k instanceof THREE.BufferGeometry ? F.renderBufferDirect(d, e, f, i, k, j) : F.renderBuffer(d, e, f, i, k, j)
            }
    }
    function j(a, b, c, d, e, f, g) {
        for (var h, i, j = 0, k = a.length; j < k; j++)
            if (h = a[j],
            i = h.object,
            i.visible) {
                if (g)
                    h = g;
                else {
                    h = h[b];
                    if (!h)
                        continue;
                    f && F.setBlending(h.blending, h.blendEquation, h.blendSrc, h.blendDst);
                    F.setDepthTest(h.depthTest);
                    F.setDepthWrite(h.depthWrite);
                    t(h.polygonOffset, h.polygonOffsetFactor, h.polygonOffsetUnits)
                }
                F.renderImmediateObject(c, d, e, h, i)
            }
    }
    function k(a, b, c) {
        a.push({
            buffer: b,
            object: c,
            opaque: null,
            transparent: null
        })
    }
    function n(a) {
        for (var b in a.attributes)
            if (a.attributes[b].needsUpdate)
                return !0;
        return !1
    }
    function p(a) {
        for (var b in a.attributes)
            a.attributes[b].needsUpdate = !1
    }
    function o(a, b) {
        for (var c = a.length - 1; 0 <= c; c--)
            a[c].object === b && a.splice(c, 1)
    }
    function r(a, b) {
        for (var c = a.length - 1; 0 <= c; c--)
            a[c] === b && a.splice(c, 1)
    }
    function q(a, b, c, d, e) {
        if (!d.program || d.needsUpdate)
            F.initMaterial(d, b, c, e),
            d.needsUpdate = !1;
        if (d.morphTargets && !e.__webglMorphTargetInfluences) {
            e.__webglMorphTargetInfluences = new Float32Array(F.maxMorphTargets);
            for (var f = 0, g = F.maxMorphTargets; f < g; f++)
                e.__webglMorphTargetInfluences[f] = 0
        }
        var h = !1
          , f = d.program
          , g = f.uniforms
          , i = d.uniforms;
        f !== D && (l.useProgram(f),
        D = f,
        h = !0);
        d.id !== T && (T = d.id,
        h = !0);
        if (h || a !== ea)
            l.uniformMatrix4fv(g.projectionMatrix, !1, a._projectionMatrixArray),
            a !== ea && (ea = a);
        if (h) {
            c && d.fog && (i.fogColor.value = c.color,
            c instanceof THREE.Fog ? (i.fogNear.value = c.near,
            i.fogFar.value = c.far) : c instanceof THREE.FogExp2 && (i.fogDensity.value = c.density));
            if (d instanceof THREE.MeshPhongMaterial || d instanceof THREE.MeshLambertMaterial || d.lights) {
                if (Ta) {
                    for (var j, k = 0, n = 0, m = 0, o, p, q, r = Ra, s = r.directional.colors, w = r.directional.positions, t = r.point.colors, u = r.point.positions, v = r.point.distances, B = r.spot.colors, Q = r.spot.positions, A = r.spot.distances, y = r.spot.directions, H = r.spot.angles, C = r.spot.exponents, M = 0, L = 0, J = 0, I = 0, c = 0, h = b.length; c < h; c++)
                        j = b[c],
                        j.onlyShadow || (o = j.color,
                        p = j.intensity,
                        q = j.distance,
                        j instanceof THREE.AmbientLight ? F.gammaInput ? (k += o.r * o.r,
                        n += o.g * o.g,
                        m += o.b * o.b) : (k += o.r,
                        n += o.g,
                        m += o.b) : j instanceof THREE.DirectionalLight ? (q = 3 * M,
                        F.gammaInput ? (s[q] = o.r * o.r * p * p,
                        s[q + 1] = o.g * o.g * p * p,
                        s[q + 2] = o.b * o.b * p * p) : (s[q] = o.r * p,
                        s[q + 1] = o.g * p,
                        s[q + 2] = o.b * p),
                        da.copy(j.matrixWorld.getPosition()),
                        da.subSelf(j.target.matrixWorld.getPosition()),
                        da.normalize(),
                        w[q] = da.x,
                        w[q + 1] = da.y,
                        w[q + 2] = da.z,
                        M += 1) : j instanceof THREE.PointLight ? (I = 3 * L,
                        F.gammaInput ? (t[I] = o.r * o.r * p * p,
                        t[I + 1] = o.g * o.g * p * p,
                        t[I + 2] = o.b * o.b * p * p) : (t[I] = o.r * p,
                        t[I + 1] = o.g * p,
                        t[I + 2] = o.b * p),
                        o = j.matrixWorld.getPosition(),
                        u[I] = o.x,
                        u[I + 1] = o.y,
                        u[I + 2] = o.z,
                        v[L] = q,
                        L += 1) : j instanceof THREE.SpotLight && (I = 3 * J,
                        F.gammaInput ? (B[I] = o.r * o.r * p * p,
                        B[I + 1] = o.g * o.g * p * p,
                        B[I + 2] = o.b * o.b * p * p) : (B[I] = o.r * p,
                        B[I + 1] = o.g * p,
                        B[I + 2] = o.b * p),
                        o = j.matrixWorld.getPosition(),
                        Q[I] = o.x,
                        Q[I + 1] = o.y,
                        Q[I + 2] = o.z,
                        A[J] = q,
                        da.copy(o),
                        da.subSelf(j.target.matrixWorld.getPosition()),
                        da.normalize(),
                        y[I] = da.x,
                        y[I + 1] = da.y,
                        y[I + 2] = da.z,
                        H[J] = Math.cos(j.angle),
                        C[J] = j.exponent,
                        J += 1));
                    c = 3 * M;
                    for (h = s.length; c < h; c++)
                        s[c] = 0;
                    c = 3 * L;
                    for (h = t.length; c < h; c++)
                        t[c] = 0;
                    c = 3 * J;
                    for (h = B.length; c < h; c++)
                        B[c] = 0;
                    r.directional.length = M;
                    r.point.length = L;
                    r.spot.length = J;
                    r.ambient[0] = k;
                    r.ambient[1] = n;
                    r.ambient[2] = m;
                    Ta = !1
                }
                c = Ra;
                i.ambientLightColor.value = c.ambient;
                i.directionalLightColor.value = c.directional.colors;
                i.directionalLightDirection.value = c.directional.positions;
                i.pointLightColor.value = c.point.colors;
                i.pointLightPosition.value = c.point.positions;
                i.pointLightDistance.value = c.point.distances;
                i.spotLightColor.value = c.spot.colors;
                i.spotLightPosition.value = c.spot.positions;
                i.spotLightDistance.value = c.spot.distances;
                i.spotLightDirection.value = c.spot.directions;
                i.spotLightAngle.value = c.spot.angles;
                i.spotLightExponent.value = c.spot.exponents
            }
            if (d instanceof THREE.MeshBasicMaterial || d instanceof THREE.MeshLambertMaterial || d instanceof THREE.MeshPhongMaterial)
                i.opacity.value = d.opacity,
                F.gammaInput ? i.diffuse.value.copyGammaToLinear(d.color) : i.diffuse.value = d.color,
                (i.map.texture = d.map) && i.offsetRepeat.value.set(d.map.offset.x, d.map.offset.y, d.map.repeat.x, d.map.repeat.y),
                i.lightMap.texture = d.lightMap,
                i.envMap.texture = d.envMap,
                i.flipEnvMap.value = d.envMap instanceof THREE.WebGLRenderTargetCube ? 1 : -1,
                i.reflectivity.value = d.reflectivity,
                i.refractionRatio.value = d.refractionRatio,
                i.combine.value = d.combine,
                i.useRefract.value = d.envMap && d.envMap.mapping instanceof THREE.CubeRefractionMapping;
            d instanceof THREE.LineBasicMaterial ? (i.diffuse.value = d.color,
            i.opacity.value = d.opacity) : d instanceof THREE.ParticleBasicMaterial ? (i.psColor.value = d.color,
            i.opacity.value = d.opacity,
            i.size.value = d.size,
            i.scale.value = z.height / 2,
            i.map.texture = d.map) : d instanceof THREE.MeshPhongMaterial ? (i.shininess.value = d.shininess,
            F.gammaInput ? (i.ambient.value.copyGammaToLinear(d.ambient),
            i.emissive.value.copyGammaToLinear(d.emissive),
            i.specular.value.copyGammaToLinear(d.specular)) : (i.ambient.value = d.ambient,
            i.emissive.value = d.emissive,
            i.specular.value = d.specular),
            d.wrapAround && i.wrapRGB.value.copy(d.wrapRGB)) : d instanceof THREE.MeshLambertMaterial ? (F.gammaInput ? (i.ambient.value.copyGammaToLinear(d.ambient),
            i.emissive.value.copyGammaToLinear(d.emissive)) : (i.ambient.value = d.ambient,
            i.emissive.value = d.emissive),
            d.wrapAround && i.wrapRGB.value.copy(d.wrapRGB)) : d instanceof THREE.MeshDepthMaterial ? (i.mNear.value = a.near,
            i.mFar.value = a.far,
            i.opacity.value = d.opacity) : d instanceof THREE.MeshNormalMaterial && (i.opacity.value = d.opacity);
            if (e.receiveShadow && !d._shadowPass && i.shadowMatrix) {
                h = c = 0;
                for (j = b.length; h < j; h++)
                    if (k = b[h],
                    k.castShadow && (k instanceof THREE.SpotLight || k instanceof THREE.DirectionalLight && !k.shadowCascade))
                        i.shadowMap.texture[c] = k.shadowMap,
                        i.shadowMapSize.value[c] = k.shadowMapSize,
                        i.shadowMatrix.value[c] = k.shadowMatrix,
                        i.shadowDarkness.value[c] = k.shadowDarkness,
                        i.shadowBias.value[c] = k.shadowBias,
                        c++
            }
            b = d.uniformsList;
            i = 0;
            for (c = b.length; i < c; i++)
                if (k = f.uniforms[b[i][1]])
                    switch (h = b[i][0],
                    n = h.type,
                    j = h.value,
                    n) {
                    case "i":
                        l.uniform1i(k, j);
                        break;
                    case "f":
                        l.uniform1f(k, j);
                        break;
                    case "v2":
                        l.uniform2f(k, j.x, j.y);
                        break;
                    case "v3":
                        l.uniform3f(k, j.x, j.y, j.z);
                        break;
                    case "v4":
                        l.uniform4f(k, j.x, j.y, j.z, j.w);
                        break;
                    case "c":
                        l.uniform3f(k, j.r, j.g, j.b);
                        break;
                    case "fv1":
                        l.uniform1fv(k, j);
                        break;
                    case "fv":
                        l.uniform3fv(k, j);
                        break;
                    case "v2v":
                        h._array || (h._array = new Float32Array(2 * j.length));
                        n = 0;
                        for (m = j.length; n < m; n++)
                            r = 2 * n,
                            h._array[r] = j[n].x,
                            h._array[r + 1] = j[n].y;
                        l.uniform2fv(k, h._array);
                        break;
                    case "v3v":
                        h._array || (h._array = new Float32Array(3 * j.length));
                        n = 0;
                        for (m = j.length; n < m; n++)
                            r = 3 * n,
                            h._array[r] = j[n].x,
                            h._array[r + 1] = j[n].y,
                            h._array[r + 2] = j[n].z;
                        l.uniform3fv(k, h._array);
                        break;
                    case "v4v":
                        h._array || (h._array = new Float32Array(4 * j.length));
                        n = 0;
                        for (m = j.length; n < m; n++)
                            r = 4 * n,
                            h._array[r] = j[n].x,
                            h._array[r + 1] = j[n].y,
                            h._array[r + 2] = j[n].z,
                            h._array[r + 3] = j[n].w;
                        l.uniform4fv(k, h._array);
                        break;
                    case "m4":
                        h._array || (h._array = new Float32Array(16));
                        j.flattenToArray(h._array);
                        l.uniformMatrix4fv(k, !1, h._array);
                        break;
                    case "m4v":
                        h._array || (h._array = new Float32Array(16 * j.length));
                        n = 0;
                        for (m = j.length; n < m; n++)
                            j[n].flattenToArrayOffset(h._array, 16 * n);
                        l.uniformMatrix4fv(k, !1, h._array);
                        break;
                    case "t":
                        l.uniform1i(k, j);
                        k = h.texture;
                        if (!k)
                            continue;
                        if (k.image instanceof Array && 6 === k.image.length) {
                            if (h = k,
                            6 === h.image.length)
                                if (h.needsUpdate) {
                                    h.image.__webglTextureCube || (h.image.__webglTextureCube = l.createTexture());
                                    l.activeTexture(l.TEXTURE0 + j);
                                    l.bindTexture(l.TEXTURE_CUBE_MAP, h.image.__webglTextureCube);
                                    j = [];
                                    for (k = 0; 6 > k; k++)
                                        n = j,
                                        m = k,
                                        F.autoScaleCubemaps ? (r = h.image[k],
                                        w = kb,
                                        r.width <= w && r.height <= w || (t = Math.max(r.width, r.height),
                                        s = Math.floor(r.width * w / t),
                                        w = Math.floor(r.height * w / t),
                                        t = document.createElement("canvas"),
                                        t.width = s,
                                        t.height = w,
                                        t.getContext("2d").drawImage(r, 0, 0, r.width, r.height, 0, 0, s, w),
                                        r = t)) : r = h.image[k],
                                        n[m] = r;
                                    k = j[0];
                                    n = 0 === (k.width & k.width - 1) && 0 === (k.height & k.height - 1);
                                    m = E(h.format);
                                    r = E(h.type);
                                    x(l.TEXTURE_CUBE_MAP, h, n);
                                    for (k = 0; 6 > k; k++)
                                        l.texImage2D(l.TEXTURE_CUBE_MAP_POSITIVE_X + k, 0, m, m, r, j[k]);
                                    h.generateMipmaps && n && l.generateMipmap(l.TEXTURE_CUBE_MAP);
                                    h.needsUpdate = !1;
                                    if (h.onUpdate)
                                        h.onUpdate()
                                } else
                                    l.activeTexture(l.TEXTURE0 + j),
                                    l.bindTexture(l.TEXTURE_CUBE_MAP, h.image.__webglTextureCube)
                        } else
                            k instanceof THREE.WebGLRenderTargetCube ? (h = k,
                            l.activeTexture(l.TEXTURE0 + j),
                            l.bindTexture(l.TEXTURE_CUBE_MAP, h.__webglTexture)) : F.setTexture(k, j);
                        break;
                    case "tv":
                        if (!h._array) {
                            h._array = [];
                            n = 0;
                            for (m = h.texture.length; n < m; n++)
                                h._array[n] = j + n
                        }
                        l.uniform1iv(k, h._array);
                        n = 0;
                        for (m = h.texture.length; n < m; n++)
                            (k = h.texture[n]) && F.setTexture(k, h._array[n])
                    }
            if ((d instanceof THREE.ShaderMaterial || d instanceof THREE.MeshPhongMaterial || d.envMap) && null !== g.cameraPosition)
                b = a.matrixWorld.getPosition(),
                l.uniform3f(g.cameraPosition, b.x, b.y, b.z);
            (d instanceof THREE.MeshPhongMaterial || d instanceof THREE.MeshLambertMaterial || d instanceof THREE.ShaderMaterial || d.skinning) && null !== g.viewMatrix && l.uniformMatrix4fv(g.viewMatrix, !1, a._viewMatrixArray);
            d.skinning && l.uniformMatrix4fv(g.boneGlobalMatrices, !1, e.boneMatrices)
        }
        l.uniformMatrix4fv(g.modelViewMatrix, !1, e._modelViewMatrix.elements);
        g.normalMatrix && l.uniformMatrix3fv(g.normalMatrix, !1, e._normalMatrix.elements);
        null !== g.objectMatrix && l.uniformMatrix4fv(g.objectMatrix, !1, e.matrixWorld.elements);
        return f
    }
    function s(a, b) {
        a._modelViewMatrix.multiply(b.matrixWorldInverse, a.matrixWorld);
        a._normalMatrix.getInverse(a._modelViewMatrix);
        a._normalMatrix.transpose()
    }
    function t(a, b, c) {
        Ga !== a && (a ? l.enable(l.POLYGON_OFFSET_FILL) : l.disable(l.POLYGON_OFFSET_FILL),
        Ga = a);
        if (a && (Pa !== b || Ua !== c))
            l.polygonOffset(b, c),
            Pa = b,
            Ua = c
    }
    function v(a, b) {
        var c;
        "fragment" === a ? c = l.createShader(l.FRAGMENT_SHADER) : "vertex" === a && (c = l.createShader(l.VERTEX_SHADER));
        l.shaderSource(c, b);
        l.compileShader(c);
        return !l.getShaderParameter(c, l.COMPILE_STATUS) ? (console.error(l.getShaderInfoLog(c)),
        console.error(b),
        null) : c
    }
    function x(a, b, c) {
        c ? (l.texParameteri(a, l.TEXTURE_WRAP_S, E(b.wrapS)),
        l.texParameteri(a, l.TEXTURE_WRAP_T, E(b.wrapT)),
        l.texParameteri(a, l.TEXTURE_MAG_FILTER, E(b.magFilter)),
        l.texParameteri(a, l.TEXTURE_MIN_FILTER, E(b.minFilter))) : (l.texParameteri(a, l.TEXTURE_WRAP_S, l.CLAMP_TO_EDGE),
        l.texParameteri(a, l.TEXTURE_WRAP_T, l.CLAMP_TO_EDGE),
        l.texParameteri(a, l.TEXTURE_MAG_FILTER, y(b.magFilter)),
        l.texParameteri(a, l.TEXTURE_MIN_FILTER, y(b.minFilter)))
    }
    function u(a, b) {
        l.bindRenderbuffer(l.RENDERBUFFER, a);
        b.depthBuffer && !b.stencilBuffer ? (l.renderbufferStorage(l.RENDERBUFFER, l.DEPTH_COMPONENT16, b.width, b.height),
        l.framebufferRenderbuffer(l.FRAMEBUFFER, l.DEPTH_ATTACHMENT, l.RENDERBUFFER, a)) : b.depthBuffer && b.stencilBuffer ? (l.renderbufferStorage(l.RENDERBUFFER, l.DEPTH_STENCIL, b.width, b.height),
        l.framebufferRenderbuffer(l.FRAMEBUFFER, l.DEPTH_STENCIL_ATTACHMENT, l.RENDERBUFFER, a)) : l.renderbufferStorage(l.RENDERBUFFER, l.RGBA4, b.width, b.height)
    }
    function y(a) {
        switch (a) {
        case THREE.NearestFilter:
        case THREE.NearestMipMapNearestFilter:
        case THREE.NearestMipMapLinearFilter:
            return l.NEAREST;
        default:
            return l.LINEAR
        }
    }
    function E(a) {
        switch (a) {
        case THREE.RepeatWrapping:
            return l.REPEAT;
        case THREE.ClampToEdgeWrapping:
            return l.CLAMP_TO_EDGE;
        case THREE.MirroredRepeatWrapping:
            return l.MIRRORED_REPEAT;
        case THREE.NearestFilter:
            return l.NEAREST;
        case THREE.NearestMipMapNearestFilter:
            return l.NEAREST_MIPMAP_NEAREST;
        case THREE.NearestMipMapLinearFilter:
            return l.NEAREST_MIPMAP_LINEAR;
        case THREE.LinearFilter:
            return l.LINEAR;
        case THREE.LinearMipMapNearestFilter:
            return l.LINEAR_MIPMAP_NEAREST;
        case THREE.LinearMipMapLinearFilter:
            return l.LINEAR_MIPMAP_LINEAR;
        case THREE.ByteType:
            return l.BYTE;
        case THREE.UnsignedByteType:
            return l.UNSIGNED_BYTE;
        case THREE.ShortType:
            return l.SHORT;
        case THREE.UnsignedShortType:
            return l.UNSIGNED_SHORT;
        case THREE.IntType:
            return l.INT;
        case THREE.UnsignedIntType:
            return l.UNSIGNED_INT;
        case THREE.FloatType:
            return l.FLOAT;
        case THREE.AlphaFormat:
            return l.ALPHA;
        case THREE.RGBFormat:
            return l.RGB;
        case THREE.RGBAFormat:
            return l.RGBA;
        case THREE.LuminanceFormat:
            return l.LUMINANCE;
        case THREE.LuminanceAlphaFormat:
            return l.LUMINANCE_ALPHA;
        case THREE.AddEquation:
            return l.FUNC_ADD;
        case THREE.SubtractEquation:
            return l.FUNC_SUBTRACT;
        case THREE.ReverseSubtractEquation:
            return l.FUNC_REVERSE_SUBTRACT;
        case THREE.ZeroFactor:
            return l.ZERO;
        case THREE.OneFactor:
            return l.ONE;
        case THREE.SrcColorFactor:
            return l.SRC_COLOR;
        case THREE.OneMinusSrcColorFactor:
            return l.ONE_MINUS_SRC_COLOR;
        case THREE.SrcAlphaFactor:
            return l.SRC_ALPHA;
        case THREE.OneMinusSrcAlphaFactor:
            return l.ONE_MINUS_SRC_ALPHA;
        case THREE.DstAlphaFactor:
            return l.DST_ALPHA;
        case THREE.OneMinusDstAlphaFactor:
            return l.ONE_MINUS_DST_ALPHA;
        case THREE.DstColorFactor:
            return l.DST_COLOR;
        case THREE.OneMinusDstColorFactor:
            return l.ONE_MINUS_DST_COLOR;
        case THREE.SrcAlphaSaturateFactor:
            return l.SRC_ALPHA_SATURATE
        }
        return 0
    }
    console.log("THREE.WebGLRenderer", THREE.REVISION);
    var a = a || {}
      , z = void 0 !== a.canvas ? a.canvas : document.createElement("canvas")
      , C = void 0 !== a.precision ? a.precision : "highp"
      , w = void 0 !== a.alpha ? a.alpha : !0
      , H = void 0 !== a.premultipliedAlpha ? a.premultipliedAlpha : !0
      , L = void 0 !== a.antialias ? a.antialias : !1
      , I = void 0 !== a.stencil ? a.stencil : !0
      , P = void 0 !== a.preserveDrawingBuffer ? a.preserveDrawingBuffer : !1
      , N = void 0 !== a.clearColor ? new THREE.Color(a.clearColor) : new THREE.Color(0)
      , A = void 0 !== a.clearAlpha ? a.clearAlpha : 0
      , J = void 0 !== a.maxLights ? a.maxLights : 4;
    this.domElement = z;
    this.context = null;
    this.autoUpdateScene = this.autoUpdateObjects = this.sortObjects = this.autoClearStencil = this.autoClearDepth = this.autoClearColor = this.autoClear = !0;
    this.shadowMapEnabled = this.physicallyBasedShading = this.gammaOutput = this.gammaInput = !1;
    this.shadowMapCullFrontFaces = this.shadowMapSoft = this.shadowMapAutoUpdate = !0;
    this.shadowMapCascade = this.shadowMapDebug = !1;
    this.maxMorphTargets = 8;
    this.maxMorphNormals = 4;
    this.autoScaleCubemaps = !0;
    this.renderPluginsPre = [];
    this.renderPluginsPost = [];
    this.info = {
        memory: {
            programs: 0,
            geometries: 0,
            textures: 0
        },
        render: {
            calls: 0,
            vertices: 0,
            faces: 0,
            points: 0
        }
    };
    var F = this, l, Q = [], D = null, B = null, T = -1, M = null, ea = null, ca = 0, ha = -1, U = -1, X = -1, aa = -1, ba = -1, m = -1, Ha = -1, La = -1, Ga = null, Pa = null, Ua = null, Qa = null, Kb = 0, xb = 0, ob = 0, Lb = 0, Ab = 0, Vb = 0, Va = new THREE.Frustum, ta = new THREE.Matrix4, Ba = new THREE.Matrix4, bb = new THREE.Vector4, da = new THREE.Vector3, Ta = !0, Ra = {
        ambient: [0, 0, 0],
        directional: {
            length: 0,
            colors: [],
            positions: []
        },
        point: {
            length: 0,
            colors: [],
            positions: [],
            distances: []
        },
        spot: {
            length: 0,
            colors: [],
            positions: [],
            distances: [],
            directions: [],
            angles: [],
            exponents: []
        }
    };
    l = function() {
        var a;
        try {
            if (!(a = z.getContext("experimental-webgl", {
                alpha: w,
                premultipliedAlpha: H,
                antialias: L,
                stencil: I,
                preserveDrawingBuffer: P
            })))
                throw "Error creating WebGL context.";
        } catch (b) {
            console.error(b)
        }
        a.getExtension("OES_texture_float") || console.log("THREE.WebGLRenderer: Float textures not supported.");
        return a
    }();
    l.clearColor(0, 0, 0, 1);
    l.clearDepth(1);
    l.clearStencil(0);
    l.enable(l.DEPTH_TEST);
    l.depthFunc(l.LEQUAL);
    l.frontFace(l.CCW);
    l.cullFace(l.BACK);
    l.enable(l.CULL_FACE);
    l.enable(l.BLEND);
    l.blendEquation(l.FUNC_ADD);
    l.blendFunc(l.SRC_ALPHA, l.ONE_MINUS_SRC_ALPHA);
    l.clearColor(N.r, N.g, N.b, A);
    this.context = l;
    var ra = l.getParameter(l.MAX_VERTEX_TEXTURE_IMAGE_UNITS);
    l.getParameter(l.MAX_TEXTURE_SIZE);
    var kb = l.getParameter(l.MAX_CUBE_MAP_TEXTURE_SIZE);
    this.getContext = function() {
        return l
    }
    ;
    this.supportsVertexTextures = function() {
        return 0 < ra
    }
    ;
    this.setSize = function(a, b) {
        z.width = a;
        z.height = b;
        this.setViewport(0, 0, z.width, z.height)
    }
    ;
    this.setViewport = function(a, b, c, d) {
        Kb = a;
        xb = b;
        ob = c;
        Lb = d;
        l.viewport(Kb, xb, ob, Lb)
    }
    ;
    this.setScissor = function(a, b, c, d) {
        l.scissor(a, b, c, d)
    }
    ;
    this.enableScissorTest = function(a) {
        a ? l.enable(l.SCISSOR_TEST) : l.disable(l.SCISSOR_TEST)
    }
    ;
    this.setClearColorHex = function(a, b) {
        N.setHex(a);
        A = b;
        l.clearColor(N.r, N.g, N.b, A)
    }
    ;
    this.setClearColor = function(a, b) {
        N.copy(a);
        A = b;
        l.clearColor(N.r, N.g, N.b, A)
    }
    ;
    this.getClearColor = function() {
        return N
    }
    ;
    this.getClearAlpha = function() {
        return A
    }
    ;
    this.clear = function(a, b, c) {
        var d = 0;
        if (void 0 === a || a)
            d |= l.COLOR_BUFFER_BIT;
        if (void 0 === b || b)
            d |= l.DEPTH_BUFFER_BIT;
        if (void 0 === c || c)
            d |= l.STENCIL_BUFFER_BIT;
        l.clear(d)
    }
    ;
    this.clearTarget = function(a, b, c, d) {
        this.setRenderTarget(a);
        this.clear(b, c, d)
    }
    ;
    this.addPostPlugin = function(a) {
        a.init(this);
        this.renderPluginsPost.push(a)
    }
    ;
    this.addPrePlugin = function(a) {
        a.init(this);
        this.renderPluginsPre.push(a)
    }
    ;
    this.deallocateObject = function(a) {
        if (a.__webglInit)
            if (a.__webglInit = !1,
            delete a._modelViewMatrix,
            delete a._normalMatrix,
            delete a._normalMatrixArray,
            delete a._modelViewMatrixArray,
            delete a._objectMatrixArray,
            a instanceof THREE.Mesh)
                for (var b in a.geometry.geometryGroups) {
                    var c = a.geometry.geometryGroups[b];
                    l.deleteBuffer(c.__webglVertexBuffer);
                    l.deleteBuffer(c.__webglNormalBuffer);
                    l.deleteBuffer(c.__webglTangentBuffer);
                    l.deleteBuffer(c.__webglColorBuffer);
                    l.deleteBuffer(c.__webglUVBuffer);
                    l.deleteBuffer(c.__webglUV2Buffer);
                    l.deleteBuffer(c.__webglSkinVertexABuffer);
                    l.deleteBuffer(c.__webglSkinVertexBBuffer);
                    l.deleteBuffer(c.__webglSkinIndicesBuffer);
                    l.deleteBuffer(c.__webglSkinWeightsBuffer);
                    l.deleteBuffer(c.__webglFaceBuffer);
                    l.deleteBuffer(c.__webglLineBuffer);
                    var d = void 0
                      , e = void 0;
                    if (c.numMorphTargets) {
                        d = 0;
                        for (e = c.numMorphTargets; d < e; d++)
                            l.deleteBuffer(c.__webglMorphTargetsBuffers[d])
                    }
                    if (c.numMorphNormals) {
                        d = 0;
                        for (e = c.numMorphNormals; d < e; d++)
                            l.deleteBuffer(c.__webglMorphNormalsBuffers[d])
                    }
                    if (c.__webglCustomAttributesList)
                        for (d in d = void 0,
                        c.__webglCustomAttributesList)
                            l.deleteBuffer(c.__webglCustomAttributesList[d].buffer);
                    F.info.memory.geometries--
                }
            else
                a instanceof THREE.Ribbon ? (a = a.geometry,
                l.deleteBuffer(a.__webglVertexBuffer),
                l.deleteBuffer(a.__webglColorBuffer),
                F.info.memory.geometries--) : a instanceof THREE.Line ? (a = a.geometry,
                l.deleteBuffer(a.__webglVertexBuffer),
                l.deleteBuffer(a.__webglColorBuffer),
                F.info.memory.geometries--) : a instanceof THREE.ParticleSystem && (a = a.geometry,
                l.deleteBuffer(a.__webglVertexBuffer),
                l.deleteBuffer(a.__webglColorBuffer),
                F.info.memory.geometries--)
    }
    ;
    this.deallocateTexture = function(a) {
        a.__webglInit && (a.__webglInit = !1,
        l.deleteTexture(a.__webglTexture),
        F.info.memory.textures--)
    }
    ;
    this.deallocateRenderTarget = function(a) {
        if (a && a.__webglTexture)
            if (l.deleteTexture(a.__webglTexture),
            a instanceof THREE.WebGLRenderTargetCube)
                for (var b = 0; 6 > b; b++)
                    l.deleteFramebuffer(a.__webglFramebuffer[b]),
                    l.deleteRenderbuffer(a.__webglRenderbuffer[b]);
            else
                l.deleteFramebuffer(a.__webglFramebuffer),
                l.deleteRenderbuffer(a.__webglRenderbuffer)
    }
    ;
    this.updateShadowMap = function(a, b) {
        D = null;
        T = M = La = Ha = X = -1;
        Ta = !0;
        U = ha = -1;
        this.shadowMapPlugin.update(a, b)
    }
    ;
    this.renderBufferImmediate = function(a, b, c) {
        a.__webglVertexBuffer || (a.__webglVertexBuffer = l.createBuffer());
        a.__webglNormalBuffer || (a.__webglNormalBuffer = l.createBuffer());
        a.hasPos && (l.bindBuffer(l.ARRAY_BUFFER, a.__webglVertexBuffer),
        l.bufferData(l.ARRAY_BUFFER, a.positionArray, l.DYNAMIC_DRAW),
        l.enableVertexAttribArray(b.attributes.position),
        l.vertexAttribPointer(b.attributes.position, 3, l.FLOAT, !1, 0, 0));
        if (a.hasNormal) {
            l.bindBuffer(l.ARRAY_BUFFER, a.__webglNormalBuffer);
            if (c === THREE.FlatShading) {
                var d, e, f, g, h, i, j, k, n, m, o = 3 * a.count;
                for (m = 0; m < o; m += 9)
                    c = a.normalArray,
                    d = c[m],
                    e = c[m + 1],
                    f = c[m + 2],
                    g = c[m + 3],
                    i = c[m + 4],
                    k = c[m + 5],
                    h = c[m + 6],
                    j = c[m + 7],
                    n = c[m + 8],
                    d = (d + g + h) / 3,
                    e = (e + i + j) / 3,
                    f = (f + k + n) / 3,
                    c[m] = d,
                    c[m + 1] = e,
                    c[m + 2] = f,
                    c[m + 3] = d,
                    c[m + 4] = e,
                    c[m + 5] = f,
                    c[m + 6] = d,
                    c[m + 7] = e,
                    c[m + 8] = f
            }
            l.bufferData(l.ARRAY_BUFFER, a.normalArray, l.DYNAMIC_DRAW);
            l.enableVertexAttribArray(b.attributes.normal);
            l.vertexAttribPointer(b.attributes.normal, 3, l.FLOAT, !1, 0, 0)
        }
        l.drawArrays(l.TRIANGLES, 0, a.count);
        a.count = 0
    }
    ;
    this.renderBufferDirect = function(a, b, c, d, e, f) {
        if (!1 !== d.visible && (c = q(a, b, c, d, f),
        a = c.attributes,
        b = !1,
        d = 16777215 * e.id + 2 * c.id + (d.wireframe ? 1 : 0),
        d !== M && (M = d,
        b = !0),
        f instanceof THREE.Mesh)) {
            f = e.offsets;
            d = 0;
            for (c = f.length; d < c; ++d)
                b && (l.bindBuffer(l.ARRAY_BUFFER, e.vertexPositionBuffer),
                l.vertexAttribPointer(a.position, e.vertexPositionBuffer.itemSize, l.FLOAT, !1, 0, 12 * f[d].index),
                0 <= a.normal && e.vertexNormalBuffer && (l.bindBuffer(l.ARRAY_BUFFER, e.vertexNormalBuffer),
                l.vertexAttribPointer(a.normal, e.vertexNormalBuffer.itemSize, l.FLOAT, !1, 0, 12 * f[d].index)),
                0 <= a.uv && e.vertexUvBuffer && (e.vertexUvBuffer ? (l.bindBuffer(l.ARRAY_BUFFER, e.vertexUvBuffer),
                l.vertexAttribPointer(a.uv, e.vertexUvBuffer.itemSize, l.FLOAT, !1, 0, 8 * f[d].index),
                l.enableVertexAttribArray(a.uv)) : l.disableVertexAttribArray(a.uv)),
                0 <= a.color && e.vertexColorBuffer && (l.bindBuffer(l.ARRAY_BUFFER, e.vertexColorBuffer),
                l.vertexAttribPointer(a.color, e.vertexColorBuffer.itemSize, l.FLOAT, !1, 0, 16 * f[d].index)),
                l.bindBuffer(l.ELEMENT_ARRAY_BUFFER, e.vertexIndexBuffer)),
                l.drawElements(l.TRIANGLES, f[d].count, l.UNSIGNED_SHORT, 2 * f[d].start),
                F.info.render.calls++,
                F.info.render.vertices += f[d].count,
                F.info.render.faces += f[d].count / 3
        }
    }
    ;
    this.renderBuffer = function(a, b, c, d, e, f) {
        if (!1 !== d.visible) {
            var g, h, c = q(a, b, c, d, f), b = c.attributes, a = !1, c = 16777215 * e.id + 2 * c.id + (d.wireframe ? 1 : 0);
            c !== M && (M = c,
            a = !0);
            if (!d.morphTargets && 0 <= b.position)
                a && (l.bindBuffer(l.ARRAY_BUFFER, e.__webglVertexBuffer),
                l.vertexAttribPointer(b.position, 3, l.FLOAT, !1, 0, 0));
            else if (f.morphTargetBase) {
                c = d.program.attributes;
                -1 !== f.morphTargetBase ? (l.bindBuffer(l.ARRAY_BUFFER, e.__webglMorphTargetsBuffers[f.morphTargetBase]),
                l.vertexAttribPointer(c.position, 3, l.FLOAT, !1, 0, 0)) : 0 <= c.position && (l.bindBuffer(l.ARRAY_BUFFER, e.__webglVertexBuffer),
                l.vertexAttribPointer(c.position, 3, l.FLOAT, !1, 0, 0));
                if (f.morphTargetForcedOrder.length) {
                    g = 0;
                    var i = f.morphTargetForcedOrder;
                    for (h = f.morphTargetInfluences; g < d.numSupportedMorphTargets && g < i.length; )
                        l.bindBuffer(l.ARRAY_BUFFER, e.__webglMorphTargetsBuffers[i[g]]),
                        l.vertexAttribPointer(c["morphTarget" + g], 3, l.FLOAT, !1, 0, 0),
                        d.morphNormals && (l.bindBuffer(l.ARRAY_BUFFER, e.__webglMorphNormalsBuffers[i[g]]),
                        l.vertexAttribPointer(c["morphNormal" + g], 3, l.FLOAT, !1, 0, 0)),
                        f.__webglMorphTargetInfluences[g] = h[i[g]],
                        g++
                } else {
                    var i = []
                      , j = -1
                      , k = 0;
                    h = f.morphTargetInfluences;
                    var n, m = h.length;
                    g = 0;
                    for (-1 !== f.morphTargetBase && (i[f.morphTargetBase] = !0); g < d.numSupportedMorphTargets; ) {
                        for (n = 0; n < m; n++)
                            !i[n] && h[n] > j && (k = n,
                            j = h[k]);
                        l.bindBuffer(l.ARRAY_BUFFER, e.__webglMorphTargetsBuffers[k]);
                        l.vertexAttribPointer(c["morphTarget" + g], 3, l.FLOAT, !1, 0, 0);
                        d.morphNormals && (l.bindBuffer(l.ARRAY_BUFFER, e.__webglMorphNormalsBuffers[k]),
                        l.vertexAttribPointer(c["morphNormal" + g], 3, l.FLOAT, !1, 0, 0));
                        f.__webglMorphTargetInfluences[g] = j;
                        i[k] = 1;
                        j = -1;
                        g++
                    }
                }
                null !== d.program.uniforms.morphTargetInfluences && l.uniform1fv(d.program.uniforms.morphTargetInfluences, f.__webglMorphTargetInfluences)
            }
            if (a) {
                if (e.__webglCustomAttributesList) {
                    g = 0;
                    for (h = e.__webglCustomAttributesList.length; g < h; g++)
                        c = e.__webglCustomAttributesList[g],
                        0 <= b[c.buffer.belongsToAttribute] && (l.bindBuffer(l.ARRAY_BUFFER, c.buffer),
                        l.vertexAttribPointer(b[c.buffer.belongsToAttribute], c.size, l.FLOAT, !1, 0, 0))
                }
                0 <= b.color && (l.bindBuffer(l.ARRAY_BUFFER, e.__webglColorBuffer),
                l.vertexAttribPointer(b.color, 3, l.FLOAT, !1, 0, 0));
                0 <= b.normal && (l.bindBuffer(l.ARRAY_BUFFER, e.__webglNormalBuffer),
                l.vertexAttribPointer(b.normal, 3, l.FLOAT, !1, 0, 0));
                0 <= b.tangent && (l.bindBuffer(l.ARRAY_BUFFER, e.__webglTangentBuffer),
                l.vertexAttribPointer(b.tangent, 4, l.FLOAT, !1, 0, 0));
                0 <= b.uv && (e.__webglUVBuffer ? (l.bindBuffer(l.ARRAY_BUFFER, e.__webglUVBuffer),
                l.vertexAttribPointer(b.uv, 2, l.FLOAT, !1, 0, 0),
                l.enableVertexAttribArray(b.uv)) : l.disableVertexAttribArray(b.uv));
                0 <= b.uv2 && (e.__webglUV2Buffer ? (l.bindBuffer(l.ARRAY_BUFFER, e.__webglUV2Buffer),
                l.vertexAttribPointer(b.uv2, 2, l.FLOAT, !1, 0, 0),
                l.enableVertexAttribArray(b.uv2)) : l.disableVertexAttribArray(b.uv2));
                d.skinning && 0 <= b.skinVertexA && 0 <= b.skinVertexB && 0 <= b.skinIndex && 0 <= b.skinWeight && (l.bindBuffer(l.ARRAY_BUFFER, e.__webglSkinVertexABuffer),
                l.vertexAttribPointer(b.skinVertexA, 4, l.FLOAT, !1, 0, 0),
                l.bindBuffer(l.ARRAY_BUFFER, e.__webglSkinVertexBBuffer),
                l.vertexAttribPointer(b.skinVertexB, 4, l.FLOAT, !1, 0, 0),
                l.bindBuffer(l.ARRAY_BUFFER, e.__webglSkinIndicesBuffer),
                l.vertexAttribPointer(b.skinIndex, 4, l.FLOAT, !1, 0, 0),
                l.bindBuffer(l.ARRAY_BUFFER, e.__webglSkinWeightsBuffer),
                l.vertexAttribPointer(b.skinWeight, 4, l.FLOAT, !1, 0, 0))
            }
            f instanceof THREE.Mesh ? (d.wireframe ? (d = d.wireframeLinewidth,
            d !== Qa && (l.lineWidth(d),
            Qa = d),
            a && l.bindBuffer(l.ELEMENT_ARRAY_BUFFER, e.__webglLineBuffer),
            l.drawElements(l.LINES, e.__webglLineCount, l.UNSIGNED_SHORT, 0)) : (a && l.bindBuffer(l.ELEMENT_ARRAY_BUFFER, e.__webglFaceBuffer),
            l.drawElements(l.TRIANGLES, e.__webglFaceCount, l.UNSIGNED_SHORT, 0)),
            F.info.render.calls++,
            F.info.render.vertices += e.__webglFaceCount,
            F.info.render.faces += e.__webglFaceCount / 3) : f instanceof THREE.Line ? (f = f.type === THREE.LineStrip ? l.LINE_STRIP : l.LINES,
            d = d.linewidth,
            d !== Qa && (l.lineWidth(d),
            Qa = d),
            l.drawArrays(f, 0, e.__webglLineCount),
            F.info.render.calls++) : f instanceof THREE.ParticleSystem ? (l.drawArrays(l.POINTS, 0, e.__webglParticleCount),
            F.info.render.calls++,
            F.info.render.points += e.__webglParticleCount) : f instanceof THREE.Ribbon && (l.drawArrays(l.TRIANGLE_STRIP, 0, e.__webglVertexCount),
            F.info.render.calls++)
        }
    }
    ;
    this.render = function(a, b, c, d) {
        var e, f, k, n, m = a.__lights, o = a.fog;
        T = -1;
        Ta = !0;
        void 0 === b.parent && (console.warn("DEPRECATED: Camera hasn't been added to a Scene. Adding it..."),
        a.add(b));
        this.autoUpdateScene && a.updateMatrixWorld();
        b._viewMatrixArray || (b._viewMatrixArray = new Float32Array(16));
        b._projectionMatrixArray || (b._projectionMatrixArray = new Float32Array(16));
        b.matrixWorldInverse.getInverse(b.matrixWorld);
        b.matrixWorldInverse.flattenToArray(b._viewMatrixArray);
        b.projectionMatrix.flattenToArray(b._projectionMatrixArray);
        ta.multiply(b.projectionMatrix, b.matrixWorldInverse);
        Va.setFromMatrix(ta);
        this.autoUpdateObjects && this.initWebGLObjects(a);
        h(this.renderPluginsPre, a, b);
        F.info.render.calls = 0;
        F.info.render.vertices = 0;
        F.info.render.faces = 0;
        F.info.render.points = 0;
        this.setRenderTarget(c);
        (this.autoClear || d) && this.clear(this.autoClearColor, this.autoClearDepth, this.autoClearStencil);
        n = a.__webglObjects;
        d = 0;
        for (e = n.length; d < e; d++)
            if (f = n[d],
            k = f.object,
            f.render = !1,
            k.visible && (!(k instanceof THREE.Mesh || k instanceof THREE.ParticleSystem) || !k.frustumCulled || Va.contains(k))) {
                s(k, b);
                var p = f
                  , q = p.object
                  , r = p.buffer
                  , w = void 0
                  , w = q.material;
                w instanceof THREE.MeshFaceMaterial ? (w = r.materialIndex,
                0 <= w && (w = q.geometry.materials[w],
                w.transparent ? (p.transparent = w,
                p.opaque = null) : (p.opaque = w,
                p.transparent = null))) : w && (w.transparent ? (p.transparent = w,
                p.opaque = null) : (p.opaque = w,
                p.transparent = null));
                f.render = !0;
                this.sortObjects && (k.renderDepth ? f.z = k.renderDepth : (bb.copy(k.matrixWorld.getPosition()),
                ta.multiplyVector3(bb),
                f.z = bb.z))
            }
        this.sortObjects && n.sort(g);
        n = a.__webglObjectsImmediate;
        d = 0;
        for (e = n.length; d < e; d++)
            f = n[d],
            k = f.object,
            k.visible && (s(k, b),
            k = f.object.material,
            k.transparent ? (f.transparent = k,
            f.opaque = null) : (f.opaque = k,
            f.transparent = null));
        a.overrideMaterial ? (d = a.overrideMaterial,
        this.setBlending(d.blending, d.blendEquation, d.blendSrc, d.blendDst),
        this.setDepthTest(d.depthTest),
        this.setDepthWrite(d.depthWrite),
        t(d.polygonOffset, d.polygonOffsetFactor, d.polygonOffsetUnits),
        i(a.__webglObjects, !1, "", b, m, o, !0, d),
        j(a.__webglObjectsImmediate, "", b, m, o, !1, d)) : (this.setBlending(THREE.NormalBlending),
        i(a.__webglObjects, !0, "opaque", b, m, o, !1),
        j(a.__webglObjectsImmediate, "opaque", b, m, o, !1),
        i(a.__webglObjects, !1, "transparent", b, m, o, !0),
        j(a.__webglObjectsImmediate, "transparent", b, m, o, !0));
        h(this.renderPluginsPost, a, b);
        c && c.generateMipmaps && c.minFilter !== THREE.NearestFilter && c.minFilter !== THREE.LinearFilter && (c instanceof THREE.WebGLRenderTargetCube ? (l.bindTexture(l.TEXTURE_CUBE_MAP, c.__webglTexture),
        l.generateMipmap(l.TEXTURE_CUBE_MAP),
        l.bindTexture(l.TEXTURE_CUBE_MAP, null)) : (l.bindTexture(l.TEXTURE_2D, c.__webglTexture),
        l.generateMipmap(l.TEXTURE_2D),
        l.bindTexture(l.TEXTURE_2D, null)));
        this.setDepthTest(!0);
        this.setDepthWrite(!0)
    }
    ;
    this.renderImmediateObject = function(a, b, c, d, e) {
        var f = q(a, b, c, d, e);
        M = -1;
        F.setObjectFaces(e);
        e.immediateRenderCallback ? e.immediateRenderCallback(f, l, Va) : e.render(function(a) {
            F.renderBufferImmediate(a, f, d.shading)
        })
    }
    ;
    this.initWebGLObjects = function(a) {
        a.__webglObjects || (a.__webglObjects = [],
        a.__webglObjectsImmediate = [],
        a.__webglSprites = [],
        a.__webglFlares = []);
        for (; a.__objectsAdded.length; ) {
            var g = a.__objectsAdded[0]
              , h = a
              , i = void 0
              , j = void 0
              , m = void 0;
            if (!g.__webglInit)
                if (g.__webglInit = !0,
                g._modelViewMatrix = new THREE.Matrix4,
                g._normalMatrix = new THREE.Matrix3,
                g instanceof THREE.Mesh) {
                    if (j = g.geometry,
                    j instanceof THREE.Geometry) {
                        if (void 0 === j.geometryGroups) {
                            var q = j
                              , s = void 0
                              , w = void 0
                              , t = void 0
                              , u = void 0
                              , v = void 0
                              , B = void 0
                              , Q = void 0
                              , D = {}
                              , A = q.morphTargets.length
                              , x = q.morphNormals.length;
                            q.geometryGroups = {};
                            s = 0;
                            for (w = q.faces.length; s < w; s++)
                                t = q.faces[s],
                                u = t.materialIndex,
                                B = void 0 !== u ? u : -1,
                                void 0 === D[B] && (D[B] = {
                                    hash: B,
                                    counter: 0
                                }),
                                Q = D[B].hash + "_" + D[B].counter,
                                void 0 === q.geometryGroups[Q] && (q.geometryGroups[Q] = {
                                    faces3: [],
                                    faces4: [],
                                    materialIndex: u,
                                    vertices: 0,
                                    numMorphTargets: A,
                                    numMorphNormals: x
                                }),
                                v = t instanceof THREE.Face3 ? 3 : 4,
                                65535 < q.geometryGroups[Q].vertices + v && (D[B].counter += 1,
                                Q = D[B].hash + "_" + D[B].counter,
                                void 0 === q.geometryGroups[Q] && (q.geometryGroups[Q] = {
                                    faces3: [],
                                    faces4: [],
                                    materialIndex: u,
                                    vertices: 0,
                                    numMorphTargets: A,
                                    numMorphNormals: x
                                })),
                                t instanceof THREE.Face3 ? q.geometryGroups[Q].faces3.push(s) : q.geometryGroups[Q].faces4.push(s),
                                q.geometryGroups[Q].vertices += v;
                            q.geometryGroupsList = [];
                            var y = void 0;
                            for (y in q.geometryGroups)
                                q.geometryGroups[y].id = ca++,
                                q.geometryGroupsList.push(q.geometryGroups[y])
                        }
                        for (i in j.geometryGroups)
                            if (m = j.geometryGroups[i],
                            !m.__webglVertexBuffer) {
                                var H = m;
                                H.__webglVertexBuffer = l.createBuffer();
                                H.__webglNormalBuffer = l.createBuffer();
                                H.__webglTangentBuffer = l.createBuffer();
                                H.__webglColorBuffer = l.createBuffer();
                                H.__webglUVBuffer = l.createBuffer();
                                H.__webglUV2Buffer = l.createBuffer();
                                H.__webglSkinVertexABuffer = l.createBuffer();
                                H.__webglSkinVertexBBuffer = l.createBuffer();
                                H.__webglSkinIndicesBuffer = l.createBuffer();
                                H.__webglSkinWeightsBuffer = l.createBuffer();
                                H.__webglFaceBuffer = l.createBuffer();
                                H.__webglLineBuffer = l.createBuffer();
                                var C = void 0
                                  , M = void 0;
                                if (H.numMorphTargets) {
                                    H.__webglMorphTargetsBuffers = [];
                                    C = 0;
                                    for (M = H.numMorphTargets; C < M; C++)
                                        H.__webglMorphTargetsBuffers.push(l.createBuffer())
                                }
                                if (H.numMorphNormals) {
                                    H.__webglMorphNormalsBuffers = [];
                                    C = 0;
                                    for (M = H.numMorphNormals; C < M; C++)
                                        H.__webglMorphNormalsBuffers.push(l.createBuffer())
                                }
                                F.info.memory.geometries++;
                                var z = m
                                  , T = g
                                  , E = T.geometry
                                  , L = z.faces3
                                  , J = z.faces4
                                  , I = 3 * L.length + 4 * J.length
                                  , N = 1 * L.length + 2 * J.length
                                  , P = 3 * L.length + 4 * J.length
                                  , X = c(T, z)
                                  , U = e(X)
                                  , ea = d(X)
                                  , ha = X.vertexColors ? X.vertexColors : !1;
                                z.__vertexArray = new Float32Array(3 * I);
                                ea && (z.__normalArray = new Float32Array(3 * I));
                                E.hasTangents && (z.__tangentArray = new Float32Array(4 * I));
                                ha && (z.__colorArray = new Float32Array(3 * I));
                                if (U) {
                                    if (0 < E.faceUvs.length || 0 < E.faceVertexUvs.length)
                                        z.__uvArray = new Float32Array(2 * I);
                                    if (1 < E.faceUvs.length || 1 < E.faceVertexUvs.length)
                                        z.__uv2Array = new Float32Array(2 * I)
                                }
                                T.geometry.skinWeights.length && T.geometry.skinIndices.length && (z.__skinVertexAArray = new Float32Array(4 * I),
                                z.__skinVertexBArray = new Float32Array(4 * I),
                                z.__skinIndexArray = new Float32Array(4 * I),
                                z.__skinWeightArray = new Float32Array(4 * I));
                                z.__faceArray = new Uint16Array(3 * N);
                                z.__lineArray = new Uint16Array(2 * P);
                                var aa = void 0
                                  , ba = void 0;
                                if (z.numMorphTargets) {
                                    z.__morphTargetsArrays = [];
                                    aa = 0;
                                    for (ba = z.numMorphTargets; aa < ba; aa++)
                                        z.__morphTargetsArrays.push(new Float32Array(3 * I))
                                }
                                if (z.numMorphNormals) {
                                    z.__morphNormalsArrays = [];
                                    aa = 0;
                                    for (ba = z.numMorphNormals; aa < ba; aa++)
                                        z.__morphNormalsArrays.push(new Float32Array(3 * I))
                                }
                                z.__webglFaceCount = 3 * N;
                                z.__webglLineCount = 2 * P;
                                if (X.attributes) {
                                    void 0 === z.__webglCustomAttributesList && (z.__webglCustomAttributesList = []);
                                    var Ga = void 0;
                                    for (Ga in X.attributes) {
                                        var Ha = X.attributes[Ga], da = {}, La;
                                        for (La in Ha)
                                            da[La] = Ha[La];
                                        if (!da.__webglInitialized || da.createUniqueBuffers) {
                                            da.__webglInitialized = !0;
                                            var Pa = 1;
                                            "v2" === da.type ? Pa = 2 : "v3" === da.type ? Pa = 3 : "v4" === da.type ? Pa = 4 : "c" === da.type && (Pa = 3);
                                            da.size = Pa;
                                            da.array = new Float32Array(I * Pa);
                                            da.buffer = l.createBuffer();
                                            da.buffer.belongsToAttribute = Ga;
                                            Ha.needsUpdate = !0;
                                            da.__original = Ha
                                        }
                                        z.__webglCustomAttributesList.push(da)
                                    }
                                }
                                z.__inittedArrays = !0;
                                j.verticesNeedUpdate = !0;
                                j.morphTargetsNeedUpdate = !0;
                                j.elementsNeedUpdate = !0;
                                j.uvsNeedUpdate = !0;
                                j.normalsNeedUpdate = !0;
                                j.tangetsNeedUpdate = !0;
                                j.colorsNeedUpdate = !0
                            }
                    }
                } else if (g instanceof THREE.Ribbon) {
                    if (j = g.geometry,
                    !j.__webglVertexBuffer) {
                        var ra = j;
                        ra.__webglVertexBuffer = l.createBuffer();
                        ra.__webglColorBuffer = l.createBuffer();
                        F.info.memory.geometries++;
                        var Ua = j
                          , ta = Ua.vertices.length;
                        Ua.__vertexArray = new Float32Array(3 * ta);
                        Ua.__colorArray = new Float32Array(3 * ta);
                        Ua.__webglVertexCount = ta;
                        j.verticesNeedUpdate = !0;
                        j.colorsNeedUpdate = !0
                    }
                } else if (g instanceof THREE.Line) {
                    if (j = g.geometry,
                    !j.__webglVertexBuffer) {
                        var Ba = j;
                        Ba.__webglVertexBuffer = l.createBuffer();
                        Ba.__webglColorBuffer = l.createBuffer();
                        F.info.memory.geometries++;
                        var Qa = j
                          , Ra = g
                          , Ta = Qa.vertices.length;
                        Qa.__vertexArray = new Float32Array(3 * Ta);
                        Qa.__colorArray = new Float32Array(3 * Ta);
                        Qa.__webglLineCount = Ta;
                        b(Qa, Ra);
                        j.verticesNeedUpdate = !0;
                        j.colorsNeedUpdate = !0
                    }
                } else if (g instanceof THREE.ParticleSystem && (j = g.geometry,
                !j.__webglVertexBuffer)) {
                    var bb = j;
                    bb.__webglVertexBuffer = l.createBuffer();
                    bb.__webglColorBuffer = l.createBuffer();
                    F.info.geometries++;
                    var Va = j
                      , Kb = g
                      , xb = Va.vertices.length;
                    Va.__vertexArray = new Float32Array(3 * xb);
                    Va.__colorArray = new Float32Array(3 * xb);
                    Va.__sortArray = [];
                    Va.__webglParticleCount = xb;
                    b(Va, Kb);
                    j.verticesNeedUpdate = !0;
                    j.colorsNeedUpdate = !0
                }
            if (!g.__webglActive) {
                if (g instanceof THREE.Mesh)
                    if (j = g.geometry,
                    j instanceof THREE.BufferGeometry)
                        k(h.__webglObjects, j, g);
                    else
                        for (i in j.geometryGroups)
                            m = j.geometryGroups[i],
                            k(h.__webglObjects, m, g);
                else
                    g instanceof THREE.Ribbon || g instanceof THREE.Line || g instanceof THREE.ParticleSystem ? (j = g.geometry,
                    k(h.__webglObjects, j, g)) : g instanceof THREE.ImmediateRenderObject || g.immediateRenderCallback ? h.__webglObjectsImmediate.push({
                        object: g,
                        opaque: null,
                        transparent: null
                    }) : g instanceof THREE.Sprite ? h.__webglSprites.push(g) : g instanceof THREE.LensFlare && h.__webglFlares.push(g);
                g.__webglActive = !0
            }
            a.__objectsAdded.splice(0, 1)
        }
        for (; a.__objectsRemoved.length; ) {
            var gb = a.__objectsRemoved[0]
              , ob = a;
            gb instanceof THREE.Mesh || gb instanceof THREE.ParticleSystem || gb instanceof THREE.Ribbon || gb instanceof THREE.Line ? o(ob.__webglObjects, gb) : gb instanceof THREE.Sprite ? r(ob.__webglSprites, gb) : gb instanceof THREE.LensFlare ? r(ob.__webglFlares, gb) : (gb instanceof THREE.ImmediateRenderObject || gb.immediateRenderCallback) && o(ob.__webglObjectsImmediate, gb);
            gb.__webglActive = !1;
            a.__objectsRemoved.splice(0, 1)
        }
        for (var kb = 0, Lb = a.__webglObjects.length; kb < Lb; kb++) {
            var tb = a.__webglObjects[kb].object
              , ja = tb.geometry
              , ub = void 0
              , mb = void 0
              , Za = void 0;
            if (tb instanceof THREE.Mesh)
                if (ja instanceof THREE.BufferGeometry)
                    ja.verticesNeedUpdate = !1,
                    ja.elementsNeedUpdate = !1,
                    ja.uvsNeedUpdate = !1,
                    ja.normalsNeedUpdate = !1,
                    ja.colorsNeedUpdate = !1;
                else {
                    for (var Ab = 0, Vb = ja.geometryGroupsList.length; Ab < Vb; Ab++)
                        if (ub = ja.geometryGroupsList[Ab],
                        Za = c(tb, ub),
                        mb = Za.attributes && n(Za),
                        ja.verticesNeedUpdate || ja.morphTargetsNeedUpdate || ja.elementsNeedUpdate || ja.uvsNeedUpdate || ja.normalsNeedUpdate || ja.colorsNeedUpdate || ja.tangetsNeedUpdate || mb) {
                            var ga = ub
                              , $c = tb
                              , ab = l.DYNAMIC_DRAW
                              , rd = !ja.dynamic
                              , Ub = Za;
                            if (ga.__inittedArrays) {
                                var Pc = d(Ub)
                                  , sc = Ub.vertexColors ? Ub.vertexColors : !1
                                  , Qc = e(Ub)
                                  , uc = Pc === THREE.SmoothShading
                                  , O = void 0
                                  , V = void 0
                                  , nb = void 0
                                  , S = void 0
                                  , kc = void 0
                                  , hb = void 0
                                  , ib = void 0
                                  , Fc = void 0
                                  , jb = void 0
                                  , Cb = void 0
                                  , lc = void 0
                                  , Y = void 0
                                  , Z = void 0
                                  , W = void 0
                                  , ka = void 0
                                  , vb = void 0
                                  , $a = void 0
                                  , Db = void 0
                                  , Hc = void 0
                                  , Eb = void 0
                                  , wb = void 0
                                  , Fb = void 0
                                  , Ic = void 0
                                  , Gb = void 0
                                  , Hb = void 0
                                  , Ib = void 0
                                  , Jc = void 0
                                  , Jb = void 0
                                  , Mb = void 0
                                  , yb = void 0
                                  , Kc = void 0
                                  , Nb = void 0
                                  , Ob = void 0
                                  , Rb = void 0
                                  , Lc = void 0
                                  , dc = void 0
                                  , ec = void 0
                                  , cc = void 0
                                  , Yc = void 0
                                  , fc = void 0
                                  , gc = void 0
                                  , hc = void 0
                                  , Xc = void 0
                                  , ma = void 0
                                  , Bd = void 0
                                  , ic = void 0
                                  , Dc = void 0
                                  , Ec = void 0
                                  , Na = void 0
                                  , Cd = void 0
                                  , Ia = void 0
                                  , Ja = void 0
                                  , bc = void 0
                                  , Xb = void 0
                                  , Ca = 0
                                  , Fa = 0
                                  , Yb = 0
                                  , Zb = 0
                                  , qb = 0
                                  , Wa = 0
                                  , qa = 0
                                  , Ya = 0
                                  , Da = 0
                                  , R = 0
                                  , fa = 0
                                  , K = 0
                                  , fb = void 0
                                  , Oa = ga.__vertexArray
                                  , Nc = ga.__uvArray
                                  , Mc = ga.__uv2Array
                                  , rb = ga.__normalArray
                                  , va = ga.__tangentArray
                                  , Ma = ga.__colorArray
                                  , wa = ga.__skinVertexAArray
                                  , xa = ga.__skinVertexBArray
                                  , ya = ga.__skinIndexArray
                                  , za = ga.__skinWeightArray
                                  , ld = ga.__morphTargetsArrays
                                  , md = ga.__morphNormalsArrays
                                  , nd = ga.__webglCustomAttributesList
                                  , G = void 0
                                  , Qb = ga.__faceArray
                                  , eb = ga.__lineArray
                                  , Xa = $c.geometry
                                  , Td = Xa.elementsNeedUpdate
                                  , Ad = Xa.uvsNeedUpdate
                                  , Ud = Xa.normalsNeedUpdate
                                  , Xd = Xa.tangetsNeedUpdate
                                  , Vd = Xa.colorsNeedUpdate
                                  , Wd = Xa.morphTargetsNeedUpdate
                                  , vc = Xa.vertices
                                  , na = ga.faces3
                                  , oa = ga.faces4
                                  , Ea = Xa.faces
                                  , sd = Xa.faceVertexUvs[0]
                                  , td = Xa.faceVertexUvs[1]
                                  , wc = Xa.skinVerticesA
                                  , xc = Xa.skinVerticesB
                                  , yc = Xa.skinIndices
                                  , mc = Xa.skinWeights
                                  , nc = Xa.morphTargets
                                  , ad = Xa.morphNormals;
                                if (Xa.verticesNeedUpdate) {
                                    O = 0;
                                    for (V = na.length; O < V; O++)
                                        S = Ea[na[O]],
                                        Y = vc[S.a],
                                        Z = vc[S.b],
                                        W = vc[S.c],
                                        Oa[Fa] = Y.x,
                                        Oa[Fa + 1] = Y.y,
                                        Oa[Fa + 2] = Y.z,
                                        Oa[Fa + 3] = Z.x,
                                        Oa[Fa + 4] = Z.y,
                                        Oa[Fa + 5] = Z.z,
                                        Oa[Fa + 6] = W.x,
                                        Oa[Fa + 7] = W.y,
                                        Oa[Fa + 8] = W.z,
                                        Fa += 9;
                                    O = 0;
                                    for (V = oa.length; O < V; O++)
                                        S = Ea[oa[O]],
                                        Y = vc[S.a],
                                        Z = vc[S.b],
                                        W = vc[S.c],
                                        ka = vc[S.d],
                                        Oa[Fa] = Y.x,
                                        Oa[Fa + 1] = Y.y,
                                        Oa[Fa + 2] = Y.z,
                                        Oa[Fa + 3] = Z.x,
                                        Oa[Fa + 4] = Z.y,
                                        Oa[Fa + 5] = Z.z,
                                        Oa[Fa + 6] = W.x,
                                        Oa[Fa + 7] = W.y,
                                        Oa[Fa + 8] = W.z,
                                        Oa[Fa + 9] = ka.x,
                                        Oa[Fa + 10] = ka.y,
                                        Oa[Fa + 11] = ka.z,
                                        Fa += 12;
                                    l.bindBuffer(l.ARRAY_BUFFER, ga.__webglVertexBuffer);
                                    l.bufferData(l.ARRAY_BUFFER, Oa, ab)
                                }
                                if (Wd) {
                                    Na = 0;
                                    for (Cd = nc.length; Na < Cd; Na++) {
                                        O = fa = 0;
                                        for (V = na.length; O < V; O++)
                                            bc = na[O],
                                            S = Ea[bc],
                                            Y = nc[Na].vertices[S.a],
                                            Z = nc[Na].vertices[S.b],
                                            W = nc[Na].vertices[S.c],
                                            Ia = ld[Na],
                                            Ia[fa] = Y.x,
                                            Ia[fa + 1] = Y.y,
                                            Ia[fa + 2] = Y.z,
                                            Ia[fa + 3] = Z.x,
                                            Ia[fa + 4] = Z.y,
                                            Ia[fa + 5] = Z.z,
                                            Ia[fa + 6] = W.x,
                                            Ia[fa + 7] = W.y,
                                            Ia[fa + 8] = W.z,
                                            Ub.morphNormals && (uc ? (Xb = ad[Na].vertexNormals[bc],
                                            Eb = Xb.a,
                                            wb = Xb.b,
                                            Fb = Xb.c) : Fb = wb = Eb = ad[Na].faceNormals[bc],
                                            Ja = md[Na],
                                            Ja[fa] = Eb.x,
                                            Ja[fa + 1] = Eb.y,
                                            Ja[fa + 2] = Eb.z,
                                            Ja[fa + 3] = wb.x,
                                            Ja[fa + 4] = wb.y,
                                            Ja[fa + 5] = wb.z,
                                            Ja[fa + 6] = Fb.x,
                                            Ja[fa + 7] = Fb.y,
                                            Ja[fa + 8] = Fb.z),
                                            fa += 9;
                                        O = 0;
                                        for (V = oa.length; O < V; O++)
                                            bc = oa[O],
                                            S = Ea[bc],
                                            Y = nc[Na].vertices[S.a],
                                            Z = nc[Na].vertices[S.b],
                                            W = nc[Na].vertices[S.c],
                                            ka = nc[Na].vertices[S.d],
                                            Ia = ld[Na],
                                            Ia[fa] = Y.x,
                                            Ia[fa + 1] = Y.y,
                                            Ia[fa + 2] = Y.z,
                                            Ia[fa + 3] = Z.x,
                                            Ia[fa + 4] = Z.y,
                                            Ia[fa + 5] = Z.z,
                                            Ia[fa + 6] = W.x,
                                            Ia[fa + 7] = W.y,
                                            Ia[fa + 8] = W.z,
                                            Ia[fa + 9] = ka.x,
                                            Ia[fa + 10] = ka.y,
                                            Ia[fa + 11] = ka.z,
                                            Ub.morphNormals && (uc ? (Xb = ad[Na].vertexNormals[bc],
                                            Eb = Xb.a,
                                            wb = Xb.b,
                                            Fb = Xb.c,
                                            Ic = Xb.d) : Ic = Fb = wb = Eb = ad[Na].faceNormals[bc],
                                            Ja = md[Na],
                                            Ja[fa] = Eb.x,
                                            Ja[fa + 1] = Eb.y,
                                            Ja[fa + 2] = Eb.z,
                                            Ja[fa + 3] = wb.x,
                                            Ja[fa + 4] = wb.y,
                                            Ja[fa + 5] = wb.z,
                                            Ja[fa + 6] = Fb.x,
                                            Ja[fa + 7] = Fb.y,
                                            Ja[fa + 8] = Fb.z,
                                            Ja[fa + 9] = Ic.x,
                                            Ja[fa + 10] = Ic.y,
                                            Ja[fa + 11] = Ic.z),
                                            fa += 12;
                                        l.bindBuffer(l.ARRAY_BUFFER, ga.__webglMorphTargetsBuffers[Na]);
                                        l.bufferData(l.ARRAY_BUFFER, ld[Na], ab);
                                        Ub.morphNormals && (l.bindBuffer(l.ARRAY_BUFFER, ga.__webglMorphNormalsBuffers[Na]),
                                        l.bufferData(l.ARRAY_BUFFER, md[Na], ab))
                                    }
                                }
                                if (mc.length) {
                                    O = 0;
                                    for (V = na.length; O < V; O++)
                                        S = Ea[na[O]],
                                        Jb = mc[S.a],
                                        Mb = mc[S.b],
                                        yb = mc[S.c],
                                        za[R] = Jb.x,
                                        za[R + 1] = Jb.y,
                                        za[R + 2] = Jb.z,
                                        za[R + 3] = Jb.w,
                                        za[R + 4] = Mb.x,
                                        za[R + 5] = Mb.y,
                                        za[R + 6] = Mb.z,
                                        za[R + 7] = Mb.w,
                                        za[R + 8] = yb.x,
                                        za[R + 9] = yb.y,
                                        za[R + 10] = yb.z,
                                        za[R + 11] = yb.w,
                                        Nb = yc[S.a],
                                        Ob = yc[S.b],
                                        Rb = yc[S.c],
                                        ya[R] = Nb.x,
                                        ya[R + 1] = Nb.y,
                                        ya[R + 2] = Nb.z,
                                        ya[R + 3] = Nb.w,
                                        ya[R + 4] = Ob.x,
                                        ya[R + 5] = Ob.y,
                                        ya[R + 6] = Ob.z,
                                        ya[R + 7] = Ob.w,
                                        ya[R + 8] = Rb.x,
                                        ya[R + 9] = Rb.y,
                                        ya[R + 10] = Rb.z,
                                        ya[R + 11] = Rb.w,
                                        dc = wc[S.a],
                                        ec = wc[S.b],
                                        cc = wc[S.c],
                                        wa[R] = dc.x,
                                        wa[R + 1] = dc.y,
                                        wa[R + 2] = dc.z,
                                        wa[R + 3] = 1,
                                        wa[R + 4] = ec.x,
                                        wa[R + 5] = ec.y,
                                        wa[R + 6] = ec.z,
                                        wa[R + 7] = 1,
                                        wa[R + 8] = cc.x,
                                        wa[R + 9] = cc.y,
                                        wa[R + 10] = cc.z,
                                        wa[R + 11] = 1,
                                        fc = xc[S.a],
                                        gc = xc[S.b],
                                        hc = xc[S.c],
                                        xa[R] = fc.x,
                                        xa[R + 1] = fc.y,
                                        xa[R + 2] = fc.z,
                                        xa[R + 3] = 1,
                                        xa[R + 4] = gc.x,
                                        xa[R + 5] = gc.y,
                                        xa[R + 6] = gc.z,
                                        xa[R + 7] = 1,
                                        xa[R + 8] = hc.x,
                                        xa[R + 9] = hc.y,
                                        xa[R + 10] = hc.z,
                                        xa[R + 11] = 1,
                                        R += 12;
                                    O = 0;
                                    for (V = oa.length; O < V; O++)
                                        S = Ea[oa[O]],
                                        Jb = mc[S.a],
                                        Mb = mc[S.b],
                                        yb = mc[S.c],
                                        Kc = mc[S.d],
                                        za[R] = Jb.x,
                                        za[R + 1] = Jb.y,
                                        za[R + 2] = Jb.z,
                                        za[R + 3] = Jb.w,
                                        za[R + 4] = Mb.x,
                                        za[R + 5] = Mb.y,
                                        za[R + 6] = Mb.z,
                                        za[R + 7] = Mb.w,
                                        za[R + 8] = yb.x,
                                        za[R + 9] = yb.y,
                                        za[R + 10] = yb.z,
                                        za[R + 11] = yb.w,
                                        za[R + 12] = Kc.x,
                                        za[R + 13] = Kc.y,
                                        za[R + 14] = Kc.z,
                                        za[R + 15] = Kc.w,
                                        Nb = yc[S.a],
                                        Ob = yc[S.b],
                                        Rb = yc[S.c],
                                        Lc = yc[S.d],
                                        ya[R] = Nb.x,
                                        ya[R + 1] = Nb.y,
                                        ya[R + 2] = Nb.z,
                                        ya[R + 3] = Nb.w,
                                        ya[R + 4] = Ob.x,
                                        ya[R + 5] = Ob.y,
                                        ya[R + 6] = Ob.z,
                                        ya[R + 7] = Ob.w,
                                        ya[R + 8] = Rb.x,
                                        ya[R + 9] = Rb.y,
                                        ya[R + 10] = Rb.z,
                                        ya[R + 11] = Rb.w,
                                        ya[R + 12] = Lc.x,
                                        ya[R + 13] = Lc.y,
                                        ya[R + 14] = Lc.z,
                                        ya[R + 15] = Lc.w,
                                        dc = wc[S.a],
                                        ec = wc[S.b],
                                        cc = wc[S.c],
                                        Yc = wc[S.d],
                                        wa[R] = dc.x,
                                        wa[R + 1] = dc.y,
                                        wa[R + 2] = dc.z,
                                        wa[R + 3] = 1,
                                        wa[R + 4] = ec.x,
                                        wa[R + 5] = ec.y,
                                        wa[R + 6] = ec.z,
                                        wa[R + 7] = 1,
                                        wa[R + 8] = cc.x,
                                        wa[R + 9] = cc.y,
                                        wa[R + 10] = cc.z,
                                        wa[R + 11] = 1,
                                        wa[R + 12] = Yc.x,
                                        wa[R + 13] = Yc.y,
                                        wa[R + 14] = Yc.z,
                                        wa[R + 15] = 1,
                                        fc = xc[S.a],
                                        gc = xc[S.b],
                                        hc = xc[S.c],
                                        Xc = xc[S.d],
                                        xa[R] = fc.x,
                                        xa[R + 1] = fc.y,
                                        xa[R + 2] = fc.z,
                                        xa[R + 3] = 1,
                                        xa[R + 4] = gc.x,
                                        xa[R + 5] = gc.y,
                                        xa[R + 6] = gc.z,
                                        xa[R + 7] = 1,
                                        xa[R + 8] = hc.x,
                                        xa[R + 9] = hc.y,
                                        xa[R + 10] = hc.z,
                                        xa[R + 11] = 1,
                                        xa[R + 12] = Xc.x,
                                        xa[R + 13] = Xc.y,
                                        xa[R + 14] = Xc.z,
                                        xa[R + 15] = 1,
                                        R += 16;
                                    0 < R && (l.bindBuffer(l.ARRAY_BUFFER, ga.__webglSkinVertexABuffer),
                                    l.bufferData(l.ARRAY_BUFFER, wa, ab),
                                    l.bindBuffer(l.ARRAY_BUFFER, ga.__webglSkinVertexBBuffer),
                                    l.bufferData(l.ARRAY_BUFFER, xa, ab),
                                    l.bindBuffer(l.ARRAY_BUFFER, ga.__webglSkinIndicesBuffer),
                                    l.bufferData(l.ARRAY_BUFFER, ya, ab),
                                    l.bindBuffer(l.ARRAY_BUFFER, ga.__webglSkinWeightsBuffer),
                                    l.bufferData(l.ARRAY_BUFFER, za, ab))
                                }
                                if (Vd && sc) {
                                    O = 0;
                                    for (V = na.length; O < V; O++)
                                        S = Ea[na[O]],
                                        ib = S.vertexColors,
                                        Fc = S.color,
                                        3 === ib.length && sc === THREE.VertexColors ? (Gb = ib[0],
                                        Hb = ib[1],
                                        Ib = ib[2]) : Ib = Hb = Gb = Fc,
                                        Ma[Da] = Gb.r,
                                        Ma[Da + 1] = Gb.g,
                                        Ma[Da + 2] = Gb.b,
                                        Ma[Da + 3] = Hb.r,
                                        Ma[Da + 4] = Hb.g,
                                        Ma[Da + 5] = Hb.b,
                                        Ma[Da + 6] = Ib.r,
                                        Ma[Da + 7] = Ib.g,
                                        Ma[Da + 8] = Ib.b,
                                        Da += 9;
                                    O = 0;
                                    for (V = oa.length; O < V; O++)
                                        S = Ea[oa[O]],
                                        ib = S.vertexColors,
                                        Fc = S.color,
                                        4 === ib.length && sc === THREE.VertexColors ? (Gb = ib[0],
                                        Hb = ib[1],
                                        Ib = ib[2],
                                        Jc = ib[3]) : Jc = Ib = Hb = Gb = Fc,
                                        Ma[Da] = Gb.r,
                                        Ma[Da + 1] = Gb.g,
                                        Ma[Da + 2] = Gb.b,
                                        Ma[Da + 3] = Hb.r,
                                        Ma[Da + 4] = Hb.g,
                                        Ma[Da + 5] = Hb.b,
                                        Ma[Da + 6] = Ib.r,
                                        Ma[Da + 7] = Ib.g,
                                        Ma[Da + 8] = Ib.b,
                                        Ma[Da + 9] = Jc.r,
                                        Ma[Da + 10] = Jc.g,
                                        Ma[Da + 11] = Jc.b,
                                        Da += 12;
                                    0 < Da && (l.bindBuffer(l.ARRAY_BUFFER, ga.__webglColorBuffer),
                                    l.bufferData(l.ARRAY_BUFFER, Ma, ab))
                                }
                                if (Xd && Xa.hasTangents) {
                                    O = 0;
                                    for (V = na.length; O < V; O++)
                                        S = Ea[na[O]],
                                        jb = S.vertexTangents,
                                        vb = jb[0],
                                        $a = jb[1],
                                        Db = jb[2],
                                        va[qa] = vb.x,
                                        va[qa + 1] = vb.y,
                                        va[qa + 2] = vb.z,
                                        va[qa + 3] = vb.w,
                                        va[qa + 4] = $a.x,
                                        va[qa + 5] = $a.y,
                                        va[qa + 6] = $a.z,
                                        va[qa + 7] = $a.w,
                                        va[qa + 8] = Db.x,
                                        va[qa + 9] = Db.y,
                                        va[qa + 10] = Db.z,
                                        va[qa + 11] = Db.w,
                                        qa += 12;
                                    O = 0;
                                    for (V = oa.length; O < V; O++)
                                        S = Ea[oa[O]],
                                        jb = S.vertexTangents,
                                        vb = jb[0],
                                        $a = jb[1],
                                        Db = jb[2],
                                        Hc = jb[3],
                                        va[qa] = vb.x,
                                        va[qa + 1] = vb.y,
                                        va[qa + 2] = vb.z,
                                        va[qa + 3] = vb.w,
                                        va[qa + 4] = $a.x,
                                        va[qa + 5] = $a.y,
                                        va[qa + 6] = $a.z,
                                        va[qa + 7] = $a.w,
                                        va[qa + 8] = Db.x,
                                        va[qa + 9] = Db.y,
                                        va[qa + 10] = Db.z,
                                        va[qa + 11] = Db.w,
                                        va[qa + 12] = Hc.x,
                                        va[qa + 13] = Hc.y,
                                        va[qa + 14] = Hc.z,
                                        va[qa + 15] = Hc.w,
                                        qa += 16;
                                    l.bindBuffer(l.ARRAY_BUFFER, ga.__webglTangentBuffer);
                                    l.bufferData(l.ARRAY_BUFFER, va, ab)
                                }
                                if (Ud && Pc) {
                                    O = 0;
                                    for (V = na.length; O < V; O++)
                                        if (S = Ea[na[O]],
                                        kc = S.vertexNormals,
                                        hb = S.normal,
                                        3 === kc.length && uc)
                                            for (ma = 0; 3 > ma; ma++)
                                                ic = kc[ma],
                                                rb[Wa] = ic.x,
                                                rb[Wa + 1] = ic.y,
                                                rb[Wa + 2] = ic.z,
                                                Wa += 3;
                                        else
                                            for (ma = 0; 3 > ma; ma++)
                                                rb[Wa] = hb.x,
                                                rb[Wa + 1] = hb.y,
                                                rb[Wa + 2] = hb.z,
                                                Wa += 3;
                                    O = 0;
                                    for (V = oa.length; O < V; O++)
                                        if (S = Ea[oa[O]],
                                        kc = S.vertexNormals,
                                        hb = S.normal,
                                        4 === kc.length && uc)
                                            for (ma = 0; 4 > ma; ma++)
                                                ic = kc[ma],
                                                rb[Wa] = ic.x,
                                                rb[Wa + 1] = ic.y,
                                                rb[Wa + 2] = ic.z,
                                                Wa += 3;
                                        else
                                            for (ma = 0; 4 > ma; ma++)
                                                rb[Wa] = hb.x,
                                                rb[Wa + 1] = hb.y,
                                                rb[Wa + 2] = hb.z,
                                                Wa += 3;
                                    l.bindBuffer(l.ARRAY_BUFFER, ga.__webglNormalBuffer);
                                    l.bufferData(l.ARRAY_BUFFER, rb, ab)
                                }
                                if (Ad && sd && Qc) {
                                    O = 0;
                                    for (V = na.length; O < V; O++)
                                        if (nb = na[O],
                                        S = Ea[nb],
                                        Cb = sd[nb],
                                        void 0 !== Cb)
                                            for (ma = 0; 3 > ma; ma++)
                                                Dc = Cb[ma],
                                                Nc[Yb] = Dc.u,
                                                Nc[Yb + 1] = Dc.v,
                                                Yb += 2;
                                    O = 0;
                                    for (V = oa.length; O < V; O++)
                                        if (nb = oa[O],
                                        S = Ea[nb],
                                        Cb = sd[nb],
                                        void 0 !== Cb)
                                            for (ma = 0; 4 > ma; ma++)
                                                Dc = Cb[ma],
                                                Nc[Yb] = Dc.u,
                                                Nc[Yb + 1] = Dc.v,
                                                Yb += 2;
                                    0 < Yb && (l.bindBuffer(l.ARRAY_BUFFER, ga.__webglUVBuffer),
                                    l.bufferData(l.ARRAY_BUFFER, Nc, ab))
                                }
                                if (Ad && td && Qc) {
                                    O = 0;
                                    for (V = na.length; O < V; O++)
                                        if (nb = na[O],
                                        S = Ea[nb],
                                        lc = td[nb],
                                        void 0 !== lc)
                                            for (ma = 0; 3 > ma; ma++)
                                                Ec = lc[ma],
                                                Mc[Zb] = Ec.u,
                                                Mc[Zb + 1] = Ec.v,
                                                Zb += 2;
                                    O = 0;
                                    for (V = oa.length; O < V; O++)
                                        if (nb = oa[O],
                                        S = Ea[nb],
                                        lc = td[nb],
                                        void 0 !== lc)
                                            for (ma = 0; 4 > ma; ma++)
                                                Ec = lc[ma],
                                                Mc[Zb] = Ec.u,
                                                Mc[Zb + 1] = Ec.v,
                                                Zb += 2;
                                    0 < Zb && (l.bindBuffer(l.ARRAY_BUFFER, ga.__webglUV2Buffer),
                                    l.bufferData(l.ARRAY_BUFFER, Mc, ab))
                                }
                                if (Td) {
                                    O = 0;
                                    for (V = na.length; O < V; O++)
                                        S = Ea[na[O]],
                                        Qb[qb] = Ca,
                                        Qb[qb + 1] = Ca + 1,
                                        Qb[qb + 2] = Ca + 2,
                                        qb += 3,
                                        eb[Ya] = Ca,
                                        eb[Ya + 1] = Ca + 1,
                                        eb[Ya + 2] = Ca,
                                        eb[Ya + 3] = Ca + 2,
                                        eb[Ya + 4] = Ca + 1,
                                        eb[Ya + 5] = Ca + 2,
                                        Ya += 6,
                                        Ca += 3;
                                    O = 0;
                                    for (V = oa.length; O < V; O++)
                                        S = Ea[oa[O]],
                                        Qb[qb] = Ca,
                                        Qb[qb + 1] = Ca + 1,
                                        Qb[qb + 2] = Ca + 3,
                                        Qb[qb + 3] = Ca + 1,
                                        Qb[qb + 4] = Ca + 2,
                                        Qb[qb + 5] = Ca + 3,
                                        qb += 6,
                                        eb[Ya] = Ca,
                                        eb[Ya + 1] = Ca + 1,
                                        eb[Ya + 2] = Ca,
                                        eb[Ya + 3] = Ca + 3,
                                        eb[Ya + 4] = Ca + 1,
                                        eb[Ya + 5] = Ca + 2,
                                        eb[Ya + 6] = Ca + 2,
                                        eb[Ya + 7] = Ca + 3,
                                        Ya += 8,
                                        Ca += 4;
                                    l.bindBuffer(l.ELEMENT_ARRAY_BUFFER, ga.__webglFaceBuffer);
                                    l.bufferData(l.ELEMENT_ARRAY_BUFFER, Qb, ab);
                                    l.bindBuffer(l.ELEMENT_ARRAY_BUFFER, ga.__webglLineBuffer);
                                    l.bufferData(l.ELEMENT_ARRAY_BUFFER, eb, ab)
                                }
                                if (nd) {
                                    ma = 0;
                                    for (Bd = nd.length; ma < Bd; ma++)
                                        if (G = nd[ma],
                                        G.__original.needsUpdate) {
                                            K = 0;
                                            if (1 === G.size)
                                                if (void 0 === G.boundTo || "vertices" === G.boundTo) {
                                                    O = 0;
                                                    for (V = na.length; O < V; O++)
                                                        S = Ea[na[O]],
                                                        G.array[K] = G.value[S.a],
                                                        G.array[K + 1] = G.value[S.b],
                                                        G.array[K + 2] = G.value[S.c],
                                                        K += 3;
                                                    O = 0;
                                                    for (V = oa.length; O < V; O++)
                                                        S = Ea[oa[O]],
                                                        G.array[K] = G.value[S.a],
                                                        G.array[K + 1] = G.value[S.b],
                                                        G.array[K + 2] = G.value[S.c],
                                                        G.array[K + 3] = G.value[S.d],
                                                        K += 4
                                                } else {
                                                    if ("faces" === G.boundTo) {
                                                        O = 0;
                                                        for (V = na.length; O < V; O++)
                                                            fb = G.value[na[O]],
                                                            G.array[K] = fb,
                                                            G.array[K + 1] = fb,
                                                            G.array[K + 2] = fb,
                                                            K += 3;
                                                        O = 0;
                                                        for (V = oa.length; O < V; O++)
                                                            fb = G.value[oa[O]],
                                                            G.array[K] = fb,
                                                            G.array[K + 1] = fb,
                                                            G.array[K + 2] = fb,
                                                            G.array[K + 3] = fb,
                                                            K += 4
                                                    }
                                                }
                                            else if (2 === G.size)
                                                if (void 0 === G.boundTo || "vertices" === G.boundTo) {
                                                    O = 0;
                                                    for (V = na.length; O < V; O++)
                                                        S = Ea[na[O]],
                                                        Y = G.value[S.a],
                                                        Z = G.value[S.b],
                                                        W = G.value[S.c],
                                                        G.array[K] = Y.x,
                                                        G.array[K + 1] = Y.y,
                                                        G.array[K + 2] = Z.x,
                                                        G.array[K + 3] = Z.y,
                                                        G.array[K + 4] = W.x,
                                                        G.array[K + 5] = W.y,
                                                        K += 6;
                                                    O = 0;
                                                    for (V = oa.length; O < V; O++)
                                                        S = Ea[oa[O]],
                                                        Y = G.value[S.a],
                                                        Z = G.value[S.b],
                                                        W = G.value[S.c],
                                                        ka = G.value[S.d],
                                                        G.array[K] = Y.x,
                                                        G.array[K + 1] = Y.y,
                                                        G.array[K + 2] = Z.x,
                                                        G.array[K + 3] = Z.y,
                                                        G.array[K + 4] = W.x,
                                                        G.array[K + 5] = W.y,
                                                        G.array[K + 6] = ka.x,
                                                        G.array[K + 7] = ka.y,
                                                        K += 8
                                                } else {
                                                    if ("faces" === G.boundTo) {
                                                        O = 0;
                                                        for (V = na.length; O < V; O++)
                                                            W = Z = Y = fb = G.value[na[O]],
                                                            G.array[K] = Y.x,
                                                            G.array[K + 1] = Y.y,
                                                            G.array[K + 2] = Z.x,
                                                            G.array[K + 3] = Z.y,
                                                            G.array[K + 4] = W.x,
                                                            G.array[K + 5] = W.y,
                                                            K += 6;
                                                        O = 0;
                                                        for (V = oa.length; O < V; O++)
                                                            ka = W = Z = Y = fb = G.value[oa[O]],
                                                            G.array[K] = Y.x,
                                                            G.array[K + 1] = Y.y,
                                                            G.array[K + 2] = Z.x,
                                                            G.array[K + 3] = Z.y,
                                                            G.array[K + 4] = W.x,
                                                            G.array[K + 5] = W.y,
                                                            G.array[K + 6] = ka.x,
                                                            G.array[K + 7] = ka.y,
                                                            K += 8
                                                    }
                                                }
                                            else if (3 === G.size) {
                                                var ia;
                                                ia = "c" === G.type ? ["r", "g", "b"] : ["x", "y", "z"];
                                                if (void 0 === G.boundTo || "vertices" === G.boundTo) {
                                                    O = 0;
                                                    for (V = na.length; O < V; O++)
                                                        S = Ea[na[O]],
                                                        Y = G.value[S.a],
                                                        Z = G.value[S.b],
                                                        W = G.value[S.c],
                                                        G.array[K] = Y[ia[0]],
                                                        G.array[K + 1] = Y[ia[1]],
                                                        G.array[K + 2] = Y[ia[2]],
                                                        G.array[K + 3] = Z[ia[0]],
                                                        G.array[K + 4] = Z[ia[1]],
                                                        G.array[K + 5] = Z[ia[2]],
                                                        G.array[K + 6] = W[ia[0]],
                                                        G.array[K + 7] = W[ia[1]],
                                                        G.array[K + 8] = W[ia[2]],
                                                        K += 9;
                                                    O = 0;
                                                    for (V = oa.length; O < V; O++)
                                                        S = Ea[oa[O]],
                                                        Y = G.value[S.a],
                                                        Z = G.value[S.b],
                                                        W = G.value[S.c],
                                                        ka = G.value[S.d],
                                                        G.array[K] = Y[ia[0]],
                                                        G.array[K + 1] = Y[ia[1]],
                                                        G.array[K + 2] = Y[ia[2]],
                                                        G.array[K + 3] = Z[ia[0]],
                                                        G.array[K + 4] = Z[ia[1]],
                                                        G.array[K + 5] = Z[ia[2]],
                                                        G.array[K + 6] = W[ia[0]],
                                                        G.array[K + 7] = W[ia[1]],
                                                        G.array[K + 8] = W[ia[2]],
                                                        G.array[K + 9] = ka[ia[0]],
                                                        G.array[K + 10] = ka[ia[1]],
                                                        G.array[K + 11] = ka[ia[2]],
                                                        K += 12
                                                } else if ("faces" === G.boundTo) {
                                                    O = 0;
                                                    for (V = na.length; O < V; O++)
                                                        W = Z = Y = fb = G.value[na[O]],
                                                        G.array[K] = Y[ia[0]],
                                                        G.array[K + 1] = Y[ia[1]],
                                                        G.array[K + 2] = Y[ia[2]],
                                                        G.array[K + 3] = Z[ia[0]],
                                                        G.array[K + 4] = Z[ia[1]],
                                                        G.array[K + 5] = Z[ia[2]],
                                                        G.array[K + 6] = W[ia[0]],
                                                        G.array[K + 7] = W[ia[1]],
                                                        G.array[K + 8] = W[ia[2]],
                                                        K += 9;
                                                    O = 0;
                                                    for (V = oa.length; O < V; O++)
                                                        ka = W = Z = Y = fb = G.value[oa[O]],
                                                        G.array[K] = Y[ia[0]],
                                                        G.array[K + 1] = Y[ia[1]],
                                                        G.array[K + 2] = Y[ia[2]],
                                                        G.array[K + 3] = Z[ia[0]],
                                                        G.array[K + 4] = Z[ia[1]],
                                                        G.array[K + 5] = Z[ia[2]],
                                                        G.array[K + 6] = W[ia[0]],
                                                        G.array[K + 7] = W[ia[1]],
                                                        G.array[K + 8] = W[ia[2]],
                                                        G.array[K + 9] = ka[ia[0]],
                                                        G.array[K + 10] = ka[ia[1]],
                                                        G.array[K + 11] = ka[ia[2]],
                                                        K += 12
                                                }
                                            } else if (4 === G.size)
                                                if (void 0 === G.boundTo || "vertices" === G.boundTo) {
                                                    O = 0;
                                                    for (V = na.length; O < V; O++)
                                                        S = Ea[na[O]],
                                                        Y = G.value[S.a],
                                                        Z = G.value[S.b],
                                                        W = G.value[S.c],
                                                        G.array[K] = Y.x,
                                                        G.array[K + 1] = Y.y,
                                                        G.array[K + 2] = Y.z,
                                                        G.array[K + 3] = Y.w,
                                                        G.array[K + 4] = Z.x,
                                                        G.array[K + 5] = Z.y,
                                                        G.array[K + 6] = Z.z,
                                                        G.array[K + 7] = Z.w,
                                                        G.array[K + 8] = W.x,
                                                        G.array[K + 9] = W.y,
                                                        G.array[K + 10] = W.z,
                                                        G.array[K + 11] = W.w,
                                                        K += 12;
                                                    O = 0;
                                                    for (V = oa.length; O < V; O++)
                                                        S = Ea[oa[O]],
                                                        Y = G.value[S.a],
                                                        Z = G.value[S.b],
                                                        W = G.value[S.c],
                                                        ka = G.value[S.d],
                                                        G.array[K] = Y.x,
                                                        G.array[K + 1] = Y.y,
                                                        G.array[K + 2] = Y.z,
                                                        G.array[K + 3] = Y.w,
                                                        G.array[K + 4] = Z.x,
                                                        G.array[K + 5] = Z.y,
                                                        G.array[K + 6] = Z.z,
                                                        G.array[K + 7] = Z.w,
                                                        G.array[K + 8] = W.x,
                                                        G.array[K + 9] = W.y,
                                                        G.array[K + 10] = W.z,
                                                        G.array[K + 11] = W.w,
                                                        G.array[K + 12] = ka.x,
                                                        G.array[K + 13] = ka.y,
                                                        G.array[K + 14] = ka.z,
                                                        G.array[K + 15] = ka.w,
                                                        K += 16
                                                } else if ("faces" === G.boundTo) {
                                                    O = 0;
                                                    for (V = na.length; O < V; O++)
                                                        W = Z = Y = fb = G.value[na[O]],
                                                        G.array[K] = Y.x,
                                                        G.array[K + 1] = Y.y,
                                                        G.array[K + 2] = Y.z,
                                                        G.array[K + 3] = Y.w,
                                                        G.array[K + 4] = Z.x,
                                                        G.array[K + 5] = Z.y,
                                                        G.array[K + 6] = Z.z,
                                                        G.array[K + 7] = Z.w,
                                                        G.array[K + 8] = W.x,
                                                        G.array[K + 9] = W.y,
                                                        G.array[K + 10] = W.z,
                                                        G.array[K + 11] = W.w,
                                                        K += 12;
                                                    O = 0;
                                                    for (V = oa.length; O < V; O++)
                                                        ka = W = Z = Y = fb = G.value[oa[O]],
                                                        G.array[K] = Y.x,
                                                        G.array[K + 1] = Y.y,
                                                        G.array[K + 2] = Y.z,
                                                        G.array[K + 3] = Y.w,
                                                        G.array[K + 4] = Z.x,
                                                        G.array[K + 5] = Z.y,
                                                        G.array[K + 6] = Z.z,
                                                        G.array[K + 7] = Z.w,
                                                        G.array[K + 8] = W.x,
                                                        G.array[K + 9] = W.y,
                                                        G.array[K + 10] = W.z,
                                                        G.array[K + 11] = W.w,
                                                        G.array[K + 12] = ka.x,
                                                        G.array[K + 13] = ka.y,
                                                        G.array[K + 14] = ka.z,
                                                        G.array[K + 15] = ka.w,
                                                        K += 16
                                                }
                                            l.bindBuffer(l.ARRAY_BUFFER, G.buffer);
                                            l.bufferData(l.ARRAY_BUFFER, G.array, ab)
                                        }
                                }
                                rd && (delete ga.__inittedArrays,
                                delete ga.__colorArray,
                                delete ga.__normalArray,
                                delete ga.__tangentArray,
                                delete ga.__uvArray,
                                delete ga.__uv2Array,
                                delete ga.__faceArray,
                                delete ga.__vertexArray,
                                delete ga.__lineArray,
                                delete ga.__skinVertexAArray,
                                delete ga.__skinVertexBArray,
                                delete ga.__skinIndexArray,
                                delete ga.__skinWeightArray)
                            }
                        }
                    ja.verticesNeedUpdate = !1;
                    ja.morphTargetsNeedUpdate = !1;
                    ja.elementsNeedUpdate = !1;
                    ja.uvsNeedUpdate = !1;
                    ja.normalsNeedUpdate = !1;
                    ja.colorsNeedUpdate = !1;
                    ja.tangetsNeedUpdate = !1;
                    Za.attributes && p(Za)
                }
            else if (tb instanceof THREE.Ribbon) {
                if (ja.verticesNeedUpdate || ja.colorsNeedUpdate) {
                    var oc = ja
                      , Id = l.DYNAMIC_DRAW
                      , Rc = void 0
                      , Sc = void 0
                      , bd = void 0
                      , pc = void 0
                      , cd = void 0
                      , Jd = oc.vertices
                      , Kd = oc.colors
                      , ie = Jd.length
                      , je = Kd.length
                      , dd = oc.__vertexArray
                      , ed = oc.__colorArray
                      , ke = oc.colorsNeedUpdate;
                    if (oc.verticesNeedUpdate) {
                        for (Rc = 0; Rc < ie; Rc++)
                            bd = Jd[Rc],
                            pc = 3 * Rc,
                            dd[pc] = bd.x,
                            dd[pc + 1] = bd.y,
                            dd[pc + 2] = bd.z;
                        l.bindBuffer(l.ARRAY_BUFFER, oc.__webglVertexBuffer);
                        l.bufferData(l.ARRAY_BUFFER, dd, Id)
                    }
                    if (ke) {
                        for (Sc = 0; Sc < je; Sc++)
                            cd = Kd[Sc],
                            pc = 3 * Sc,
                            ed[pc] = cd.r,
                            ed[pc + 1] = cd.g,
                            ed[pc + 2] = cd.b;
                        l.bindBuffer(l.ARRAY_BUFFER, oc.__webglColorBuffer);
                        l.bufferData(l.ARRAY_BUFFER, ed, Id)
                    }
                }
                ja.verticesNeedUpdate = !1;
                ja.colorsNeedUpdate = !1
            } else if (tb instanceof THREE.Line) {
                Za = c(tb, ub);
                mb = Za.attributes && n(Za);
                if (ja.verticesNeedUpdate || ja.colorsNeedUpdate || mb) {
                    var ac = ja
                      , ud = l.DYNAMIC_DRAW
                      , Tc = void 0
                      , Uc = void 0
                      , fd = void 0
                      , Aa = void 0
                      , gd = void 0
                      , Ld = ac.vertices
                      , Md = ac.colors
                      , le = Ld.length
                      , me = Md.length
                      , hd = ac.__vertexArray
                      , id = ac.__colorArray
                      , ne = ac.colorsNeedUpdate
                      , vd = ac.__webglCustomAttributesList
                      , jd = void 0
                      , Nd = void 0
                      , Sa = void 0
                      , Gc = void 0
                      , cb = void 0
                      , ua = void 0;
                    if (ac.verticesNeedUpdate) {
                        for (Tc = 0; Tc < le; Tc++)
                            fd = Ld[Tc],
                            Aa = 3 * Tc,
                            hd[Aa] = fd.x,
                            hd[Aa + 1] = fd.y,
                            hd[Aa + 2] = fd.z;
                        l.bindBuffer(l.ARRAY_BUFFER, ac.__webglVertexBuffer);
                        l.bufferData(l.ARRAY_BUFFER, hd, ud)
                    }
                    if (ne) {
                        for (Uc = 0; Uc < me; Uc++)
                            gd = Md[Uc],
                            Aa = 3 * Uc,
                            id[Aa] = gd.r,
                            id[Aa + 1] = gd.g,
                            id[Aa + 2] = gd.b;
                        l.bindBuffer(l.ARRAY_BUFFER, ac.__webglColorBuffer);
                        l.bufferData(l.ARRAY_BUFFER, id, ud)
                    }
                    if (vd) {
                        jd = 0;
                        for (Nd = vd.length; jd < Nd; jd++)
                            if (ua = vd[jd],
                            ua.needsUpdate && (void 0 === ua.boundTo || "vertices" === ua.boundTo)) {
                                Aa = 0;
                                Gc = ua.value.length;
                                if (1 === ua.size)
                                    for (Sa = 0; Sa < Gc; Sa++)
                                        ua.array[Sa] = ua.value[Sa];
                                else if (2 === ua.size)
                                    for (Sa = 0; Sa < Gc; Sa++)
                                        cb = ua.value[Sa],
                                        ua.array[Aa] = cb.x,
                                        ua.array[Aa + 1] = cb.y,
                                        Aa += 2;
                                else if (3 === ua.size)
                                    if ("c" === ua.type)
                                        for (Sa = 0; Sa < Gc; Sa++)
                                            cb = ua.value[Sa],
                                            ua.array[Aa] = cb.r,
                                            ua.array[Aa + 1] = cb.g,
                                            ua.array[Aa + 2] = cb.b,
                                            Aa += 3;
                                    else
                                        for (Sa = 0; Sa < Gc; Sa++)
                                            cb = ua.value[Sa],
                                            ua.array[Aa] = cb.x,
                                            ua.array[Aa + 1] = cb.y,
                                            ua.array[Aa + 2] = cb.z,
                                            Aa += 3;
                                else if (4 === ua.size)
                                    for (Sa = 0; Sa < Gc; Sa++)
                                        cb = ua.value[Sa],
                                        ua.array[Aa] = cb.x,
                                        ua.array[Aa + 1] = cb.y,
                                        ua.array[Aa + 2] = cb.z,
                                        ua.array[Aa + 3] = cb.w,
                                        Aa += 4;
                                l.bindBuffer(l.ARRAY_BUFFER, ua.buffer);
                                l.bufferData(l.ARRAY_BUFFER, ua.array, ud)
                            }
                    }
                }
                ja.verticesNeedUpdate = !1;
                ja.colorsNeedUpdate = !1;
                Za.attributes && p(Za)
            } else
                tb instanceof THREE.ParticleSystem && (Za = c(tb, ub),
                mb = Za.attributes && n(Za),
                (ja.verticesNeedUpdate || ja.colorsNeedUpdate || tb.sortParticles || mb) && f(ja, l.DYNAMIC_DRAW, tb),
                ja.verticesNeedUpdate = !1,
                ja.colorsNeedUpdate = !1,
                Za.attributes && p(Za))
        }
    }
    ;
    this.initMaterial = function(a, b, c, d) {
        var e, f, g;
        a instanceof THREE.MeshDepthMaterial ? g = "depth" : a instanceof THREE.MeshNormalMaterial ? g = "normal" : a instanceof THREE.MeshBasicMaterial ? g = "basic" : a instanceof THREE.MeshLambertMaterial ? g = "lambert" : a instanceof THREE.MeshPhongMaterial ? g = "phong" : a instanceof THREE.LineBasicMaterial ? g = "basic" : a instanceof THREE.ParticleBasicMaterial && (g = "particle_basic");
        if (g) {
            var h = THREE.ShaderLib[g];
            a.uniforms = THREE.UniformsUtils.clone(h.uniforms);
            a.vertexShader = h.vertexShader;
            a.fragmentShader = h.fragmentShader
        }
        var i, j, k, n, m;
        i = n = m = h = 0;
        for (j = b.length; i < j; i++)
            k = b[i],
            k.onlyShadow || (k instanceof THREE.DirectionalLight && n++,
            k instanceof THREE.PointLight && m++,
            k instanceof THREE.SpotLight && h++);
        m + h + n <= J ? (j = n,
        k = m,
        n = h) : (j = Math.ceil(J * n / (m + n)),
        n = k = J - j);
        var o = 0
          , h = 0;
        for (m = b.length; h < m; h++)
            i = b[h],
            i.castShadow && (i instanceof THREE.SpotLight && o++,
            i instanceof THREE.DirectionalLight && !i.shadowCascade && o++);
        var p = 50;
        void 0 !== d && d instanceof THREE.SkinnedMesh && (p = d.bones.length);
        var q;
        a: {
            m = a.fragmentShader;
            i = a.vertexShader;
            var h = a.uniforms, b = a.attributes, c = {
                map: !!a.map,
                envMap: !!a.envMap,
                lightMap: !!a.lightMap,
                vertexColors: a.vertexColors,
                fog: c,
                useFog: a.fog,
                sizeAttenuation: a.sizeAttenuation,
                skinning: a.skinning,
                maxBones: p,
                morphTargets: a.morphTargets,
                morphNormals: a.morphNormals,
                maxMorphTargets: this.maxMorphTargets,
                maxMorphNormals: this.maxMorphNormals,
                maxDirLights: j,
                maxPointLights: k,
                maxSpotLights: n,
                maxShadows: o,
                shadowMapEnabled: this.shadowMapEnabled && d.receiveShadow,
                shadowMapSoft: this.shadowMapSoft,
                shadowMapDebug: this.shadowMapDebug,
                shadowMapCascade: this.shadowMapCascade,
                alphaTest: a.alphaTest,
                metal: a.metal,
                perPixel: a.perPixel,
                wrapAround: a.wrapAround,
                doubleSided: d && d.doubleSided
            }, r, d = [];
            g ? d.push(g) : (d.push(m),
            d.push(i));
            for (r in c)
                d.push(r),
                d.push(c[r]);
            g = d.join();
            r = 0;
            for (d = Q.length; r < d; r++)
                if (Q[r].code === g) {
                    q = Q[r].program;
                    break a
                }
            r = l.createProgram();
            d = ["precision " + C + " float;", 0 < ra ? "#define VERTEX_TEXTURES" : "", F.gammaInput ? "#define GAMMA_INPUT" : "", F.gammaOutput ? "#define GAMMA_OUTPUT" : "", F.physicallyBasedShading ? "#define PHYSICALLY_BASED_SHADING" : "", "#define MAX_DIR_LIGHTS " + c.maxDirLights, "#define MAX_POINT_LIGHTS " + c.maxPointLights, "#define MAX_SPOT_LIGHTS " + c.maxSpotLights, "#define MAX_SHADOWS " + c.maxShadows, "#define MAX_BONES " + c.maxBones, c.map ? "#define USE_MAP" : "", c.envMap ? "#define USE_ENVMAP" : "", c.lightMap ? "#define USE_LIGHTMAP" : "", c.vertexColors ? "#define USE_COLOR" : "", c.skinning ? "#define USE_SKINNING" : "", c.morphTargets ? "#define USE_MORPHTARGETS" : "", c.morphNormals ? "#define USE_MORPHNORMALS" : "", c.perPixel ? "#define PHONG_PER_PIXEL" : "", c.wrapAround ? "#define WRAP_AROUND" : "", c.doubleSided ? "#define DOUBLE_SIDED" : "", c.shadowMapEnabled ? "#define USE_SHADOWMAP" : "", c.shadowMapSoft ? "#define SHADOWMAP_SOFT" : "", c.shadowMapDebug ? "#define SHADOWMAP_DEBUG" : "", c.shadowMapCascade ? "#define SHADOWMAP_CASCADE" : "", c.sizeAttenuation ? "#define USE_SIZEATTENUATION" : "", "uniform mat4 objectMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 cameraPosition;\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\nattribute vec2 uv2;\n#ifdef USE_COLOR\nattribute vec3 color;\n#endif\n#ifdef USE_MORPHTARGETS\nattribute vec3 morphTarget0;\nattribute vec3 morphTarget1;\nattribute vec3 morphTarget2;\nattribute vec3 morphTarget3;\n#ifdef USE_MORPHNORMALS\nattribute vec3 morphNormal0;\nattribute vec3 morphNormal1;\nattribute vec3 morphNormal2;\nattribute vec3 morphNormal3;\n#else\nattribute vec3 morphTarget4;\nattribute vec3 morphTarget5;\nattribute vec3 morphTarget6;\nattribute vec3 morphTarget7;\n#endif\n#endif\n#ifdef USE_SKINNING\nattribute vec4 skinVertexA;\nattribute vec4 skinVertexB;\nattribute vec4 skinIndex;\nattribute vec4 skinWeight;\n#endif\n"].join("\n");
            j = ["precision " + C + " float;", "#define MAX_DIR_LIGHTS " + c.maxDirLights, "#define MAX_POINT_LIGHTS " + c.maxPointLights, "#define MAX_SPOT_LIGHTS " + c.maxSpotLights, "#define MAX_SHADOWS " + c.maxShadows, c.alphaTest ? "#define ALPHATEST " + c.alphaTest : "", F.gammaInput ? "#define GAMMA_INPUT" : "", F.gammaOutput ? "#define GAMMA_OUTPUT" : "", F.physicallyBasedShading ? "#define PHYSICALLY_BASED_SHADING" : "", c.useFog && c.fog ? "#define USE_FOG" : "", c.useFog && c.fog instanceof THREE.FogExp2 ? "#define FOG_EXP2" : "", c.map ? "#define USE_MAP" : "", c.envMap ? "#define USE_ENVMAP" : "", c.lightMap ? "#define USE_LIGHTMAP" : "", c.vertexColors ? "#define USE_COLOR" : "", c.metal ? "#define METAL" : "", c.perPixel ? "#define PHONG_PER_PIXEL" : "", c.wrapAround ? "#define WRAP_AROUND" : "", c.doubleSided ? "#define DOUBLE_SIDED" : "", c.shadowMapEnabled ? "#define USE_SHADOWMAP" : "", c.shadowMapSoft ? "#define SHADOWMAP_SOFT" : "", c.shadowMapDebug ? "#define SHADOWMAP_DEBUG" : "", c.shadowMapCascade ? "#define SHADOWMAP_CASCADE" : "", "uniform mat4 viewMatrix;\nuniform vec3 cameraPosition;\n"].join("\n");
            l.attachShader(r, v("fragment", j + m));
            l.attachShader(r, v("vertex", d + i));
            l.linkProgram(r);
            l.getProgramParameter(r, l.LINK_STATUS) || console.error("Could not initialise shader\nVALIDATE_STATUS: " + l.getProgramParameter(r, l.VALIDATE_STATUS) + ", gl error [" + l.getError() + "]");
            r.uniforms = {};
            r.attributes = {};
            var s, d = "viewMatrix,modelViewMatrix,projectionMatrix,normalMatrix,objectMatrix,cameraPosition,boneGlobalMatrices,morphTargetInfluences".split(",");
            for (s in h)
                d.push(s);
            s = d;
            d = 0;
            for (h = s.length; d < h; d++)
                m = s[d],
                r.uniforms[m] = l.getUniformLocation(r, m);
            d = "position,normal,uv,uv2,tangent,color,skinVertexA,skinVertexB,skinIndex,skinWeight".split(",");
            for (s = 0; s < c.maxMorphTargets; s++)
                d.push("morphTarget" + s);
            for (s = 0; s < c.maxMorphNormals; s++)
                d.push("morphNormal" + s);
            for (q in b)
                d.push(q);
            q = d;
            s = 0;
            for (b = q.length; s < b; s++)
                c = q[s],
                r.attributes[c] = l.getAttribLocation(r, c);
            r.id = Q.length;
            Q.push({
                program: r,
                code: g
            });
            F.info.memory.programs = Q.length;
            q = r
        }
        a.program = q;
        q = a.program.attributes;
        0 <= q.position && l.enableVertexAttribArray(q.position);
        0 <= q.color && l.enableVertexAttribArray(q.color);
        0 <= q.normal && l.enableVertexAttribArray(q.normal);
        0 <= q.tangent && l.enableVertexAttribArray(q.tangent);
        a.skinning && 0 <= q.skinVertexA && 0 <= q.skinVertexB && 0 <= q.skinIndex && 0 <= q.skinWeight && (l.enableVertexAttribArray(q.skinVertexA),
        l.enableVertexAttribArray(q.skinVertexB),
        l.enableVertexAttribArray(q.skinIndex),
        l.enableVertexAttribArray(q.skinWeight));
        if (a.attributes)
            for (f in a.attributes)
                void 0 !== q[f] && 0 <= q[f] && l.enableVertexAttribArray(q[f]);
        if (a.morphTargets) {
            a.numSupportedMorphTargets = 0;
            r = "morphTarget";
            for (f = 0; f < this.maxMorphTargets; f++)
                s = r + f,
                0 <= q[s] && (l.enableVertexAttribArray(q[s]),
                a.numSupportedMorphTargets++)
        }
        if (a.morphNormals) {
            a.numSupportedMorphNormals = 0;
            r = "morphNormal";
            for (f = 0; f < this.maxMorphNormals; f++)
                s = r + f,
                0 <= q[s] && (l.enableVertexAttribArray(q[s]),
                a.numSupportedMorphNormals++)
        }
        a.uniformsList = [];
        for (e in a.uniforms)
            a.uniformsList.push([a.uniforms[e], e])
    }
    ;
    this.setFaceCulling = function(a, b) {
        a ? (!b || "ccw" === b ? l.frontFace(l.CCW) : l.frontFace(l.CW),
        "back" === a ? l.cullFace(l.BACK) : "front" === a ? l.cullFace(l.FRONT) : l.cullFace(l.FRONT_AND_BACK),
        l.enable(l.CULL_FACE)) : l.disable(l.CULL_FACE)
    }
    ;
    this.setObjectFaces = function(a) {
        ha !== a.doubleSided && (a.doubleSided ? l.disable(l.CULL_FACE) : l.enable(l.CULL_FACE),
        ha = a.doubleSided);
        U !== a.flipSided && (a.flipSided ? l.frontFace(l.CW) : l.frontFace(l.CCW),
        U = a.flipSided)
    }
    ;
    this.setDepthTest = function(a) {
        Ha !== a && (a ? l.enable(l.DEPTH_TEST) : l.disable(l.DEPTH_TEST),
        Ha = a)
    }
    ;
    this.setDepthWrite = function(a) {
        La !== a && (l.depthMask(a),
        La = a)
    }
    ;
    this.setBlending = function(a, b, c, d) {
        if (a !== X) {
            switch (a) {
            case THREE.NoBlending:
                l.disable(l.BLEND);
                break;
            case THREE.AdditiveBlending:
                l.enable(l.BLEND);
                l.blendEquation(l.FUNC_ADD);
                l.blendFunc(l.SRC_ALPHA, l.ONE);
                break;
            case THREE.SubtractiveBlending:
                l.enable(l.BLEND);
                l.blendEquation(l.FUNC_ADD);
                l.blendFunc(l.ZERO, l.ONE_MINUS_SRC_COLOR);
                break;
            case THREE.MultiplyBlending:
                l.enable(l.BLEND);
                l.blendEquation(l.FUNC_ADD);
                l.blendFunc(l.ZERO, l.SRC_COLOR);
                break;
            case THREE.CustomBlending:
                l.enable(l.BLEND);
                break;
            default:
                l.enable(l.BLEND),
                l.blendEquationSeparate(l.FUNC_ADD, l.FUNC_ADD),
                l.blendFuncSeparate(l.SRC_ALPHA, l.ONE_MINUS_SRC_ALPHA, l.ONE, l.ONE_MINUS_SRC_ALPHA)
            }
            X = a
        }
        if (a === THREE.CustomBlending) {
            if (b !== aa && (l.blendEquation(E(b)),
            aa = b),
            c !== ba || d !== m)
                l.blendFunc(E(c), E(d)),
                ba = c,
                m = d
        } else
            m = ba = aa = null
    }
    ;
    this.setTexture = function(a, b) {
        if (a.needsUpdate) {
            a.__webglInit || (a.__webglInit = !0,
            a.__webglTexture = l.createTexture(),
            F.info.memory.textures++);
            l.activeTexture(l.TEXTURE0 + b);
            l.bindTexture(l.TEXTURE_2D, a.__webglTexture);
            l.pixelStorei(l.UNPACK_PREMULTIPLY_ALPHA_WEBGL, a.premultiplyAlpha);
            var c = a.image
              , d = 0 === (c.width & c.width - 1) && 0 === (c.height & c.height - 1)
              , e = E(a.format)
              , f = E(a.type);
            x(l.TEXTURE_2D, a, d);
            a instanceof THREE.DataTexture ? l.texImage2D(l.TEXTURE_2D, 0, e, c.width, c.height, 0, e, f, c.data) : l.texImage2D(l.TEXTURE_2D, 0, e, e, f, a.image);
            a.generateMipmaps && d && l.generateMipmap(l.TEXTURE_2D);
            a.needsUpdate = !1;
            if (a.onUpdate)
                a.onUpdate()
        } else
            l.activeTexture(l.TEXTURE0 + b),
            l.bindTexture(l.TEXTURE_2D, a.__webglTexture)
    }
    ;
    this.setRenderTarget = function(a) {
        var b = a instanceof THREE.WebGLRenderTargetCube;
        if (a && !a.__webglFramebuffer) {
            void 0 === a.depthBuffer && (a.depthBuffer = !0);
            void 0 === a.stencilBuffer && (a.stencilBuffer = !0);
            a.__webglTexture = l.createTexture();
            var c = 0 === (a.width & a.width - 1) && 0 === (a.height & a.height - 1)
              , d = E(a.format)
              , e = E(a.type);
            if (b) {
                a.__webglFramebuffer = [];
                a.__webglRenderbuffer = [];
                l.bindTexture(l.TEXTURE_CUBE_MAP, a.__webglTexture);
                x(l.TEXTURE_CUBE_MAP, a, c);
                for (var f = 0; 6 > f; f++) {
                    a.__webglFramebuffer[f] = l.createFramebuffer();
                    a.__webglRenderbuffer[f] = l.createRenderbuffer();
                    l.texImage2D(l.TEXTURE_CUBE_MAP_POSITIVE_X + f, 0, d, a.width, a.height, 0, d, e, null);
                    var g = a
                      , h = l.TEXTURE_CUBE_MAP_POSITIVE_X + f;
                    l.bindFramebuffer(l.FRAMEBUFFER, a.__webglFramebuffer[f]);
                    l.framebufferTexture2D(l.FRAMEBUFFER, l.COLOR_ATTACHMENT0, h, g.__webglTexture, 0);
                    u(a.__webglRenderbuffer[f], a)
                }
                c && l.generateMipmap(l.TEXTURE_CUBE_MAP)
            } else
                a.__webglFramebuffer = l.createFramebuffer(),
                a.__webglRenderbuffer = l.createRenderbuffer(),
                l.bindTexture(l.TEXTURE_2D, a.__webglTexture),
                x(l.TEXTURE_2D, a, c),
                l.texImage2D(l.TEXTURE_2D, 0, d, a.width, a.height, 0, d, e, null),
                d = l.TEXTURE_2D,
                l.bindFramebuffer(l.FRAMEBUFFER, a.__webglFramebuffer),
                l.framebufferTexture2D(l.FRAMEBUFFER, l.COLOR_ATTACHMENT0, d, a.__webglTexture, 0),
                u(a.__webglRenderbuffer, a),
                c && l.generateMipmap(l.TEXTURE_2D);
            b ? l.bindTexture(l.TEXTURE_CUBE_MAP, null) : l.bindTexture(l.TEXTURE_2D, null);
            l.bindRenderbuffer(l.RENDERBUFFER, null);
            l.bindFramebuffer(l.FRAMEBUFFER, null)
        }
        a ? (b = b ? a.__webglFramebuffer[a.activeCubeFace] : a.__webglFramebuffer,
        c = a.width,
        a = a.height,
        e = d = 0) : (b = null,
        c = ob,
        a = Lb,
        d = Kb,
        e = xb);
        b !== B && (l.bindFramebuffer(l.FRAMEBUFFER, b),
        l.viewport(d, e, c, a),
        B = b);
        Ab = c;
        Vb = a
    }
    ;
    this.shadowMapPlugin = new THREE.ShadowMapPlugin;
    this.addPrePlugin(this.shadowMapPlugin);
    this.addPostPlugin(new THREE.SpritePlugin);
    this.addPostPlugin(new THREE.LensFlarePlugin)
}
;
THREE.WebGLRenderTarget = function(a, b, c) {
    this.width = a;
    this.height = b;
    c = c || {};
    this.wrapS = void 0 !== c.wrapS ? c.wrapS : THREE.ClampToEdgeWrapping;
    this.wrapT = void 0 !== c.wrapT ? c.wrapT : THREE.ClampToEdgeWrapping;
    this.magFilter = void 0 !== c.magFilter ? c.magFilter : THREE.LinearFilter;
    this.minFilter = void 0 !== c.minFilter ? c.minFilter : THREE.LinearMipMapLinearFilter;
    this.offset = new THREE.Vector2(0,0);
    this.repeat = new THREE.Vector2(1,1);
    this.format = void 0 !== c.format ? c.format : THREE.RGBAFormat;
    this.type = void 0 !== c.type ? c.type : THREE.UnsignedByteType;
    this.depthBuffer = void 0 !== c.depthBuffer ? c.depthBuffer : !0;
    this.stencilBuffer = void 0 !== c.stencilBuffer ? c.stencilBuffer : !0;
    this.generateMipmaps = !0
}
;
THREE.WebGLRenderTarget.prototype.clone = function() {
    var a = new THREE.WebGLRenderTarget(this.width,this.height);
    a.wrapS = this.wrapS;
    a.wrapT = this.wrapT;
    a.magFilter = this.magFilter;
    a.minFilter = this.minFilter;
    a.offset.copy(this.offset);
    a.repeat.copy(this.repeat);
    a.format = this.format;
    a.type = this.type;
    a.depthBuffer = this.depthBuffer;
    a.stencilBuffer = this.stencilBuffer;
    return a
}
;
THREE.WebGLRenderTargetCube = function(a, b, c) {
    THREE.WebGLRenderTarget.call(this, a, b, c);
    this.activeCubeFace = 0
}
;
THREE.WebGLRenderTargetCube.prototype = new THREE.WebGLRenderTarget;
THREE.WebGLRenderTargetCube.prototype.constructor = THREE.WebGLRenderTargetCube;
THREE.RenderableVertex = function() {
    this.positionWorld = new THREE.Vector3;
    this.positionScreen = new THREE.Vector4;
    this.visible = !0
}
;
THREE.RenderableVertex.prototype.copy = function(a) {
    this.positionWorld.copy(a.positionWorld);
    this.positionScreen.copy(a.positionScreen)
}
;
THREE.RenderableFace3 = function() {
    this.v1 = new THREE.RenderableVertex;
    this.v2 = new THREE.RenderableVertex;
    this.v3 = new THREE.RenderableVertex;
    this.centroidWorld = new THREE.Vector3;
    this.centroidScreen = new THREE.Vector3;
    this.normalWorld = new THREE.Vector3;
    this.vertexNormalsWorld = [new THREE.Vector3, new THREE.Vector3, new THREE.Vector3];
    this.faceMaterial = this.material = null;
    this.uvs = [[]];
    this.z = null
}
;
THREE.RenderableFace4 = function() {
    this.v1 = new THREE.RenderableVertex;
    this.v2 = new THREE.RenderableVertex;
    this.v3 = new THREE.RenderableVertex;
    this.v4 = new THREE.RenderableVertex;
    this.centroidWorld = new THREE.Vector3;
    this.centroidScreen = new THREE.Vector3;
    this.normalWorld = new THREE.Vector3;
    this.vertexNormalsWorld = [new THREE.Vector3, new THREE.Vector3, new THREE.Vector3, new THREE.Vector3];
    this.faceMaterial = this.material = null;
    this.uvs = [[]];
    this.z = null
}
;
THREE.RenderableObject = function() {
    this.z = this.object = null
}
;
THREE.RenderableParticle = function() {
    this.rotation = this.z = this.y = this.x = null;
    this.scale = new THREE.Vector2;
    this.material = null
}
;
THREE.RenderableLine = function() {
    this.z = null;
    this.v1 = new THREE.RenderableVertex;
    this.v2 = new THREE.RenderableVertex;
    this.material = null
}
;
THREE.ColorUtils = {
    adjustHSV: function(a, b, c, d) {
        var e = THREE.ColorUtils.__hsv;
        THREE.ColorUtils.rgbToHsv(a, e);
        e.h = THREE.Math.clamp(e.h + b, 0, 1);
        e.s = THREE.Math.clamp(e.s + c, 0, 1);
        e.v = THREE.Math.clamp(e.v + d, 0, 1);
        a.setHSV(e.h, e.s, e.v)
    },
    rgbToHsv: function(a, b) {
        var c = a.r
          , d = a.g
          , e = a.b
          , f = Math.max(Math.max(c, d), e)
          , g = Math.min(Math.min(c, d), e);
        if (g === f)
            g = c = 0;
        else {
            var h = f - g
              , g = h / f
              , c = (c === f ? (d - e) / h : d === f ? 2 + (e - c) / h : 4 + (c - d) / h) / 6;
            0 > c && (c += 1);
            1 < c && (c -= 1)
        }
        void 0 === b && (b = {
            h: 0,
            s: 0,
            v: 0
        });
        b.h = c;
        b.s = g;
        b.v = f;
        return b
    }
};
THREE.ColorUtils.__hsv = {
    h: 0,
    s: 0,
    v: 0
};
THREE.GeometryUtils = {
    merge: function(a, b) {
        for (var c, d, e = a.vertices.length, f = b instanceof THREE.Mesh ? b.geometry : b, g = a.vertices, h = f.vertices, i = a.faces, j = f.faces, k = a.faceVertexUvs[0], n = f.faceVertexUvs[0], p = {}, o = 0; o < a.materials.length; o++)
            p[a.materials[o].id] = o;
        b instanceof THREE.Mesh && (b.matrixAutoUpdate && b.updateMatrix(),
        c = b.matrix,
        d = new THREE.Matrix4,
        d.extractRotation(c, b.scale));
        for (var o = 0, r = h.length; o < r; o++) {
            var q = h[o].clone();
            c && c.multiplyVector3(q);
            g.push(q)
        }
        o = 0;
        for (r = j.length; o < r; o++) {
            var g = j[o], s, t, v = g.vertexNormals, x = g.vertexColors;
            g instanceof THREE.Face3 ? s = new THREE.Face3(g.a + e,g.b + e,g.c + e) : g instanceof THREE.Face4 && (s = new THREE.Face4(g.a + e,g.b + e,g.c + e,g.d + e));
            s.normal.copy(g.normal);
            d && d.multiplyVector3(s.normal);
            h = 0;
            for (q = v.length; h < q; h++)
                t = v[h].clone(),
                d && d.multiplyVector3(t),
                s.vertexNormals.push(t);
            s.color.copy(g.color);
            h = 0;
            for (q = x.length; h < q; h++)
                t = x[h],
                s.vertexColors.push(t.clone());
            void 0 !== g.materialIndex && (h = f.materials[g.materialIndex],
            q = h.id,
            x = p[q],
            void 0 === x && (x = a.materials.length,
            p[q] = x,
            a.materials.push(h)),
            s.materialIndex = x);
            s.centroid.copy(g.centroid);
            c && c.multiplyVector3(s.centroid);
            i.push(s)
        }
        o = 0;
        for (r = n.length; o < r; o++) {
            c = n[o];
            d = [];
            h = 0;
            for (q = c.length; h < q; h++)
                d.push(new THREE.UV(c[h].u,c[h].v));
            k.push(d)
        }
    },
    clone: function(a) {
        var b = new THREE.Geometry, c, d = a.vertices, e = a.faces, f = a.faceVertexUvs[0];
        a.materials && (b.materials = a.materials.slice());
        a = 0;
        for (c = d.length; a < c; a++)
            b.vertices.push(d[a].clone());
        a = 0;
        for (c = e.length; a < c; a++)
            b.faces.push(e[a].clone());
        a = 0;
        for (c = f.length; a < c; a++) {
            for (var d = f[a], e = [], g = 0, h = d.length; g < h; g++)
                e.push(new THREE.UV(d[g].u,d[g].v));
            b.faceVertexUvs[0].push(e)
        }
        return b
    },
    randomPointInTriangle: function(a, b, c) {
        var d, e, f, g = new THREE.Vector3, h = THREE.GeometryUtils.__v1;
        d = THREE.GeometryUtils.random();
        e = THREE.GeometryUtils.random();
        1 < d + e && (d = 1 - d,
        e = 1 - e);
        f = 1 - d - e;
        g.copy(a);
        g.multiplyScalar(d);
        h.copy(b);
        h.multiplyScalar(e);
        g.addSelf(h);
        h.copy(c);
        h.multiplyScalar(f);
        g.addSelf(h);
        return g
    },
    randomPointInFace: function(a, b, c) {
        var d, e, f;
        if (a instanceof THREE.Face3)
            return d = b.vertices[a.a],
            e = b.vertices[a.b],
            f = b.vertices[a.c],
            THREE.GeometryUtils.randomPointInTriangle(d, e, f);
        if (a instanceof THREE.Face4) {
            d = b.vertices[a.a];
            e = b.vertices[a.b];
            f = b.vertices[a.c];
            var b = b.vertices[a.d], g;
            c ? a._area1 && a._area2 ? (c = a._area1,
            g = a._area2) : (c = THREE.GeometryUtils.triangleArea(d, e, b),
            g = THREE.GeometryUtils.triangleArea(e, f, b),
            a._area1 = c,
            a._area2 = g) : (c = THREE.GeometryUtils.triangleArea(d, e, b),
            g = THREE.GeometryUtils.triangleArea(e, f, b));
            return THREE.GeometryUtils.random() * (c + g) < c ? THREE.GeometryUtils.randomPointInTriangle(d, e, b) : THREE.GeometryUtils.randomPointInTriangle(e, f, b)
        }
    },
    randomPointsInGeometry: function(a, b) {
        function c(a) {
            function b(c, d) {
                if (d < c)
                    return c;
                var e = c + Math.floor((d - c) / 2);
                return j[e] > a ? b(c, e - 1) : j[e] < a ? b(e + 1, d) : e
            }
            return b(0, j.length - 1)
        }
        var d, e, f = a.faces, g = a.vertices, h = f.length, i = 0, j = [], k, n, p, o;
        for (e = 0; e < h; e++)
            d = f[e],
            d instanceof THREE.Face3 ? (k = g[d.a],
            n = g[d.b],
            p = g[d.c],
            d._area = THREE.GeometryUtils.triangleArea(k, n, p)) : d instanceof THREE.Face4 && (k = g[d.a],
            n = g[d.b],
            p = g[d.c],
            o = g[d.d],
            d._area1 = THREE.GeometryUtils.triangleArea(k, n, o),
            d._area2 = THREE.GeometryUtils.triangleArea(n, p, o),
            d._area = d._area1 + d._area2),
            i += d._area,
            j[e] = i;
        d = [];
        for (e = 0; e < b; e++)
            g = THREE.GeometryUtils.random() * i,
            g = c(g),
            d[e] = THREE.GeometryUtils.randomPointInFace(f[g], a, !0);
        return d
    },
    triangleArea: function(a, b, c) {
        var d, e = THREE.GeometryUtils.__v1;
        e.sub(a, b);
        d = e.length();
        e.sub(a, c);
        a = e.length();
        e.sub(b, c);
        c = e.length();
        b = 0.5 * (d + a + c);
        return Math.sqrt(b * (b - d) * (b - a) * (b - c))
    },
    center: function(a) {
        a.computeBoundingBox();
        var b = a.boundingBox
          , c = new THREE.Vector3;
        c.add(b.min, b.max);
        c.multiplyScalar(-0.5);
        a.applyMatrix((new THREE.Matrix4).makeTranslation(c.x, c.y, c.z));
        a.computeBoundingBox();
        return c
    },
    normalizeUVs: function(a) {
        for (var a = a.faceVertexUvs[0], b = 0, c = a.length; b < c; b++)
            for (var d = a[b], e = 0, f = d.length; e < f; e++)
                if (1 !== d[e].u && (d[e].u -= Math.floor(d[e].u)),
                1 !== d[e].v)
                    d[e].v -= Math.floor(d[e].v)
    },
    triangulateQuads: function(a) {
        var b, c, d, e, f = [], g = [], h = [];
        b = 0;
        for (c = a.faceUvs.length; b < c; b++)
            g[b] = [];
        b = 0;
        for (c = a.faceVertexUvs.length; b < c; b++)
            h[b] = [];
        b = 0;
        for (c = a.faces.length; b < c; b++)
            if (d = a.faces[b],
            d instanceof THREE.Face4) {
                e = d.a;
                var i = d.b
                  , j = d.c
                  , k = d.d
                  , n = new THREE.Face3
                  , p = new THREE.Face3;
                n.color.copy(d.color);
                p.color.copy(d.color);
                n.materialIndex = d.materialIndex;
                p.materialIndex = d.materialIndex;
                n.a = e;
                n.b = i;
                n.c = k;
                p.a = i;
                p.b = j;
                p.c = k;
                4 === d.vertexColors.length && (n.vertexColors[0] = d.vertexColors[0].clone(),
                n.vertexColors[1] = d.vertexColors[1].clone(),
                n.vertexColors[2] = d.vertexColors[3].clone(),
                p.vertexColors[0] = d.vertexColors[1].clone(),
                p.vertexColors[1] = d.vertexColors[2].clone(),
                p.vertexColors[2] = d.vertexColors[3].clone());
                f.push(n, p);
                d = 0;
                for (e = a.faceVertexUvs.length; d < e; d++)
                    a.faceVertexUvs[d].length && (n = a.faceVertexUvs[d][b],
                    i = n[1],
                    j = n[2],
                    k = n[3],
                    n = [n[0].clone(), i.clone(), k.clone()],
                    i = [i.clone(), j.clone(), k.clone()],
                    h[d].push(n, i));
                d = 0;
                for (e = a.faceUvs.length; d < e; d++)
                    a.faceUvs[d].length && (i = a.faceUvs[d][b],
                    g[d].push(i, i))
            } else {
                f.push(d);
                d = 0;
                for (e = a.faceUvs.length; d < e; d++)
                    g[d].push(a.faceUvs[d]);
                d = 0;
                for (e = a.faceVertexUvs.length; d < e; d++)
                    h[d].push(a.faceVertexUvs[d])
            }
        a.faces = f;
        a.faceUvs = g;
        a.faceVertexUvs = h;
        a.computeCentroids();
        a.computeFaceNormals();
        a.computeVertexNormals();
        a.hasTangents && a.computeTangents()
    },
    explode: function(a) {
        for (var b = [], c = 0, d = a.faces.length; c < d; c++) {
            var e = b.length
              , f = a.faces[c];
            if (f instanceof THREE.Face4) {
                var g = f.a
                  , h = f.b
                  , i = f.c
                  , g = a.vertices[g]
                  , h = a.vertices[h]
                  , i = a.vertices[i]
                  , j = a.vertices[f.d];
                b.push(g.clone());
                b.push(h.clone());
                b.push(i.clone());
                b.push(j.clone());
                f.a = e;
                f.b = e + 1;
                f.c = e + 2;
                f.d = e + 3
            } else
                g = f.a,
                h = f.b,
                i = f.c,
                g = a.vertices[g],
                h = a.vertices[h],
                i = a.vertices[i],
                b.push(g.clone()),
                b.push(h.clone()),
                b.push(i.clone()),
                f.a = e,
                f.b = e + 1,
                f.c = e + 2
        }
        a.vertices = b;
        delete a.__tmpVertices
    },
    tessellate: function(a, b) {
        var c, d, e, f, g, h, i, j, k, n, p, o, r, q, s, t, v, x, u, y = [], E = [];
        c = 0;
        for (d = a.faceVertexUvs.length; c < d; c++)
            E[c] = [];
        c = 0;
        for (d = a.faces.length; c < d; c++)
            if (e = a.faces[c],
            e instanceof THREE.Face3)
                if (f = e.a,
                g = e.b,
                h = e.c,
                j = a.vertices[f],
                k = a.vertices[g],
                n = a.vertices[h],
                o = j.distanceTo(k),
                r = k.distanceTo(n),
                p = j.distanceTo(n),
                o > b || r > b || p > b) {
                    i = a.vertices.length;
                    x = e.clone();
                    u = e.clone();
                    o >= r && o >= p ? (j = j.clone(),
                    j.lerpSelf(k, 0.5),
                    x.a = f,
                    x.b = i,
                    x.c = h,
                    u.a = i,
                    u.b = g,
                    u.c = h,
                    3 === e.vertexNormals.length && (f = e.vertexNormals[0].clone(),
                    f.lerpSelf(e.vertexNormals[1], 0.5),
                    x.vertexNormals[1].copy(f),
                    u.vertexNormals[0].copy(f)),
                    3 === e.vertexColors.length && (f = e.vertexColors[0].clone(),
                    f.lerpSelf(e.vertexColors[1], 0.5),
                    x.vertexColors[1].copy(f),
                    u.vertexColors[0].copy(f)),
                    e = 0) : r >= o && r >= p ? (j = k.clone(),
                    j.lerpSelf(n, 0.5),
                    x.a = f,
                    x.b = g,
                    x.c = i,
                    u.a = i,
                    u.b = h,
                    u.c = f,
                    3 === e.vertexNormals.length && (f = e.vertexNormals[1].clone(),
                    f.lerpSelf(e.vertexNormals[2], 0.5),
                    x.vertexNormals[2].copy(f),
                    u.vertexNormals[0].copy(f),
                    u.vertexNormals[1].copy(e.vertexNormals[2]),
                    u.vertexNormals[2].copy(e.vertexNormals[0])),
                    3 === e.vertexColors.length && (f = e.vertexColors[1].clone(),
                    f.lerpSelf(e.vertexColors[2], 0.5),
                    x.vertexColors[2].copy(f),
                    u.vertexColors[0].copy(f),
                    u.vertexColors[1].copy(e.vertexColors[2]),
                    u.vertexColors[2].copy(e.vertexColors[0])),
                    e = 1) : (j = j.clone(),
                    j.lerpSelf(n, 0.5),
                    x.a = f,
                    x.b = g,
                    x.c = i,
                    u.a = i,
                    u.b = g,
                    u.c = h,
                    3 === e.vertexNormals.length && (f = e.vertexNormals[0].clone(),
                    f.lerpSelf(e.vertexNormals[2], 0.5),
                    x.vertexNormals[2].copy(f),
                    u.vertexNormals[0].copy(f)),
                    3 === e.vertexColors.length && (f = e.vertexColors[0].clone(),
                    f.lerpSelf(e.vertexColors[2], 0.5),
                    x.vertexColors[2].copy(f),
                    u.vertexColors[0].copy(f)),
                    e = 2);
                    y.push(x, u);
                    a.vertices.push(j);
                    f = 0;
                    for (g = a.faceVertexUvs.length; f < g; f++)
                        a.faceVertexUvs[f].length && (j = a.faceVertexUvs[f][c],
                        u = j[0],
                        h = j[1],
                        x = j[2],
                        0 === e ? (k = u.clone(),
                        k.lerpSelf(h, 0.5),
                        j = [u.clone(), k.clone(), x.clone()],
                        h = [k.clone(), h.clone(), x.clone()]) : 1 === e ? (k = h.clone(),
                        k.lerpSelf(x, 0.5),
                        j = [u.clone(), h.clone(), k.clone()],
                        h = [k.clone(), x.clone(), u.clone()]) : (k = u.clone(),
                        k.lerpSelf(x, 0.5),
                        j = [u.clone(), h.clone(), k.clone()],
                        h = [k.clone(), h.clone(), x.clone()]),
                        E[f].push(j, h))
                } else {
                    y.push(e);
                    f = 0;
                    for (g = a.faceVertexUvs.length; f < g; f++)
                        E[f].push(a.faceVertexUvs[f][c])
                }
            else if (f = e.a,
            g = e.b,
            h = e.c,
            i = e.d,
            j = a.vertices[f],
            k = a.vertices[g],
            n = a.vertices[h],
            p = a.vertices[i],
            o = j.distanceTo(k),
            r = k.distanceTo(n),
            q = n.distanceTo(p),
            s = j.distanceTo(p),
            o > b || r > b || q > b || s > b) {
                t = a.vertices.length;
                v = a.vertices.length + 1;
                x = e.clone();
                u = e.clone();
                o >= r && o >= q && o >= s || q >= r && q >= o && q >= s ? (o = j.clone(),
                o.lerpSelf(k, 0.5),
                k = n.clone(),
                k.lerpSelf(p, 0.5),
                x.a = f,
                x.b = t,
                x.c = v,
                x.d = i,
                u.a = t,
                u.b = g,
                u.c = h,
                u.d = v,
                4 === e.vertexNormals.length && (f = e.vertexNormals[0].clone(),
                f.lerpSelf(e.vertexNormals[1], 0.5),
                g = e.vertexNormals[2].clone(),
                g.lerpSelf(e.vertexNormals[3], 0.5),
                x.vertexNormals[1].copy(f),
                x.vertexNormals[2].copy(g),
                u.vertexNormals[0].copy(f),
                u.vertexNormals[3].copy(g)),
                4 === e.vertexColors.length && (f = e.vertexColors[0].clone(),
                f.lerpSelf(e.vertexColors[1], 0.5),
                g = e.vertexColors[2].clone(),
                g.lerpSelf(e.vertexColors[3], 0.5),
                x.vertexColors[1].copy(f),
                x.vertexColors[2].copy(g),
                u.vertexColors[0].copy(f),
                u.vertexColors[3].copy(g)),
                e = 0) : (o = k.clone(),
                o.lerpSelf(n, 0.5),
                k = p.clone(),
                k.lerpSelf(j, 0.5),
                x.a = f,
                x.b = g,
                x.c = t,
                x.d = v,
                u.a = v,
                u.b = t,
                u.c = h,
                u.d = i,
                4 === e.vertexNormals.length && (f = e.vertexNormals[1].clone(),
                f.lerpSelf(e.vertexNormals[2], 0.5),
                g = e.vertexNormals[3].clone(),
                g.lerpSelf(e.vertexNormals[0], 0.5),
                x.vertexNormals[2].copy(f),
                x.vertexNormals[3].copy(g),
                u.vertexNormals[0].copy(g),
                u.vertexNormals[1].copy(f)),
                4 === e.vertexColors.length && (f = e.vertexColors[1].clone(),
                f.lerpSelf(e.vertexColors[2], 0.5),
                g = e.vertexColors[3].clone(),
                g.lerpSelf(e.vertexColors[0], 0.5),
                x.vertexColors[2].copy(f),
                x.vertexColors[3].copy(g),
                u.vertexColors[0].copy(g),
                u.vertexColors[1].copy(f)),
                e = 1);
                y.push(x, u);
                a.vertices.push(o, k);
                f = 0;
                for (g = a.faceVertexUvs.length; f < g; f++)
                    a.faceVertexUvs[f].length && (j = a.faceVertexUvs[f][c],
                    u = j[0],
                    h = j[1],
                    x = j[2],
                    j = j[3],
                    0 === e ? (k = u.clone(),
                    k.lerpSelf(h, 0.5),
                    n = x.clone(),
                    n.lerpSelf(j, 0.5),
                    u = [u.clone(), k.clone(), n.clone(), j.clone()],
                    h = [k.clone(), h.clone(), x.clone(), n.clone()]) : (k = h.clone(),
                    k.lerpSelf(x, 0.5),
                    n = j.clone(),
                    n.lerpSelf(u, 0.5),
                    u = [u.clone(), h.clone(), k.clone(), n.clone()],
                    h = [n.clone(), k.clone(), x.clone(), j.clone()]),
                    E[f].push(u, h))
            } else {
                y.push(e);
                f = 0;
                for (g = a.faceVertexUvs.length; f < g; f++)
                    E[f].push(a.faceVertexUvs[f][c])
            }
        a.faces = y;
        a.faceVertexUvs = E
    }
};
THREE.GeometryUtils.random = THREE.Math.random16;
THREE.GeometryUtils.__v1 = new THREE.Vector3;
THREE.ImageUtils = {
    crossOrigin: "anonymous",
    loadTexture: function(a, b, c) {
        var d = new Image
          , e = new THREE.Texture(d,b);
        d.onload = function() {
            e.needsUpdate = !0;
            c && c(this)
        }
        ;
        d.crossOrigin = this.crossOrigin;
        d.src = a;
        return e
    },
    loadTextureCube: function(a, b, c) {
        var d, e = [], f = new THREE.Texture(e,b), b = e.loadCount = 0;
        for (d = a.length; b < d; ++b)
            e[b] = new Image,
            e[b].onload = function() {
                e.loadCount += 1;
                6 === e.loadCount && (f.needsUpdate = !0);
                c && c(this)
            }
            ,
            e[b].crossOrigin = this.crossOrigin,
            e[b].src = a[b];
        return f
    },
    getNormalMap: function(a, b) {
        var c = function(a) {
            var b = Math.sqrt(a[0] * a[0] + a[1] * a[1] + a[2] * a[2]);
            return [a[0] / b, a[1] / b, a[2] / b]
        }
          , b = b | 1
          , d = a.width
          , e = a.height
          , f = document.createElement("canvas");
        f.width = d;
        f.height = e;
        var g = f.getContext("2d");
        g.drawImage(a, 0, 0);
        for (var h = g.getImageData(0, 0, d, e).data, i = g.createImageData(d, e), j = i.data, k = 0; k < d; k++)
            for (var n = 0; n < e; n++) {
                var p = 0 > n - 1 ? 0 : n - 1
                  , o = n + 1 > e - 1 ? e - 1 : n + 1
                  , r = 0 > k - 1 ? 0 : k - 1
                  , q = k + 1 > d - 1 ? d - 1 : k + 1
                  , s = []
                  , t = [0, 0, h[4 * (n * d + k)] / 255 * b];
                s.push([-1, 0, h[4 * (n * d + r)] / 255 * b]);
                s.push([-1, -1, h[4 * (p * d + r)] / 255 * b]);
                s.push([0, -1, h[4 * (p * d + k)] / 255 * b]);
                s.push([1, -1, h[4 * (p * d + q)] / 255 * b]);
                s.push([1, 0, h[4 * (n * d + q)] / 255 * b]);
                s.push([1, 1, h[4 * (o * d + q)] / 255 * b]);
                s.push([0, 1, h[4 * (o * d + k)] / 255 * b]);
                s.push([-1, 1, h[4 * (o * d + r)] / 255 * b]);
                p = [];
                r = s.length;
                for (o = 0; o < r; o++) {
                    var q = s[o]
                      , v = s[(o + 1) % r]
                      , q = [q[0] - t[0], q[1] - t[1], q[2] - t[2]]
                      , v = [v[0] - t[0], v[1] - t[1], v[2] - t[2]];
                    p.push(c([q[1] * v[2] - q[2] * v[1], q[2] * v[0] - q[0] * v[2], q[0] * v[1] - q[1] * v[0]]))
                }
                s = [0, 0, 0];
                for (o = 0; o < p.length; o++)
                    s[0] += p[o][0],
                    s[1] += p[o][1],
                    s[2] += p[o][2];
                s[0] /= p.length;
                s[1] /= p.length;
                s[2] /= p.length;
                t = 4 * (n * d + k);
                j[t] = 255 * ((s[0] + 1) / 2) | 0;
                j[t + 1] = 255 * (s[1] + 0.5) | 0;
                j[t + 2] = 255 * s[2] | 0;
                j[t + 3] = 255
            }
        g.putImageData(i, 0, 0);
        return f
    },
    generateDataTexture: function(a, b, c) {
        for (var d = a * b, e = new Uint8Array(3 * d), f = Math.floor(255 * c.r), g = Math.floor(255 * c.g), c = Math.floor(255 * c.b), h = 0; h < d; h++)
            e[3 * h] = f,
            e[3 * h + 1] = g,
            e[3 * h + 2] = c;
        a = new THREE.DataTexture(e,a,b,THREE.RGBFormat);
        a.needsUpdate = !0;
        return a
    }
};
THREE.SceneUtils = {
    showHierarchy: function(a, b) {
        THREE.SceneUtils.traverseHierarchy(a, function(a) {
            a.visible = b
        })
    },
    traverseHierarchy: function(a, b) {
        var c, d, e = a.children.length;
        for (d = 0; d < e; d++)
            c = a.children[d],
            b(c),
            THREE.SceneUtils.traverseHierarchy(c, b)
    },
    createMultiMaterialObject: function(a, b) {
        var c, d = b.length, e = new THREE.Object3D;
        for (c = 0; c < d; c++) {
            var f = new THREE.Mesh(a,b[c]);
            e.add(f)
        }
        return e
    },
    cloneObject: function(a) {
        var b;
        a instanceof THREE.MorphAnimMesh ? (b = new THREE.MorphAnimMesh(a.geometry,a.material),
        b.duration = a.duration,
        b.mirroredLoop = a.mirroredLoop,
        b.time = a.time,
        b.lastKeyframe = a.lastKeyframe,
        b.currentKeyframe = a.currentKeyframe,
        b.direction = a.direction,
        b.directionBackwards = a.directionBackwards) : a instanceof THREE.SkinnedMesh ? b = new THREE.SkinnedMesh(a.geometry,a.material) : a instanceof THREE.Mesh ? b = new THREE.Mesh(a.geometry,a.material) : a instanceof THREE.Line ? b = new THREE.Line(a.geometry,a.material,a.type) : a instanceof THREE.Ribbon ? b = new THREE.Ribbon(a.geometry,a.material) : a instanceof THREE.ParticleSystem ? (b = new THREE.ParticleSystem(a.geometry,a.material),
        b.sortParticles = a.sortParticles) : a instanceof THREE.Particle ? b = new THREE.Particle(a.material) : a instanceof THREE.Sprite ? (b = new THREE.Sprite({}),
        b.color.copy(a.color),
        b.map = a.map,
        b.blending = a.blending,
        b.useScreenCoordinates = a.useScreenCoordinates,
        b.mergeWith3D = a.mergeWith3D,
        b.affectedByDistance = a.affectedByDistance,
        b.scaleByViewport = a.scaleByViewport,
        b.alignment = a.alignment,
        b.rotation3d.copy(a.rotation3d),
        b.rotation = a.rotation,
        b.opacity = a.opacity,
        b.uvOffset.copy(a.uvOffset),
        b.uvScale.copy(a.uvScale)) : a instanceof THREE.LOD ? b = new THREE.LOD : a instanceof THREE.Object3D && (b = new THREE.Object3D);
        b.name = a.name;
        b.parent = a.parent;
        b.up.copy(a.up);
        b.position.copy(a.position);
        b.rotation instanceof THREE.Vector3 && b.rotation.copy(a.rotation);
        b.eulerOrder = a.eulerOrder;
        b.scale.copy(a.scale);
        b.dynamic = a.dynamic;
        b.doubleSided = a.doubleSided;
        b.flipSided = a.flipSided;
        b.renderDepth = a.renderDepth;
        b.rotationAutoUpdate = a.rotationAutoUpdate;
        b.matrix.copy(a.matrix);
        b.matrixWorld.copy(a.matrixWorld);
        b.matrixRotationWorld.copy(a.matrixRotationWorld);
        b.matrixAutoUpdate = a.matrixAutoUpdate;
        b.matrixWorldNeedsUpdate = a.matrixWorldNeedsUpdate;
        b.quaternion.copy(a.quaternion);
        b.useQuaternion = a.useQuaternion;
        b.boundRadius = a.boundRadius;
        b.boundRadiusScale = a.boundRadiusScale;
        b.visible = a.visible;
        b.castShadow = a.castShadow;
        b.receiveShadow = a.receiveShadow;
        b.frustumCulled = a.frustumCulled;
        for (var c = 0; c < a.children.length; c++) {
            var d = THREE.SceneUtils.cloneObject(a.children[c]);
            b.children[c] = d;
            d.parent = b
        }
        if (a instanceof THREE.LOD)
            for (c = 0; c < a.LODs.length; c++)
                b.LODs[c] = {
                    visibleAtDistance: a.LODs[c].visibleAtDistance,
                    object3D: b.children[c]
                };
        return b
    },
    detach: function(a, b, c) {
        a.applyMatrix(b.matrixWorld);
        b.remove(a);
        c.add(a)
    },
    attach: function(a, b, c) {
        var d = new THREE.Matrix4;
        d.getInverse(c.matrixWorld);
        a.applyMatrix(d);
        b.remove(a);
        c.add(a)
    }
};
THREE.WebGLRenderer && (THREE.ShaderUtils = {
    lib: {
        fresnel: {
            uniforms: {
                mRefractionRatio: {
                    type: "f",
                    value: 1.02
                },
                mFresnelBias: {
                    type: "f",
                    value: 0.1
                },
                mFresnelPower: {
                    type: "f",
                    value: 2
                },
                mFresnelScale: {
                    type: "f",
                    value: 1
                },
                tCube: {
                    type: "t",
                    value: 1,
                    texture: null
                }
            },
            fragmentShader: "uniform samplerCube tCube;\nvarying vec3 vReflect;\nvarying vec3 vRefract[3];\nvarying float vReflectionFactor;\nvoid main() {\nvec4 reflectedColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );\nvec4 refractedColor = vec4( 1.0, 1.0, 1.0, 1.0 );\nrefractedColor.r = textureCube( tCube, vec3( -vRefract[0].x, vRefract[0].yz ) ).r;\nrefractedColor.g = textureCube( tCube, vec3( -vRefract[1].x, vRefract[1].yz ) ).g;\nrefractedColor.b = textureCube( tCube, vec3( -vRefract[2].x, vRefract[2].yz ) ).b;\nrefractedColor.a = 1.0;\ngl_FragColor = mix( refractedColor, reflectedColor, clamp( vReflectionFactor, 0.0, 1.0 ) );\n}",
            vertexShader: "uniform float mRefractionRatio;\nuniform float mFresnelBias;\nuniform float mFresnelScale;\nuniform float mFresnelPower;\nvarying vec3 vReflect;\nvarying vec3 vRefract[3];\nvarying float vReflectionFactor;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvec3 nWorld = normalize ( mat3( objectMatrix[0].xyz, objectMatrix[1].xyz, objectMatrix[2].xyz ) * normal );\nvec3 I = mPosition.xyz - cameraPosition;\nvReflect = reflect( I, nWorld );\nvRefract[0] = refract( normalize( I ), nWorld, mRefractionRatio );\nvRefract[1] = refract( normalize( I ), nWorld, mRefractionRatio * 0.99 );\nvRefract[2] = refract( normalize( I ), nWorld, mRefractionRatio * 0.98 );\nvReflectionFactor = mFresnelBias + mFresnelScale * pow( 1.0 + dot( normalize( I ), nWorld ), mFresnelPower );\ngl_Position = projectionMatrix * mvPosition;\n}"
        },
        normal: {
            uniforms: THREE.UniformsUtils.merge([THREE.UniformsLib.fog, THREE.UniformsLib.lights, THREE.UniformsLib.shadowmap, {
                enableAO: {
                    type: "i",
                    value: 0
                },
                enableDiffuse: {
                    type: "i",
                    value: 0
                },
                enableSpecular: {
                    type: "i",
                    value: 0
                },
                enableReflection: {
                    type: "i",
                    value: 0
                },
                tDiffuse: {
                    type: "t",
                    value: 0,
                    texture: null
                },
                tCube: {
                    type: "t",
                    value: 1,
                    texture: null
                },
                tNormal: {
                    type: "t",
                    value: 2,
                    texture: null
                },
                tSpecular: {
                    type: "t",
                    value: 3,
                    texture: null
                },
                tAO: {
                    type: "t",
                    value: 4,
                    texture: null
                },
                tDisplacement: {
                    type: "t",
                    value: 5,
                    texture: null
                },
                uNormalScale: {
                    type: "f",
                    value: 1
                },
                uDisplacementBias: {
                    type: "f",
                    value: 0
                },
                uDisplacementScale: {
                    type: "f",
                    value: 1
                },
                uDiffuseColor: {
                    type: "c",
                    value: new THREE.Color(16777215)
                },
                uSpecularColor: {
                    type: "c",
                    value: new THREE.Color(1118481)
                },
                uAmbientColor: {
                    type: "c",
                    value: new THREE.Color(16777215)
                },
                uShininess: {
                    type: "f",
                    value: 30
                },
                uOpacity: {
                    type: "f",
                    value: 1
                },
                uReflectivity: {
                    type: "f",
                    value: 0.5
                },
                uOffset: {
                    type: "v2",
                    value: new THREE.Vector2(0,0)
                },
                uRepeat: {
                    type: "v2",
                    value: new THREE.Vector2(1,1)
                },
                wrapRGB: {
                    type: "v3",
                    value: new THREE.Vector3(1,1,1)
                }
            }]),
            fragmentShader: ["uniform vec3 uAmbientColor;\nuniform vec3 uDiffuseColor;\nuniform vec3 uSpecularColor;\nuniform float uShininess;\nuniform float uOpacity;\nuniform bool enableDiffuse;\nuniform bool enableSpecular;\nuniform bool enableAO;\nuniform bool enableReflection;\nuniform sampler2D tDiffuse;\nuniform sampler2D tNormal;\nuniform sampler2D tSpecular;\nuniform sampler2D tAO;\nuniform samplerCube tCube;\nuniform float uNormalScale;\nuniform float uReflectivity;\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\n#ifdef WRAP_AROUND\nuniform vec3 wrapRGB;\n#endif\nvarying vec3 vViewPosition;", THREE.ShaderChunk.shadowmap_pars_fragment, THREE.ShaderChunk.fog_pars_fragment, "void main() {\ngl_FragColor = vec4( vec3( 1.0 ), uOpacity );\nvec3 specularTex = vec3( 1.0 );\nvec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;\nnormalTex.xy *= uNormalScale;\nnormalTex = normalize( normalTex );\nif( enableDiffuse ) {\n#ifdef GAMMA_INPUT\nvec4 texelColor = texture2D( tDiffuse, vUv );\ntexelColor.xyz *= texelColor.xyz;\ngl_FragColor = gl_FragColor * texelColor;\n#else\ngl_FragColor = gl_FragColor * texture2D( tDiffuse, vUv );\n#endif\n}\nif( enableAO ) {\n#ifdef GAMMA_INPUT\nvec4 aoColor = texture2D( tAO, vUv );\naoColor.xyz *= aoColor.xyz;\ngl_FragColor.xyz = gl_FragColor.xyz * aoColor.xyz;\n#else\ngl_FragColor.xyz = gl_FragColor.xyz * texture2D( tAO, vUv ).xyz;\n#endif\n}\nif( enableSpecular )\nspecularTex = texture2D( tSpecular, vUv ).xyz;\nmat3 tsb = mat3( normalize( vTangent ), normalize( vBinormal ), normalize( vNormal ) );\nvec3 finalNormal = tsb * normalTex;\nvec3 normal = normalize( finalNormal );\nvec3 viewPosition = normalize( vViewPosition );\n#if MAX_POINT_LIGHTS > 0\nvec3 pointDiffuse = vec3( 0.0 );\nvec3 pointSpecular = vec3( 0.0 );\nfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec3 pointVector = normalize( vPointLight[ i ].xyz );\nfloat pointDistance = vPointLight[ i ].w;\n#ifdef WRAP_AROUND\nfloat pointDiffuseWeightFull = max( dot( normal, pointVector ), 0.0 );\nfloat pointDiffuseWeightHalf = max( 0.5 * dot( normal, pointVector ) + 0.5, 0.0 );\nvec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );\n#else\nfloat pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );\n#endif\npointDiffuse += pointDistance * pointLightColor[ i ] * uDiffuseColor * pointDiffuseWeight;\nvec3 pointHalfVector = normalize( pointVector + viewPosition );\nfloat pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\nfloat pointSpecularWeight = specularTex.r * max( pow( pointDotNormalHalf, uShininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( uShininess + 2.0001 ) / 8.0;\nvec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( pointVector, pointHalfVector ), 5.0 );\npointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * pointDistance * specularNormalization;\n#else\npointSpecular += pointDistance * pointLightColor[ i ] * uSpecularColor * pointSpecularWeight * pointDiffuseWeight;\n#endif\n}\n#endif\n#if MAX_DIR_LIGHTS > 0\nvec3 dirDiffuse = vec3( 0.0 );\nvec3 dirSpecular = vec3( 0.0 );\nfor( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\n#ifdef WRAP_AROUND\nfloat directionalLightWeightingFull = max( dot( normal, dirVector ), 0.0 );\nfloat directionalLightWeightingHalf = max( 0.5 * dot( normal, dirVector ) + 0.5, 0.0 );\nvec3 dirDiffuseWeight = mix( vec3( directionalLightWeightingFull ), vec3( directionalLightWeightingHalf ), wrapRGB );\n#else\nfloat dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );\n#endif\ndirDiffuse += directionalLightColor[ i ] * uDiffuseColor * dirDiffuseWeight;\nvec3 dirHalfVector = normalize( dirVector + viewPosition );\nfloat dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\nfloat dirSpecularWeight = specularTex.r * max( pow( dirDotNormalHalf, uShininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( uShininess + 2.0001 ) / 8.0;\nvec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );\ndirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\n#else\ndirSpecular += directionalLightColor[ i ] * uSpecularColor * dirSpecularWeight * dirDiffuseWeight;\n#endif\n}\n#endif\nvec3 totalDiffuse = vec3( 0.0 );\nvec3 totalSpecular = vec3( 0.0 );\n#if MAX_DIR_LIGHTS > 0\ntotalDiffuse += dirDiffuse;\ntotalSpecular += dirSpecular;\n#endif\n#if MAX_POINT_LIGHTS > 0\ntotalDiffuse += pointDiffuse;\ntotalSpecular += pointSpecular;\n#endif\ngl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * uAmbientColor) + totalSpecular;\nif ( enableReflection ) {\nvec3 wPos = cameraPosition - vViewPosition;\nvec3 vReflect = reflect( normalize( wPos ), normal );\nvec4 cubeColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );\n#ifdef GAMMA_INPUT\ncubeColor.xyz *= cubeColor.xyz;\n#endif\ngl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularTex.r * uReflectivity );\n}", THREE.ShaderChunk.shadowmap_fragment, THREE.ShaderChunk.linear_to_gamma_fragment, THREE.ShaderChunk.fog_fragment, "}"].join("\n"),
            vertexShader: ["attribute vec4 tangent;\nuniform vec2 uOffset;\nuniform vec2 uRepeat;\n#ifdef VERTEX_TEXTURES\nuniform sampler2D tDisplacement;\nuniform float uDisplacementScale;\nuniform float uDisplacementBias;\n#endif\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\nvarying vec3 vViewPosition;", THREE.ShaderChunk.shadowmap_pars_vertex, "void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvViewPosition = -mvPosition.xyz;\nvNormal = normalMatrix * normal;\nvTangent = normalMatrix * tangent.xyz;\nvBinormal = cross( vNormal, vTangent ) * tangent.w;\nvUv = uv * uRepeat + uOffset;\n#if MAX_POINT_LIGHTS > 0\nfor( int i = 0; i < MAX_POINT_LIGHTS; i++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\nvPointLight[ i ] = vec4( lVector, lDistance );\n}\n#endif\n#ifdef VERTEX_TEXTURES\nvec3 dv = texture2D( tDisplacement, uv ).xyz;\nfloat df = uDisplacementScale * dv.x + uDisplacementBias;\nvec4 displacedPosition = vec4( normalize( vNormal.xyz ) * df, 0.0 ) + mvPosition;\ngl_Position = projectionMatrix * displacedPosition;\n#else\ngl_Position = projectionMatrix * mvPosition;\n#endif", THREE.ShaderChunk.shadowmap_vertex, "}"].join("\n")
        },
        cube: {
            uniforms: {
                tCube: {
                    type: "t",
                    value: 1,
                    texture: null
                },
                tFlip: {
                    type: "f",
                    value: -1
                }
            },
            vertexShader: "varying vec3 vViewPosition;\nvoid main() {\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvViewPosition = cameraPosition - mPosition.xyz;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
            fragmentShader: "uniform samplerCube tCube;\nuniform float tFlip;\nvarying vec3 vViewPosition;\nvoid main() {\nvec3 wPos = cameraPosition - vViewPosition;\ngl_FragColor = textureCube( tCube, vec3( tFlip * wPos.x, wPos.yz ) );\n}"
        }
    }
});
THREE.BufferGeometry = function() {
    this.id = THREE.GeometryCount++;
    this.vertexColorArray = this.vertexUvArray = this.vertexNormalArray = this.vertexPositionArray = this.vertexIndexArray = this.vertexColorBuffer = this.vertexUvBuffer = this.vertexNormalBuffer = this.vertexPositionBuffer = this.vertexIndexBuffer = null;
    this.dynamic = !1;
    this.boundingSphere = this.boundingBox = null;
    this.morphTargets = []
}
;
THREE.BufferGeometry.prototype = {
    constructor: THREE.BufferGeometry,
    computeBoundingBox: function() {},
    computeBoundingSphere: function() {}
};
THREE.Curve = function() {}
;
THREE.Curve.prototype.getPoint = function() {
    console.log("Warning, getPoint() not implemented!");
    return null
}
;
THREE.Curve.prototype.getPointAt = function(a) {
    return this.getPoint(this.getUtoTmapping(a))
}
;
THREE.Curve.prototype.getPoints = function(a) {
    a || (a = 5);
    var b, c = [];
    for (b = 0; b <= a; b++)
        c.push(this.getPoint(b / a));
    return c
}
;
THREE.Curve.prototype.getSpacedPoints = function(a) {
    a || (a = 5);
    var b, c = [];
    for (b = 0; b <= a; b++)
        c.push(this.getPointAt(b / a));
    return c
}
;
THREE.Curve.prototype.getLength = function() {
    var a = this.getLengths();
    return a[a.length - 1]
}
;
THREE.Curve.prototype.getLengths = function(a) {
    a || (a = this.__arcLengthDivisions ? this.__arcLengthDivisions : 200);
    if (this.cacheArcLengths && this.cacheArcLengths.length == a + 1 && !this.needsUpdate)
        return this.cacheArcLengths;
    this.needsUpdate = !1;
    var b = [], c, d = this.getPoint(0), e, f = 0;
    b.push(0);
    for (e = 1; e <= a; e++)
        c = this.getPoint(e / a),
        f += c.distanceTo(d),
        b.push(f),
        d = c;
    return this.cacheArcLengths = b
}
;
THREE.Curve.prototype.updateArcLengths = function() {
    this.needsUpdate = !0;
    this.getLengths()
}
;
THREE.Curve.prototype.getUtoTmapping = function(a, b) {
    var c = this.getLengths(), d = 0, e = c.length, f;
    f = b ? b : a * c[e - 1];
    for (var g = 0, h = e - 1, i; g <= h; )
        if (d = Math.floor(g + (h - g) / 2),
        i = c[d] - f,
        0 > i)
            g = d + 1;
        else if (0 < i)
            h = d - 1;
        else {
            h = d;
            break
        }
    d = h;
    if (c[d] == f)
        return d / (e - 1);
    g = c[d];
    return (d + (f - g) / (c[d + 1] - g)) / (e - 1)
}
;
THREE.Curve.prototype.getNormalVector = function(a) {
    a = this.getTangent(a);
    return new THREE.Vector2(-a.y,a.x)
}
;
THREE.Curve.prototype.getTangent = function(a) {
    var b = a - 1.0E-4
      , a = a + 1.0E-4;
    0 > b && (b = 0);
    1 < a && (a = 1);
    b = this.getPoint(b);
    return this.getPoint(a).clone().subSelf(b).normalize()
}
;
THREE.Curve.prototype.getTangentAt = function(a) {
    return this.getTangent(this.getUtoTmapping(a))
}
;
THREE.LineCurve = function(a, b) {
    this.v1 = a;
    this.v2 = b
}
;
THREE.LineCurve.prototype = new THREE.Curve;
THREE.LineCurve.prototype.constructor = THREE.LineCurve;
THREE.LineCurve.prototype.getPoint = function(a) {
    var b = this.v2.clone().subSelf(this.v1);
    b.multiplyScalar(a).addSelf(this.v1);
    return b
}
;
THREE.LineCurve.prototype.getPointAt = function(a) {
    return this.getPoint(a)
}
;
THREE.LineCurve.prototype.getTangent = function() {
    return this.v2.clone().subSelf(this.v1).normalize()
}
;
THREE.QuadraticBezierCurve = function(a, b, c) {
    this.v0 = a;
    this.v1 = b;
    this.v2 = c
}
;
THREE.QuadraticBezierCurve.prototype = new THREE.Curve;
THREE.QuadraticBezierCurve.prototype.constructor = THREE.QuadraticBezierCurve;
THREE.QuadraticBezierCurve.prototype.getPoint = function(a) {
    var b;
    b = THREE.Shape.Utils.b2(a, this.v0.x, this.v1.x, this.v2.x);
    a = THREE.Shape.Utils.b2(a, this.v0.y, this.v1.y, this.v2.y);
    return new THREE.Vector2(b,a)
}
;
THREE.QuadraticBezierCurve.prototype.getTangent = function(a) {
    var b;
    b = THREE.Curve.Utils.tangentQuadraticBezier(a, this.v0.x, this.v1.x, this.v2.x);
    a = THREE.Curve.Utils.tangentQuadraticBezier(a, this.v0.y, this.v1.y, this.v2.y);
    b = new THREE.Vector2(b,a);
    b.normalize();
    return b
}
;
THREE.CubicBezierCurve = function(a, b, c, d) {
    this.v0 = a;
    this.v1 = b;
    this.v2 = c;
    this.v3 = d
}
;
THREE.CubicBezierCurve.prototype = new THREE.Curve;
THREE.CubicBezierCurve.prototype.constructor = THREE.CubicBezierCurve;
THREE.CubicBezierCurve.prototype.getPoint = function(a) {
    var b;
    b = THREE.Shape.Utils.b3(a, this.v0.x, this.v1.x, this.v2.x, this.v3.x);
    a = THREE.Shape.Utils.b3(a, this.v0.y, this.v1.y, this.v2.y, this.v3.y);
    return new THREE.Vector2(b,a)
}
;
THREE.CubicBezierCurve.prototype.getTangent = function(a) {
    var b;
    b = THREE.Curve.Utils.tangentCubicBezier(a, this.v0.x, this.v1.x, this.v2.x, this.v3.x);
    a = THREE.Curve.Utils.tangentCubicBezier(a, this.v0.y, this.v1.y, this.v2.y, this.v3.y);
    b = new THREE.Vector2(b,a);
    b.normalize();
    return b
}
;
THREE.SplineCurve = function(a) {
    this.points = void 0 == a ? [] : a
}
;
THREE.SplineCurve.prototype = new THREE.Curve;
THREE.SplineCurve.prototype.constructor = THREE.SplineCurve;
THREE.SplineCurve.prototype.getPoint = function(a) {
    var b = new THREE.Vector2, c = [], d = this.points, e;
    e = (d.length - 1) * a;
    a = Math.floor(e);
    e -= a;
    c[0] = 0 == a ? a : a - 1;
    c[1] = a;
    c[2] = a > d.length - 2 ? d.length - 1 : a + 1;
    c[3] = a > d.length - 3 ? d.length - 1 : a + 2;
    b.x = THREE.Curve.Utils.interpolate(d[c[0]].x, d[c[1]].x, d[c[2]].x, d[c[3]].x, e);
    b.y = THREE.Curve.Utils.interpolate(d[c[0]].y, d[c[1]].y, d[c[2]].y, d[c[3]].y, e);
    return b
}
;
THREE.ArcCurve = function(a, b, c, d, e, f) {
    this.aX = a;
    this.aY = b;
    this.aRadius = c;
    this.aStartAngle = d;
    this.aEndAngle = e;
    this.aClockwise = f
}
;
THREE.ArcCurve.prototype = new THREE.Curve;
THREE.ArcCurve.prototype.constructor = THREE.ArcCurve;
THREE.ArcCurve.prototype.getPoint = function(a) {
    var b = this.aEndAngle - this.aStartAngle;
    this.aClockwise || (a = 1 - a);
    b = this.aStartAngle + a * b;
    a = this.aX + this.aRadius * Math.cos(b);
    b = this.aY + this.aRadius * Math.sin(b);
    return new THREE.Vector2(a,b)
}
;
THREE.Curve.Utils = {
    tangentQuadraticBezier: function(a, b, c, d) {
        return 2 * (1 - a) * (c - b) + 2 * a * (d - c)
    },
    tangentCubicBezier: function(a, b, c, d, e) {
        return -3 * b * (1 - a) * (1 - a) + 3 * c * (1 - a) * (1 - a) - 6 * a * c * (1 - a) + 6 * a * d * (1 - a) - 3 * a * a * d + 3 * a * a * e
    },
    tangentSpline: function(a) {
        return 6 * a * a - 6 * a + (3 * a * a - 4 * a + 1) + (-6 * a * a + 6 * a) + (3 * a * a - 2 * a)
    },
    interpolate: function(a, b, c, d, e) {
        var a = 0.5 * (c - a)
          , d = 0.5 * (d - b)
          , f = e * e;
        return (2 * b - 2 * c + a + d) * e * f + (-3 * b + 3 * c - 2 * a - d) * f + a * e + b
    }
};
THREE.Curve.create = function(a, b) {
    a.prototype = new THREE.Curve;
    a.prototype.constructor = a;
    a.prototype.getPoint = b;
    return a
}
;
THREE.LineCurve3 = THREE.Curve.create(function(a, b) {
    this.v1 = a;
    this.v2 = b
}, function(a) {
    var b = new THREE.Vector3;
    b.sub(this.v2, this.v1);
    b.multiplyScalar(a);
    b.addSelf(this.v1);
    return b
});
THREE.QuadraticBezierCurve3 = THREE.Curve.create(function(a, b, c) {
    this.v0 = a;
    this.v1 = b;
    this.v2 = c
}, function(a) {
    var b, c;
    b = THREE.Shape.Utils.b2(a, this.v0.x, this.v1.x, this.v2.x);
    c = THREE.Shape.Utils.b2(a, this.v0.y, this.v1.y, this.v2.y);
    a = THREE.Shape.Utils.b2(a, this.v0.z, this.v1.z, this.v2.z);
    return new THREE.Vector3(b,c,a)
});
THREE.CubicBezierCurve3 = THREE.Curve.create(function(a, b, c, d) {
    this.v0 = a;
    this.v1 = b;
    this.v2 = c;
    this.v3 = d
}, function(a) {
    var b, c;
    b = THREE.Shape.Utils.b3(a, this.v0.x, this.v1.x, this.v2.x, this.v3.x);
    c = THREE.Shape.Utils.b3(a, this.v0.y, this.v1.y, this.v2.y, this.v3.y);
    a = THREE.Shape.Utils.b3(a, this.v0.z, this.v1.z, this.v2.z, this.v3.z);
    return new THREE.Vector3(b,c,a)
});
THREE.SplineCurve3 = THREE.Curve.create(function(a) {
    this.points = void 0 == a ? [] : a
}, function(a) {
    var b = new THREE.Vector3, c = [], d = this.points, e, a = (d.length - 1) * a;
    e = Math.floor(a);
    a -= e;
    c[0] = 0 == e ? e : e - 1;
    c[1] = e;
    c[2] = e > d.length - 2 ? d.length - 1 : e + 1;
    c[3] = e > d.length - 3 ? d.length - 1 : e + 2;
    e = d[c[0]];
    var f = d[c[1]]
      , g = d[c[2]]
      , c = d[c[3]];
    b.x = THREE.Curve.Utils.interpolate(e.x, f.x, g.x, c.x, a);
    b.y = THREE.Curve.Utils.interpolate(e.y, f.y, g.y, c.y, a);
    b.z = THREE.Curve.Utils.interpolate(e.z, f.z, g.z, c.z, a);
    return b
});
THREE.ClosedSplineCurve3 = THREE.Curve.create(function(a) {
    this.points = void 0 == a ? [] : a
}, function(a) {
    var b = new THREE.Vector3, c = [], d = this.points, e;
    e = (d.length - 0) * a;
    a = Math.floor(e);
    e -= a;
    a += 0 < a ? 0 : (Math.floor(Math.abs(a) / d.length) + 1) * d.length;
    c[0] = (a - 1) % d.length;
    c[1] = a % d.length;
    c[2] = (a + 1) % d.length;
    c[3] = (a + 2) % d.length;
    b.x = THREE.Curve.Utils.interpolate(d[c[0]].x, d[c[1]].x, d[c[2]].x, d[c[3]].x, e);
    b.y = THREE.Curve.Utils.interpolate(d[c[0]].y, d[c[1]].y, d[c[2]].y, d[c[3]].y, e);
    b.z = THREE.Curve.Utils.interpolate(d[c[0]].z, d[c[1]].z, d[c[2]].z, d[c[3]].z, e);
    return b
});
THREE.CurvePath = function() {
    this.curves = [];
    this.bends = [];
    this.autoClose = !1
}
;
THREE.CurvePath.prototype = new THREE.Curve;
THREE.CurvePath.prototype.constructor = THREE.CurvePath;
THREE.CurvePath.prototype.add = function(a) {
    this.curves.push(a)
}
;
THREE.CurvePath.prototype.checkConnection = function() {}
;
THREE.CurvePath.prototype.closePath = function() {
    var a = this.curves[0].getPoint(0)
      , b = this.curves[this.curves.length - 1].getPoint(1);
    a.equals(b) || this.curves.push(new THREE.LineCurve(b,a))
}
;
THREE.CurvePath.prototype.getPoint = function(a) {
    for (var b = a * this.getLength(), c = this.getCurveLengths(), a = 0; a < c.length; ) {
        if (c[a] >= b)
            return b = c[a] - b,
            a = this.curves[a],
            b = 1 - b / a.getLength(),
            a.getPointAt(b);
        a++
    }
    return null
}
;
THREE.CurvePath.prototype.getLength = function() {
    var a = this.getCurveLengths();
    return a[a.length - 1]
}
;
THREE.CurvePath.prototype.getCurveLengths = function() {
    if (this.cacheLengths && this.cacheLengths.length == this.curves.length)
        return this.cacheLengths;
    var a = [], b = 0, c, d = this.curves.length;
    for (c = 0; c < d; c++)
        b += this.curves[c].getLength(),
        a.push(b);
    return this.cacheLengths = a
}
;
THREE.CurvePath.prototype.getBoundingBox = function() {
    var a = this.getPoints(), b, c, d, e;
    b = c = Number.NEGATIVE_INFINITY;
    d = e = Number.POSITIVE_INFINITY;
    var f, g, h, i;
    i = new THREE.Vector2;
    g = 0;
    for (h = a.length; g < h; g++)
        f = a[g],
        f.x > b ? b = f.x : f.x < d && (d = f.x),
        f.y > c ? c = f.y : f.y < c && (e = f.y),
        i.addSelf(f.x, f.y);
    return {
        minX: d,
        minY: e,
        maxX: b,
        maxY: c,
        centroid: i.divideScalar(h)
    }
}
;
THREE.CurvePath.prototype.createPointsGeometry = function(a) {
    return this.createGeometry(this.getPoints(a, !0))
}
;
THREE.CurvePath.prototype.createSpacedPointsGeometry = function(a) {
    return this.createGeometry(this.getSpacedPoints(a, !0))
}
;
THREE.CurvePath.prototype.createGeometry = function(a) {
    for (var b = new THREE.Geometry, c = 0; c < a.length; c++)
        b.vertices.push(new THREE.Vector3(a[c].x,a[c].y,0));
    return b
}
;
THREE.CurvePath.prototype.addWrapPath = function(a) {
    this.bends.push(a)
}
;
THREE.CurvePath.prototype.getTransformedPoints = function(a, b) {
    var c = this.getPoints(a), d, e;
    b || (b = this.bends);
    d = 0;
    for (e = b.length; d < e; d++)
        c = this.getWrapPoints(c, b[d]);
    return c
}
;
THREE.CurvePath.prototype.getTransformedSpacedPoints = function(a, b) {
    var c = this.getSpacedPoints(a), d, e;
    b || (b = this.bends);
    d = 0;
    for (e = b.length; d < e; d++)
        c = this.getWrapPoints(c, b[d]);
    return c
}
;
THREE.CurvePath.prototype.getWrapPoints = function(a, b) {
    var c = this.getBoundingBox(), d, e, f, g, h, i;
    d = 0;
    for (e = a.length; d < e; d++)
        f = a[d],
        g = f.x,
        h = f.y,
        i = g / c.maxX,
        i = b.getUtoTmapping(i, g),
        g = b.getPoint(i),
        h = b.getNormalVector(i).multiplyScalar(h),
        f.x = g.x + h.x,
        f.y = g.y + h.y;
    return a
}
;
THREE.EventTarget = function() {
    var a = {};
    this.addEventListener = function(b, c) {
        void 0 == a[b] && (a[b] = []);
        -1 === a[b].indexOf(c) && a[b].push(c)
    }
    ;
    this.dispatchEvent = function(b) {
        for (var c in a[b.type])
            a[b.type][c](b)
    }
    ;
    this.removeEventListener = function(b, c) {
        var d = a[b].indexOf(c);
        -1 !== d && a[b].splice(d, 1)
    }
}
;
THREE.Gyroscope = function() {
    THREE.Object3D.call(this)
}
;
THREE.Gyroscope.prototype = new THREE.Object3D;
THREE.Gyroscope.prototype.constructor = THREE.Gyroscope;
THREE.Gyroscope.prototype.updateMatrixWorld = function(a) {
    this.matrixAutoUpdate && this.updateMatrix();
    if (this.matrixWorldNeedsUpdate || a)
        this.parent ? (this.matrixWorld.multiply(this.parent.matrixWorld, this.matrix),
        this.matrixWorld.decompose(this.translationWorld, this.rotationWorld, this.scaleWorld),
        this.matrix.decompose(this.translationObject, this.rotationObject, this.scaleObject),
        this.matrixWorld.compose(this.translationWorld, this.rotationObject, this.scaleWorld)) : this.matrixWorld.copy(this.matrix),
        this.matrixWorldNeedsUpdate = !1,
        a = !0;
    for (var b = 0, c = this.children.length; b < c; b++)
        this.children[b].updateMatrixWorld(a)
}
;
THREE.Gyroscope.prototype.translationWorld = new THREE.Vector3;
THREE.Gyroscope.prototype.translationObject = new THREE.Vector3;
THREE.Gyroscope.prototype.rotationWorld = new THREE.Quaternion;
THREE.Gyroscope.prototype.rotationObject = new THREE.Quaternion;
THREE.Gyroscope.prototype.scaleWorld = new THREE.Vector3;
THREE.Gyroscope.prototype.scaleObject = new THREE.Vector3;
THREE.Path = function(a) {
    THREE.CurvePath.call(this);
    this.actions = [];
    a && this.fromPoints(a)
}
;
THREE.Path.prototype = new THREE.CurvePath;
THREE.Path.prototype.constructor = THREE.Path;
THREE.PathActions = {
    MOVE_TO: "moveTo",
    LINE_TO: "lineTo",
    QUADRATIC_CURVE_TO: "quadraticCurveTo",
    BEZIER_CURVE_TO: "bezierCurveTo",
    CSPLINE_THRU: "splineThru",
    ARC: "arc"
};
THREE.Path.prototype.fromPoints = function(a) {
    this.moveTo(a[0].x, a[0].y);
    for (var b = 1, c = a.length; b < c; b++)
        this.lineTo(a[b].x, a[b].y)
}
;
THREE.Path.prototype.moveTo = function(a, b) {
    var c = Array.prototype.slice.call(arguments);
    this.actions.push({
        action: THREE.PathActions.MOVE_TO,
        args: c
    })
}
;
THREE.Path.prototype.lineTo = function(a, b) {
    var c = Array.prototype.slice.call(arguments)
      , d = this.actions[this.actions.length - 1].args;
    this.curves.push(new THREE.LineCurve(new THREE.Vector2(d[d.length - 2],d[d.length - 1]),new THREE.Vector2(a,b)));
    this.actions.push({
        action: THREE.PathActions.LINE_TO,
        args: c
    })
}
;
THREE.Path.prototype.quadraticCurveTo = function(a, b, c, d) {
    var e = Array.prototype.slice.call(arguments)
      , f = this.actions[this.actions.length - 1].args;
    this.curves.push(new THREE.QuadraticBezierCurve(new THREE.Vector2(f[f.length - 2],f[f.length - 1]),new THREE.Vector2(a,b),new THREE.Vector2(c,d)));
    this.actions.push({
        action: THREE.PathActions.QUADRATIC_CURVE_TO,
        args: e
    })
}
;
THREE.Path.prototype.bezierCurveTo = function(a, b, c, d, e, f) {
    var g = Array.prototype.slice.call(arguments)
      , h = this.actions[this.actions.length - 1].args;
    this.curves.push(new THREE.CubicBezierCurve(new THREE.Vector2(h[h.length - 2],h[h.length - 1]),new THREE.Vector2(a,b),new THREE.Vector2(c,d),new THREE.Vector2(e,f)));
    this.actions.push({
        action: THREE.PathActions.BEZIER_CURVE_TO,
        args: g
    })
}
;
THREE.Path.prototype.splineThru = function(a) {
    var b = Array.prototype.slice.call(arguments)
      , c = this.actions[this.actions.length - 1].args
      , c = [new THREE.Vector2(c[c.length - 2],c[c.length - 1])];
    Array.prototype.push.apply(c, a);
    this.curves.push(new THREE.SplineCurve(c));
    this.actions.push({
        action: THREE.PathActions.CSPLINE_THRU,
        args: b
    })
}
;
THREE.Path.prototype.arc = function(a, b, c, d, e, f) {
    var g = Array.prototype.slice.call(arguments)
      , h = this.actions[this.actions.length - 1]
      , h = new THREE.ArcCurve(h.x + a,h.y + b,c,d,e,f);
    this.curves.push(h);
    h = h.getPoint(f ? 1 : 0);
    g.push(h.x);
    g.push(h.y);
    this.actions.push({
        action: THREE.PathActions.ARC,
        args: g
    })
}
;
THREE.Path.prototype.absarc = function(a, b, c, d, e, f) {
    var g = Array.prototype.slice.call(arguments)
      , h = new THREE.ArcCurve(a,b,c,d,e,f);
    this.curves.push(h);
    h = h.getPoint(f ? 1 : 0);
    g.push(h.x);
    g.push(h.y);
    this.actions.push({
        action: THREE.PathActions.ARC,
        args: g
    })
}
;
THREE.Path.prototype.getSpacedPoints = function(a) {
    a || (a = 40);
    for (var b = [], c = 0; c < a; c++)
        b.push(this.getPoint(c / a));
    return b
}
;
THREE.Path.prototype.getPoints = function(a, b) {
    if (this.useSpacedPoints)
        return console.log("tata"),
        this.getSpacedPoints(a, b);
    var a = a || 12, c = [], d, e, f, g, h, i, j, k, n, p, o, r, q;
    d = 0;
    for (e = this.actions.length; d < e; d++)
        switch (f = this.actions[d],
        g = f.action,
        f = f.args,
        g) {
        case THREE.PathActions.MOVE_TO:
            c.push(new THREE.Vector2(f[0],f[1]));
            break;
        case THREE.PathActions.LINE_TO:
            c.push(new THREE.Vector2(f[0],f[1]));
            break;
        case THREE.PathActions.QUADRATIC_CURVE_TO:
            h = f[2];
            i = f[3];
            n = f[0];
            p = f[1];
            0 < c.length ? (g = c[c.length - 1],
            o = g.x,
            r = g.y) : (g = this.actions[d - 1].args,
            o = g[g.length - 2],
            r = g[g.length - 1]);
            for (f = 1; f <= a; f++)
                q = f / a,
                g = THREE.Shape.Utils.b2(q, o, n, h),
                q = THREE.Shape.Utils.b2(q, r, p, i),
                c.push(new THREE.Vector2(g,q));
            break;
        case THREE.PathActions.BEZIER_CURVE_TO:
            h = f[4];
            i = f[5];
            n = f[0];
            p = f[1];
            j = f[2];
            k = f[3];
            0 < c.length ? (g = c[c.length - 1],
            o = g.x,
            r = g.y) : (g = this.actions[d - 1].args,
            o = g[g.length - 2],
            r = g[g.length - 1]);
            for (f = 1; f <= a; f++)
                q = f / a,
                g = THREE.Shape.Utils.b3(q, o, n, j, h),
                q = THREE.Shape.Utils.b3(q, r, p, k, i),
                c.push(new THREE.Vector2(g,q));
            break;
        case THREE.PathActions.CSPLINE_THRU:
            g = this.actions[d - 1].args;
            q = [new THREE.Vector2(g[g.length - 2],g[g.length - 1])];
            g = a * f[0].length;
            q = q.concat(f[0]);
            q = new THREE.SplineCurve(q);
            for (f = 1; f <= g; f++)
                c.push(q.getPointAt(f / g));
            break;
        case THREE.PathActions.ARC:
            h = f[0];
            i = f[1];
            j = f[2];
            n = f[3];
            p = !!f[5];
            k = f[4] - n;
            o = 2 * a;
            for (f = 1; f <= o; f++)
                q = f / o,
                p || (q = 1 - q),
                q = n + q * k,
                g = h + j * Math.cos(q),
                q = i + j * Math.sin(q),
                c.push(new THREE.Vector2(g,q))
        }
    d = c[c.length - 1];
    1.0E-10 > Math.abs(d.x - c[0].x) && 1.0E-10 > Math.abs(d.y - c[0].y) && c.splice(c.length - 1, 1);
    b && c.push(c[0]);
    return c
}
;
THREE.Path.prototype.transform = function(a, b) {
    this.getBoundingBox();
    return this.getWrapPoints(this.getPoints(b), a)
}
;
THREE.Path.prototype.nltransform = function(a, b, c, d, e, f) {
    var g = this.getPoints(), h, i, j, k, n;
    h = 0;
    for (i = g.length; h < i; h++)
        j = g[h],
        k = j.x,
        n = j.y,
        j.x = a * k + b * n + c,
        j.y = d * n + e * k + f;
    return g
}
;
THREE.Path.prototype.debug = function(a) {
    var b = this.getBoundingBox();
    a || (a = document.createElement("canvas"),
    a.setAttribute("width", b.maxX + 100),
    a.setAttribute("height", b.maxY + 100),
    document.body.appendChild(a));
    b = a.getContext("2d");
    b.fillStyle = "white";
    b.fillRect(0, 0, a.width, a.height);
    b.strokeStyle = "black";
    b.beginPath();
    var c, d, e, a = 0;
    for (c = this.actions.length; a < c; a++)
        d = this.actions[a],
        e = d.args,
        d = d.action,
        d != THREE.PathActions.CSPLINE_THRU && b[d].apply(b, e);
    b.stroke();
    b.closePath();
    b.strokeStyle = "red";
    d = this.getPoints();
    a = 0;
    for (c = d.length; a < c; a++)
        e = d[a],
        b.beginPath(),
        b.arc(e.x, e.y, 1.5, 0, 2 * Math.PI, !1),
        b.stroke(),
        b.closePath()
}
;
THREE.Path.prototype.toShapes = function() {
    var a, b, c, d, e = [], f = new THREE.Path;
    a = 0;
    for (b = this.actions.length; a < b; a++)
        c = this.actions[a],
        d = c.args,
        c = c.action,
        c == THREE.PathActions.MOVE_TO && 0 != f.actions.length && (e.push(f),
        f = new THREE.Path),
        f[c].apply(f, d);
    0 != f.actions.length && e.push(f);
    if (0 == e.length)
        return [];
    var g;
    d = [];
    a = !THREE.Shape.Utils.isClockWise(e[0].getPoints());
    if (1 == e.length)
        return f = e[0],
        g = new THREE.Shape,
        g.actions = f.actions,
        g.curves = f.curves,
        d.push(g),
        d;
    if (a) {
        g = new THREE.Shape;
        a = 0;
        for (b = e.length; a < b; a++)
            f = e[a],
            THREE.Shape.Utils.isClockWise(f.getPoints()) ? (g.actions = f.actions,
            g.curves = f.curves,
            d.push(g),
            g = new THREE.Shape) : g.holes.push(f)
    } else {
        a = 0;
        for (b = e.length; a < b; a++)
            f = e[a],
            THREE.Shape.Utils.isClockWise(f.getPoints()) ? (g && d.push(g),
            g = new THREE.Shape,
            g.actions = f.actions,
            g.curves = f.curves) : g.holes.push(f);
        d.push(g)
    }
    return d
}
;
THREE.Shape = function() {
    THREE.Path.apply(this, arguments);
    this.holes = []
}
;
THREE.Shape.prototype = new THREE.Path;
THREE.Shape.prototype.constructor = THREE.Path;
THREE.Shape.prototype.extrude = function(a) {
    return new THREE.ExtrudeGeometry(this,a)
}
;
THREE.Shape.prototype.getPointsHoles = function(a) {
    var b, c = this.holes.length, d = [];
    for (b = 0; b < c; b++)
        d[b] = this.holes[b].getTransformedPoints(a, this.bends);
    return d
}
;
THREE.Shape.prototype.getSpacedPointsHoles = function(a) {
    var b, c = this.holes.length, d = [];
    for (b = 0; b < c; b++)
        d[b] = this.holes[b].getTransformedSpacedPoints(a, this.bends);
    return d
}
;
THREE.Shape.prototype.extractAllPoints = function(a) {
    return {
        shape: this.getTransformedPoints(a),
        holes: this.getPointsHoles(a)
    }
}
;
THREE.Shape.prototype.extractPoints = function(a) {
    return this.useSpacedPoints ? this.extractAllSpacedPoints(a) : this.extractAllPoints(a)
}
;
THREE.Shape.prototype.extractAllSpacedPoints = function(a) {
    return {
        shape: this.getTransformedSpacedPoints(a),
        holes: this.getSpacedPointsHoles(a)
    }
}
;
THREE.Shape.Utils = {
    removeHoles: function(a, b) {
        var c = a.concat(), d = c.concat(), e, f, g, h, i, j, k, n, p, o, r = [];
        for (i = 0; i < b.length; i++) {
            j = b[i];
            Array.prototype.push.apply(d, j);
            f = Number.POSITIVE_INFINITY;
            for (e = 0; e < j.length; e++) {
                p = j[e];
                o = [];
                for (n = 0; n < c.length; n++)
                    k = c[n],
                    k = p.distanceToSquared(k),
                    o.push(k),
                    k < f && (f = k,
                    g = e,
                    h = n)
            }
            e = 0 <= h - 1 ? h - 1 : c.length - 1;
            f = 0 <= g - 1 ? g - 1 : j.length - 1;
            var q = [j[g], c[h], c[e]];
            n = THREE.FontUtils.Triangulate.area(q);
            var s = [j[g], j[f], c[h]];
            p = THREE.FontUtils.Triangulate.area(s);
            o = h;
            k = g;
            h += 1;
            g += -1;
            0 > h && (h += c.length);
            h %= c.length;
            0 > g && (g += j.length);
            g %= j.length;
            e = 0 <= h - 1 ? h - 1 : c.length - 1;
            f = 0 <= g - 1 ? g - 1 : j.length - 1;
            q = [j[g], c[h], c[e]];
            q = THREE.FontUtils.Triangulate.area(q);
            s = [j[g], j[f], c[h]];
            s = THREE.FontUtils.Triangulate.area(s);
            n + p > q + s && (h = o,
            g = k,
            0 > h && (h += c.length),
            h %= c.length,
            0 > g && (g += j.length),
            g %= j.length,
            e = 0 <= h - 1 ? h - 1 : c.length - 1,
            f = 0 <= g - 1 ? g - 1 : j.length - 1);
            n = c.slice(0, h);
            p = c.slice(h);
            o = j.slice(g);
            k = j.slice(0, g);
            f = [j[g], j[f], c[h]];
            r.push([j[g], c[h], c[e]]);
            r.push(f);
            c = n.concat(o).concat(k).concat(p)
        }
        return {
            shape: c,
            isolatedPts: r,
            allpoints: d
        }
    },
    triangulateShape: function(a, b) {
        var c = THREE.Shape.Utils.removeHoles(a, b), d = c.allpoints, e = c.isolatedPts, c = THREE.FontUtils.Triangulate(c.shape, !1), f, g, h, i, j = {};
        f = 0;
        for (g = d.length; f < g; f++)
            i = d[f].x + ":" + d[f].y,
            void 0 !== j[i] && console.log("Duplicate point", i),
            j[i] = f;
        f = 0;
        for (g = c.length; f < g; f++) {
            h = c[f];
            for (d = 0; 3 > d; d++)
                i = h[d].x + ":" + h[d].y,
                i = j[i],
                void 0 !== i && (h[d] = i)
        }
        f = 0;
        for (g = e.length; f < g; f++) {
            h = e[f];
            for (d = 0; 3 > d; d++)
                i = h[d].x + ":" + h[d].y,
                i = j[i],
                void 0 !== i && (h[d] = i)
        }
        return c.concat(e)
    },
    isClockWise: function(a) {
        return 0 > THREE.FontUtils.Triangulate.area(a)
    },
    b2p0: function(a, b) {
        var c = 1 - a;
        return c * c * b
    },
    b2p1: function(a, b) {
        return 2 * (1 - a) * a * b
    },
    b2p2: function(a, b) {
        return a * a * b
    },
    b2: function(a, b, c, d) {
        return this.b2p0(a, b) + this.b2p1(a, c) + this.b2p2(a, d)
    },
    b3p0: function(a, b) {
        var c = 1 - a;
        return c * c * c * b
    },
    b3p1: function(a, b) {
        var c = 1 - a;
        return 3 * c * c * a * b
    },
    b3p2: function(a, b) {
        return 3 * (1 - a) * a * a * b
    },
    b3p3: function(a, b) {
        return a * a * a * b
    },
    b3: function(a, b, c, d, e) {
        return this.b3p0(a, b) + this.b3p1(a, c) + this.b3p2(a, d) + this.b3p3(a, e)
    }
};
THREE.TextPath = function(a, b) {
    THREE.Path.call(this);
    this.parameters = b || {};
    this.set(a)
}
;
THREE.TextPath.prototype.set = function(a, b) {
    b = b || this.parameters;
    this.text = a;
    var c = void 0 !== b.curveSegments ? b.curveSegments : 4
      , d = void 0 !== b.font ? b.font : "helvetiker"
      , e = void 0 !== b.weight ? b.weight : "normal"
      , f = void 0 !== b.style ? b.style : "normal";
    THREE.FontUtils.size = void 0 !== b.size ? b.size : 100;
    THREE.FontUtils.divisions = c;
    THREE.FontUtils.face = d;
    THREE.FontUtils.weight = e;
    THREE.FontUtils.style = f
}
;
THREE.TextPath.prototype.toShapes = function() {
    for (var a = THREE.FontUtils.drawText(this.text).paths, b = [], c = 0, d = a.length; c < d; c++)
        Array.prototype.push.apply(b, a[c].toShapes());
    return b
}
;
THREE.AnimationHandler = function() {
    var a = []
      , b = {}
      , c = {
        update: function(b) {
            for (var c = 0; c < a.length; c++)
                a[c].update(b)
        },
        addToUpdate: function(b) {
            -1 === a.indexOf(b) && a.push(b)
        },
        removeFromUpdate: function(b) {
            b = a.indexOf(b);
            -1 !== b && a.splice(b, 1)
        },
        add: function(a) {
            void 0 !== b[a.name] && console.log("THREE.AnimationHandler.add: Warning! " + a.name + " already exists in library. Overwriting.");
            b[a.name] = a;
            if (!0 !== a.initialized) {
                for (var c = 0; c < a.hierarchy.length; c++) {
                    for (var d = 0; d < a.hierarchy[c].keys.length; d++)
                        if (0 > a.hierarchy[c].keys[d].time && (a.hierarchy[c].keys[d].time = 0),
                        void 0 !== a.hierarchy[c].keys[d].rot && !(a.hierarchy[c].keys[d].rot instanceof THREE.Quaternion)) {
                            var h = a.hierarchy[c].keys[d].rot;
                            a.hierarchy[c].keys[d].rot = new THREE.Quaternion(h[0],h[1],h[2],h[3])
                        }
                    if (a.hierarchy[c].keys.length && void 0 !== a.hierarchy[c].keys[0].morphTargets) {
                        h = {};
                        for (d = 0; d < a.hierarchy[c].keys.length; d++)
                            for (var i = 0; i < a.hierarchy[c].keys[d].morphTargets.length; i++) {
                                var j = a.hierarchy[c].keys[d].morphTargets[i];
                                h[j] = -1
                            }
                        a.hierarchy[c].usedMorphTargets = h;
                        for (d = 0; d < a.hierarchy[c].keys.length; d++) {
                            var k = {};
                            for (j in h) {
                                for (i = 0; i < a.hierarchy[c].keys[d].morphTargets.length; i++)
                                    if (a.hierarchy[c].keys[d].morphTargets[i] === j) {
                                        k[j] = a.hierarchy[c].keys[d].morphTargetsInfluences[i];
                                        break
                                    }
                                i === a.hierarchy[c].keys[d].morphTargets.length && (k[j] = 0)
                            }
                            a.hierarchy[c].keys[d].morphTargetsInfluences = k
                        }
                    }
                    for (d = 1; d < a.hierarchy[c].keys.length; d++)
                        a.hierarchy[c].keys[d].time === a.hierarchy[c].keys[d - 1].time && (a.hierarchy[c].keys.splice(d, 1),
                        d--);
                    for (d = 0; d < a.hierarchy[c].keys.length; d++)
                        a.hierarchy[c].keys[d].index = d
                }
                d = parseInt(a.length * a.fps, 10);
                a.JIT = {};
                a.JIT.hierarchy = [];
                for (c = 0; c < a.hierarchy.length; c++)
                    a.JIT.hierarchy.push(Array(d));
                a.initialized = !0
            }
        },
        get: function(a) {
            if ("string" === typeof a) {
                if (b[a])
                    return b[a];
                console.log("THREE.AnimationHandler.get: Couldn't find animation " + a);
                return null
            }
        },
        parse: function(a) {
            var b = [];
            if (a instanceof THREE.SkinnedMesh)
                for (var c = 0; c < a.bones.length; c++)
                    b.push(a.bones[c]);
            else
                d(a, b);
            return b
        }
    }
      , d = function(a, b) {
        b.push(a);
        for (var c = 0; c < a.children.length; c++)
            d(a.children[c], b)
    };
    c.LINEAR = 0;
    c.CATMULLROM = 1;
    c.CATMULLROM_FORWARD = 2;
    return c
}();
THREE.Animation = function(a, b, c, d) {
    this.root = a;
    this.data = THREE.AnimationHandler.get(b);
    this.hierarchy = THREE.AnimationHandler.parse(a);
    this.currentTime = 0;
    this.timeScale = 1;
    this.isPlaying = !1;
    this.loop = this.isPaused = !0;
    this.interpolationType = void 0 !== c ? c : THREE.AnimationHandler.LINEAR;
    this.JITCompile = void 0 !== d ? d : !0;
    this.points = [];
    this.target = new THREE.Vector3
}
;
THREE.Animation.prototype.play = function(a, b) {
    if (!this.isPlaying) {
        this.isPlaying = !0;
        this.loop = void 0 !== a ? a : !0;
        this.currentTime = void 0 !== b ? b : 0;
        var c, d = this.hierarchy.length, e;
        for (c = 0; c < d; c++) {
            e = this.hierarchy[c];
            this.interpolationType !== THREE.AnimationHandler.CATMULLROM_FORWARD && (e.useQuaternion = !0);
            e.matrixAutoUpdate = !0;
            void 0 === e.animationCache && (e.animationCache = {},
            e.animationCache.prevKey = {
                pos: 0,
                rot: 0,
                scl: 0
            },
            e.animationCache.nextKey = {
                pos: 0,
                rot: 0,
                scl: 0
            },
            e.animationCache.originalMatrix = e instanceof THREE.Bone ? e.skinMatrix : e.matrix);
            var f = e.animationCache.prevKey;
            e = e.animationCache.nextKey;
            f.pos = this.data.hierarchy[c].keys[0];
            f.rot = this.data.hierarchy[c].keys[0];
            f.scl = this.data.hierarchy[c].keys[0];
            e.pos = this.getNextKeyWith("pos", c, 1);
            e.rot = this.getNextKeyWith("rot", c, 1);
            e.scl = this.getNextKeyWith("scl", c, 1)
        }
        this.update(0)
    }
    this.isPaused = !1;
    THREE.AnimationHandler.addToUpdate(this)
}
;
THREE.Animation.prototype.pause = function() {
    this.isPaused ? THREE.AnimationHandler.addToUpdate(this) : THREE.AnimationHandler.removeFromUpdate(this);
    this.isPaused = !this.isPaused
}
;
THREE.Animation.prototype.stop = function() {
    this.isPaused = this.isPlaying = !1;
    THREE.AnimationHandler.removeFromUpdate(this);
    for (var a = 0; a < this.hierarchy.length; a++)
        void 0 !== this.hierarchy[a].animationCache && (this.hierarchy[a]instanceof THREE.Bone ? this.hierarchy[a].skinMatrix = this.hierarchy[a].animationCache.originalMatrix : this.hierarchy[a].matrix = this.hierarchy[a].animationCache.originalMatrix,
        delete this.hierarchy[a].animationCache)
}
;
THREE.Animation.prototype.update = function(a) {
    if (this.isPlaying) {
        var b = ["pos", "rot", "scl"], c, d, e, f, g, h, i, j, k = this.data.JIT.hierarchy, n, p;
        p = this.currentTime += a * this.timeScale;
        n = this.currentTime %= this.data.length;
        j = parseInt(Math.min(n * this.data.fps, this.data.length * this.data.fps), 10);
        for (var o = 0, r = this.hierarchy.length; o < r; o++)
            if (a = this.hierarchy[o],
            i = a.animationCache,
            this.JITCompile && void 0 !== k[o][j])
                a instanceof THREE.Bone ? (a.skinMatrix = k[o][j],
                a.matrixAutoUpdate = !1,
                a.matrixWorldNeedsUpdate = !1) : (a.matrix = k[o][j],
                a.matrixAutoUpdate = !1,
                a.matrixWorldNeedsUpdate = !0);
            else {
                this.JITCompile && (a instanceof THREE.Bone ? a.skinMatrix = a.animationCache.originalMatrix : a.matrix = a.animationCache.originalMatrix);
                for (var q = 0; 3 > q; q++) {
                    c = b[q];
                    g = i.prevKey[c];
                    h = i.nextKey[c];
                    if (h.time <= p) {
                        if (n < p)
                            if (this.loop) {
                                g = this.data.hierarchy[o].keys[0];
                                for (h = this.getNextKeyWith(c, o, 1); h.time < n; )
                                    g = h,
                                    h = this.getNextKeyWith(c, o, h.index + 1)
                            } else {
                                this.stop();
                                return
                            }
                        else {
                            do
                                g = h,
                                h = this.getNextKeyWith(c, o, h.index + 1);
                            while (h.time < n)
                        }
                        i.prevKey[c] = g;
                        i.nextKey[c] = h
                    }
                    a.matrixAutoUpdate = !0;
                    a.matrixWorldNeedsUpdate = !0;
                    d = (n - g.time) / (h.time - g.time);
                    e = g[c];
                    f = h[c];
                    if (0 > d || 1 < d)
                        console.log("THREE.Animation.update: Warning! Scale out of bounds:" + d + " on bone " + o),
                        d = 0 > d ? 0 : 1;
                    if ("pos" === c)
                        if (c = a.position,
                        this.interpolationType === THREE.AnimationHandler.LINEAR)
                            c.x = e[0] + (f[0] - e[0]) * d,
                            c.y = e[1] + (f[1] - e[1]) * d,
                            c.z = e[2] + (f[2] - e[2]) * d;
                        else {
                            if (this.interpolationType === THREE.AnimationHandler.CATMULLROM || this.interpolationType === THREE.AnimationHandler.CATMULLROM_FORWARD)
                                this.points[0] = this.getPrevKeyWith("pos", o, g.index - 1).pos,
                                this.points[1] = e,
                                this.points[2] = f,
                                this.points[3] = this.getNextKeyWith("pos", o, h.index + 1).pos,
                                d = 0.33 * d + 0.33,
                                e = this.interpolateCatmullRom(this.points, d),
                                c.x = e[0],
                                c.y = e[1],
                                c.z = e[2],
                                this.interpolationType === THREE.AnimationHandler.CATMULLROM_FORWARD && (d = this.interpolateCatmullRom(this.points, 1.01 * d),
                                this.target.set(d[0], d[1], d[2]),
                                this.target.subSelf(c),
                                this.target.y = 0,
                                this.target.normalize(),
                                d = Math.atan2(this.target.x, this.target.z),
                                a.rotation.set(0, d, 0))
                        }
                    else
                        "rot" === c ? THREE.Quaternion.slerp(e, f, a.quaternion, d) : "scl" === c && (c = a.scale,
                        c.x = e[0] + (f[0] - e[0]) * d,
                        c.y = e[1] + (f[1] - e[1]) * d,
                        c.z = e[2] + (f[2] - e[2]) * d)
                }
            }
        if (this.JITCompile && void 0 === k[0][j]) {
            this.hierarchy[0].updateMatrixWorld(!0);
            for (o = 0; o < this.hierarchy.length; o++)
                k[o][j] = this.hierarchy[o]instanceof THREE.Bone ? this.hierarchy[o].skinMatrix.clone() : this.hierarchy[o].matrix.clone()
        }
    }
}
;
THREE.Animation.prototype.interpolateCatmullRom = function(a, b) {
    var c = [], d = [], e, f, g, h, i, j;
    e = (a.length - 1) * b;
    f = Math.floor(e);
    e -= f;
    c[0] = 0 === f ? f : f - 1;
    c[1] = f;
    c[2] = f > a.length - 2 ? f : f + 1;
    c[3] = f > a.length - 3 ? f : f + 2;
    f = a[c[0]];
    h = a[c[1]];
    i = a[c[2]];
    j = a[c[3]];
    c = e * e;
    g = e * c;
    d[0] = this.interpolate(f[0], h[0], i[0], j[0], e, c, g);
    d[1] = this.interpolate(f[1], h[1], i[1], j[1], e, c, g);
    d[2] = this.interpolate(f[2], h[2], i[2], j[2], e, c, g);
    return d
}
;
THREE.Animation.prototype.interpolate = function(a, b, c, d, e, f, g) {
    a = 0.5 * (c - a);
    d = 0.5 * (d - b);
    return (2 * (b - c) + a + d) * g + (-3 * (b - c) - 2 * a - d) * f + a * e + b
}
;
THREE.Animation.prototype.getNextKeyWith = function(a, b, c) {
    for (var d = this.data.hierarchy[b].keys, c = this.interpolationType === THREE.AnimationHandler.CATMULLROM || this.interpolationType === THREE.AnimationHandler.CATMULLROM_FORWARD ? c < d.length - 1 ? c : d.length - 1 : c % d.length; c < d.length; c++)
        if (void 0 !== d[c][a])
            return d[c];
    return this.data.hierarchy[b].keys[0]
}
;
THREE.Animation.prototype.getPrevKeyWith = function(a, b, c) {
    for (var d = this.data.hierarchy[b].keys, c = this.interpolationType === THREE.AnimationHandler.CATMULLROM || this.interpolationType === THREE.AnimationHandler.CATMULLROM_FORWARD ? 0 < c ? c : 0 : 0 <= c ? c : c + d.length; 0 <= c; c--)
        if (void 0 !== d[c][a])
            return d[c];
    return this.data.hierarchy[b].keys[d.length - 1]
}
;
THREE.KeyFrameAnimation = function(a, b, c) {
    this.root = a;
    this.data = THREE.AnimationHandler.get(b);
    this.hierarchy = THREE.AnimationHandler.parse(a);
    this.currentTime = 0;
    this.timeScale = 0.0010;
    this.isPlaying = !1;
    this.loop = this.isPaused = !0;
    this.JITCompile = void 0 !== c ? c : !0;
    a = 0;
    for (b = this.hierarchy.length; a < b; a++) {
        var c = this.data.hierarchy[a].sids
          , d = this.hierarchy[a];
        if (this.data.hierarchy[a].keys.length && c) {
            for (var e = 0; e < c.length; e++) {
                var f = c[e]
                  , g = this.getNextKeyWith(f, a, 0);
                g && g.apply(f)
            }
            d.matrixAutoUpdate = !1;
            this.data.hierarchy[a].node.updateMatrix();
            d.matrixWorldNeedsUpdate = !0
        }
    }
}
;
THREE.KeyFrameAnimation.prototype.play = function(a, b) {
    if (!this.isPlaying) {
        this.isPlaying = !0;
        this.loop = void 0 !== a ? a : !0;
        this.currentTime = void 0 !== b ? b : 0;
        this.startTimeMs = b;
        this.startTime = 1E7;
        this.endTime = -this.startTime;
        var c, d = this.hierarchy.length, e, f;
        for (c = 0; c < d; c++)
            if (e = this.hierarchy[c],
            f = this.data.hierarchy[c],
            e.useQuaternion = !0,
            void 0 === f.animationCache && (f.animationCache = {},
            f.animationCache.prevKey = null,
            f.animationCache.nextKey = null,
            f.animationCache.originalMatrix = e instanceof THREE.Bone ? e.skinMatrix : e.matrix),
            e = this.data.hierarchy[c].keys,
            e.length)
                f.animationCache.prevKey = e[0],
                f.animationCache.nextKey = e[1],
                this.startTime = Math.min(e[0].time, this.startTime),
                this.endTime = Math.max(e[e.length - 1].time, this.endTime);
        this.update(0)
    }
    this.isPaused = !1;
    THREE.AnimationHandler.addToUpdate(this)
}
;
THREE.KeyFrameAnimation.prototype.pause = function() {
    this.isPaused ? THREE.AnimationHandler.addToUpdate(this) : THREE.AnimationHandler.removeFromUpdate(this);
    this.isPaused = !this.isPaused
}
;
THREE.KeyFrameAnimation.prototype.stop = function() {
    this.isPaused = this.isPlaying = !1;
    THREE.AnimationHandler.removeFromUpdate(this);
    for (var a = 0; a < this.data.hierarchy.length; a++) {
        var b = this.hierarchy[a]
          , c = this.data.hierarchy[a];
        if (void 0 !== c.animationCache) {
            var d = c.animationCache.originalMatrix;
            b instanceof THREE.Bone ? (d.copy(b.skinMatrix),
            b.skinMatrix = d) : (d.copy(b.matrix),
            b.matrix = d);
            delete c.animationCache
        }
    }
}
;
THREE.KeyFrameAnimation.prototype.update = function(a) {
    if (this.isPlaying) {
        var b, c, d, e, f = this.data.JIT.hierarchy, g, h, i;
        h = this.currentTime += a * this.timeScale;
        g = this.currentTime %= this.data.length;
        g < this.startTimeMs && (g = this.currentTime = this.startTimeMs + g);
        e = parseInt(Math.min(g * this.data.fps, this.data.length * this.data.fps), 10);
        if ((i = g < h) && !this.loop) {
            for (var a = 0, j = this.hierarchy.length; a < j; a++) {
                var k = this.data.hierarchy[a].keys
                  , f = this.data.hierarchy[a].sids;
                d = k.length - 1;
                e = this.hierarchy[a];
                if (k.length) {
                    for (k = 0; k < f.length; k++)
                        g = f[k],
                        (h = this.getPrevKeyWith(g, a, d)) && h.apply(g);
                    this.data.hierarchy[a].node.updateMatrix();
                    e.matrixWorldNeedsUpdate = !0
                }
            }
            this.stop()
        } else if (!(g < this.startTime)) {
            a = 0;
            for (j = this.hierarchy.length; a < j; a++) {
                d = this.hierarchy[a];
                b = this.data.hierarchy[a];
                var k = b.keys
                  , n = b.animationCache;
                if (this.JITCompile && void 0 !== f[a][e])
                    d instanceof THREE.Bone ? (d.skinMatrix = f[a][e],
                    d.matrixWorldNeedsUpdate = !1) : (d.matrix = f[a][e],
                    d.matrixWorldNeedsUpdate = !0);
                else if (k.length) {
                    this.JITCompile && n && (d instanceof THREE.Bone ? d.skinMatrix = n.originalMatrix : d.matrix = n.originalMatrix);
                    b = n.prevKey;
                    c = n.nextKey;
                    if (b && c) {
                        if (c.time <= h) {
                            if (i && this.loop) {
                                b = k[0];
                                for (c = k[1]; c.time < g; )
                                    b = c,
                                    c = k[b.index + 1]
                            } else if (!i)
                                for (var p = k.length - 1; c.time < g && c.index !== p; )
                                    b = c,
                                    c = k[b.index + 1];
                            n.prevKey = b;
                            n.nextKey = c
                        }
                        c.time >= g ? b.interpolate(c, g) : b.interpolate(c, c.time)
                    }
                    this.data.hierarchy[a].node.updateMatrix();
                    d.matrixWorldNeedsUpdate = !0
                }
            }
            if (this.JITCompile && void 0 === f[0][e]) {
                this.hierarchy[0].updateMatrixWorld(!0);
                for (a = 0; a < this.hierarchy.length; a++)
                    f[a][e] = this.hierarchy[a]instanceof THREE.Bone ? this.hierarchy[a].skinMatrix.clone() : this.hierarchy[a].matrix.clone()
            }
        }
    }
}
;
THREE.KeyFrameAnimation.prototype.getNextKeyWith = function(a, b, c) {
    b = this.data.hierarchy[b].keys;
    for (c %= b.length; c < b.length; c++)
        if (b[c].hasTarget(a))
            return b[c];
    return b[0]
}
;
THREE.KeyFrameAnimation.prototype.getPrevKeyWith = function(a, b, c) {
    b = this.data.hierarchy[b].keys;
    for (c = 0 <= c ? c : c + b.length; 0 <= c; c--)
        if (b[c].hasTarget(a))
            return b[c];
    return b[b.length - 1]
}
;
THREE.CubeCamera = function(a, b, c) {
    THREE.Object3D.call(this);
    var d = new THREE.PerspectiveCamera(90,1,a,b);
    d.up.set(0, -1, 0);
    d.lookAt(new THREE.Vector3(1,0,0));
    this.add(d);
    var e = new THREE.PerspectiveCamera(90,1,a,b);
    e.up.set(0, -1, 0);
    e.lookAt(new THREE.Vector3(-1,0,0));
    this.add(e);
    var f = new THREE.PerspectiveCamera(90,1,a,b);
    f.up.set(0, 0, 1);
    f.lookAt(new THREE.Vector3(0,1,0));
    this.add(f);
    var g = new THREE.PerspectiveCamera(90,1,a,b);
    g.up.set(0, 0, -1);
    g.lookAt(new THREE.Vector3(0,-1,0));
    this.add(g);
    var h = new THREE.PerspectiveCamera(90,1,a,b);
    h.up.set(0, -1, 0);
    h.lookAt(new THREE.Vector3(0,0,1));
    this.add(h);
    var i = new THREE.PerspectiveCamera(90,1,a,b);
    i.up.set(0, -1, 0);
    i.lookAt(new THREE.Vector3(0,0,-1));
    this.add(i);
    this.renderTarget = new THREE.WebGLRenderTargetCube(c,c,{
        format: THREE.RGBFormat,
        magFilter: THREE.LinearFilter,
        minFilter: THREE.LinearFilter
    });
    this.updateCubeMap = function(a, b) {
        var c = this.renderTarget
          , p = c.generateMipmaps;
        c.generateMipmaps = !1;
        c.activeCubeFace = 0;
        a.render(b, d, c);
        c.activeCubeFace = 1;
        a.render(b, e, c);
        c.activeCubeFace = 2;
        a.render(b, f, c);
        c.activeCubeFace = 3;
        a.render(b, g, c);
        c.activeCubeFace = 4;
        a.render(b, h, c);
        c.generateMipmaps = p;
        c.activeCubeFace = 5;
        a.render(b, i, c)
    }
}
;
THREE.CubeCamera.prototype = new THREE.Object3D;
THREE.CubeCamera.prototype.constructor = THREE.CubeCamera;
THREE.CombinedCamera = function(a, b, c, d, e, f, g) {
    THREE.Camera.call(this);
    this.fov = c;
    this.left = -a / 2;
    this.right = a / 2;
    this.top = b / 2;
    this.bottom = -b / 2;
    this.cameraO = new THREE.OrthographicCamera(a / -2,a / 2,b / 2,b / -2,f,g);
    this.cameraP = new THREE.PerspectiveCamera(c,a / b,d,e);
    this.zoom = 1;
    this.toPerspective()
}
;
THREE.CombinedCamera.prototype = new THREE.Camera;
THREE.CombinedCamera.prototype.constructor = THREE.CombinedCamera;
THREE.CombinedCamera.prototype.toPerspective = function() {
    this.near = this.cameraP.near;
    this.far = this.cameraP.far;
    this.cameraP.fov = this.fov / this.zoom;
    this.cameraP.updateProjectionMatrix();
    this.projectionMatrix = this.cameraP.projectionMatrix;
    this.inPersepectiveMode = !0;
    this.inOrthographicMode = !1
}
;
THREE.CombinedCamera.prototype.toOrthographic = function() {
    var a = this.cameraP.aspect
      , b = (this.cameraP.near + this.cameraP.far) / 2
      , b = Math.tan(this.fov / 2) * b
      , a = 2 * b * a / 2
      , b = b / this.zoom
      , a = a / this.zoom;
    this.cameraO.left = -a;
    this.cameraO.right = a;
    this.cameraO.top = b;
    this.cameraO.bottom = -b;
    this.cameraO.updateProjectionMatrix();
    this.near = this.cameraO.near;
    this.far = this.cameraO.far;
    this.projectionMatrix = this.cameraO.projectionMatrix;
    this.inPersepectiveMode = !1;
    this.inOrthographicMode = !0
}
;
THREE.CombinedCamera.prototype.setSize = function(a, b) {
    this.cameraP.aspect = a / b;
    this.left = -a / 2;
    this.right = a / 2;
    this.top = b / 2;
    this.bottom = -b / 2
}
;
THREE.CombinedCamera.prototype.setFov = function(a) {
    this.fov = a;
    this.inPersepectiveMode ? this.toPerspective() : this.toOrthographic()
}
;
THREE.CombinedCamera.prototype.updateProjectionMatrix = function() {
    this.inPersepectiveMode ? this.toPerspective() : (this.toPerspective(),
    this.toOrthographic())
}
;
THREE.CombinedCamera.prototype.setLens = function(a, b) {
    var c = 2 * Math.atan((void 0 !== b ? b : 24) / (2 * a)) * (180 / Math.PI);
    this.setFov(c);
    return c
}
;
THREE.CombinedCamera.prototype.setZoom = function(a) {
    this.zoom = a;
    this.inPersepectiveMode ? this.toPerspective() : this.toOrthographic()
}
;
THREE.CombinedCamera.prototype.toFrontView = function() {
    this.rotation.x = 0;
    this.rotation.y = 0;
    this.rotation.z = 0;
    this.rotationAutoUpdate = !1
}
;
THREE.CombinedCamera.prototype.toBackView = function() {
    this.rotation.x = 0;
    this.rotation.y = Math.PI;
    this.rotation.z = 0;
    this.rotationAutoUpdate = !1
}
;
THREE.CombinedCamera.prototype.toLeftView = function() {
    this.rotation.x = 0;
    this.rotation.y = -Math.PI / 2;
    this.rotation.z = 0;
    this.rotationAutoUpdate = !1
}
;
THREE.CombinedCamera.prototype.toRightView = function() {
    this.rotation.x = 0;
    this.rotation.y = Math.PI / 2;
    this.rotation.z = 0;
    this.rotationAutoUpdate = !1
}
;
THREE.CombinedCamera.prototype.toTopView = function() {
    this.rotation.x = -Math.PI / 2;
    this.rotation.y = 0;
    this.rotation.z = 0;
    this.rotationAutoUpdate = !1
}
;
THREE.CombinedCamera.prototype.toBottomView = function() {
    this.rotation.x = Math.PI / 2;
    this.rotation.y = 0;
    this.rotation.z = 0;
    this.rotationAutoUpdate = !1
}
;
THREE.FirstPersonControls = function(a, b) {
    function c(a, b) {
        return function() {
            b.apply(a, arguments)
        }
    }
    this.object = a;
    this.target = new THREE.Vector3(0,0,0);
    this.domElement = void 0 !== b ? b : document;
    this.movementSpeed = 1;
    this.lookSpeed = 0.0050;
    this.noFly = !1;
    this.lookVertical = !0;
    this.autoForward = !1;
    this.activeLook = !0;
    this.heightSpeed = !1;
    this.heightCoef = 1;
    this.heightMin = 0;
    this.constrainVertical = !1;
    this.verticalMin = 0;
    this.verticalMax = Math.PI;
    this.theta = this.phi = this.lon = this.lat = this.mouseY = this.mouseX = this.autoSpeedFactor = 0;
    this.mouseDragOn = this.freeze = this.moveRight = this.moveLeft = this.moveBackward = this.moveForward = !1;
    this.domElement === document ? (this.viewHalfX = window.innerWidth / 2,
    this.viewHalfY = window.innerHeight / 2) : (this.viewHalfX = this.domElement.offsetWidth / 2,
    this.viewHalfY = this.domElement.offsetHeight / 2,
    this.domElement.setAttribute("tabindex", -1));
    this.onMouseDown = function(a) {
        this.domElement !== document && this.domElement.focus();
        a.preventDefault();
        a.stopPropagation();
        if (this.activeLook)
            switch (a.button) {
            case 0:
                this.moveForward = true;
                break;
            case 2:
                this.moveBackward = true
            }
        this.mouseDragOn = true
    }
    ;
    this.onMouseUp = function(a) {
        a.preventDefault();
        a.stopPropagation();
        if (this.activeLook)
            switch (a.button) {
            case 0:
                this.moveForward = false;
                break;
            case 2:
                this.moveBackward = false
            }
        this.mouseDragOn = false
    }
    ;
    this.onMouseMove = function(a) {
        if (this.domElement === document) {
            this.mouseX = a.pageX - this.viewHalfX;
            this.mouseY = a.pageY - this.viewHalfY
        } else {
            this.mouseX = a.pageX - this.domElement.offsetLeft - this.viewHalfX;
            this.mouseY = a.pageY - this.domElement.offsetTop - this.viewHalfY
        }
    }
    ;
    this.onKeyDown = function(a) {
        switch (a.keyCode) {
        case 38:
        case 87:
            this.moveForward = true;
            break;
        case 37:
        case 65:
            this.moveLeft = true;
            break;
        case 40:
        case 83:
            this.moveBackward = true;
            break;
        case 39:
        case 68:
            this.moveRight = true;
            break;
        case 82:
            this.moveUp = true;
            break;
        case 70:
            this.moveDown = true;
            break;
        case 81:
            this.freeze = !this.freeze
        }
    }
    ;
    this.onKeyUp = function(a) {
        switch (a.keyCode) {
        case 38:
        case 87:
            this.moveForward = false;
            break;
        case 37:
        case 65:
            this.moveLeft = false;
            break;
        case 40:
        case 83:
            this.moveBackward = false;
            break;
        case 39:
        case 68:
            this.moveRight = false;
            break;
        case 82:
            this.moveUp = false;
            break;
        case 70:
            this.moveDown = false
        }
    }
    ;
    this.update = function(a) {
        var b = 0;
        if (!this.freeze) {
            if (this.heightSpeed) {
                b = THREE.Math.clamp(this.object.position.y, this.heightMin, this.heightMax) - this.heightMin;
                this.autoSpeedFactor = a * b * this.heightCoef
            } else
                this.autoSpeedFactor = 0;
            b = a * this.movementSpeed;
            (this.moveForward || this.autoForward && !this.moveBackward) && this.object.translateZ(-(b + this.autoSpeedFactor));
            this.moveBackward && this.object.translateZ(b);
            this.moveLeft && this.object.translateX(-b);
            this.moveRight && this.object.translateX(b);
            this.moveUp && this.object.translateY(b);
            this.moveDown && this.object.translateY(-b);
            a = a * this.lookSpeed;
            this.activeLook || (a = 0);
            this.lon = this.lon + this.mouseX * a;
            if (this.lookVertical)
                this.lat = this.lat - this.mouseY * a;
            this.lat = Math.max(-85, Math.min(85, this.lat));
            this.phi = (90 - this.lat) * Math.PI / 180;
            this.theta = this.lon * Math.PI / 180;
            var b = this.target
              , c = this.object.position;
            b.x = c.x + 100 * Math.sin(this.phi) * Math.cos(this.theta);
            b.y = c.y + 100 * Math.cos(this.phi);
            b.z = c.z + 100 * Math.sin(this.phi) * Math.sin(this.theta);
            b = 1;
            this.constrainVertical && (b = Math.PI / (this.verticalMax - this.verticalMin));
            this.lon = this.lon + this.mouseX * a;
            if (this.lookVertical)
                this.lat = this.lat - this.mouseY * a * b;
            this.lat = Math.max(-85, Math.min(85, this.lat));
            this.phi = (90 - this.lat) * Math.PI / 180;
            this.theta = this.lon * Math.PI / 180;
            if (this.constrainVertical)
                this.phi = THREE.Math.mapLinear(this.phi, 0, Math.PI, this.verticalMin, this.verticalMax);
            b = this.target;
            c = this.object.position;
            b.x = c.x + 100 * Math.sin(this.phi) * Math.cos(this.theta);
            b.y = c.y + 100 * Math.cos(this.phi);
            b.z = c.z + 100 * Math.sin(this.phi) * Math.sin(this.theta);
            this.object.lookAt(b)
        }
    }
    ;
    this.domElement.addEventListener("contextmenu", function(a) {
        a.preventDefault()
    }, !1);
    this.domElement.addEventListener("mousemove", c(this, this.onMouseMove), !1);
    this.domElement.addEventListener("mousedown", c(this, this.onMouseDown), !1);
    this.domElement.addEventListener("mouseup", c(this, this.onMouseUp), !1);
    this.domElement.addEventListener("keydown", c(this, this.onKeyDown), !1);
    this.domElement.addEventListener("keyup", c(this, this.onKeyUp), !1)
}
;
THREE.PathControls = function(a, b) {
    function c(a) {
        return 1 > (a *= 2) ? 0.5 * a * a : -0.5 * (--a * (a - 2) - 1)
    }
    function d(a, b) {
        return function() {
            b.apply(a, arguments)
        }
    }
    function e(a, b, c, d) {
        var e = {
            name: c,
            fps: 0.6,
            length: d,
            hierarchy: []
        }, f, g = b.getControlPointsArray(), h = b.getLength(), s = g.length, t = 0;
        f = s - 1;
        b = {
            parent: -1,
            keys: []
        };
        b.keys[0] = {
            time: 0,
            pos: g[0],
            rot: [0, 0, 0, 1],
            scl: [1, 1, 1]
        };
        b.keys[f] = {
            time: d,
            pos: g[f],
            rot: [0, 0, 0, 1],
            scl: [1, 1, 1]
        };
        for (f = 1; f < s - 1; f++)
            t = d * h.chunks[f] / h.total,
            b.keys[f] = {
                time: t,
                pos: g[f]
            };
        e.hierarchy[0] = b;
        THREE.AnimationHandler.add(e);
        return new THREE.Animation(a,c,THREE.AnimationHandler.CATMULLROM_FORWARD,!1)
    }
    function f(a, b) {
        var c, d, e = new THREE.Geometry;
        for (c = 0; c < a.points.length * b; c++)
            d = c / (a.points.length * b),
            d = a.getPoint(d),
            e.vertices[c] = new THREE.Vector3(d.x,d.y,d.z);
        return e
    }
    this.object = a;
    this.domElement = void 0 !== b ? b : document;
    this.id = "PathControls" + THREE.PathControlsIdCounter++;
    this.duration = 1E4;
    this.waypoints = [];
    this.useConstantSpeed = !0;
    this.resamplingCoef = 50;
    this.debugPath = new THREE.Object3D;
    this.debugDummy = new THREE.Object3D;
    this.animationParent = new THREE.Object3D;
    this.lookSpeed = 0.0050;
    this.lookHorizontal = this.lookVertical = !0;
    this.verticalAngleMap = {
        srcRange: [0, 2 * Math.PI],
        dstRange: [0, 2 * Math.PI]
    };
    this.horizontalAngleMap = {
        srcRange: [0, 2 * Math.PI],
        dstRange: [0, 2 * Math.PI]
    };
    this.target = new THREE.Object3D;
    this.theta = this.phi = this.lon = this.lat = this.mouseY = this.mouseX = 0;
    this.domElement === document ? (this.viewHalfX = window.innerWidth / 2,
    this.viewHalfY = window.innerHeight / 2) : (this.viewHalfX = this.domElement.offsetWidth / 2,
    this.viewHalfY = this.domElement.offsetHeight / 2,
    this.domElement.setAttribute("tabindex", -1));
    var g = 2 * Math.PI
      , h = Math.PI / 180;
    this.update = function(a) {
        var b;
        if (this.lookHorizontal)
            this.lon = this.lon + this.mouseX * this.lookSpeed * a;
        if (this.lookVertical)
            this.lat = this.lat - this.mouseY * this.lookSpeed * a;
        this.lon = Math.max(0, Math.min(360, this.lon));
        this.lat = Math.max(-85, Math.min(85, this.lat));
        this.phi = (90 - this.lat) * h;
        this.theta = this.lon * h;
        a = this.phi % g;
        this.phi = a >= 0 ? a : a + g;
        b = this.verticalAngleMap.srcRange;
        a = this.verticalAngleMap.dstRange;
        b = THREE.Math.mapLinear(this.phi, b[0], b[1], a[0], a[1]);
        var d = a[1] - a[0];
        this.phi = c((b - a[0]) / d) * d + a[0];
        b = this.horizontalAngleMap.srcRange;
        a = this.horizontalAngleMap.dstRange;
        b = THREE.Math.mapLinear(this.theta, b[0], b[1], a[0], a[1]);
        d = a[1] - a[0];
        this.theta = c((b - a[0]) / d) * d + a[0];
        a = this.target.position;
        a.x = 100 * Math.sin(this.phi) * Math.cos(this.theta);
        a.y = 100 * Math.cos(this.phi);
        a.z = 100 * Math.sin(this.phi) * Math.sin(this.theta);
        this.object.lookAt(this.target.position)
    }
    ;
    this.onMouseMove = function(a) {
        if (this.domElement === document) {
            this.mouseX = a.pageX - this.viewHalfX;
            this.mouseY = a.pageY - this.viewHalfY
        } else {
            this.mouseX = a.pageX - this.domElement.offsetLeft - this.viewHalfX;
            this.mouseY = a.pageY - this.domElement.offsetTop - this.viewHalfY
        }
    }
    ;
    this.init = function() {
        this.spline = new THREE.Spline;
        this.spline.initFromArray(this.waypoints);
        this.useConstantSpeed && this.spline.reparametrizeByArcLength(this.resamplingCoef);
        if (this.createDebugDummy) {
            var a = new THREE.MeshLambertMaterial({
                color: 30719
            })
              , b = new THREE.MeshLambertMaterial({
                color: 65280
            })
              , c = new THREE.CubeGeometry(10,10,20)
              , g = new THREE.CubeGeometry(2,2,10);
            this.animationParent = new THREE.Mesh(c,a);
            a = new THREE.Mesh(g,b);
            a.position.set(0, 10, 0);
            this.animation = e(this.animationParent, this.spline, this.id, this.duration);
            this.animationParent.add(this.object);
            this.animationParent.add(this.target);
            this.animationParent.add(a)
        } else {
            this.animation = e(this.animationParent, this.spline, this.id, this.duration);
            this.animationParent.add(this.target);
            this.animationParent.add(this.object)
        }
        if (this.createDebugPath) {
            var a = this.debugPath
              , b = this.spline
              , g = f(b, 10)
              , c = f(b, 10)
              , h = new THREE.LineBasicMaterial({
                color: 16711680,
                linewidth: 3
            })
              , g = new THREE.Line(g,h)
              , c = new THREE.ParticleSystem(c,new THREE.ParticleBasicMaterial({
                color: 16755200,
                size: 3
            }));
            g.scale.set(1, 1, 1);
            a.add(g);
            c.scale.set(1, 1, 1);
            a.add(c);
            for (var g = new THREE.SphereGeometry(1,16,8), h = new THREE.MeshBasicMaterial({
                color: 65280
            }), o = 0; o < b.points.length; o++) {
                c = new THREE.Mesh(g,h);
                c.position.copy(b.points[o]);
                a.add(c)
            }
        }
        this.domElement.addEventListener("mousemove", d(this, this.onMouseMove), false)
    }
}
;
THREE.PathControlsIdCounter = 0;
THREE.FlyControls = function(a, b) {
    function c(a, b) {
        return function() {
            b.apply(a, arguments)
        }
    }
    this.object = a;
    this.domElement = void 0 !== b ? b : document;
    b && this.domElement.setAttribute("tabindex", -1);
    this.movementSpeed = 1;
    this.rollSpeed = 0.0050;
    this.autoForward = this.dragToLook = !1;
    this.object.useQuaternion = !0;
    this.tmpQuaternion = new THREE.Quaternion;
    this.mouseStatus = 0;
    this.moveState = {
        up: 0,
        down: 0,
        left: 0,
        right: 0,
        forward: 0,
        back: 0,
        pitchUp: 0,
        pitchDown: 0,
        yawLeft: 0,
        yawRight: 0,
        rollLeft: 0,
        rollRight: 0
    };
    this.moveVector = new THREE.Vector3(0,0,0);
    this.rotationVector = new THREE.Vector3(0,0,0);
    this.handleEvent = function(a) {
        if ("function" == typeof this[a.type])
            this[a.type](a)
    }
    ;
    this.keydown = function(a) {
        if (!a.altKey) {
            switch (a.keyCode) {
            case 16:
                this.movementSpeedMultiplier = 0.1;
                break;
            case 87:
                this.moveState.forward = 1;
                break;
            case 83:
                this.moveState.back = 1;
                break;
            case 65:
                this.moveState.left = 1;
                break;
            case 68:
                this.moveState.right = 1;
                break;
            case 82:
                this.moveState.up = 1;
                break;
            case 70:
                this.moveState.down = 1;
                break;
            case 38:
                this.moveState.pitchUp = 1;
                break;
            case 40:
                this.moveState.pitchDown = 1;
                break;
            case 37:
                this.moveState.yawLeft = 1;
                break;
            case 39:
                this.moveState.yawRight = 1;
                break;
            case 81:
                this.moveState.rollLeft = 1;
                break;
            case 69:
                this.moveState.rollRight = 1
            }
            this.updateMovementVector();
            this.updateRotationVector()
        }
    }
    ;
    this.keyup = function(a) {
        switch (a.keyCode) {
        case 16:
            this.movementSpeedMultiplier = 1;
            break;
        case 87:
            this.moveState.forward = 0;
            break;
        case 83:
            this.moveState.back = 0;
            break;
        case 65:
            this.moveState.left = 0;
            break;
        case 68:
            this.moveState.right = 0;
            break;
        case 82:
            this.moveState.up = 0;
            break;
        case 70:
            this.moveState.down = 0;
            break;
        case 38:
            this.moveState.pitchUp = 0;
            break;
        case 40:
            this.moveState.pitchDown = 0;
            break;
        case 37:
            this.moveState.yawLeft = 0;
            break;
        case 39:
            this.moveState.yawRight = 0;
            break;
        case 81:
            this.moveState.rollLeft = 0;
            break;
        case 69:
            this.moveState.rollRight = 0
        }
        this.updateMovementVector();
        this.updateRotationVector()
    }
    ;
    this.mousedown = function(a) {
        this.domElement !== document && this.domElement.focus();
        a.preventDefault();
        a.stopPropagation();
        if (this.dragToLook)
            this.mouseStatus++;
        else
            switch (a.button) {
            case 0:
                this.object.moveForward = !0;
                break;
            case 2:
                this.object.moveBackward = !0
            }
    }
    ;
    this.mousemove = function(a) {
        if (!this.dragToLook || 0 < this.mouseStatus) {
            var b = this.getContainerDimensions()
              , c = b.size[0] / 2
              , g = b.size[1] / 2;
            this.moveState.yawLeft = -(a.pageX - b.offset[0] - c) / c;
            this.moveState.pitchDown = (a.pageY - b.offset[1] - g) / g;
            this.updateRotationVector()
        }
    }
    ;
    this.mouseup = function(a) {
        a.preventDefault();
        a.stopPropagation();
        if (this.dragToLook)
            this.mouseStatus--,
            this.moveState.yawLeft = this.moveState.pitchDown = 0;
        else
            switch (a.button) {
            case 0:
                this.moveForward = !1;
                break;
            case 2:
                this.moveBackward = !1
            }
        this.updateRotationVector()
    }
    ;
    this.update = function(a) {
        var b = a * this.movementSpeed
          , a = a * this.rollSpeed;
        this.object.translateX(this.moveVector.x * b);
        this.object.translateY(this.moveVector.y * b);
        this.object.translateZ(this.moveVector.z * b);
        this.tmpQuaternion.set(this.rotationVector.x * a, this.rotationVector.y * a, this.rotationVector.z * a, 1).normalize();
        this.object.quaternion.multiplySelf(this.tmpQuaternion);
        this.object.matrix.setPosition(this.object.position);
        this.object.matrix.setRotationFromQuaternion(this.object.quaternion);
        this.object.matrixWorldNeedsUpdate = !0
    }
    ;
    this.updateMovementVector = function() {
        var a = this.moveState.forward || this.autoForward && !this.moveState.back ? 1 : 0;
        this.moveVector.x = -this.moveState.left + this.moveState.right;
        this.moveVector.y = -this.moveState.down + this.moveState.up;
        this.moveVector.z = -a + this.moveState.back
    }
    ;
    this.updateRotationVector = function() {
        this.rotationVector.x = -this.moveState.pitchDown + this.moveState.pitchUp;
        this.rotationVector.y = -this.moveState.yawRight + this.moveState.yawLeft;
        this.rotationVector.z = -this.moveState.rollRight + this.moveState.rollLeft
    }
    ;
    this.getContainerDimensions = function() {
        return this.domElement != document ? {
            size: [this.domElement.offsetWidth, this.domElement.offsetHeight],
            offset: [this.domElement.offsetLeft, this.domElement.offsetTop]
        } : {
            size: [window.innerWidth, window.innerHeight],
            offset: [0, 0]
        }
    }
    ;
    this.domElement.addEventListener("mousemove", c(this, this.mousemove), !1);
    this.domElement.addEventListener("mousedown", c(this, this.mousedown), !1);
    this.domElement.addEventListener("mouseup", c(this, this.mouseup), !1);
    this.domElement.addEventListener("keydown", c(this, this.keydown), !1);
    this.domElement.addEventListener("keyup", c(this, this.keyup), !1);
    this.updateMovementVector();
    this.updateRotationVector()
}
;
THREE.RollControls = function(a, b) {
    this.object = a;
    this.domElement = void 0 !== b ? b : document;
    this.mouseLook = !0;
    this.autoForward = !1;
    this.rollSpeed = this.movementSpeed = this.lookSpeed = 1;
    this.constrainVertical = [-0.9, 0.9];
    this.object.matrixAutoUpdate = !1;
    this.forward = new THREE.Vector3(0,0,1);
    this.roll = 0;
    var c = new THREE.Vector3
      , d = new THREE.Vector3
      , e = new THREE.Vector3
      , f = new THREE.Matrix4
      , g = !1
      , h = 1
      , i = 0
      , j = 0
      , k = 0
      , n = 0
      , p = 0
      , o = window.innerWidth / 2
      , r = window.innerHeight / 2;
    this.update = function(a) {
        if (this.mouseLook) {
            var b = a * this.lookSpeed;
            this.rotateHorizontally(b * n);
            this.rotateVertically(b * p)
        }
        b = a * this.movementSpeed;
        this.object.translateZ(-b * (0 < i || this.autoForward && !(0 > i) ? 1 : i));
        this.object.translateX(b * j);
        this.object.translateY(b * k);
        g && (this.roll += this.rollSpeed * a * h);
        this.forward.y > this.constrainVertical[1] ? (this.forward.y = this.constrainVertical[1],
        this.forward.normalize()) : this.forward.y < this.constrainVertical[0] && (this.forward.y = this.constrainVertical[0],
        this.forward.normalize());
        e.copy(this.forward);
        d.set(0, 1, 0);
        c.cross(d, e).normalize();
        d.cross(e, c).normalize();
        this.object.matrix.elements[0] = c.x;
        this.object.matrix.elements[4] = d.x;
        this.object.matrix.elements[8] = e.x;
        this.object.matrix.elements[1] = c.y;
        this.object.matrix.elements[5] = d.y;
        this.object.matrix.elements[9] = e.y;
        this.object.matrix.elements[2] = c.z;
        this.object.matrix.elements[6] = d.z;
        this.object.matrix.elements[10] = e.z;
        f.identity();
        f.elements[0] = Math.cos(this.roll);
        f.elements[4] = -Math.sin(this.roll);
        f.elements[1] = Math.sin(this.roll);
        f.elements[5] = Math.cos(this.roll);
        this.object.matrix.multiplySelf(f);
        this.object.matrixWorldNeedsUpdate = !0;
        this.object.matrix.elements[12] = this.object.position.x;
        this.object.matrix.elements[13] = this.object.position.y;
        this.object.matrix.elements[14] = this.object.position.z
    }
    ;
    this.translateX = function(a) {
        this.object.position.x += this.object.matrix.elements[0] * a;
        this.object.position.y += this.object.matrix.elements[1] * a;
        this.object.position.z += this.object.matrix.elements[2] * a
    }
    ;
    this.translateY = function(a) {
        this.object.position.x += this.object.matrix.elements[4] * a;
        this.object.position.y += this.object.matrix.elements[5] * a;
        this.object.position.z += this.object.matrix.elements[6] * a
    }
    ;
    this.translateZ = function(a) {
        this.object.position.x -= this.object.matrix.elements[8] * a;
        this.object.position.y -= this.object.matrix.elements[9] * a;
        this.object.position.z -= this.object.matrix.elements[10] * a
    }
    ;
    this.rotateHorizontally = function(a) {
        c.set(this.object.matrix.elements[0], this.object.matrix.elements[1], this.object.matrix.elements[2]);
        c.multiplyScalar(a);
        this.forward.subSelf(c);
        this.forward.normalize()
    }
    ;
    this.rotateVertically = function(a) {
        d.set(this.object.matrix.elements[4], this.object.matrix.elements[5], this.object.matrix.elements[6]);
        d.multiplyScalar(a);
        this.forward.addSelf(d);
        this.forward.normalize()
    }
    ;
    this.domElement.addEventListener("contextmenu", function(a) {
        a.preventDefault()
    }, !1);
    this.domElement.addEventListener("mousemove", function(a) {
        n = (a.clientX - o) / window.innerWidth;
        p = (a.clientY - r) / window.innerHeight
    }, !1);
    this.domElement.addEventListener("mousedown", function(a) {
        a.preventDefault();
        a.stopPropagation();
        switch (a.button) {
        case 0:
            i = 1;
            break;
        case 2:
            i = -1
        }
    }, !1);
    this.domElement.addEventListener("mouseup", function(a) {
        a.preventDefault();
        a.stopPropagation();
        switch (a.button) {
        case 0:
            i = 0;
            break;
        case 2:
            i = 0
        }
    }, !1);
    this.domElement.addEventListener("keydown", function(a) {
        switch (a.keyCode) {
        case 38:
        case 87:
            i = 1;
            break;
        case 37:
        case 65:
            j = -1;
            break;
        case 40:
        case 83:
            i = -1;
            break;
        case 39:
        case 68:
            j = 1;
            break;
        case 81:
            g = !0;
            h = 1;
            break;
        case 69:
            g = !0;
            h = -1;
            break;
        case 82:
            k = 1;
            break;
        case 70:
            k = -1
        }
    }, !1);
    this.domElement.addEventListener("keyup", function(a) {
        switch (a.keyCode) {
        case 38:
        case 87:
            i = 0;
            break;
        case 37:
        case 65:
            j = 0;
            break;
        case 40:
        case 83:
            i = 0;
            break;
        case 39:
        case 68:
            j = 0;
            break;
        case 81:
            g = !1;
            break;
        case 69:
            g = !1;
            break;
        case 82:
            k = 0;
            break;
        case 70:
            k = 0
        }
    }, !1)
}
;
THREE.TrackballControls = function(a, b) {
    THREE.EventTarget.call(this);
    var c = this;
    this.object = a;
    this.domElement = void 0 !== b ? b : document;
    this.enabled = !0;
    this.screen = {
        width: window.innerWidth,
        height: window.innerHeight,
        offsetLeft: 0,
        offsetTop: 0
    };
    this.radius = (this.screen.width + this.screen.height) / 4;
    this.rotateSpeed = 1;
    this.zoomSpeed = 1.2;
    this.panSpeed = 0.3;
    this.staticMoving = this.noPan = this.noZoom = this.noRotate = !1;
    this.dynamicDampingFactor = 0.2;
    this.minDistance = 0;
    this.maxDistance = Infinity;
    this.keys = [65, 83, 68];
    this.target = new THREE.Vector3;
    var d = new THREE.Vector3
      , e = !1
      , f = -1
      , g = new THREE.Vector3
      , h = new THREE.Vector3
      , i = new THREE.Vector3
      , j = new THREE.Vector2
      , k = new THREE.Vector2
      , n = new THREE.Vector2
      , p = new THREE.Vector2
      , o = {
        type: "change"
    };
    this.handleEvent = function(a) {
        if ("function" == typeof this[a.type])
            this[a.type](a)
    }
    ;
    this.getMouseOnScreen = function(a, b) {
        return new THREE.Vector2(0.5 * ((a - c.screen.offsetLeft) / c.radius),0.5 * ((b - c.screen.offsetTop) / c.radius))
    }
    ;
    this.getMouseProjectionOnBall = function(a, b) {
        var d = new THREE.Vector3((a - 0.5 * c.screen.width - c.screen.offsetLeft) / c.radius,(0.5 * c.screen.height + c.screen.offsetTop - b) / c.radius,0)
          , e = d.length();
        1 < e ? d.normalize() : d.z = Math.sqrt(1 - e * e);
        g.copy(c.object.position).subSelf(c.target);
        e = c.object.up.clone().setLength(d.y);
        e.addSelf(c.object.up.clone().crossSelf(g).setLength(d.x));
        e.addSelf(g.setLength(d.z));
        return e
    }
    ;
    this.rotateCamera = function() {
        var a = Math.acos(h.dot(i) / h.length() / i.length());
        if (a) {
            var b = (new THREE.Vector3).cross(h, i).normalize()
              , d = new THREE.Quaternion
              , a = a * c.rotateSpeed;
            d.setFromAxisAngle(b, -a);
            d.multiplyVector3(g);
            d.multiplyVector3(c.object.up);
            d.multiplyVector3(i);
            c.staticMoving ? h = i : (d.setFromAxisAngle(b, a * (c.dynamicDampingFactor - 1)),
            d.multiplyVector3(h))
        }
    }
    ;
    this.zoomCamera = function() {
        var a = 1 + (k.y - j.y) * c.zoomSpeed;
        1 !== a && 0 < a && (g.multiplyScalar(a),
        c.staticMoving ? j = k : j.y += (k.y - j.y) * this.dynamicDampingFactor)
    }
    ;
    this.panCamera = function() {
        var a = p.clone().subSelf(n);
        if (a.lengthSq()) {
            a.multiplyScalar(g.length() * c.panSpeed);
            var b = g.clone().crossSelf(c.object.up).setLength(a.x);
            b.addSelf(c.object.up.clone().setLength(a.y));
            c.object.position.addSelf(b);
            c.target.addSelf(b);
            c.staticMoving ? n = p : n.addSelf(a.sub(p, n).multiplyScalar(c.dynamicDampingFactor))
        }
    }
    ;
    this.checkDistances = function() {
        if (!c.noZoom || !c.noPan)
            c.object.position.lengthSq() > c.maxDistance * c.maxDistance && c.object.position.setLength(c.maxDistance),
            g.lengthSq() < c.minDistance * c.minDistance && c.object.position.add(c.target, g.setLength(c.minDistance))
    }
    ;
    this.update = function() {
        g.copy(c.object.position).subSelf(c.target);
        c.noRotate || c.rotateCamera();
        c.noZoom || c.zoomCamera();
        c.noPan || c.panCamera();
        c.object.position.add(c.target, g);
        c.checkDistances();
        c.object.lookAt(c.target);
        0 < d.distanceTo(c.object.position) && (c.dispatchEvent(o),
        d.copy(c.object.position))
    }
    ;
    this.domElement.addEventListener("contextmenu", function(a) {
        a.preventDefault()
    }, !1);
    this.domElement.addEventListener("mousemove", function(a) {
        c.enabled && (e && (h = i = c.getMouseProjectionOnBall(a.clientX, a.clientY),
        j = k = c.getMouseOnScreen(a.clientX, a.clientY),
        n = p = c.getMouseOnScreen(a.clientX, a.clientY),
        e = !1),
        -1 !== f && (0 === f && !c.noRotate ? i = c.getMouseProjectionOnBall(a.clientX, a.clientY) : 1 === f && !c.noZoom ? k = c.getMouseOnScreen(a.clientX, a.clientY) : 2 === f && !c.noPan && (p = c.getMouseOnScreen(a.clientX, a.clientY))))
    }, !1);
    this.domElement.addEventListener("mousedown", function(a) {
        c.enabled && (a.preventDefault(),
        a.stopPropagation(),
        -1 === f && (f = a.button,
        0 === f && !c.noRotate ? h = i = c.getMouseProjectionOnBall(a.clientX, a.clientY) : 1 === f && !c.noZoom ? j = k = c.getMouseOnScreen(a.clientX, a.clientY) : this.noPan || (n = p = c.getMouseOnScreen(a.clientX, a.clientY))))
    }, !1);
    this.domElement.addEventListener("mouseup", function(a) {
        c.enabled && (a.preventDefault(),
        a.stopPropagation(),
        f = -1)
    }, !1);
    window.addEventListener("keydown", function(a) {
        c.enabled && -1 === f && (a.keyCode === c.keys[0] && !c.noRotate ? f = 0 : a.keyCode === c.keys[1] && !c.noZoom ? f = 1 : a.keyCode === c.keys[2] && !c.noPan && (f = 2),
        -1 !== f && (e = !0))
    }, !1);
    window.addEventListener("keyup", function() {
        c.enabled && -1 !== f && (f = -1)
    }, !1)
}
;
THREE.CubeGeometry = function(a, b, c, d, e, f, g, h) {
    function i(a, b, c, g, h, i, k, n) {
        var o, p = d || 1, q = e || 1, r = h / 2, s = i / 2, t = j.vertices.length;
        if ("x" === a && "y" === b || "y" === a && "x" === b)
            o = "z";
        else if ("x" === a && "z" === b || "z" === a && "x" === b)
            o = "y",
            q = f || 1;
        else if ("z" === a && "y" === b || "y" === a && "z" === b)
            o = "x",
            p = f || 1;
        var l = p + 1
          , v = q + 1
          , D = h / p
          , B = i / q
          , x = new THREE.Vector3;
        x[o] = 0 < k ? 1 : -1;
        for (h = 0; h < v; h++)
            for (i = 0; i < l; i++) {
                var M = new THREE.Vector3;
                M[a] = (i * D - r) * c;
                M[b] = (h * B - s) * g;
                M[o] = k;
                j.vertices.push(M)
            }
        for (h = 0; h < q; h++)
            for (i = 0; i < p; i++)
                a = new THREE.Face4(i + l * h + t,i + l * (h + 1) + t,i + 1 + l * (h + 1) + t,i + 1 + l * h + t),
                a.normal.copy(x),
                a.vertexNormals.push(x.clone(), x.clone(), x.clone(), x.clone()),
                a.materialIndex = n,
                j.faces.push(a),
                j.faceVertexUvs[0].push([new THREE.UV(i / p,h / q), new THREE.UV(i / p,(h + 1) / q), new THREE.UV((i + 1) / p,(h + 1) / q), new THREE.UV((i + 1) / p,h / q)])
    }
    THREE.Geometry.call(this);
    var j = this, k = a / 2, n = b / 2, p = c / 2, o, r, q, s, t, v;
    if (void 0 !== g) {
        if (g instanceof Array)
            this.materials = g;
        else {
            this.materials = [];
            for (o = 0; 6 > o; o++)
                this.materials.push(g)
        }
        o = 0;
        s = 1;
        r = 2;
        t = 3;
        q = 4;
        v = 5
    } else
        this.materials = [];
    this.sides = {
        px: !0,
        nx: !0,
        py: !0,
        ny: !0,
        pz: !0,
        nz: !0
    };
    if (void 0 != h)
        for (var x in h)
            void 0 !== this.sides[x] && (this.sides[x] = h[x]);
    this.sides.px && i("z", "y", -1, -1, c, b, k, o);
    this.sides.nx && i("z", "y", 1, -1, c, b, -k, s);
    this.sides.py && i("x", "z", 1, 1, a, c, n, r);
    this.sides.ny && i("x", "z", 1, -1, a, c, -n, t);
    this.sides.pz && i("x", "y", 1, -1, a, b, p, q);
    this.sides.nz && i("x", "y", -1, -1, a, b, -p, v);
    this.computeCentroids();
    this.mergeVertices()
}
;
THREE.CubeGeometry.prototype = new THREE.Geometry;
THREE.CubeGeometry.prototype.constructor = THREE.CubeGeometry;
THREE.CylinderGeometry = function(a, b, c, d, e, f) {
    THREE.Geometry.call(this);
    var a = void 0 !== a ? a : 20, b = void 0 !== b ? b : 20, c = void 0 !== c ? c : 100, g = c / 2, d = d || 8, e = e || 1, h, i, j = [], k = [];
    for (i = 0; i <= e; i++) {
        var n = []
          , p = []
          , o = i / e
          , r = o * (b - a) + a;
        for (h = 0; h <= d; h++) {
            var q = h / d
              , s = new THREE.Vector3;
            s.x = r * Math.sin(2 * q * Math.PI);
            s.y = -o * c + g;
            s.z = r * Math.cos(2 * q * Math.PI);
            this.vertices.push(s);
            n.push(this.vertices.length - 1);
            p.push(new THREE.UV(q,o))
        }
        j.push(n);
        k.push(p)
    }
    c = (b - a) / c;
    for (h = 0; h < d; h++) {
        0 !== a ? (n = this.vertices[j[0][h]].clone(),
        p = this.vertices[j[0][h + 1]].clone()) : (n = this.vertices[j[1][h]].clone(),
        p = this.vertices[j[1][h + 1]].clone());
        n.setY(Math.sqrt(n.x * n.x + n.z * n.z) * c).normalize();
        p.setY(Math.sqrt(p.x * p.x + p.z * p.z) * c).normalize();
        for (i = 0; i < e; i++) {
            var o = j[i][h]
              , r = j[i + 1][h]
              , q = j[i + 1][h + 1]
              , s = j[i][h + 1]
              , t = n.clone()
              , v = n.clone()
              , x = p.clone()
              , u = p.clone()
              , y = k[i][h].clone()
              , E = k[i + 1][h].clone()
              , z = k[i + 1][h + 1].clone()
              , C = k[i][h + 1].clone();
            this.faces.push(new THREE.Face4(o,r,q,s,[t, v, x, u]));
            this.faceVertexUvs[0].push([y, E, z, C])
        }
    }
    if (!f && 0 < a) {
        this.vertices.push(new THREE.Vector3(0,g,0));
        for (h = 0; h < d; h++)
            o = j[0][h],
            r = j[0][h + 1],
            q = this.vertices.length - 1,
            t = new THREE.Vector3(0,1,0),
            v = new THREE.Vector3(0,1,0),
            x = new THREE.Vector3(0,1,0),
            y = k[0][h].clone(),
            E = k[0][h + 1].clone(),
            z = new THREE.UV(E.u,0),
            this.faces.push(new THREE.Face3(o,r,q,[t, v, x])),
            this.faceVertexUvs[0].push([y, E, z])
    }
    if (!f && 0 < b) {
        this.vertices.push(new THREE.Vector3(0,-g,0));
        for (h = 0; h < d; h++)
            o = j[i][h + 1],
            r = j[i][h],
            q = this.vertices.length - 1,
            t = new THREE.Vector3(0,-1,0),
            v = new THREE.Vector3(0,-1,0),
            x = new THREE.Vector3(0,-1,0),
            y = k[i][h + 1].clone(),
            E = k[i][h].clone(),
            z = new THREE.UV(E.u,1),
            this.faces.push(new THREE.Face3(o,r,q,[t, v, x])),
            this.faceVertexUvs[0].push([y, E, z])
    }
    this.computeCentroids();
    this.computeFaceNormals()
}
;
THREE.CylinderGeometry.prototype = new THREE.Geometry;
THREE.CylinderGeometry.prototype.constructor = THREE.CylinderGeometry;
THREE.ExtrudeGeometry = function(a, b) {
    "undefined" !== typeof a && (THREE.Geometry.call(this),
    a = a instanceof Array ? a : [a],
    this.shapebb = a[a.length - 1].getBoundingBox(),
    this.addShapeList(a, b),
    this.computeCentroids(),
    this.computeFaceNormals())
}
;
THREE.ExtrudeGeometry.prototype = new THREE.Geometry;
THREE.ExtrudeGeometry.prototype.constructor = THREE.ExtrudeGeometry;
THREE.ExtrudeGeometry.prototype.addShapeList = function(a, b) {
    for (var c = a.length, d = 0; d < c; d++)
        this.addShape(a[d], b)
}
;
THREE.ExtrudeGeometry.prototype.addShape = function(a, b) {
    function c(a, b, c) {
        b || console.log("die");
        return b.clone().multiplyScalar(c).addSelf(a)
    }
    function d(a, b, c) {
        var d = THREE.ExtrudeGeometry.__v1
          , e = THREE.ExtrudeGeometry.__v2
          , f = THREE.ExtrudeGeometry.__v3
          , g = THREE.ExtrudeGeometry.__v4
          , h = THREE.ExtrudeGeometry.__v5
          , i = THREE.ExtrudeGeometry.__v6;
        d.set(a.x - b.x, a.y - b.y);
        e.set(a.x - c.x, a.y - c.y);
        d = d.normalize();
        e = e.normalize();
        f.set(-d.y, d.x);
        g.set(e.y, -e.x);
        h.copy(a).addSelf(f);
        i.copy(a).addSelf(g);
        if (h.equals(i))
            return g.clone();
        h.copy(b).addSelf(f);
        i.copy(c).addSelf(g);
        f = d.dot(g);
        g = i.subSelf(h).dot(g);
        0 === f && (console.log("Either infinite or no solutions!"),
        0 === g ? console.log("Its finite solutions.") : console.log("Too bad, no solutions."));
        g /= f;
        return 0 > g ? (b = Math.atan2(b.y - a.y, b.x - a.x),
        a = Math.atan2(c.y - a.y, c.x - a.x),
        b > a && (a += 2 * Math.PI),
        c = (b + a) / 2,
        a = -Math.cos(c),
        c = -Math.sin(c),
        new THREE.Vector2(a,c)) : d.multiplyScalar(g).addSelf(h).subSelf(a).clone()
    }
    function e(c, d) {
        var e, f;
        for (M = c.length; 0 <= --M; ) {
            e = M;
            f = M - 1;
            0 > f && (f = c.length - 1);
            for (var g = 0, h = p + 2 * k, g = 0; g < h; g++) {
                var i = D * g
                  , j = D * (g + 1)
                  , n = d + e + i
                  , i = d + f + i
                  , l = d + f + j
                  , j = d + e + j
                  , o = c
                  , q = g
                  , r = h
                  , n = n + L
                  , i = i + L
                  , l = l + L
                  , j = j + L;
                H.faces.push(new THREE.Face4(n,i,l,j,null,null,v));
                n = U.generateSideWallUV(H, a, o, b, n, i, l, j, q, r);
                H.faceVertexUvs[0].push(n)
            }
        }
    }
    function f(a, b, c) {
        H.vertices.push(new THREE.Vector3(a,b,c))
    }
    function g(c, d, e, f) {
        c += L;
        d += L;
        e += L;
        H.faces.push(new THREE.Face3(c,d,e,null,null,t));
        c = f ? U.generateBottomUV(H, a, b, c, d, e) : U.generateTopUV(H, a, b, c, d, e);
        H.faceVertexUvs[0].push(c)
    }
    var h = void 0 !== b.amount ? b.amount : 100, i = void 0 !== b.bevelThickness ? b.bevelThickness : 6, j = void 0 !== b.bevelSize ? b.bevelSize : i - 2, k = void 0 !== b.bevelSegments ? b.bevelSegments : 3, n = void 0 !== b.bevelEnabled ? b.bevelEnabled : !0, p = void 0 !== b.steps ? b.steps : 1, o = b.bendPath, r = b.extrudePath, q, s = !1, t = b.material, v = b.extrudeMaterial, x, u, y, E;
    r && (q = r.getSpacedPoints(p),
    s = !0,
    n = !1,
    x = new THREE.TubeGeometry.FrenetFrames(r,p,!1),
    u = new THREE.Vector3,
    y = new THREE.Vector3,
    E = new THREE.Vector3);
    n || (j = i = k = 0);
    var z, C, w, H = this, L = this.vertices.length;
    o && a.addWrapPath(o);
    var r = a.extractPoints()
      , o = r.shape
      , I = r.holes;
    if (r = !THREE.Shape.Utils.isClockWise(o)) {
        o = o.reverse();
        C = 0;
        for (w = I.length; C < w; C++)
            z = I[C],
            THREE.Shape.Utils.isClockWise(z) && (I[C] = z.reverse());
        r = !1
    }
    var P = THREE.Shape.Utils.triangulateShape(o, I)
      , N = o;
    C = 0;
    for (w = I.length; C < w; C++)
        z = I[C],
        o = o.concat(z);
    var A, J, F, l, Q, D = o.length, B, T = P.length, r = [], M = 0;
    F = N.length;
    A = F - 1;
    for (J = M + 1; M < F; M++,
    A++,
    J++)
        A === F && (A = 0),
        J === F && (J = 0),
        r[M] = d(N[M], N[A], N[J]);
    var ea = [], ca, ha = r.concat();
    C = 0;
    for (w = I.length; C < w; C++) {
        z = I[C];
        ca = [];
        M = 0;
        F = z.length;
        A = F - 1;
        for (J = M + 1; M < F; M++,
        A++,
        J++)
            A === F && (A = 0),
            J === F && (J = 0),
            ca[M] = d(z[M], z[A], z[J]);
        ea.push(ca);
        ha = ha.concat(ca)
    }
    for (A = 0; A < k; A++) {
        F = A / k;
        l = i * (1 - F);
        J = j * Math.sin(F * Math.PI / 2);
        M = 0;
        for (F = N.length; M < F; M++)
            Q = c(N[M], r[M], J),
            f(Q.x, Q.y, -l);
        C = 0;
        for (w = I.length; C < w; C++) {
            z = I[C];
            ca = ea[C];
            M = 0;
            for (F = z.length; M < F; M++)
                Q = c(z[M], ca[M], J),
                f(Q.x, Q.y, -l)
        }
    }
    J = j;
    for (M = 0; M < D; M++)
        Q = n ? c(o[M], ha[M], J) : o[M],
        s ? (y.copy(x.normals[0]).multiplyScalar(Q.x),
        u.copy(x.binormals[0]).multiplyScalar(Q.y),
        E.copy(q[0]).addSelf(y).addSelf(u),
        f(E.x, E.y, E.z)) : f(Q.x, Q.y, 0);
    for (F = 1; F <= p; F++)
        for (M = 0; M < D; M++)
            Q = n ? c(o[M], ha[M], J) : o[M],
            s ? (y.copy(x.normals[F]).multiplyScalar(Q.x),
            u.copy(x.binormals[F]).multiplyScalar(Q.y),
            E.copy(q[F]).addSelf(y).addSelf(u),
            f(E.x, E.y, E.z)) : f(Q.x, Q.y, h / p * F);
    for (A = k - 1; 0 <= A; A--) {
        F = A / k;
        l = i * (1 - F);
        J = j * Math.sin(F * Math.PI / 2);
        M = 0;
        for (F = N.length; M < F; M++)
            Q = c(N[M], r[M], J),
            f(Q.x, Q.y, h + l);
        C = 0;
        for (w = I.length; C < w; C++) {
            z = I[C];
            ca = ea[C];
            M = 0;
            for (F = z.length; M < F; M++)
                Q = c(z[M], ca[M], J),
                s ? f(Q.x, Q.y + q[p - 1].y, q[p - 1].x + l) : f(Q.x, Q.y, h + l)
        }
    }
    var U = THREE.ExtrudeGeometry.WorldUVGenerator;
    (function() {
        if (n) {
            var a;
            a = D * 0;
            for (M = 0; M < T; M++) {
                B = P[M];
                g(B[2] + a, B[1] + a, B[0] + a, true)
            }
            a = p + k * 2;
            a = D * a;
            for (M = 0; M < T; M++) {
                B = P[M];
                g(B[0] + a, B[1] + a, B[2] + a, false)
            }
        } else {
            for (M = 0; M < T; M++) {
                B = P[M];
                g(B[2], B[1], B[0], true)
            }
            for (M = 0; M < T; M++) {
                B = P[M];
                g(B[0] + D * p, B[1] + D * p, B[2] + D * p, false)
            }
        }
    }
    )();
    (function() {
        var a = 0;
        e(N, a);
        a = a + N.length;
        C = 0;
        for (w = I.length; C < w; C++) {
            z = I[C];
            e(z, a);
            a = a + z.length
        }
    }
    )()
}
;
THREE.ExtrudeGeometry.WorldUVGenerator = {
    generateTopUV: function(a, b, c, d, e, f) {
        b = a.vertices[e].x;
        e = a.vertices[e].y;
        c = a.vertices[f].x;
        f = a.vertices[f].y;
        return [new THREE.UV(a.vertices[d].x,1 - a.vertices[d].y), new THREE.UV(b,1 - e), new THREE.UV(c,1 - f)]
    },
    generateBottomUV: function(a, b, c, d, e, f) {
        return this.generateTopUV(a, b, c, d, e, f)
    },
    generateSideWallUV: function(a, b, c, d, e, f, g, h) {
        var b = a.vertices[e].x
          , c = a.vertices[e].y
          , e = a.vertices[e].z
          , d = a.vertices[f].x
          , i = a.vertices[f].y
          , f = a.vertices[f].z
          , j = a.vertices[g].x
          , k = a.vertices[g].y
          , g = a.vertices[g].z
          , n = a.vertices[h].x
          , p = a.vertices[h].y
          , a = a.vertices[h].z;
        return 0.01 > Math.abs(c - i) ? [new THREE.UV(b,e), new THREE.UV(d,f), new THREE.UV(j,g), new THREE.UV(n,a)] : [new THREE.UV(c,e), new THREE.UV(i,f), new THREE.UV(k,g), new THREE.UV(p,a)]
    }
};
THREE.ExtrudeGeometry.__v1 = new THREE.Vector2;
THREE.ExtrudeGeometry.__v2 = new THREE.Vector2;
THREE.ExtrudeGeometry.__v3 = new THREE.Vector2;
THREE.ExtrudeGeometry.__v4 = new THREE.Vector2;
THREE.ExtrudeGeometry.__v5 = new THREE.Vector2;
THREE.ExtrudeGeometry.__v6 = new THREE.Vector2;
THREE.LatheGeometry = function(a, b, c) {
    THREE.Geometry.call(this);
    for (var b = b || 12, c = c || 2 * Math.PI, d = [], e = (new THREE.Matrix4).makeRotationZ(c / b), f = 0; f < a.length; f++)
        d[f] = a[f].clone(),
        this.vertices.push(d[f]);
    for (var g = b + 1, c = 0; c < g; c++)
        for (f = 0; f < d.length; f++)
            d[f] = e.multiplyVector3(d[f].clone()),
            this.vertices.push(d[f]);
    for (c = 0; c < b; c++) {
        d = 0;
        for (e = a.length; d < e - 1; d++)
            this.faces.push(new THREE.Face4(c * e + d,(c + 1) % g * e + d,(c + 1) % g * e + (d + 1) % e,c * e + (d + 1) % e)),
            this.faceVertexUvs[0].push([new THREE.UV(1 - c / b,d / e), new THREE.UV(1 - (c + 1) / b,d / e), new THREE.UV(1 - (c + 1) / b,(d + 1) / e), new THREE.UV(1 - c / b,(d + 1) / e)])
    }
    this.computeCentroids();
    this.computeFaceNormals();
    this.computeVertexNormals()
}
;
THREE.LatheGeometry.prototype = new THREE.Geometry;
THREE.LatheGeometry.prototype.constructor = THREE.LatheGeometry;
THREE.PlaneGeometry = function(a, b, c, d) {
    THREE.Geometry.call(this);
    for (var e = a / 2, f = b / 2, c = c || 1, d = d || 1, g = c + 1, h = d + 1, i = a / c, j = b / d, k = new THREE.Vector3(0,1,0), a = 0; a < h; a++)
        for (b = 0; b < g; b++)
            this.vertices.push(new THREE.Vector3(b * i - e,0,a * j - f));
    for (a = 0; a < d; a++)
        for (b = 0; b < c; b++)
            e = new THREE.Face4(b + g * a,b + g * (a + 1),b + 1 + g * (a + 1),b + 1 + g * a),
            e.normal.copy(k),
            e.vertexNormals.push(k.clone(), k.clone(), k.clone(), k.clone()),
            this.faces.push(e),
            this.faceVertexUvs[0].push([new THREE.UV(b / c,a / d), new THREE.UV(b / c,(a + 1) / d), new THREE.UV((b + 1) / c,(a + 1) / d), new THREE.UV((b + 1) / c,a / d)]);
    this.computeCentroids()
}
;
THREE.PlaneGeometry.prototype = new THREE.Geometry;
THREE.PlaneGeometry.prototype.constructor = THREE.PlaneGeometry;
THREE.SphereGeometry = function(a, b, c, d, e, f, g) {
    THREE.Geometry.call(this);
    var a = a || 50, d = void 0 !== d ? d : 0, e = void 0 !== e ? e : 2 * Math.PI, f = void 0 !== f ? f : 0, g = void 0 !== g ? g : Math.PI, b = Math.max(3, Math.floor(b) || 8), c = Math.max(2, Math.floor(c) || 6), h, i, j = [], k = [];
    for (i = 0; i <= c; i++) {
        var n = []
          , p = [];
        for (h = 0; h <= b; h++) {
            var o = h / b
              , r = i / c
              , q = new THREE.Vector3;
            q.x = -a * Math.cos(d + o * e) * Math.sin(f + r * g);
            q.y = a * Math.cos(f + r * g);
            q.z = a * Math.sin(d + o * e) * Math.sin(f + r * g);
            this.vertices.push(q);
            n.push(this.vertices.length - 1);
            p.push(new THREE.UV(o,r))
        }
        j.push(n);
        k.push(p)
    }
    for (i = 0; i < c; i++)
        for (h = 0; h < b; h++) {
            var d = j[i][h + 1]
              , e = j[i][h]
              , f = j[i + 1][h]
              , g = j[i + 1][h + 1]
              , n = this.vertices[d].clone().normalize()
              , p = this.vertices[e].clone().normalize()
              , o = this.vertices[f].clone().normalize()
              , r = this.vertices[g].clone().normalize()
              , q = k[i][h + 1].clone()
              , s = k[i][h].clone()
              , t = k[i + 1][h].clone()
              , v = k[i + 1][h + 1].clone();
            Math.abs(this.vertices[d].y) == a ? (this.faces.push(new THREE.Face3(d,f,g,[n, o, r])),
            this.faceVertexUvs[0].push([q, t, v])) : Math.abs(this.vertices[f].y) == a ? (this.faces.push(new THREE.Face3(d,e,f,[n, p, o])),
            this.faceVertexUvs[0].push([q, s, t])) : (this.faces.push(new THREE.Face4(d,e,f,g,[n, p, o, r])),
            this.faceVertexUvs[0].push([q, s, t, v]))
        }
    this.computeCentroids();
    this.computeFaceNormals();
    this.boundingSphere = {
        radius: a
    }
}
;
THREE.SphereGeometry.prototype = new THREE.Geometry;
THREE.SphereGeometry.prototype.constructor = THREE.SphereGeometry;
THREE.TextGeometry = function(a, b) {
    var c = (new THREE.TextPath(a,b)).toShapes();
    b.amount = void 0 !== b.height ? b.height : 50;
    void 0 === b.bevelThickness && (b.bevelThickness = 10);
    void 0 === b.bevelSize && (b.bevelSize = 8);
    void 0 === b.bevelEnabled && (b.bevelEnabled = !1);
    if (b.bend) {
        var d = c[c.length - 1].getBoundingBox().maxX;
        b.bendPath = new THREE.QuadraticBezierCurve(new THREE.Vector2(0,0),new THREE.Vector2(d / 2,120),new THREE.Vector2(d,0))
    }
    THREE.ExtrudeGeometry.call(this, c, b)
}
;
THREE.TextGeometry.prototype = new THREE.ExtrudeGeometry;
THREE.TextGeometry.prototype.constructor = THREE.TextGeometry;
THREE.FontUtils = {
    faces: {},
    face: "helvetiker",
    weight: "normal",
    style: "normal",
    size: 150,
    divisions: 10,
    getFace: function() {
        return this.faces[this.face][this.weight][this.style]
    },
    loadFace: function(a) {
        var b = a.familyName.toLowerCase();
        this.faces[b] = this.faces[b] || {};
        this.faces[b][a.cssFontWeight] = this.faces[b][a.cssFontWeight] || {};
        this.faces[b][a.cssFontWeight][a.cssFontStyle] = a;
        return this.faces[b][a.cssFontWeight][a.cssFontStyle] = a
    },
    drawText: function(a) {
        for (var b = this.getFace(), c = this.size / b.resolution, d = 0, e = ("" + a).split(""), f = e.length, g = [], a = 0; a < f; a++) {
            var h = new THREE.Path
              , h = this.extractGlyphPoints(e[a], b, c, d, h)
              , d = d + h.offset;
            g.push(h.path)
        }
        return {
            paths: g,
            offset: d / 2
        }
    },
    extractGlyphPoints: function(a, b, c, d, e) {
        var f = [], g, h, i, j, k, n, p, o, r, q, s, t = b.glyphs[a] || b.glyphs["?"];
        if (t) {
            if (t.o) {
                b = t._cachedOutline || (t._cachedOutline = t.o.split(" "));
                j = b.length;
                for (a = 0; a < j; )
                    switch (i = b[a++],
                    i) {
                    case "m":
                        i = b[a++] * c + d;
                        k = b[a++] * c;
                        f.push(new THREE.Vector2(i,k));
                        e.moveTo(i, k);
                        break;
                    case "l":
                        i = b[a++] * c + d;
                        k = b[a++] * c;
                        f.push(new THREE.Vector2(i,k));
                        e.lineTo(i, k);
                        break;
                    case "q":
                        i = b[a++] * c + d;
                        k = b[a++] * c;
                        o = b[a++] * c + d;
                        r = b[a++] * c;
                        e.quadraticCurveTo(o, r, i, k);
                        if (g = f[f.length - 1]) {
                            n = g.x;
                            p = g.y;
                            g = 1;
                            for (h = this.divisions; g <= h; g++) {
                                var v = g / h
                                  , x = THREE.Shape.Utils.b2(v, n, o, i)
                                  , v = THREE.Shape.Utils.b2(v, p, r, k);
                                f.push(new THREE.Vector2(x,v))
                            }
                        }
                        break;
                    case "b":
                        if (i = b[a++] * c + d,
                        k = b[a++] * c,
                        o = b[a++] * c + d,
                        r = b[a++] * -c,
                        q = b[a++] * c + d,
                        s = b[a++] * -c,
                        e.bezierCurveTo(i, k, o, r, q, s),
                        g = f[f.length - 1]) {
                            n = g.x;
                            p = g.y;
                            g = 1;
                            for (h = this.divisions; g <= h; g++)
                                v = g / h,
                                x = THREE.Shape.Utils.b3(v, n, o, q, i),
                                v = THREE.Shape.Utils.b3(v, p, r, s, k),
                                f.push(new THREE.Vector2(x,v))
                        }
                    }
            }
            return {
                offset: t.ha * c,
                points: f,
                path: e
            }
        }
    }
};
(function(a) {
    var b = function(a) {
        for (var b = a.length, e = 0, f = b - 1, g = 0; g < b; f = g++)
            e += a[f].x * a[g].y - a[g].x * a[f].y;
        return 0.5 * e
    };
    a.Triangulate = function(a, d) {
        var e = a.length;
        if (3 > e)
            return null;
        var f = [], g = [], h = [], i, j, k;
        if (0 < b(a))
            for (j = 0; j < e; j++)
                g[j] = j;
        else
            for (j = 0; j < e; j++)
                g[j] = e - 1 - j;
        var n = 2 * e;
        for (j = e - 1; 2 < e; ) {
            if (0 >= n--) {
                console.log("Warning, unable to triangulate polygon!");
                break
            }
            i = j;
            e <= i && (i = 0);
            j = i + 1;
            e <= j && (j = 0);
            k = j + 1;
            e <= k && (k = 0);
            var p;
            a: {
                p = a;
                var o = i
                  , r = j
                  , q = k
                  , s = e
                  , t = g
                  , v = void 0
                  , x = void 0
                  , u = void 0
                  , y = void 0
                  , E = void 0
                  , z = void 0
                  , C = void 0
                  , w = void 0
                  , H = void 0
                  , x = p[t[o]].x
                  , u = p[t[o]].y
                  , y = p[t[r]].x
                  , E = p[t[r]].y
                  , z = p[t[q]].x
                  , C = p[t[q]].y;
                if (1.0E-10 > (y - x) * (C - u) - (E - u) * (z - x))
                    p = !1;
                else {
                    for (v = 0; v < s; v++)
                        if (!(v == o || v == r || v == q)) {
                            var w = p[t[v]].x
                              , H = p[t[v]].y
                              , L = void 0
                              , I = void 0
                              , P = void 0
                              , N = void 0
                              , A = void 0
                              , J = void 0
                              , F = void 0
                              , l = void 0
                              , Q = void 0
                              , D = void 0
                              , B = void 0
                              , T = void 0
                              , L = z - y
                              , I = C - E
                              , P = x - z
                              , N = u - C
                              , A = y - x
                              , J = E - u
                              , F = w - x
                              , l = H - u
                              , Q = w - y
                              , D = H - E
                              , B = w - z
                              , T = H - C
                              , L = L * D - I * Q
                              , A = A * l - J * F
                              , P = P * T - N * B;
                            if (0 <= L && 0 <= P && 0 <= A) {
                                p = !1;
                                break a
                            }
                        }
                    p = !0
                }
            }
            if (p) {
                f.push([a[g[i]], a[g[j]], a[g[k]]]);
                h.push([g[i], g[j], g[k]]);
                i = j;
                for (k = j + 1; k < e; i++,
                k++)
                    g[i] = g[k];
                e--;
                n = 2 * e
            }
        }
        return d ? h : f
    }
    ;
    a.Triangulate.area = b;
    return a
}
)(THREE.FontUtils);
self._typeface_js = {
    faces: THREE.FontUtils.faces,
    loadFace: THREE.FontUtils.loadFace
};
THREE.TorusGeometry = function(a, b, c, d, e) {
    THREE.Geometry.call(this);
    this.radius = a || 100;
    this.tube = b || 40;
    this.segmentsR = c || 8;
    this.segmentsT = d || 6;
    this.arc = e || 2 * Math.PI;
    e = new THREE.Vector3;
    a = [];
    b = [];
    for (c = 0; c <= this.segmentsR; c++)
        for (d = 0; d <= this.segmentsT; d++) {
            var f = d / this.segmentsT * this.arc
              , g = 2 * c / this.segmentsR * Math.PI;
            e.x = this.radius * Math.cos(f);
            e.y = this.radius * Math.sin(f);
            var h = new THREE.Vector3;
            h.x = (this.radius + this.tube * Math.cos(g)) * Math.cos(f);
            h.y = (this.radius + this.tube * Math.cos(g)) * Math.sin(f);
            h.z = this.tube * Math.sin(g);
            this.vertices.push(h);
            a.push(new THREE.UV(d / this.segmentsT,1 - c / this.segmentsR));
            b.push(h.clone().subSelf(e).normalize())
        }
    for (c = 1; c <= this.segmentsR; c++)
        for (d = 1; d <= this.segmentsT; d++) {
            var e = (this.segmentsT + 1) * c + d - 1
              , f = (this.segmentsT + 1) * (c - 1) + d - 1
              , g = (this.segmentsT + 1) * (c - 1) + d
              , h = (this.segmentsT + 1) * c + d
              , i = new THREE.Face4(e,f,g,h,[b[e], b[f], b[g], b[h]]);
            i.normal.addSelf(b[e]);
            i.normal.addSelf(b[f]);
            i.normal.addSelf(b[g]);
            i.normal.addSelf(b[h]);
            i.normal.normalize();
            this.faces.push(i);
            this.faceVertexUvs[0].push([a[e].clone(), a[f].clone(), a[g].clone(), a[h].clone()])
        }
    this.computeCentroids()
}
;
THREE.TorusGeometry.prototype = new THREE.Geometry;
THREE.TorusGeometry.prototype.constructor = THREE.TorusGeometry;
THREE.TorusKnotGeometry = function(a, b, c, d, e, f, g) {
    function h(a, b, c, d, e, f) {
        var g = Math.cos(a);
        Math.cos(b);
        b = Math.sin(a);
        a *= c / d;
        c = Math.cos(a);
        g *= 0.5 * e * (2 + c);
        b = 0.5 * e * (2 + c) * b;
        e = 0.5 * f * e * Math.sin(a);
        return new THREE.Vector3(g,b,e)
    }
    THREE.Geometry.call(this);
    this.radius = a || 200;
    this.tube = b || 40;
    this.segmentsR = c || 64;
    this.segmentsT = d || 8;
    this.p = e || 2;
    this.q = f || 3;
    this.heightScale = g || 1;
    this.grid = Array(this.segmentsR);
    c = new THREE.Vector3;
    d = new THREE.Vector3;
    e = new THREE.Vector3;
    for (a = 0; a < this.segmentsR; ++a) {
        this.grid[a] = Array(this.segmentsT);
        for (b = 0; b < this.segmentsT; ++b) {
            var i = 2 * (a / this.segmentsR) * this.p * Math.PI
              , g = 2 * (b / this.segmentsT) * Math.PI
              , f = h(i, g, this.q, this.p, this.radius, this.heightScale)
              , i = h(i + 0.01, g, this.q, this.p, this.radius, this.heightScale);
            c.sub(i, f);
            d.add(i, f);
            e.cross(c, d);
            d.cross(e, c);
            e.normalize();
            d.normalize();
            i = -this.tube * Math.cos(g);
            g = this.tube * Math.sin(g);
            f.x += i * d.x + g * e.x;
            f.y += i * d.y + g * e.y;
            f.z += i * d.z + g * e.z;
            this.grid[a][b] = this.vertices.push(new THREE.Vector3(f.x,f.y,f.z)) - 1
        }
    }
    for (a = 0; a < this.segmentsR; ++a)
        for (b = 0; b < this.segmentsT; ++b) {
            var e = (a + 1) % this.segmentsR
              , f = (b + 1) % this.segmentsT
              , c = this.grid[a][b]
              , d = this.grid[e][b]
              , e = this.grid[e][f]
              , f = this.grid[a][f]
              , g = new THREE.UV(a / this.segmentsR,b / this.segmentsT)
              , i = new THREE.UV((a + 1) / this.segmentsR,b / this.segmentsT)
              , j = new THREE.UV((a + 1) / this.segmentsR,(b + 1) / this.segmentsT)
              , k = new THREE.UV(a / this.segmentsR,(b + 1) / this.segmentsT);
            this.faces.push(new THREE.Face4(c,d,e,f));
            this.faceVertexUvs[0].push([g, i, j, k])
        }
    this.computeCentroids();
    this.computeFaceNormals();
    this.computeVertexNormals()
}
;
THREE.TorusKnotGeometry.prototype = new THREE.Geometry;
THREE.TorusKnotGeometry.prototype.constructor = THREE.TorusKnotGeometry;
THREE.TubeGeometry = function(a, b, c, d, e, f) {
    THREE.Geometry.call(this);
    this.path = a;
    this.segments = b || 64;
    this.radius = c || 1;
    this.segmentsRadius = d || 8;
    this.closed = e || !1;
    f && (this.debug = new THREE.Object3D);
    this.grid = [];
    var g, h, f = this.segments + 1, i, j, k, n = new THREE.Vector3, p, o, r, b = new THREE.TubeGeometry.FrenetFrames(a,b,e);
    p = b.tangents;
    o = b.normals;
    r = b.binormals;
    this.tangents = p;
    this.normals = o;
    this.binormals = r;
    for (b = 0; b < f; b++) {
        this.grid[b] = [];
        d = b / (f - 1);
        k = a.getPointAt(d);
        d = p[b];
        g = o[b];
        h = r[b];
        this.debug && (this.debug.add(new THREE.ArrowHelper(d,k,c,255)),
        this.debug.add(new THREE.ArrowHelper(g,k,c,16711680)),
        this.debug.add(new THREE.ArrowHelper(h,k,c,65280)));
        for (d = 0; d < this.segmentsRadius; d++)
            i = 2 * (d / this.segmentsRadius) * Math.PI,
            j = -this.radius * Math.cos(i),
            i = this.radius * Math.sin(i),
            n.copy(k),
            n.x += j * g.x + i * h.x,
            n.y += j * g.y + i * h.y,
            n.z += j * g.z + i * h.z,
            this.grid[b][d] = this.vertices.push(new THREE.Vector3(n.x,n.y,n.z)) - 1
    }
    for (b = 0; b < this.segments; b++)
        for (d = 0; d < this.segmentsRadius; d++)
            f = e ? (b + 1) % this.segments : b + 1,
            n = (d + 1) % this.segmentsRadius,
            a = this.grid[b][d],
            c = this.grid[f][d],
            f = this.grid[f][n],
            n = this.grid[b][n],
            p = new THREE.UV(b / this.segments,d / this.segmentsRadius),
            o = new THREE.UV((b + 1) / this.segments,d / this.segmentsRadius),
            r = new THREE.UV((b + 1) / this.segments,(d + 1) / this.segmentsRadius),
            g = new THREE.UV(b / this.segments,(d + 1) / this.segmentsRadius),
            this.faces.push(new THREE.Face4(a,c,f,n)),
            this.faceVertexUvs[0].push([p, o, r, g]);
    this.computeCentroids();
    this.computeFaceNormals();
    this.computeVertexNormals()
}
;
THREE.TubeGeometry.prototype = new THREE.Geometry;
THREE.TubeGeometry.prototype.constructor = THREE.TubeGeometry;
THREE.TubeGeometry.FrenetFrames = function(a, b, c) {
    new THREE.Vector3;
    var d = new THREE.Vector3;
    new THREE.Vector3;
    var e = [], f = [], g = [], h = new THREE.Vector3, i = new THREE.Matrix4, b = b + 1, j, k, n;
    this.tangents = e;
    this.normals = f;
    this.binormals = g;
    for (j = 0; j < b; j++)
        k = j / (b - 1),
        e[j] = a.getTangentAt(k),
        e[j].normalize();
    f[0] = new THREE.Vector3;
    g[0] = new THREE.Vector3;
    a = Number.MAX_VALUE;
    j = Math.abs(e[0].x);
    k = Math.abs(e[0].y);
    n = Math.abs(e[0].z);
    j <= a && (a = j,
    d.set(1, 0, 0));
    k <= a && (a = k,
    d.set(0, 1, 0));
    n <= a && d.set(0, 0, 1);
    h.cross(e[0], d).normalize();
    f[0].cross(e[0], h);
    g[0].cross(e[0], f[0]);
    for (j = 1; j < b; j++)
        f[j] = f[j - 1].clone(),
        g[j] = g[j - 1].clone(),
        h.cross(e[j - 1], e[j]),
        1.0E-4 < h.length() && (h.normalize(),
        d = Math.acos(e[j - 1].dot(e[j])),
        i.makeRotationAxis(h, d).multiplyVector3(f[j])),
        g[j].cross(e[j], f[j]);
    if (c) {
        d = Math.acos(f[0].dot(f[b - 1]));
        d /= b - 1;
        0 < e[0].dot(h.cross(f[0], f[b - 1])) && (d = -d);
        for (j = 1; j < b; j++)
            i.makeRotationAxis(e[j], d * j).multiplyVector3(f[j]),
            g[j].cross(e[j], f[j])
    }
}
;
THREE.PolyhedronGeometry = function(a, b, c, d) {
    function e(a) {
        var b = a.normalize().clone();
        b.index = i.vertices.push(b) - 1;
        var c = Math.atan2(a.z, -a.x) / 2 / Math.PI + 0.5
          , a = Math.atan2(-a.y, Math.sqrt(a.x * a.x + a.z * a.z)) / Math.PI + 0.5;
        b.uv = new THREE.UV(c,a);
        return b
    }
    function f(a, b, c, d) {
        1 > d ? (d = new THREE.Face3(a.index,b.index,c.index,[a.clone(), b.clone(), c.clone()]),
        d.centroid.addSelf(a).addSelf(b).addSelf(c).divideScalar(3),
        d.normal = d.centroid.clone().normalize(),
        i.faces.push(d),
        d = Math.atan2(d.centroid.z, -d.centroid.x),
        i.faceVertexUvs[0].push([h(a.uv, a, d), h(b.uv, b, d), h(c.uv, c, d)])) : (d -= 1,
        f(a, g(a, b), g(a, c), d),
        f(g(a, b), b, g(b, c), d),
        f(g(a, c), g(b, c), c, d),
        f(g(a, b), g(b, c), g(a, c), d))
    }
    function g(a, b) {
        n[a.index] || (n[a.index] = []);
        n[b.index] || (n[b.index] = []);
        var c = n[a.index][b.index];
        void 0 === c && (n[a.index][b.index] = n[b.index][a.index] = c = e((new THREE.Vector3).add(a, b).divideScalar(2)));
        return c
    }
    function h(a, b, c) {
        0 > c && 1 === a.u && (a = new THREE.UV(a.u - 1,a.v));
        0 === b.x && 0 === b.z && (a = new THREE.UV(c / 2 / Math.PI + 0.5,a.v));
        return a
    }
    THREE.Geometry.call(this);
    for (var c = c || 1, d = d || 0, i = this, j = 0, k = a.length; j < k; j++)
        e(new THREE.Vector3(a[j][0],a[j][1],a[j][2]));
    for (var n = [], a = this.vertices, j = 0, k = b.length; j < k; j++)
        f(a[b[j][0]], a[b[j][1]], a[b[j][2]], d);
    this.mergeVertices();
    j = 0;
    for (k = this.vertices.length; j < k; j++)
        this.vertices[j].multiplyScalar(c);
    this.computeCentroids();
    this.boundingSphere = {
        radius: c
    }
}
;
THREE.PolyhedronGeometry.prototype = new THREE.Geometry;
THREE.PolyhedronGeometry.prototype.constructor = THREE.PolyhedronGeometry;
THREE.IcosahedronGeometry = function(a, b) {
    var c = (1 + Math.sqrt(5)) / 2;
    THREE.PolyhedronGeometry.call(this, [[-1, c, 0], [1, c, 0], [-1, -c, 0], [1, -c, 0], [0, -1, c], [0, 1, c], [0, -1, -c], [0, 1, -c], [c, 0, -1], [c, 0, 1], [-c, 0, -1], [-c, 0, 1]], [[0, 11, 5], [0, 5, 1], [0, 1, 7], [0, 7, 10], [0, 10, 11], [1, 5, 9], [5, 11, 4], [11, 10, 2], [10, 7, 6], [7, 1, 8], [3, 9, 4], [3, 4, 2], [3, 2, 6], [3, 6, 8], [3, 8, 9], [4, 9, 5], [2, 4, 11], [6, 2, 10], [8, 6, 7], [9, 8, 1]], a, b)
}
;
THREE.IcosahedronGeometry.prototype = new THREE.Geometry;
THREE.IcosahedronGeometry.prototype.constructor = THREE.IcosahedronGeometry;
THREE.OctahedronGeometry = function(a, b) {
    THREE.PolyhedronGeometry.call(this, [[1, 0, 0], [-1, 0, 0], [0, 1, 0], [0, -1, 0], [0, 0, 1], [0, 0, -1]], [[0, 2, 4], [0, 4, 3], [0, 3, 5], [0, 5, 2], [1, 2, 5], [1, 5, 3], [1, 3, 4], [1, 4, 2]], a, b)
}
;
THREE.OctahedronGeometry.prototype = new THREE.Geometry;
THREE.OctahedronGeometry.prototype.constructor = THREE.OctahedronGeometry;
THREE.TetrahedronGeometry = function(a, b) {
    THREE.PolyhedronGeometry.call(this, [[1, 1, 1], [-1, -1, 1], [-1, 1, -1], [1, -1, -1]], [[2, 1, 0], [0, 3, 2], [1, 3, 0], [2, 3, 1]], a, b)
}
;
THREE.TetrahedronGeometry.prototype = new THREE.Geometry;
THREE.TetrahedronGeometry.prototype.constructor = THREE.TetrahedronGeometry;
THREE.ParametricGeometry = function(a, b, c, d) {
    THREE.Geometry.call(this);
    var e = this.vertices, f = this.faces, g = this.faceVertexUvs[0], d = void 0 === d ? !1 : d, h, i, j, k, n = b + 1;
    for (h = 0; h <= c; h++) {
        k = h / c;
        for (i = 0; i <= b; i++)
            j = i / b,
            j = a(j, k),
            e.push(j)
    }
    var p, o, r, q;
    for (h = 0; h < c; h++)
        for (i = 0; i < b; i++)
            a = h * n + i,
            e = h * n + i + 1,
            k = (h + 1) * n + i,
            j = (h + 1) * n + i + 1,
            p = new THREE.UV(h / b,i / c),
            o = new THREE.UV(h / b,(i + 1) / c),
            r = new THREE.UV((h + 1) / b,i / c),
            q = new THREE.UV((h + 1) / b,(i + 1) / c),
            d ? (f.push(new THREE.Face3(a,e,k)),
            f.push(new THREE.Face3(e,j,k)),
            g.push([p, o, r]),
            g.push([o, q, r])) : (f.push(new THREE.Face4(a,e,j,k)),
            g.push([p, o, r, q]));
    this.computeCentroids();
    this.computeFaceNormals();
    this.computeVertexNormals()
}
;
THREE.ParametricGeometry.prototype = new THREE.Geometry;
THREE.ParametricGeometry.prototype.constructor = THREE.ParametricGeometry;
THREE.AxisHelper = function() {
    THREE.Object3D.call(this);
    var a = new THREE.Geometry;
    a.vertices.push(new THREE.Vector3);
    a.vertices.push(new THREE.Vector3(0,100,0));
    var b = new THREE.CylinderGeometry(0,5,25,5,1), c;
    c = new THREE.Line(a,new THREE.LineBasicMaterial({
        color: 16711680
    }));
    c.rotation.z = -Math.PI / 2;
    this.add(c);
    c = new THREE.Mesh(b,new THREE.MeshBasicMaterial({
        color: 16711680
    }));
    c.position.x = 100;
    c.rotation.z = -Math.PI / 2;
    this.add(c);
    c = new THREE.Line(a,new THREE.LineBasicMaterial({
        color: 65280
    }));
    this.add(c);
    c = new THREE.Mesh(b,new THREE.MeshBasicMaterial({
        color: 65280
    }));
    c.position.y = 100;
    this.add(c);
    c = new THREE.Line(a,new THREE.LineBasicMaterial({
        color: 255
    }));
    c.rotation.x = Math.PI / 2;
    this.add(c);
    c = new THREE.Mesh(b,new THREE.MeshBasicMaterial({
        color: 255
    }));
    c.position.z = 100;
    c.rotation.x = Math.PI / 2;
    this.add(c)
}
;
THREE.AxisHelper.prototype = new THREE.Object3D;
THREE.AxisHelper.prototype.constructor = THREE.AxisHelper;
THREE.ArrowHelper = function(a, b, c, d) {
    THREE.Object3D.call(this);
    void 0 === d && (d = 16776960);
    void 0 === c && (c = 20);
    var e = new THREE.Geometry;
    e.vertices.push(new THREE.Vector3(0,0,0));
    e.vertices.push(new THREE.Vector3(0,1,0));
    this.line = new THREE.Line(e,new THREE.LineBasicMaterial({
        color: d
    }));
    this.add(this.line);
    e = new THREE.CylinderGeometry(0,0.05,0.25,5,1);
    this.cone = new THREE.Mesh(e,new THREE.MeshBasicMaterial({
        color: d
    }));
    this.cone.position.set(0, 1, 0);
    this.add(this.cone);
    b instanceof THREE.Vector3 && (this.position = b);
    this.setDirection(a);
    this.setLength(c)
}
;
THREE.ArrowHelper.prototype = new THREE.Object3D;
THREE.ArrowHelper.prototype.constructor = THREE.ArrowHelper;
THREE.ArrowHelper.prototype.setDirection = function(a) {
    var b = (new THREE.Vector3(0,1,0)).crossSelf(a)
      , a = Math.acos((new THREE.Vector3(0,1,0)).dot(a.clone().normalize()));
    this.matrix = (new THREE.Matrix4).makeRotationAxis(b.normalize(), a);
    this.rotation.getRotationFromMatrix(this.matrix, this.scale)
}
;
THREE.ArrowHelper.prototype.setLength = function(a) {
    this.scale.set(a, a, a)
}
;
THREE.ArrowHelper.prototype.setColor = function(a) {
    this.line.material.color.setHex(a);
    this.cone.material.color.setHex(a)
}
;
THREE.CameraHelper = function(a) {
    function b(a, b, d) {
        c(a, d);
        c(b, d)
    }
    function c(a, b) {
        d.lineGeometry.vertices.push(new THREE.Vector3);
        d.lineGeometry.colors.push(new THREE.Color(b));
        void 0 === d.pointMap[a] && (d.pointMap[a] = []);
        d.pointMap[a].push(d.lineGeometry.vertices.length - 1)
    }
    THREE.Object3D.call(this);
    var d = this;
    this.lineGeometry = new THREE.Geometry;
    this.lineMaterial = new THREE.LineBasicMaterial({
        color: 16777215,
        vertexColors: THREE.FaceColors
    });
    this.pointMap = {};
    b("n1", "n2", 16755200);
    b("n2", "n4", 16755200);
    b("n4", "n3", 16755200);
    b("n3", "n1", 16755200);
    b("f1", "f2", 16755200);
    b("f2", "f4", 16755200);
    b("f4", "f3", 16755200);
    b("f3", "f1", 16755200);
    b("n1", "f1", 16755200);
    b("n2", "f2", 16755200);
    b("n3", "f3", 16755200);
    b("n4", "f4", 16755200);
    b("p", "n1", 16711680);
    b("p", "n2", 16711680);
    b("p", "n3", 16711680);
    b("p", "n4", 16711680);
    b("u1", "u2", 43775);
    b("u2", "u3", 43775);
    b("u3", "u1", 43775);
    b("c", "t", 16777215);
    b("p", "c", 3355443);
    b("cn1", "cn2", 3355443);
    b("cn3", "cn4", 3355443);
    b("cf1", "cf2", 3355443);
    b("cf3", "cf4", 3355443);
    this.camera = a;
    this.update(a);
    this.lines = new THREE.Line(this.lineGeometry,this.lineMaterial,THREE.LinePieces);
    this.add(this.lines)
}
;
THREE.CameraHelper.prototype = new THREE.Object3D;
THREE.CameraHelper.prototype.constructor = THREE.CameraHelper;
THREE.CameraHelper.prototype.update = function() {
    function a(a, d, e, f) {
        THREE.CameraHelper.__v.set(d, e, f);
        THREE.CameraHelper.__projector.unprojectVector(THREE.CameraHelper.__v, THREE.CameraHelper.__c);
        a = b.pointMap[a];
        if (void 0 !== a) {
            d = 0;
            for (e = a.length; d < e; d++)
                b.lineGeometry.vertices[a[d]].copy(THREE.CameraHelper.__v)
        }
    }
    var b = this;
    THREE.CameraHelper.__c.projectionMatrix.copy(this.camera.projectionMatrix);
    a("c", 0, 0, -1);
    a("t", 0, 0, 1);
    a("n1", -1, -1, -1);
    a("n2", 1, -1, -1);
    a("n3", -1, 1, -1);
    a("n4", 1, 1, -1);
    a("f1", -1, -1, 1);
    a("f2", 1, -1, 1);
    a("f3", -1, 1, 1);
    a("f4", 1, 1, 1);
    a("u1", 0.7, 1.1, -1);
    a("u2", -0.7, 1.1, -1);
    a("u3", 0, 2, -1);
    a("cf1", -1, 0, 1);
    a("cf2", 1, 0, 1);
    a("cf3", 0, -1, 1);
    a("cf4", 0, 1, 1);
    a("cn1", -1, 0, -1);
    a("cn2", 1, 0, -1);
    a("cn3", 0, -1, -1);
    a("cn4", 0, 1, -1);
    this.lineGeometry.verticesNeedUpdate = !0
}
;
THREE.CameraHelper.__projector = new THREE.Projector;
THREE.CameraHelper.__v = new THREE.Vector3;
THREE.CameraHelper.__c = new THREE.Camera;
THREE.SubdivisionModifier = function(a) {
    this.subdivisions = void 0 === a ? 1 : a;
    this.useOldVertexColors = !1;
    this.supportUVs = !0;
    this.debug = !1
}
;
THREE.SubdivisionModifier.prototype.constructor = THREE.SubdivisionModifier;
THREE.SubdivisionModifier.prototype.modify = function(a) {
    for (var b = this.subdivisions; 0 < b--; )
        this.smooth(a)
}
;
THREE.SubdivisionModifier.prototype.smooth = function(a) {
    function b() {
        p.debug && console.log.apply(console, arguments)
    }
    function c() {
        console && console.log.apply(console, arguments)
    }
    function d(a, c, d, e, g, h, i) {
        var j = new THREE.Face4(a,c,d,e,null,g.color,g.material);
        if (p.useOldVertexColors) {
            j.vertexColors = [];
            for (var l, m, o, q = 0; 4 > q; q++) {
                o = h[q];
                l = new THREE.Color;
                l.setRGB(0, 0, 0);
                for (var r = 0; r < o.length; r++)
                    m = g.vertexColors[o[r] - 1],
                    l.r += m.r,
                    l.g += m.g,
                    l.b += m.b;
                l.r /= o.length;
                l.g /= o.length;
                l.b /= o.length;
                j.vertexColors[q] = l
            }
        }
        k.push(j);
        p.supportUVs && (g = [f(a, ""), f(c, i), f(d, i), f(e, i)],
        g[0] ? g[1] ? g[2] ? g[3] ? n.push(g) : b("d :( ", e + ":" + i) : b("c :( ", d + ":" + i) : b("b :( ", c + ":" + i) : b("a :( ", a + ":" + i))
    }
    function e(a, b) {
        return Math.min(a, b) + "_" + Math.max(a, b)
    }
    function f(a, d) {
        var e = a + ":" + d
          , f = v[e];
        return !f ? (a >= x && a < x + r.length ? b("face pt") : b("edge pt"),
        c("warning, UV not found for", e),
        null) : f
    }
    function g(a, b, d) {
        var e = a + ":" + b;
        e in v ? c("dup vertexNo", a, "oldFaceNo", b, "value", d, "key", e, v[e]) : v[e] = d
    }
    function h(a, b) {
        void 0 === P[a] && (P[a] = []);
        P[a].push(b)
    }
    function i(a, b, c) {
        void 0 === N[a] && (N[a] = {});
        N[a][b] = c
    }
    var j = [], k = [], n = [], p = this, o = a.vertices, r = a.faces, j = o.concat(), q = [], s = {}, t = {}, v = {}, x = o.length, u, y, E, z, C, w = a.faceVertexUvs[0], H;
    b("originalFaces, uvs, originalVerticesLength", r.length, w.length, x);
    if (p.supportUVs) {
        u = 0;
        for (y = w.length; u < y; u++) {
            E = 0;
            for (z = w[u].length; E < z; E++)
                H = r[u]["abcd".charAt(E)],
                g(H, u, w[u][E])
        }
    }
    0 == w.length && (p.supportUVs = !1);
    u = 0;
    for (C in v)
        u++;
    u || (p.supportUVs = !1,
    b("no uvs"));
    b("-- Original Faces + Vertices UVs completed", v, "vs", w.length);
    u = 0;
    for (y = r.length; u < y; u++)
        C = r[u],
        q.push(C.centroid),
        j.push(C.centroid),
        p.supportUVs && (w = new THREE.UV,
        C instanceof THREE.Face3 ? (w.u = f(C.a, u).u + f(C.b, u).u + f(C.c, u).u,
        w.v = f(C.a, u).v + f(C.b, u).v + f(C.c, u).v,
        w.u /= 3,
        w.v /= 3) : C instanceof THREE.Face4 && (w.u = f(C.a, u).u + f(C.b, u).u + f(C.c, u).u + f(C.d, u).u,
        w.v = f(C.a, u).v + f(C.b, u).v + f(C.c, u).v + f(C.d, u).v,
        w.u /= 4,
        w.v /= 4),
        g(x + u, "", w));
    b("-- added UVs for new Faces", v);
    y = function(a) {
        function b(a, c) {
            h[a] === void 0 && (h[a] = []);
            h[a].push(c)
        }
        var c, d, f, g, h = {};
        c = 0;
        for (d = a.faces.length; c < d; c++) {
            f = a.faces[c];
            if (f instanceof THREE.Face3) {
                g = e(f.a, f.b);
                b(g, c);
                g = e(f.b, f.c);
                b(g, c);
                g = e(f.c, f.a);
                b(g, c)
            } else if (f instanceof THREE.Face4) {
                g = e(f.a, f.b);
                b(g, c);
                g = e(f.b, f.c);
                b(g, c);
                g = e(f.c, f.d);
                b(g, c);
                g = e(f.d, f.a);
                b(g, c)
            }
        }
        return h
    }(a);
    H = 0;
    var L, I, P = {}, N = {};
    for (u in y) {
        w = y[u];
        L = u.split("_");
        I = L[0];
        L = L[1];
        h(I, [I, L]);
        h(L, [I, L]);
        E = 0;
        for (z = w.length; E < z; E++)
            C = w[E],
            i(I, C, u),
            i(L, C, u);
        2 > w.length && (t[u] = !0)
    }
    b("vertexEdgeMap", P, "vertexFaceMap", N);
    for (u in y)
        if (w = y[u],
        C = w[0],
        z = w[1],
        L = u.split("_"),
        I = L[0],
        L = L[1],
        w = new THREE.Vector3,
        t[u] ? (w.addSelf(o[I]),
        w.addSelf(o[L]),
        w.multiplyScalar(0.5)) : (w.addSelf(q[C]),
        w.addSelf(q[z]),
        w.addSelf(o[I]),
        w.addSelf(o[L]),
        w.multiplyScalar(0.25)),
        s[u] = x + r.length + H,
        j.push(w),
        H++,
        p.supportUVs)
            w = new THREE.UV,
            w.u = f(I, C).u + f(L, C).u,
            w.v = f(I, C).v + f(L, C).v,
            w.u /= 2,
            w.v /= 2,
            g(s[u], C, w),
            t[u] || (w = new THREE.UV,
            w.u = f(I, z).u + f(L, z).u,
            w.v = f(I, z).v + f(L, z).v,
            w.u /= 2,
            w.v /= 2,
            g(s[u], z, w));
    b("-- Step 2 done");
    var A, J;
    z = ["123", "12", "2", "23"];
    L = ["123", "23", "3", "31"];
    var F = ["123", "31", "1", "12"]
      , l = ["1234", "12", "2", "23"]
      , Q = ["1234", "23", "3", "34"]
      , D = ["1234", "34", "4", "41"]
      , B = ["1234", "41", "1", "12"];
    u = 0;
    for (y = q.length; u < y; u++)
        C = r[u],
        w = x + u,
        C instanceof THREE.Face3 ? (H = e(C.a, C.b),
        I = e(C.b, C.c),
        A = e(C.c, C.a),
        d(w, s[H], C.b, s[I], C, z, u),
        d(w, s[I], C.c, s[A], C, L, u),
        d(w, s[A], C.a, s[H], C, F, u)) : C instanceof THREE.Face4 ? (H = e(C.a, C.b),
        I = e(C.b, C.c),
        A = e(C.c, C.d),
        J = e(C.d, C.a),
        d(w, s[H], C.b, s[I], C, l, u),
        d(w, s[I], C.c, s[A], C, Q, u),
        d(w, s[A], C.d, s[J], C, D, u),
        d(w, s[J], C.a, s[H], C, B, u)) : b("face should be a face!", C);
    s = new THREE.Vector3;
    C = new THREE.Vector3;
    u = 0;
    for (y = o.length; u < y; u++)
        if (void 0 !== P[u]) {
            s.set(0, 0, 0);
            C.set(0, 0, 0);
            I = new THREE.Vector3(0,0,0);
            w = 0;
            for (E in N[u])
                s.addSelf(q[E]),
                w++;
            z = 0;
            H = P[u].length;
            for (E = 0; E < H; E++)
                t[e(P[u][E][0], P[u][E][1])] && z++;
            if (2 != z) {
                s.divideScalar(w);
                for (E = 0; E < H; E++)
                    w = P[u][E],
                    w = o[w[0]].clone().addSelf(o[w[1]]).divideScalar(2),
                    C.addSelf(w);
                C.divideScalar(H);
                I.addSelf(o[u]);
                I.multiplyScalar(H - 3);
                I.addSelf(s);
                I.addSelf(C.multiplyScalar(2));
                I.divideScalar(H);
                j[u] = I
            }
        }
    a.vertices = j;
    a.faces = k;
    a.faceVertexUvs[0] = n;
    delete a.__tmpVertices;
    a.computeCentroids();
    a.computeFaceNormals();
    a.computeVertexNormals()
}
;
THREE.ImmediateRenderObject = function() {
    THREE.Object3D.call(this);
    this.render = function() {}
}
;
THREE.ImmediateRenderObject.prototype = new THREE.Object3D;
THREE.ImmediateRenderObject.prototype.constructor = THREE.ImmediateRenderObject;
THREE.LensFlare = function(a, b, c, d, e) {
    THREE.Object3D.call(this);
    this.lensFlares = [];
    this.positionScreen = new THREE.Vector3;
    this.customUpdateCallback = void 0;
    void 0 !== a && this.add(a, b, c, d, e)
}
;
THREE.LensFlare.prototype = new THREE.Object3D;
THREE.LensFlare.prototype.constructor = THREE.LensFlare;
THREE.LensFlare.prototype.supr = THREE.Object3D.prototype;
THREE.LensFlare.prototype.add = function(a, b, c, d, e, f) {
    void 0 === b && (b = -1);
    void 0 === c && (c = 0);
    void 0 === f && (f = 1);
    void 0 === e && (e = new THREE.Color(16777215));
    void 0 === d && (d = THREE.NormalBlending);
    c = Math.min(c, Math.max(0, c));
    this.lensFlares.push({
        texture: a,
        size: b,
        distance: c,
        x: 0,
        y: 0,
        z: 0,
        scale: 1,
        rotation: 1,
        opacity: f,
        color: e,
        blending: d
    })
}
;
THREE.LensFlare.prototype.updateLensFlares = function() {
    var a, b = this.lensFlares.length, c, d = 2 * -this.positionScreen.x, e = 2 * -this.positionScreen.y;
    for (a = 0; a < b; a++)
        c = this.lensFlares[a],
        c.x = this.positionScreen.x + d * c.distance,
        c.y = this.positionScreen.y + e * c.distance,
        c.wantedRotation = 0.25 * c.x * Math.PI,
        c.rotation += 0.25 * (c.wantedRotation - c.rotation)
}
;
THREE.MorphBlendMesh = function(a, b) {
    THREE.Mesh.call(this, a, b);
    this.animationsMap = {};
    this.animationsList = [];
    var c = this.geometry.morphTargets.length;
    this.createAnimation("__default", 0, c - 1, c / 1);
    this.setAnimationWeight("__default", 1)
}
;
THREE.MorphBlendMesh.prototype = new THREE.Mesh;
THREE.MorphBlendMesh.prototype.constructor = THREE.MorphBlendMesh;
THREE.MorphBlendMesh.prototype.createAnimation = function(a, b, c, d) {
    b = {
        startFrame: b,
        endFrame: c,
        length: c - b + 1,
        fps: d,
        duration: (c - b) / d,
        lastFrame: 0,
        currentFrame: 0,
        active: !1,
        time: 0,
        direction: 1,
        weight: 1,
        directionBackwards: !1,
        mirroredLoop: !1
    };
    this.animationsMap[a] = b;
    this.animationsList.push(b)
}
;
THREE.MorphBlendMesh.prototype.autoCreateAnimations = function(a) {
    for (var b = /([a-z]+)(\d+)/, c, d = {}, e = this.geometry, f = 0, g = e.morphTargets.length; f < g; f++) {
        var h = e.morphTargets[f].name.match(b);
        if (h && 1 < h.length) {
            var i = h[1];
            d[i] || (d[i] = {
                start: Infinity,
                end: -Infinity
            });
            h = d[i];
            f < h.start && (h.start = f);
            f > h.end && (h.end = f);
            c || (c = i)
        }
    }
    for (i in d)
        h = d[i],
        this.createAnimation(i, h.start, h.end, a);
    this.firstAnimation = c
}
;
THREE.MorphBlendMesh.prototype.setAnimationDirectionForward = function(a) {
    if (a = this.animationsMap[a])
        a.direction = 1,
        a.directionBackwards = !1
}
;
THREE.MorphBlendMesh.prototype.setAnimationDirectionBackward = function(a) {
    if (a = this.animationsMap[a])
        a.direction = -1,
        a.directionBackwards = !0
}
;
THREE.MorphBlendMesh.prototype.setAnimationFPS = function(a, b) {
    var c = this.animationsMap[a];
    c && (c.fps = b,
    c.duration = (c.end - c.start) / c.fps)
}
;
THREE.MorphBlendMesh.prototype.setAnimationDuration = function(a, b) {
    var c = this.animationsMap[a];
    c && (c.duration = b,
    c.fps = (c.end - c.start) / c.duration)
}
;
THREE.MorphBlendMesh.prototype.setAnimationWeight = function(a, b) {
    var c = this.animationsMap[a];
    c && (c.weight = b)
}
;
THREE.MorphBlendMesh.prototype.setAnimationTime = function(a, b) {
    var c = this.animationsMap[a];
    c && (c.time = b)
}
;
THREE.MorphBlendMesh.prototype.getAnimationTime = function(a) {
    var b = 0;
    if (a = this.animationsMap[a])
        b = a.time;
    return b
}
;
THREE.MorphBlendMesh.prototype.getAnimationDuration = function(a) {
    var b = -1;
    if (a = this.animationsMap[a])
        b = a.duration;
    return b
}
;
THREE.MorphBlendMesh.prototype.playAnimation = function(a) {
    var b = this.animationsMap[a];
    b ? (b.time = 0,
    b.active = !0) : console.warn("animation[" + a + "] undefined")
}
;
THREE.MorphBlendMesh.prototype.stopAnimation = function(a) {
    if (a = this.animationsMap[a])
        a.active = !1
}
;
THREE.MorphBlendMesh.prototype.update = function(a) {
    for (var b = 0, c = this.animationsList.length; b < c; b++) {
        var d = this.animationsList[b];
        if (d.active) {
            var e = d.duration / d.length;
            d.time += d.direction * a;
            if (d.mirroredLoop) {
                if (d.time > d.duration || 0 > d.time)
                    if (d.direction *= -1,
                    d.time > d.duration && (d.time = d.duration,
                    d.directionBackwards = !0),
                    0 > d.time)
                        d.time = 0,
                        d.directionBackwards = !1
            } else
                d.time %= d.duration,
                0 > d.time && (d.time += d.duration);
            var f = d.startFrame + THREE.Math.clamp(Math.floor(d.time / e), 0, d.length - 1)
              , g = d.weight;
            f !== d.currentFrame && (this.morphTargetInfluences[d.lastFrame] = 0,
            this.morphTargetInfluences[d.currentFrame] = 1 * g,
            this.morphTargetInfluences[f] = 0,
            d.lastFrame = d.currentFrame,
            d.currentFrame = f);
            e = d.time % e / e;
            d.directionBackwards && (e = 1 - e);
            this.morphTargetInfluences[d.currentFrame] = e * g;
            this.morphTargetInfluences[d.lastFrame] = (1 - e) * g
        }
    }
}
;
THREE.LensFlarePlugin = function() {
    function a(a) {
        var c = b.createProgram()
          , d = b.createShader(b.FRAGMENT_SHADER)
          , e = b.createShader(b.VERTEX_SHADER);
        b.shaderSource(d, a.fragmentShader);
        b.shaderSource(e, a.vertexShader);
        b.compileShader(d);
        b.compileShader(e);
        b.attachShader(c, d);
        b.attachShader(c, e);
        b.linkProgram(c);
        return c
    }
    var b, c, d, e, f, g, h, i, j, k, n, p, o;
    this.init = function(r) {
        b = r.context;
        c = r;
        d = new Float32Array(16);
        e = new Uint16Array(6);
        r = 0;
        d[r++] = -1;
        d[r++] = -1;
        d[r++] = 0;
        d[r++] = 0;
        d[r++] = 1;
        d[r++] = -1;
        d[r++] = 1;
        d[r++] = 0;
        d[r++] = 1;
        d[r++] = 1;
        d[r++] = 1;
        d[r++] = 1;
        d[r++] = -1;
        d[r++] = 1;
        d[r++] = 0;
        d[r++] = 1;
        r = 0;
        e[r++] = 0;
        e[r++] = 1;
        e[r++] = 2;
        e[r++] = 0;
        e[r++] = 2;
        e[r++] = 3;
        f = b.createBuffer();
        g = b.createBuffer();
        b.bindBuffer(b.ARRAY_BUFFER, f);
        b.bufferData(b.ARRAY_BUFFER, d, b.STATIC_DRAW);
        b.bindBuffer(b.ELEMENT_ARRAY_BUFFER, g);
        b.bufferData(b.ELEMENT_ARRAY_BUFFER, e, b.STATIC_DRAW);
        h = b.createTexture();
        i = b.createTexture();
        b.bindTexture(b.TEXTURE_2D, h);
        b.texImage2D(b.TEXTURE_2D, 0, b.RGB, 16, 16, 0, b.RGB, b.UNSIGNED_BYTE, null);
        b.texParameteri(b.TEXTURE_2D, b.TEXTURE_WRAP_S, b.CLAMP_TO_EDGE);
        b.texParameteri(b.TEXTURE_2D, b.TEXTURE_WRAP_T, b.CLAMP_TO_EDGE);
        b.texParameteri(b.TEXTURE_2D, b.TEXTURE_MAG_FILTER, b.NEAREST);
        b.texParameteri(b.TEXTURE_2D, b.TEXTURE_MIN_FILTER, b.NEAREST);
        b.bindTexture(b.TEXTURE_2D, i);
        b.texImage2D(b.TEXTURE_2D, 0, b.RGBA, 16, 16, 0, b.RGBA, b.UNSIGNED_BYTE, null);
        b.texParameteri(b.TEXTURE_2D, b.TEXTURE_WRAP_S, b.CLAMP_TO_EDGE);
        b.texParameteri(b.TEXTURE_2D, b.TEXTURE_WRAP_T, b.CLAMP_TO_EDGE);
        b.texParameteri(b.TEXTURE_2D, b.TEXTURE_MAG_FILTER, b.NEAREST);
        b.texParameteri(b.TEXTURE_2D, b.TEXTURE_MIN_FILTER, b.NEAREST);
        0 >= b.getParameter(b.MAX_VERTEX_TEXTURE_IMAGE_UNITS) ? (j = !1,
        k = a(THREE.ShaderFlares.lensFlare)) : (j = !0,
        k = a(THREE.ShaderFlares.lensFlareVertexTexture));
        n = {};
        p = {};
        n.vertex = b.getAttribLocation(k, "position");
        n.uv = b.getAttribLocation(k, "uv");
        p.renderType = b.getUniformLocation(k, "renderType");
        p.map = b.getUniformLocation(k, "map");
        p.occlusionMap = b.getUniformLocation(k, "occlusionMap");
        p.opacity = b.getUniformLocation(k, "opacity");
        p.color = b.getUniformLocation(k, "color");
        p.scale = b.getUniformLocation(k, "scale");
        p.rotation = b.getUniformLocation(k, "rotation");
        p.screenPosition = b.getUniformLocation(k, "screenPosition");
        o = !1
    }
    ;
    this.render = function(a, d, e, t) {
        var a = a.__webglFlares
          , v = a.length;
        if (v) {
            var x = new THREE.Vector3
              , u = t / e
              , y = 0.5 * e
              , E = 0.5 * t
              , z = 16 / t
              , C = new THREE.Vector2(z * u,z)
              , w = new THREE.Vector3(1,1,0)
              , H = new THREE.Vector2(1,1)
              , L = p
              , z = n;
            b.useProgram(k);
            o || (b.enableVertexAttribArray(n.vertex),
            b.enableVertexAttribArray(n.uv),
            o = !0);
            b.uniform1i(L.occlusionMap, 0);
            b.uniform1i(L.map, 1);
            b.bindBuffer(b.ARRAY_BUFFER, f);
            b.vertexAttribPointer(z.vertex, 2, b.FLOAT, !1, 16, 0);
            b.vertexAttribPointer(z.uv, 2, b.FLOAT, !1, 16, 8);
            b.bindBuffer(b.ELEMENT_ARRAY_BUFFER, g);
            b.disable(b.CULL_FACE);
            b.depthMask(!1);
            var I, P, N, A, J;
            for (I = 0; I < v; I++)
                if (z = 16 / t,
                C.set(z * u, z),
                A = a[I],
                x.set(A.matrixWorld.elements[12], A.matrixWorld.elements[13], A.matrixWorld.elements[14]),
                d.matrixWorldInverse.multiplyVector3(x),
                d.projectionMatrix.multiplyVector3(x),
                w.copy(x),
                H.x = w.x * y + y,
                H.y = w.y * E + E,
                j || 0 < H.x && H.x < e && 0 < H.y && H.y < t) {
                    b.activeTexture(b.TEXTURE1);
                    b.bindTexture(b.TEXTURE_2D, h);
                    b.copyTexImage2D(b.TEXTURE_2D, 0, b.RGB, H.x - 8, H.y - 8, 16, 16, 0);
                    b.uniform1i(L.renderType, 0);
                    b.uniform2f(L.scale, C.x, C.y);
                    b.uniform3f(L.screenPosition, w.x, w.y, w.z);
                    b.disable(b.BLEND);
                    b.enable(b.DEPTH_TEST);
                    b.drawElements(b.TRIANGLES, 6, b.UNSIGNED_SHORT, 0);
                    b.activeTexture(b.TEXTURE0);
                    b.bindTexture(b.TEXTURE_2D, i);
                    b.copyTexImage2D(b.TEXTURE_2D, 0, b.RGBA, H.x - 8, H.y - 8, 16, 16, 0);
                    b.uniform1i(L.renderType, 1);
                    b.disable(b.DEPTH_TEST);
                    b.activeTexture(b.TEXTURE1);
                    b.bindTexture(b.TEXTURE_2D, h);
                    b.drawElements(b.TRIANGLES, 6, b.UNSIGNED_SHORT, 0);
                    A.positionScreen.copy(w);
                    A.customUpdateCallback ? A.customUpdateCallback(A) : A.updateLensFlares();
                    b.uniform1i(L.renderType, 2);
                    b.enable(b.BLEND);
                    P = 0;
                    for (N = A.lensFlares.length; P < N; P++)
                        J = A.lensFlares[P],
                        0.0010 < J.opacity && 0.0010 < J.scale && (w.x = J.x,
                        w.y = J.y,
                        w.z = J.z,
                        z = J.size * J.scale / t,
                        C.x = z * u,
                        C.y = z,
                        b.uniform3f(L.screenPosition, w.x, w.y, w.z),
                        b.uniform2f(L.scale, C.x, C.y),
                        b.uniform1f(L.rotation, J.rotation),
                        b.uniform1f(L.opacity, J.opacity),
                        b.uniform3f(L.color, J.color.r, J.color.g, J.color.b),
                        c.setBlending(J.blending, J.blendEquation, J.blendSrc, J.blendDst),
                        c.setTexture(J.texture, 1),
                        b.drawElements(b.TRIANGLES, 6, b.UNSIGNED_SHORT, 0))
                }
            b.enable(b.CULL_FACE);
            b.enable(b.DEPTH_TEST);
            b.depthMask(!0)
        }
    }
}
;
THREE.ShadowMapPlugin = function() {
    var a, b, c, d, e = new THREE.Frustum, f = new THREE.Matrix4, g = new THREE.Vector3, h = new THREE.Vector3;
    this.init = function(e) {
        a = e.context;
        b = e;
        var e = THREE.ShaderLib.depthRGBA
          , f = THREE.UniformsUtils.clone(e.uniforms);
        c = new THREE.ShaderMaterial({
            fragmentShader: e.fragmentShader,
            vertexShader: e.vertexShader,
            uniforms: f
        });
        d = new THREE.ShaderMaterial({
            fragmentShader: e.fragmentShader,
            vertexShader: e.vertexShader,
            uniforms: f,
            morphTargets: !0
        });
        c._shadowPass = !0;
        d._shadowPass = !0
    }
    ;
    this.render = function(a, c) {
        b.shadowMapEnabled && b.shadowMapAutoUpdate && this.update(a, c)
    }
    ;
    this.update = function(i, j) {
        var k, n, p, o, r, q, s, t, v, x = [];
        o = 0;
        a.clearColor(1, 1, 1, 1);
        a.disable(a.BLEND);
        a.enable(a.CULL_FACE);
        b.shadowMapCullFrontFaces ? a.cullFace(a.FRONT) : a.cullFace(a.BACK);
        b.setDepthTest(!0);
        k = 0;
        for (n = i.__lights.length; k < n; k++)
            if (p = i.__lights[k],
            p.castShadow)
                if (p instanceof THREE.DirectionalLight && p.shadowCascade)
                    for (r = 0; r < p.shadowCascadeCount; r++) {
                        var u;
                        if (p.shadowCascadeArray[r])
                            u = p.shadowCascadeArray[r];
                        else {
                            v = p;
                            s = r;
                            u = new THREE.DirectionalLight;
                            u.isVirtual = !0;
                            u.onlyShadow = !0;
                            u.castShadow = !0;
                            u.shadowCameraNear = v.shadowCameraNear;
                            u.shadowCameraFar = v.shadowCameraFar;
                            u.shadowCameraLeft = v.shadowCameraLeft;
                            u.shadowCameraRight = v.shadowCameraRight;
                            u.shadowCameraBottom = v.shadowCameraBottom;
                            u.shadowCameraTop = v.shadowCameraTop;
                            u.shadowCameraVisible = v.shadowCameraVisible;
                            u.shadowDarkness = v.shadowDarkness;
                            u.shadowBias = v.shadowCascadeBias[s];
                            u.shadowMapWidth = v.shadowCascadeWidth[s];
                            u.shadowMapHeight = v.shadowCascadeHeight[s];
                            u.pointsWorld = [];
                            u.pointsFrustum = [];
                            t = u.pointsWorld;
                            q = u.pointsFrustum;
                            for (var y = 0; 8 > y; y++)
                                t[y] = new THREE.Vector3,
                                q[y] = new THREE.Vector3;
                            t = v.shadowCascadeNearZ[s];
                            v = v.shadowCascadeFarZ[s];
                            q[0].set(-1, -1, t);
                            q[1].set(1, -1, t);
                            q[2].set(-1, 1, t);
                            q[3].set(1, 1, t);
                            q[4].set(-1, -1, v);
                            q[5].set(1, -1, v);
                            q[6].set(-1, 1, v);
                            q[7].set(1, 1, v);
                            u.originalCamera = j;
                            q = new THREE.Gyroscope;
                            q.position = p.shadowCascadeOffset;
                            q.add(u);
                            q.add(u.target);
                            j.add(q);
                            p.shadowCascadeArray[r] = u;
                            console.log("Created virtualLight", u)
                        }
                        s = p;
                        t = r;
                        v = s.shadowCascadeArray[t];
                        v.position.copy(s.position);
                        v.target.position.copy(s.target.position);
                        v.lookAt(v.target);
                        v.shadowCameraVisible = s.shadowCameraVisible;
                        v.shadowDarkness = s.shadowDarkness;
                        v.shadowBias = s.shadowCascadeBias[t];
                        q = s.shadowCascadeNearZ[t];
                        s = s.shadowCascadeFarZ[t];
                        v = v.pointsFrustum;
                        v[0].z = q;
                        v[1].z = q;
                        v[2].z = q;
                        v[3].z = q;
                        v[4].z = s;
                        v[5].z = s;
                        v[6].z = s;
                        v[7].z = s;
                        x[o] = u;
                        o++
                    }
                else
                    x[o] = p,
                    o++;
        k = 0;
        for (n = x.length; k < n; k++) {
            p = x[k];
            p.shadowMap || (p.shadowMap = new THREE.WebGLRenderTarget(p.shadowMapWidth,p.shadowMapHeight,{
                minFilter: THREE.LinearFilter,
                magFilter: THREE.LinearFilter,
                format: THREE.RGBAFormat
            }),
            p.shadowMapSize = new THREE.Vector2(p.shadowMapWidth,p.shadowMapHeight),
            p.shadowMatrix = new THREE.Matrix4);
            if (!p.shadowCamera) {
                if (p instanceof THREE.SpotLight)
                    p.shadowCamera = new THREE.PerspectiveCamera(p.shadowCameraFov,p.shadowMapWidth / p.shadowMapHeight,p.shadowCameraNear,p.shadowCameraFar);
                else if (p instanceof THREE.DirectionalLight)
                    p.shadowCamera = new THREE.OrthographicCamera(p.shadowCameraLeft,p.shadowCameraRight,p.shadowCameraTop,p.shadowCameraBottom,p.shadowCameraNear,p.shadowCameraFar);
                else {
                    console.error("Unsupported light type for shadow");
                    continue
                }
                i.add(p.shadowCamera);
                b.autoUpdateScene && i.updateMatrixWorld()
            }
            p.shadowCameraVisible && !p.cameraHelper && (p.cameraHelper = new THREE.CameraHelper(p.shadowCamera),
            p.shadowCamera.add(p.cameraHelper));
            if (p.isVirtual && u.originalCamera == j) {
                r = j;
                o = p.shadowCamera;
                q = p.pointsFrustum;
                v = p.pointsWorld;
                g.set(Infinity, Infinity, Infinity);
                h.set(-Infinity, -Infinity, -Infinity);
                for (s = 0; 8 > s; s++)
                    if (t = v[s],
                    t.copy(q[s]),
                    THREE.ShadowMapPlugin.__projector.unprojectVector(t, r),
                    o.matrixWorldInverse.multiplyVector3(t),
                    t.x < g.x && (g.x = t.x),
                    t.x > h.x && (h.x = t.x),
                    t.y < g.y && (g.y = t.y),
                    t.y > h.y && (h.y = t.y),
                    t.z < g.z && (g.z = t.z),
                    t.z > h.z)
                        h.z = t.z;
                o.left = g.x;
                o.right = h.x;
                o.top = h.y;
                o.bottom = g.y;
                o.updateProjectionMatrix()
            }
            o = p.shadowMap;
            q = p.shadowMatrix;
            r = p.shadowCamera;
            r.position.copy(p.matrixWorld.getPosition());
            r.lookAt(p.target.matrixWorld.getPosition());
            r.updateMatrixWorld();
            r.matrixWorldInverse.getInverse(r.matrixWorld);
            p.cameraHelper && (p.cameraHelper.lines.visible = p.shadowCameraVisible);
            p.shadowCameraVisible && p.cameraHelper.update();
            q.set(0.5, 0, 0, 0.5, 0, 0.5, 0, 0.5, 0, 0, 0.5, 0.5, 0, 0, 0, 1);
            q.multiplySelf(r.projectionMatrix);
            q.multiplySelf(r.matrixWorldInverse);
            r._viewMatrixArray || (r._viewMatrixArray = new Float32Array(16));
            r._projectionMatrixArray || (r._projectionMatrixArray = new Float32Array(16));
            r.matrixWorldInverse.flattenToArray(r._viewMatrixArray);
            r.projectionMatrix.flattenToArray(r._projectionMatrixArray);
            f.multiply(r.projectionMatrix, r.matrixWorldInverse);
            e.setFromMatrix(f);
            b.setRenderTarget(o);
            b.clear();
            v = i.__webglObjects;
            p = 0;
            for (o = v.length; p < o; p++)
                if (s = v[p],
                q = s.object,
                s.render = !1,
                q.visible && q.castShadow && (!(q instanceof THREE.Mesh) || !q.frustumCulled || e.contains(q)))
                    q._modelViewMatrix.multiply(r.matrixWorldInverse, q.matrixWorld),
                    s.render = !0;
            p = 0;
            for (o = v.length; p < o; p++)
                s = v[p],
                s.render && (q = s.object,
                s = s.buffer,
                t = q.customDepthMaterial ? q.customDepthMaterial : q.geometry.morphTargets.length ? d : c,
                s instanceof THREE.BufferGeometry ? b.renderBufferDirect(r, i.__lights, null, t, s, q) : b.renderBuffer(r, i.__lights, null, t, s, q));
            v = i.__webglObjectsImmediate;
            p = 0;
            for (o = v.length; p < o; p++)
                s = v[p],
                q = s.object,
                q.visible && q.castShadow && (q._modelViewMatrix.multiply(r.matrixWorldInverse, q.matrixWorld),
                b.renderImmediateObject(r, i.__lights, null, c, q))
        }
        k = b.getClearColor();
        n = b.getClearAlpha();
        a.clearColor(k.r, k.g, k.b, n);
        a.enable(a.BLEND);
        b.shadowMapCullFrontFaces && a.cullFace(a.BACK)
    }
}
;
THREE.ShadowMapPlugin.__projector = new THREE.Projector;
THREE.SpritePlugin = function() {
    function a(a, b) {
        return b.z - a.z
    }
    var b, c, d, e, f, g, h, i, j, k;
    this.init = function(a) {
        b = a.context;
        c = a;
        d = new Float32Array(16);
        e = new Uint16Array(6);
        a = 0;
        d[a++] = -1;
        d[a++] = -1;
        d[a++] = 0;
        d[a++] = 1;
        d[a++] = 1;
        d[a++] = -1;
        d[a++] = 1;
        d[a++] = 1;
        d[a++] = 1;
        d[a++] = 1;
        d[a++] = 1;
        d[a++] = 0;
        d[a++] = -1;
        d[a++] = 1;
        d[a++] = 0;
        a = d[a++] = 0;
        e[a++] = 0;
        e[a++] = 1;
        e[a++] = 2;
        e[a++] = 0;
        e[a++] = 2;
        e[a++] = 3;
        f = b.createBuffer();
        g = b.createBuffer();
        b.bindBuffer(b.ARRAY_BUFFER, f);
        b.bufferData(b.ARRAY_BUFFER, d, b.STATIC_DRAW);
        b.bindBuffer(b.ELEMENT_ARRAY_BUFFER, g);
        b.bufferData(b.ELEMENT_ARRAY_BUFFER, e, b.STATIC_DRAW);
        var a = THREE.ShaderSprite.sprite
          , p = b.createProgram()
          , o = b.createShader(b.FRAGMENT_SHADER)
          , r = b.createShader(b.VERTEX_SHADER);
        b.shaderSource(o, a.fragmentShader);
        b.shaderSource(r, a.vertexShader);
        b.compileShader(o);
        b.compileShader(r);
        b.attachShader(p, o);
        b.attachShader(p, r);
        b.linkProgram(p);
        h = p;
        i = {};
        j = {};
        i.position = b.getAttribLocation(h, "position");
        i.uv = b.getAttribLocation(h, "uv");
        j.uvOffset = b.getUniformLocation(h, "uvOffset");
        j.uvScale = b.getUniformLocation(h, "uvScale");
        j.rotation = b.getUniformLocation(h, "rotation");
        j.scale = b.getUniformLocation(h, "scale");
        j.alignment = b.getUniformLocation(h, "alignment");
        j.color = b.getUniformLocation(h, "color");
        j.map = b.getUniformLocation(h, "map");
        j.opacity = b.getUniformLocation(h, "opacity");
        j.useScreenCoordinates = b.getUniformLocation(h, "useScreenCoordinates");
        j.affectedByDistance = b.getUniformLocation(h, "affectedByDistance");
        j.screenPosition = b.getUniformLocation(h, "screenPosition");
        j.modelViewMatrix = b.getUniformLocation(h, "modelViewMatrix");
        j.projectionMatrix = b.getUniformLocation(h, "projectionMatrix");
        k = !1
    }
    ;
    this.render = function(d, e, o, r) {
        var d = d.__webglSprites
          , q = d.length;
        if (q) {
            var s = i
              , t = j
              , v = r / o
              , o = 0.5 * o
              , x = 0.5 * r
              , u = !0;
            b.useProgram(h);
            k || (b.enableVertexAttribArray(s.position),
            b.enableVertexAttribArray(s.uv),
            k = !0);
            b.disable(b.CULL_FACE);
            b.enable(b.BLEND);
            b.depthMask(!0);
            b.bindBuffer(b.ARRAY_BUFFER, f);
            b.vertexAttribPointer(s.position, 2, b.FLOAT, !1, 16, 0);
            b.vertexAttribPointer(s.uv, 2, b.FLOAT, !1, 16, 8);
            b.bindBuffer(b.ELEMENT_ARRAY_BUFFER, g);
            b.uniformMatrix4fv(t.projectionMatrix, !1, e._projectionMatrixArray);
            b.activeTexture(b.TEXTURE0);
            b.uniform1i(t.map, 0);
            for (var y, E = [], s = 0; s < q; s++)
                y = d[s],
                y.visible && 0 !== y.opacity && (y.useScreenCoordinates ? y.z = -y.position.z : (y._modelViewMatrix.multiply(e.matrixWorldInverse, y.matrixWorld),
                y.z = -y._modelViewMatrix.elements[14]));
            d.sort(a);
            for (s = 0; s < q; s++)
                if (y = d[s],
                y.visible && 0 !== y.opacity && y.map && y.map.image && y.map.image.width)
                    y.useScreenCoordinates ? (b.uniform1i(t.useScreenCoordinates, 1),
                    b.uniform3f(t.screenPosition, (y.position.x - o) / o, (x - y.position.y) / x, Math.max(0, Math.min(1, y.position.z)))) : (b.uniform1i(t.useScreenCoordinates, 0),
                    b.uniform1i(t.affectedByDistance, y.affectedByDistance ? 1 : 0),
                    b.uniformMatrix4fv(t.modelViewMatrix, !1, y._modelViewMatrix.elements)),
                    e = y.map.image.width / (y.scaleByViewport ? r : 1),
                    E[0] = e * v * y.scale.x,
                    E[1] = e * y.scale.y,
                    b.uniform2f(t.uvScale, y.uvScale.x, y.uvScale.y),
                    b.uniform2f(t.uvOffset, y.uvOffset.x, y.uvOffset.y),
                    b.uniform2f(t.alignment, y.alignment.x, y.alignment.y),
                    b.uniform1f(t.opacity, y.opacity),
                    b.uniform3f(t.color, y.color.r, y.color.g, y.color.b),
                    b.uniform1f(t.rotation, y.rotation),
                    b.uniform2fv(t.scale, E),
                    y.mergeWith3D && !u ? (b.enable(b.DEPTH_TEST),
                    u = !0) : !y.mergeWith3D && u && (b.disable(b.DEPTH_TEST),
                    u = !1),
                    c.setBlending(y.blending, y.blendEquation, y.blendSrc, y.blendDst),
                    c.setTexture(y.map, 0),
                    b.drawElements(b.TRIANGLES, 6, b.UNSIGNED_SHORT, 0);
            b.enable(b.CULL_FACE);
            b.enable(b.DEPTH_TEST);
            b.depthMask(!0)
        }
    }
}
;
THREE.DepthPassPlugin = function() {
    this.enabled = !1;
    this.renderTarget = null;
    var a, b, c, d, e = new THREE.Frustum, f = new THREE.Matrix4;
    this.init = function(e) {
        a = e.context;
        b = e;
        var e = THREE.ShaderLib.depthRGBA
          , f = THREE.UniformsUtils.clone(e.uniforms);
        c = new THREE.ShaderMaterial({
            fragmentShader: e.fragmentShader,
            vertexShader: e.vertexShader,
            uniforms: f
        });
        d = new THREE.ShaderMaterial({
            fragmentShader: e.fragmentShader,
            vertexShader: e.vertexShader,
            uniforms: f,
            morphTargets: !0
        });
        c._shadowPass = !0;
        d._shadowPass = !0
    }
    ;
    this.render = function(a, b) {
        this.enabled && this.update(a, b)
    }
    ;
    this.update = function(g, h) {
        var i, j, k, n, p, o;
        a.clearColor(1, 1, 1, 1);
        a.disable(a.BLEND);
        b.setDepthTest(!0);
        b.autoUpdateScene && g.updateMatrixWorld();
        h._viewMatrixArray || (h._viewMatrixArray = new Float32Array(16));
        h._projectionMatrixArray || (h._projectionMatrixArray = new Float32Array(16));
        h.matrixWorldInverse.getInverse(h.matrixWorld);
        h.matrixWorldInverse.flattenToArray(h._viewMatrixArray);
        h.projectionMatrix.flattenToArray(h._projectionMatrixArray);
        f.multiply(h.projectionMatrix, h.matrixWorldInverse);
        e.setFromMatrix(f);
        b.setRenderTarget(this.renderTarget);
        b.clear();
        o = g.__webglObjects;
        i = 0;
        for (j = o.length; i < j; i++)
            if (k = o[i],
            p = k.object,
            k.render = !1,
            p.visible && (!(p instanceof THREE.Mesh) || !p.frustumCulled || e.contains(p)))
                p._modelViewMatrix.multiply(h.matrixWorldInverse, p.matrixWorld),
                k.render = !0;
        i = 0;
        for (j = o.length; i < j; i++)
            k = o[i],
            k.render && (p = k.object,
            k = k.buffer,
            b.setObjectFaces(p),
            n = p.customDepthMaterial ? p.customDepthMaterial : p.geometry.morphTargets.length ? d : c,
            k instanceof THREE.BufferGeometry ? b.renderBufferDirect(h, g.__lights, null, n, k, p) : b.renderBuffer(h, g.__lights, null, n, k, p));
        o = g.__webglObjectsImmediate;
        i = 0;
        for (j = o.length; i < j; i++)
            k = o[i],
            p = k.object,
            p.visible && p.castShadow && (p._modelViewMatrix.multiply(h.matrixWorldInverse, p.matrixWorld),
            b.renderImmediateObject(h, g.__lights, null, c, p));
        i = b.getClearColor();
        j = b.getClearAlpha();
        a.clearColor(i.r, i.g, i.b, j);
        a.enable(a.BLEND)
    }
}
;
THREE.ShaderFlares = {
    lensFlareVertexTexture: {
        vertexShader: "uniform vec3 screenPosition;\nuniform vec2 scale;\nuniform float rotation;\nuniform int renderType;\nuniform sampler2D occlusionMap;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nvUV = uv;\nvec2 pos = position;\nif( renderType == 2 ) {\nvec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) ) +\ntexture2D( occlusionMap, vec2( 0.5, 0.1 ) ) +\ntexture2D( occlusionMap, vec2( 0.9, 0.1 ) ) +\ntexture2D( occlusionMap, vec2( 0.9, 0.5 ) ) +\ntexture2D( occlusionMap, vec2( 0.9, 0.9 ) ) +\ntexture2D( occlusionMap, vec2( 0.5, 0.9 ) ) +\ntexture2D( occlusionMap, vec2( 0.1, 0.9 ) ) +\ntexture2D( occlusionMap, vec2( 0.1, 0.5 ) ) +\ntexture2D( occlusionMap, vec2( 0.5, 0.5 ) );\nvVisibility = (       visibility.r / 9.0 ) *\n( 1.0 - visibility.g / 9.0 ) *\n(       visibility.b / 9.0 ) *\n( 1.0 - visibility.a / 9.0 );\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",
        fragmentShader: "precision mediump float;\nuniform sampler2D map;\nuniform float opacity;\nuniform int renderType;\nuniform vec3 color;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nif( renderType == 0 ) {\ngl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );\n} else if( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nvec4 texture = texture2D( map, vUV );\ntexture.a *= opacity * vVisibility;\ngl_FragColor = texture;\ngl_FragColor.rgb *= color;\n}\n}"
    },
    lensFlare: {
        vertexShader: "uniform vec3 screenPosition;\nuniform vec2 scale;\nuniform float rotation;\nuniform int renderType;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\nvUV = uv;\nvec2 pos = position;\nif( renderType == 2 ) {\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",
        fragmentShader: "precision mediump float;\nuniform sampler2D map;\nuniform sampler2D occlusionMap;\nuniform float opacity;\nuniform int renderType;\nuniform vec3 color;\nvarying vec2 vUV;\nvoid main() {\nif( renderType == 0 ) {\ngl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );\n} else if( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nfloat visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a +\ntexture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a +\ntexture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a +\ntexture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;\nvisibility = ( 1.0 - visibility / 4.0 );\nvec4 texture = texture2D( map, vUV );\ntexture.a *= opacity * visibility;\ngl_FragColor = texture;\ngl_FragColor.rgb *= color;\n}\n}"
    }
};
THREE.ShaderSprite = {
    sprite: {
        vertexShader: "uniform int useScreenCoordinates;\nuniform int affectedByDistance;\nuniform vec3 screenPosition;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform float rotation;\nuniform vec2 scale;\nuniform vec2 alignment;\nuniform vec2 uvOffset;\nuniform vec2 uvScale;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\nvUV = uvOffset + uv * uvScale;\nvec2 alignedPosition = position + alignment;\nvec2 rotatedPosition;\nrotatedPosition.x = ( cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y ) * scale.x;\nrotatedPosition.y = ( sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y ) * scale.y;\nvec4 finalPosition;\nif( useScreenCoordinates != 0 ) {\nfinalPosition = vec4( screenPosition.xy + rotatedPosition, screenPosition.z, 1.0 );\n} else {\nfinalPosition = projectionMatrix * modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\nfinalPosition.xy += rotatedPosition * ( affectedByDistance == 1 ? 1.0 : finalPosition.z );\n}\ngl_Position = finalPosition;\n}",
        fragmentShader: "precision mediump float;\nuniform vec3 color;\nuniform sampler2D map;\nuniform float opacity;\nvarying vec2 vUV;\nvoid main() {\nvec4 texture = texture2D( map, vUV );\ngl_FragColor = vec4( color * texture.xyz, texture.a * opacity );\n}"
    }
};
(function(a, b) {
    function c(b, c) {
        var g = b.nodeName.toLowerCase();
        if ("area" === g) {
            var g = b.parentNode, h = g.name, i;
            return !b.href || !h || "map" !== g.nodeName.toLowerCase() ? !1 : (i = a("img[usemap=#" + h + "]")[0],
            !!i && d(i))
        }
        return (/input|select|textarea|button|object/.test(g) ? !b.disabled : "a" == g ? b.href || c : c) && d(b)
    }
    function d(b) {
        return !a(b).parents().andSelf().filter(function() {
            return "hidden" === a.curCSS(this, "visibility") || a.expr.filters.hidden(this)
        }).length
    }
    a.ui = a.ui || {};
    a.ui.version || (a.extend(a.ui, {
        version: "1.8.23",
        keyCode: {
            ALT: 18,
            BACKSPACE: 8,
            CAPS_LOCK: 20,
            COMMA: 188,
            COMMAND: 91,
            COMMAND_LEFT: 91,
            COMMAND_RIGHT: 93,
            CONTROL: 17,
            DELETE: 46,
            DOWN: 40,
            END: 35,
            ENTER: 13,
            ESCAPE: 27,
            HOME: 36,
            INSERT: 45,
            LEFT: 37,
            MENU: 93,
            NUMPAD_ADD: 107,
            NUMPAD_DECIMAL: 110,
            NUMPAD_DIVIDE: 111,
            NUMPAD_ENTER: 108,
            NUMPAD_MULTIPLY: 106,
            NUMPAD_SUBTRACT: 109,
            PAGE_DOWN: 34,
            PAGE_UP: 33,
            PERIOD: 190,
            RIGHT: 39,
            SHIFT: 16,
            SPACE: 32,
            TAB: 9,
            UP: 38,
            WINDOWS: 91
        }
    }),
    a.fn.extend({
        propAttr: a.fn.prop || a.fn.attr,
        _focus: a.fn.focus,
        focus: function(b, c) {
            return "number" == typeof b ? this.each(function() {
                var d = this;
                setTimeout(function() {
                    a(d).focus();
                    c && c.call(d)
                }, b)
            }) : this._focus.apply(this, arguments)
        },
        scrollParent: function() {
            var b;
            return a.browser.msie && /(static|relative)/.test(this.css("position")) || /absolute/.test(this.css("position")) ? b = this.parents().filter(function() {
                return /(relative|absolute|fixed)/.test(a.curCSS(this, "position", 1)) && /(auto|scroll)/.test(a.curCSS(this, "overflow", 1) + a.curCSS(this, "overflow-y", 1) + a.curCSS(this, "overflow-x", 1))
            }).eq(0) : b = this.parents().filter(function() {
                return /(auto|scroll)/.test(a.curCSS(this, "overflow", 1) + a.curCSS(this, "overflow-y", 1) + a.curCSS(this, "overflow-x", 1))
            }).eq(0),
            /fixed/.test(this.css("position")) || !b.length ? a(document) : b
        },
        zIndex: function(c) {
            if (c !== b)
                return this.css("zIndex", c);
            if (this.length)
                for (var c = a(this[0]), d; c.length && c[0] !== document; ) {
                    d = c.css("position");
                    if ("absolute" === d || "relative" === d || "fixed" === d)
                        if (d = parseInt(c.css("zIndex"), 10),
                        !isNaN(d) && 0 !== d)
                            return d;
                    c = c.parent()
                }
            return 0
        },
        disableSelection: function() {
            return this.bind((a.support.selectstart ? "selectstart" : "mousedown") + ".ui-disableSelection", function(a) {
                a.preventDefault()
            })
        },
        enableSelection: function() {
            return this.unbind(".ui-disableSelection")
        }
    }),
    a("<a>").outerWidth(1).jquery || a.each(["Width", "Height"], function(c, d) {
        function g(b, c, d, e) {
            return a.each(h, function() {
                c -= parseFloat(a.curCSS(b, "padding" + this, !0)) || 0;
                d && (c -= parseFloat(a.curCSS(b, "border" + this + "Width", !0)) || 0);
                e && (c -= parseFloat(a.curCSS(b, "margin" + this, !0)) || 0)
            }),
            c
        }
        var h = "Width" === d ? ["Left", "Right"] : ["Top", "Bottom"]
          , i = d.toLowerCase()
          , j = {
            innerWidth: a.fn.innerWidth,
            innerHeight: a.fn.innerHeight,
            outerWidth: a.fn.outerWidth,
            outerHeight: a.fn.outerHeight
        };
        a.fn["inner" + d] = function(c) {
            return c === b ? j["inner" + d].call(this) : this.each(function() {
                a(this).css(i, g(this, c) + "px")
            })
        }
        ;
        a.fn["outer" + d] = function(b, c) {
            return "number" != typeof b ? j["outer" + d].call(this, b) : this.each(function() {
                a(this).css(i, g(this, b, !0, c) + "px")
            })
        }
    }),
    a.extend(a.expr[":"], {
        data: a.expr.createPseudo ? a.expr.createPseudo(function(b) {
            return function(c) {
                return !!a.data(c, b)
            }
        }) : function(b, c, d) {
            return !!a.data(b, d[3])
        }
        ,
        focusable: function(b) {
            return c(b, !isNaN(a.attr(b, "tabindex")))
        },
        tabbable: function(b) {
            var d = a.attr(b, "tabindex")
              , g = isNaN(d);
            return (g || 0 <= d) && c(b, !g)
        }
    }),
    a(function() {
        var b = document.body
          , c = b.appendChild(c = document.createElement("div"));
        c.offsetHeight;
        a.extend(c.style, {
            minHeight: "100px",
            height: "auto",
            padding: 0,
            borderWidth: 0
        });
        a.support.minHeight = 100 === c.offsetHeight;
        a.support.selectstart = "onselectstart"in c;
        b.removeChild(c).style.display = "none"
    }),
    a.curCSS || (a.curCSS = a.css),
    a.extend(a.ui, {
        plugin: {
            add: function(b, c, d) {
                var b = a.ui[b].prototype, h;
                for (h in d)
                    b.plugins[h] = b.plugins[h] || [],
                    b.plugins[h].push([c, d[h]])
            },
            call: function(a, b, c) {
                if ((b = a.plugins[b]) && a.element[0].parentNode)
                    for (var d = 0; d < b.length; d++)
                        a.options[b[d][0]] && b[d][1].apply(a.element, c)
            }
        },
        contains: function(a, b) {
            return document.compareDocumentPosition ? a.compareDocumentPosition(b) & 16 : a !== b && a.contains(b)
        },
        hasScroll: function(b, c) {
            if ("hidden" === a(b).css("overflow"))
                return !1;
            var d = c && "left" === c ? "scrollLeft" : "scrollTop";
            return 0 < b[d] ? !0 : (b[d] = 1,
            b[d] = 0,
            !1)
        },
        isOverAxis: function(a, b, c) {
            return a > b && a < b + c
        },
        isOver: function(b, c, d, h, i, j) {
            return a.ui.isOverAxis(b, d, i) && a.ui.isOverAxis(c, h, j)
        }
    }))
}
)(jQuery);
(function(a, b) {
    if (a.cleanData) {
        var c = a.cleanData;
        a.cleanData = function(b) {
            for (var d = 0, g; null != (g = b[d]); d++)
                try {
                    a(g).triggerHandler("remove")
                } catch (h) {}
            c(b)
        }
    } else {
        var d = a.fn.remove;
        a.fn.remove = function(b, c) {
            return this.each(function() {
                return c || (!b || a.filter(b, [this]).length) && a("*", this).add([this]).each(function() {
                    try {
                        a(this).triggerHandler("remove")
                    } catch (b) {}
                }),
                d.call(a(this), b, c)
            })
        }
    }
    a.widget = function(b, c, d) {
        var h = b.split(".")[0], i, b = b.split(".")[1];
        i = h + "-" + b;
        d || (d = c,
        c = a.Widget);
        a.expr[":"][i] = function(c) {
            return !!a.data(c, b)
        }
        ;
        a[h] = a[h] || {};
        a[h][b] = function(a, b) {
            arguments.length && this._createWidget(a, b)
        }
        ;
        c = new c;
        c.options = a.extend(!0, {}, c.options);
        a[h][b].prototype = a.extend(!0, c, {
            namespace: h,
            widgetName: b,
            widgetEventPrefix: a[h][b].prototype.widgetEventPrefix || b,
            widgetBaseClass: i
        }, d);
        a.widget.bridge(b, a[h][b])
    }
    ;
    a.widget.bridge = function(c, d) {
        a.fn[c] = function(g) {
            var h = "string" == typeof g
              , i = Array.prototype.slice.call(arguments, 1)
              , j = this;
            return g = !h && i.length ? a.extend.apply(null, [!0, g].concat(i)) : g,
            h && "_" === g.charAt(0) ? j : (h ? this.each(function() {
                var d = a.data(this, c)
                  , f = d && a.isFunction(d[g]) ? d[g].apply(d, i) : d;
                if (f !== d && f !== b)
                    return j = f,
                    !1
            }) : this.each(function() {
                var b = a.data(this, c);
                b ? b.option(g || {})._init() : a.data(this, c, new d(g,this))
            }),
            j)
        }
    }
    ;
    a.Widget = function(a, b) {
        arguments.length && this._createWidget(a, b)
    }
    ;
    a.Widget.prototype = {
        widgetName: "widget",
        widgetEventPrefix: "",
        options: {
            disabled: !1
        },
        _createWidget: function(b, c) {
            a.data(c, this.widgetName, this);
            this.element = a(c);
            this.options = a.extend(!0, {}, this.options, this._getCreateOptions(), b);
            var d = this;
            this.element.bind("remove." + this.widgetName, function() {
                d.destroy()
            });
            this._create();
            this._trigger("create");
            this._init()
        },
        _getCreateOptions: function() {
            return a.metadata && a.metadata.get(this.element[0])[this.widgetName]
        },
        _create: function() {},
        _init: function() {},
        destroy: function() {
            this.element.unbind("." + this.widgetName).removeData(this.widgetName);
            this.widget().unbind("." + this.widgetName).removeAttr("aria-disabled").removeClass(this.widgetBaseClass + "-disabled ui-state-disabled")
        },
        widget: function() {
            return this.element
        },
        option: function(c, d) {
            var g = c;
            if (0 === arguments.length)
                return a.extend({}, this.options);
            if ("string" == typeof c) {
                if (d === b)
                    return this.options[c];
                g = {};
                g[c] = d
            }
            return this._setOptions(g),
            this
        },
        _setOptions: function(b) {
            var c = this;
            return a.each(b, function(a, b) {
                c._setOption(a, b)
            }),
            this
        },
        _setOption: function(a, b) {
            return this.options[a] = b,
            "disabled" === a && this.widget()[b ? "addClass" : "removeClass"](this.widgetBaseClass + "-disabled ui-state-disabled").attr("aria-disabled", b),
            this
        },
        enable: function() {
            return this._setOption("disabled", !1)
        },
        disable: function() {
            return this._setOption("disabled", !0)
        },
        _trigger: function(b, c, d) {
            var h, i = this.options[b], d = d || {}, c = a.Event(c);
            c.type = (b === this.widgetEventPrefix ? b : this.widgetEventPrefix + b).toLowerCase();
            c.target = this.element[0];
            if (b = c.originalEvent)
                for (h in b)
                    h in c || (c[h] = b[h]);
            return this.element.trigger(c, d),
            !(a.isFunction(i) && !1 === i.call(this.element[0], c, d) || c.isDefaultPrevented())
        }
    }
}
)(jQuery);
(function(a) {
    var b = !1;
    a(document).mouseup(function() {
        b = !1
    });
    a.widget("ui.mouse", {
        options: {
            cancel: ":input,option",
            distance: 1,
            delay: 0
        },
        _mouseInit: function() {
            var b = this;
            this.element.bind("mousedown." + this.widgetName, function(a) {
                return b._mouseDown(a)
            }).bind("click." + this.widgetName, function(d) {
                if (!0 === a.data(d.target, b.widgetName + ".preventClickEvent"))
                    return a.removeData(d.target, b.widgetName + ".preventClickEvent"),
                    d.stopImmediatePropagation(),
                    !1
            });
            this.started = !1
        },
        _mouseDestroy: function() {
            this.element.unbind("." + this.widgetName);
            this._mouseMoveDelegate && a(document).unbind("mousemove." + this.widgetName, this._mouseMoveDelegate).unbind("mouseup." + this.widgetName, this._mouseUpDelegate)
        },
        _mouseDown: function(c) {
            if (!b) {
                this._mouseStarted && this._mouseUp(c);
                this._mouseDownEvent = c;
                var d = this
                  , e = 1 == c.which
                  , f = "string" == typeof this.options.cancel && c.target.nodeName ? a(c.target).closest(this.options.cancel).length : !1;
                if (!e || f || !this._mouseCapture(c))
                    return !0;
                (this.mouseDelayMet = !this.options.delay) || (this._mouseDelayTimer = setTimeout(function() {
                    d.mouseDelayMet = !0
                }, this.options.delay));
                return this._mouseDistanceMet(c) && this._mouseDelayMet(c) && (this._mouseStarted = !1 !== this._mouseStart(c),
                !this._mouseStarted) ? (c.preventDefault(),
                !0) : (!0 === a.data(c.target, this.widgetName + ".preventClickEvent") && a.removeData(c.target, this.widgetName + ".preventClickEvent"),
                this._mouseMoveDelegate = function(a) {
                    return d._mouseMove(a)
                }
                ,
                this._mouseUpDelegate = function(a) {
                    return d._mouseUp(a)
                }
                ,
                a(document).bind("mousemove." + this.widgetName, this._mouseMoveDelegate).bind("mouseup." + this.widgetName, this._mouseUpDelegate),
                c.preventDefault(),
                b = !0,
                !0)
            }
        },
        _mouseMove: function(b) {
            return !a.browser.msie || 9 <= document.documentMode || b.button ? this._mouseStarted ? (this._mouseDrag(b),
            b.preventDefault()) : (this._mouseDistanceMet(b) && this._mouseDelayMet(b) && (this._mouseStarted = !1 !== this._mouseStart(this._mouseDownEvent, b),
            this._mouseStarted ? this._mouseDrag(b) : this._mouseUp(b)),
            !this._mouseStarted) : this._mouseUp(b)
        },
        _mouseUp: function(b) {
            return a(document).unbind("mousemove." + this.widgetName, this._mouseMoveDelegate).unbind("mouseup." + this.widgetName, this._mouseUpDelegate),
            this._mouseStarted && (this._mouseStarted = !1,
            b.target == this._mouseDownEvent.target && a.data(b.target, this.widgetName + ".preventClickEvent", !0),
            this._mouseStop(b)),
            !1
        },
        _mouseDistanceMet: function(a) {
            return Math.max(Math.abs(this._mouseDownEvent.pageX - a.pageX), Math.abs(this._mouseDownEvent.pageY - a.pageY)) >= this.options.distance
        },
        _mouseDelayMet: function() {
            return this.mouseDelayMet
        },
        _mouseStart: function() {},
        _mouseDrag: function() {},
        _mouseStop: function() {},
        _mouseCapture: function() {
            return !0
        }
    })
}
)(jQuery);
(function(a) {
    a.ui = a.ui || {};
    var b = /left|center|right/, c = /top|center|bottom/, d, e = a.fn.position, f = a.fn.offset;
    a.fn.position = function(f) {
        if (!f || !f.of)
            return e.apply(this, arguments);
        var f = a.extend({}, f), h = a(f.of), i = h[0], j = (f.collision || "flip").split(" "), k = f.offset ? f.offset.split(" ") : [0, 0], n, p, o;
        return 9 === i.nodeType ? (n = h.width(),
        p = h.height(),
        o = {
            top: 0,
            left: 0
        }) : i.setTimeout ? (n = h.width(),
        p = h.height(),
        o = {
            top: h.scrollTop(),
            left: h.scrollLeft()
        }) : i.preventDefault ? (f.at = "left top",
        n = p = 0,
        o = {
            top: f.of.pageY,
            left: f.of.pageX
        }) : (n = h.outerWidth(),
        p = h.outerHeight(),
        o = h.offset()),
        a.each(["my", "at"], function() {
            var a = (f[this] || "").split(" ");
            1 === a.length && (a = b.test(a[0]) ? a.concat(["center"]) : c.test(a[0]) ? ["center"].concat(a) : ["center", "center"]);
            a[0] = b.test(a[0]) ? a[0] : "center";
            a[1] = c.test(a[1]) ? a[1] : "center";
            f[this] = a
        }),
        1 === j.length && (j[1] = j[0]),
        k[0] = parseInt(k[0], 10) || 0,
        1 === k.length && (k[1] = k[0]),
        k[1] = parseInt(k[1], 10) || 0,
        "right" === f.at[0] ? o.left += n : "center" === f.at[0] && (o.left += n / 2),
        "bottom" === f.at[1] ? o.top += p : "center" === f.at[1] && (o.top += p / 2),
        o.left += k[0],
        o.top += k[1],
        this.each(function() {
            var b = a(this), c = b.outerWidth(), e = b.outerHeight(), h = parseInt(a.curCSS(this, "marginLeft", !0)) || 0, i = parseInt(a.curCSS(this, "marginTop", !0)) || 0, x = c + h + (parseInt(a.curCSS(this, "marginRight", !0)) || 0), u = e + i + (parseInt(a.curCSS(this, "marginBottom", !0)) || 0), y = a.extend({}, o), E;
            "right" === f.my[0] ? y.left -= c : "center" === f.my[0] && (y.left -= c / 2);
            "bottom" === f.my[1] ? y.top -= e : "center" === f.my[1] && (y.top -= e / 2);
            d || (y.left = Math.round(y.left),
            y.top = Math.round(y.top));
            E = {
                left: y.left - h,
                top: y.top - i
            };
            a.each(["left", "top"], function(b, d) {
                a.ui.position[j[b]] && a.ui.position[j[b]][d](y, {
                    targetWidth: n,
                    targetHeight: p,
                    elemWidth: c,
                    elemHeight: e,
                    collisionPosition: E,
                    collisionWidth: x,
                    collisionHeight: u,
                    offset: k,
                    my: f.my,
                    at: f.at
                })
            });
            a.fn.bgiframe && b.bgiframe();
            b.offset(a.extend(y, {
                using: f.using
            }))
        })
    }
    ;
    a.ui.position = {
        fit: {
            left: function(b, c) {
                var d = a(window)
                  , d = c.collisionPosition.left + c.collisionWidth - d.width() - d.scrollLeft();
                b.left = 0 < d ? b.left - d : Math.max(b.left - c.collisionPosition.left, b.left)
            },
            top: function(b, c) {
                var d = a(window)
                  , d = c.collisionPosition.top + c.collisionHeight - d.height() - d.scrollTop();
                b.top = 0 < d ? b.top - d : Math.max(b.top - c.collisionPosition.top, b.top)
            }
        },
        flip: {
            left: function(b, c) {
                if ("center" !== c.at[0]) {
                    var d = a(window)
                      , d = c.collisionPosition.left + c.collisionWidth - d.width() - d.scrollLeft()
                      , e = "left" === c.my[0] ? -c.elemWidth : "right" === c.my[0] ? c.elemWidth : 0
                      , f = "left" === c.at[0] ? c.targetWidth : -c.targetWidth
                      , n = -2 * c.offset[0];
                    b.left += 0 > c.collisionPosition.left ? e + f + n : 0 < d ? e + f + n : 0
                }
            },
            top: function(b, c) {
                if ("center" !== c.at[1]) {
                    var d = a(window)
                      , d = c.collisionPosition.top + c.collisionHeight - d.height() - d.scrollTop()
                      , e = "top" === c.my[1] ? -c.elemHeight : "bottom" === c.my[1] ? c.elemHeight : 0
                      , f = "top" === c.at[1] ? c.targetHeight : -c.targetHeight
                      , n = -2 * c.offset[1];
                    b.top += 0 > c.collisionPosition.top ? e + f + n : 0 < d ? e + f + n : 0
                }
            }
        }
    };
    a.offset.setOffset || (a.offset.setOffset = function(b, c) {
        /static/.test(a.curCSS(b, "position")) && (b.style.position = "relative");
        var d = a(b)
          , e = d.offset()
          , f = parseInt(a.curCSS(b, "top", !0), 10) || 0
          , n = parseInt(a.curCSS(b, "left", !0), 10) || 0
          , e = {
            top: c.top - e.top + f,
            left: c.left - e.left + n
        };
        "using"in c ? c.using.call(b, e) : d.css(e)
    }
    ,
    a.fn.offset = function(b) {
        var c = this[0];
        return !c || !c.ownerDocument ? null : b ? a.isFunction(b) ? this.each(function(c) {
            a(this).offset(b.call(this, c, a(this).offset()))
        }) : this.each(function() {
            a.offset.setOffset(this, b)
        }) : f.call(this)
    }
    );
    a.curCSS || (a.curCSS = a.css);
    (function() {
        var b = document.getElementsByTagName("body")[0], c = document.createElement("div"), e, f;
        e = document.createElement(b ? "div" : "body");
        f = {
            visibility: "hidden",
            width: 0,
            height: 0,
            border: 0,
            margin: 0,
            background: "none"
        };
        b && a.extend(f, {
            position: "absolute",
            left: "-1000px",
            top: "-1000px"
        });
        for (var k in f)
            e.style[k] = f[k];
        e.appendChild(c);
        f = b || document.documentElement;
        f.insertBefore(e, f.firstChild);
        c.style.cssText = "position: absolute; left: 10.7432222px; top: 10.432325px; height: 30px; width: 201px;";
        c = a(c).offset(function(a, b) {
            return b
        }).offset();
        e.innerHTML = "";
        f.removeChild(e);
        b = c.top + c.left + (b ? 2E3 : 0);
        d = 21 < b && 22 > b
    }
    )()
}
)(jQuery);
(function(a) {
    a.widget("ui.draggable", a.ui.mouse, {
        widgetEventPrefix: "drag",
        options: {
            addClasses: !0,
            appendTo: "parent",
            axis: !1,
            connectToSortable: !1,
            containment: !1,
            cursor: "auto",
            cursorAt: !1,
            grid: !1,
            handle: !1,
            helper: "original",
            iframeFix: !1,
            opacity: !1,
            refreshPositions: !1,
            revert: !1,
            revertDuration: 500,
            scope: "default",
            scroll: !0,
            scrollSensitivity: 20,
            scrollSpeed: 20,
            snap: !1,
            snapMode: "both",
            snapTolerance: 20,
            stack: !1,
            zIndex: !1
        },
        _create: function() {
            "original" == this.options.helper && !/^(?:r|a|f)/.test(this.element.css("position")) && (this.element[0].style.position = "relative");
            this.options.addClasses && this.element.addClass("ui-draggable");
            this.options.disabled && this.element.addClass("ui-draggable-disabled");
            this._mouseInit()
        },
        destroy: function() {
            return !this.element.data("draggable") ? void 0 : (this.element.removeData("draggable").unbind(".draggable").removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),
            this._mouseDestroy(),
            this)
        },
        _mouseCapture: function(b) {
            var c = this.options;
            return this.helper || c.disabled || a(b.target).is(".ui-resizable-handle") ? !1 : (this.handle = this._getHandle(b),
            this.handle ? (c.iframeFix && a(!0 === c.iframeFix ? "iframe" : c.iframeFix).each(function() {
                a('<div class="ui-draggable-iframeFix" style="background: #fff;"></div>').css({
                    width: this.offsetWidth + "px",
                    height: this.offsetHeight + "px",
                    position: "absolute",
                    opacity: "0.001",
                    zIndex: 1E3
                }).css(a(this).offset()).appendTo("body")
            }),
            !0) : !1)
        },
        _mouseStart: function(b) {
            var c = this.options;
            return this.helper = this._createHelper(b),
            this.helper.addClass("ui-draggable-dragging"),
            this._cacheHelperProportions(),
            a.ui.ddmanager && (a.ui.ddmanager.current = this),
            this._cacheMargins(),
            this.cssPosition = this.helper.css("position"),
            this.scrollParent = this.helper.scrollParent(),
            this.offset = this.positionAbs = this.element.offset(),
            this.offset = {
                top: this.offset.top - this.margins.top,
                left: this.offset.left - this.margins.left
            },
            a.extend(this.offset, {
                click: {
                    left: b.pageX - this.offset.left,
                    top: b.pageY - this.offset.top
                },
                parent: this._getParentOffset(),
                relative: this._getRelativeOffset()
            }),
            this.originalPosition = this.position = this._generatePosition(b),
            this.originalPageX = b.pageX,
            this.originalPageY = b.pageY,
            c.cursorAt && this._adjustOffsetFromHelper(c.cursorAt),
            c.containment && this._setContainment(),
            !1 === this._trigger("start", b) ? (this._clear(),
            !1) : (this._cacheHelperProportions(),
            a.ui.ddmanager && !c.dropBehaviour && a.ui.ddmanager.prepareOffsets(this, b),
            this._mouseDrag(b, !0),
            a.ui.ddmanager && a.ui.ddmanager.dragStart(this, b),
            !0)
        },
        _mouseDrag: function(b, c) {
            this.position = this._generatePosition(b);
            this.positionAbs = this._convertPositionTo("absolute");
            if (!c) {
                var d = this._uiHash();
                if (!1 === this._trigger("drag", b, d))
                    return this._mouseUp({}),
                    !1;
                this.position = d.position
            }
            if (!this.options.axis || "y" != this.options.axis)
                this.helper[0].style.left = this.position.left + "px";
            if (!this.options.axis || "x" != this.options.axis)
                this.helper[0].style.top = this.position.top + "px";
            return a.ui.ddmanager && a.ui.ddmanager.drag(this, b),
            !1
        },
        _mouseStop: function(b) {
            var c = !1;
            a.ui.ddmanager && !this.options.dropBehaviour && (c = a.ui.ddmanager.drop(this, b));
            this.dropped && (c = this.dropped,
            this.dropped = !1);
            for (var d = this.element[0], e = !1; d && (d = d.parentNode); )
                d == document && (e = !0);
            if (!e && "original" === this.options.helper)
                return !1;
            if ("invalid" == this.options.revert && !c || "valid" == this.options.revert && c || !0 === this.options.revert || a.isFunction(this.options.revert) && this.options.revert.call(this.element, c)) {
                var f = this;
                a(this.helper).animate(this.originalPosition, parseInt(this.options.revertDuration, 10), function() {
                    !1 !== f._trigger("stop", b) && f._clear()
                })
            } else
                !1 !== this._trigger("stop", b) && this._clear();
            return !1
        },
        _mouseUp: function(b) {
            return !0 === this.options.iframeFix && a("div.ui-draggable-iframeFix").each(function() {
                this.parentNode.removeChild(this)
            }),
            a.ui.ddmanager && a.ui.ddmanager.dragStop(this, b),
            a.ui.mouse.prototype._mouseUp.call(this, b)
        },
        cancel: function() {
            return this.helper.is(".ui-draggable-dragging") ? this._mouseUp({}) : this._clear(),
            this
        },
        _getHandle: function(b) {
            var c = !this.options.handle || !a(this.options.handle, this.element).length ? !0 : !1;
            return a(this.options.handle, this.element).find("*").andSelf().each(function() {
                this == b.target && (c = !0)
            }),
            c
        },
        _createHelper: function(b) {
            var c = this.options
              , b = a.isFunction(c.helper) ? a(c.helper.apply(this.element[0], [b])) : "clone" == c.helper ? this.element.clone().removeAttr("id") : this.element;
            return b.parents("body").length || b.appendTo("parent" == c.appendTo ? this.element[0].parentNode : c.appendTo),
            b[0] != this.element[0] && !/(fixed|absolute)/.test(b.css("position")) && b.css("position", "absolute"),
            b
        },
        _adjustOffsetFromHelper: function(b) {
            "string" == typeof b && (b = b.split(" "));
            a.isArray(b) && (b = {
                left: +b[0],
                top: +b[1] || 0
            });
            "left"in b && (this.offset.click.left = b.left + this.margins.left);
            "right"in b && (this.offset.click.left = this.helperProportions.width - b.right + this.margins.left);
            "top"in b && (this.offset.click.top = b.top + this.margins.top);
            "bottom"in b && (this.offset.click.top = this.helperProportions.height - b.bottom + this.margins.top)
        },
        _getParentOffset: function() {
            this.offsetParent = this.helper.offsetParent();
            var b = this.offsetParent.offset();
            "absolute" == this.cssPosition && this.scrollParent[0] != document && a.ui.contains(this.scrollParent[0], this.offsetParent[0]) && (b.left += this.scrollParent.scrollLeft(),
            b.top += this.scrollParent.scrollTop());
            if (this.offsetParent[0] == document.body || this.offsetParent[0].tagName && "html" == this.offsetParent[0].tagName.toLowerCase() && a.browser.msie)
                b = {
                    top: 0,
                    left: 0
                };
            return {
                top: b.top + (parseInt(this.offsetParent.css("borderTopWidth"), 10) || 0),
                left: b.left + (parseInt(this.offsetParent.css("borderLeftWidth"), 10) || 0)
            }
        },
        _getRelativeOffset: function() {
            if ("relative" == this.cssPosition) {
                var a = this.element.position();
                return {
                    top: a.top - (parseInt(this.helper.css("top"), 10) || 0) + this.scrollParent.scrollTop(),
                    left: a.left - (parseInt(this.helper.css("left"), 10) || 0) + this.scrollParent.scrollLeft()
                }
            }
            return {
                top: 0,
                left: 0
            }
        },
        _cacheMargins: function() {
            this.margins = {
                left: parseInt(this.element.css("marginLeft"), 10) || 0,
                top: parseInt(this.element.css("marginTop"), 10) || 0,
                right: parseInt(this.element.css("marginRight"), 10) || 0,
                bottom: parseInt(this.element.css("marginBottom"), 10) || 0
            }
        },
        _cacheHelperProportions: function() {
            this.helperProportions = {
                width: this.helper.outerWidth(),
                height: this.helper.outerHeight()
            }
        },
        _setContainment: function() {
            var b = this.options;
            "parent" == b.containment && (b.containment = this.helper[0].parentNode);
            if ("document" == b.containment || "window" == b.containment)
                this.containment = ["document" == b.containment ? 0 : a(window).scrollLeft() - this.offset.relative.left - this.offset.parent.left, "document" == b.containment ? 0 : a(window).scrollTop() - this.offset.relative.top - this.offset.parent.top, ("document" == b.containment ? 0 : a(window).scrollLeft()) + a("document" == b.containment ? document : window).width() - this.helperProportions.width - this.margins.left, ("document" == b.containment ? 0 : a(window).scrollTop()) + (a("document" == b.containment ? document : window).height() || document.body.parentNode.scrollHeight) - this.helperProportions.height - this.margins.top];
            if (!/^(document|window|parent)$/.test(b.containment) && b.containment.constructor != Array) {
                var b = a(b.containment)
                  , c = b[0];
                if (c) {
                    b.offset();
                    var d = "hidden" != a(c).css("overflow");
                    this.containment = [(parseInt(a(c).css("borderLeftWidth"), 10) || 0) + (parseInt(a(c).css("paddingLeft"), 10) || 0), (parseInt(a(c).css("borderTopWidth"), 10) || 0) + (parseInt(a(c).css("paddingTop"), 10) || 0), (d ? Math.max(c.scrollWidth, c.offsetWidth) : c.offsetWidth) - (parseInt(a(c).css("borderLeftWidth"), 10) || 0) - (parseInt(a(c).css("paddingRight"), 10) || 0) - this.helperProportions.width - this.margins.left - this.margins.right, (d ? Math.max(c.scrollHeight, c.offsetHeight) : c.offsetHeight) - (parseInt(a(c).css("borderTopWidth"), 10) || 0) - (parseInt(a(c).css("paddingBottom"), 10) || 0) - this.helperProportions.height - this.margins.top - this.margins.bottom];
                    this.relative_container = b
                }
            } else
                b.containment.constructor == Array && (this.containment = b.containment)
        },
        _convertPositionTo: function(b, c) {
            c || (c = this.position);
            var d = "absolute" == b ? 1 : -1
              , e = "absolute" == this.cssPosition && (this.scrollParent[0] == document || !a.ui.contains(this.scrollParent[0], this.offsetParent[0])) ? this.offsetParent : this.scrollParent
              , f = /(html|body)/i.test(e[0].tagName);
            return {
                top: c.top + this.offset.relative.top * d + this.offset.parent.top * d - (a.browser.safari && 526 > a.browser.version && "fixed" == this.cssPosition ? 0 : ("fixed" == this.cssPosition ? -this.scrollParent.scrollTop() : f ? 0 : e.scrollTop()) * d),
                left: c.left + this.offset.relative.left * d + this.offset.parent.left * d - (a.browser.safari && 526 > a.browser.version && "fixed" == this.cssPosition ? 0 : ("fixed" == this.cssPosition ? -this.scrollParent.scrollLeft() : f ? 0 : e.scrollLeft()) * d)
            }
        },
        _generatePosition: function(b) {
            var c = this.options
              , d = "absolute" == this.cssPosition && (this.scrollParent[0] == document || !a.ui.contains(this.scrollParent[0], this.offsetParent[0])) ? this.offsetParent : this.scrollParent
              , e = /(html|body)/i.test(d[0].tagName)
              , f = b.pageX
              , g = b.pageY;
            if (this.originalPosition) {
                var h;
                this.containment && (this.relative_container ? (h = this.relative_container.offset(),
                h = [this.containment[0] + h.left, this.containment[1] + h.top, this.containment[2] + h.left, this.containment[3] + h.top]) : h = this.containment,
                b.pageX - this.offset.click.left < h[0] && (f = h[0] + this.offset.click.left),
                b.pageY - this.offset.click.top < h[1] && (g = h[1] + this.offset.click.top),
                b.pageX - this.offset.click.left > h[2] && (f = h[2] + this.offset.click.left),
                b.pageY - this.offset.click.top > h[3] && (g = h[3] + this.offset.click.top));
                c.grid && (g = c.grid[1] ? this.originalPageY + Math.round((g - this.originalPageY) / c.grid[1]) * c.grid[1] : this.originalPageY,
                g = h ? g - this.offset.click.top < h[1] || g - this.offset.click.top > h[3] ? g - this.offset.click.top < h[1] ? g + c.grid[1] : g - c.grid[1] : g : g,
                f = c.grid[0] ? this.originalPageX + Math.round((f - this.originalPageX) / c.grid[0]) * c.grid[0] : this.originalPageX,
                f = h ? f - this.offset.click.left < h[0] || f - this.offset.click.left > h[2] ? f - this.offset.click.left < h[0] ? f + c.grid[0] : f - c.grid[0] : f : f)
            }
            return {
                top: g - this.offset.click.top - this.offset.relative.top - this.offset.parent.top + (a.browser.safari && 526 > a.browser.version && "fixed" == this.cssPosition ? 0 : "fixed" == this.cssPosition ? -this.scrollParent.scrollTop() : e ? 0 : d.scrollTop()),
                left: f - this.offset.click.left - this.offset.relative.left - this.offset.parent.left + (a.browser.safari && 526 > a.browser.version && "fixed" == this.cssPosition ? 0 : "fixed" == this.cssPosition ? -this.scrollParent.scrollLeft() : e ? 0 : d.scrollLeft())
            }
        },
        _clear: function() {
            this.helper.removeClass("ui-draggable-dragging");
            this.helper[0] != this.element[0] && !this.cancelHelperRemoval && this.helper.remove();
            this.helper = null;
            this.cancelHelperRemoval = !1
        },
        _trigger: function(b, c, d) {
            return d = d || this._uiHash(),
            a.ui.plugin.call(this, b, [c, d]),
            "drag" == b && (this.positionAbs = this._convertPositionTo("absolute")),
            a.Widget.prototype._trigger.call(this, b, c, d)
        },
        plugins: {},
        _uiHash: function() {
            return {
                helper: this.helper,
                position: this.position,
                originalPosition: this.originalPosition,
                offset: this.positionAbs
            }
        }
    });
    a.extend(a.ui.draggable, {
        version: "1.8.23"
    });
    a.ui.plugin.add("draggable", "connectToSortable", {
        start: function(b, c) {
            var d = a(this).data("draggable")
              , e = d.options
              , f = a.extend({}, c, {
                item: d.element
            });
            d.sortables = [];
            a(e.connectToSortable).each(function() {
                var c = a.data(this, "sortable");
                c && !c.options.disabled && (d.sortables.push({
                    instance: c,
                    shouldRevert: c.options.revert
                }),
                c.refreshPositions(),
                c._trigger("activate", b, f))
            })
        },
        stop: function(b, c) {
            var d = a(this).data("draggable")
              , e = a.extend({}, c, {
                item: d.element
            });
            a.each(d.sortables, function() {
                this.instance.isOver ? (this.instance.isOver = 0,
                d.cancelHelperRemoval = !0,
                this.instance.cancelHelperRemoval = !1,
                this.shouldRevert && (this.instance.options.revert = !0),
                this.instance._mouseStop(b),
                this.instance.options.helper = this.instance.options._helper,
                "original" == d.options.helper && this.instance.currentItem.css({
                    top: "auto",
                    left: "auto"
                })) : (this.instance.cancelHelperRemoval = !1,
                this.instance._trigger("deactivate", b, e))
            })
        },
        drag: function(b, c) {
            var d = a(this).data("draggable")
              , e = this;
            a.each(d.sortables, function() {
                this.instance.positionAbs = d.positionAbs;
                this.instance.helperProportions = d.helperProportions;
                this.instance.offset.click = d.offset.click;
                this.instance._intersectsWith(this.instance.containerCache) ? (this.instance.isOver || (this.instance.isOver = 1,
                this.instance.currentItem = a(e).clone().removeAttr("id").appendTo(this.instance.element).data("sortable-item", !0),
                this.instance.options._helper = this.instance.options.helper,
                this.instance.options.helper = function() {
                    return c.helper[0]
                }
                ,
                b.target = this.instance.currentItem[0],
                this.instance._mouseCapture(b, !0),
                this.instance._mouseStart(b, !0, !0),
                this.instance.offset.click.top = d.offset.click.top,
                this.instance.offset.click.left = d.offset.click.left,
                this.instance.offset.parent.left -= d.offset.parent.left - this.instance.offset.parent.left,
                this.instance.offset.parent.top -= d.offset.parent.top - this.instance.offset.parent.top,
                d._trigger("toSortable", b),
                d.dropped = this.instance.element,
                d.currentItem = d.element,
                this.instance.fromOutside = d),
                this.instance.currentItem && this.instance._mouseDrag(b)) : this.instance.isOver && (this.instance.isOver = 0,
                this.instance.cancelHelperRemoval = !0,
                this.instance.options.revert = !1,
                this.instance._trigger("out", b, this.instance._uiHash(this.instance)),
                this.instance._mouseStop(b, !0),
                this.instance.options.helper = this.instance.options._helper,
                this.instance.currentItem.remove(),
                this.instance.placeholder && this.instance.placeholder.remove(),
                d._trigger("fromSortable", b),
                d.dropped = !1)
            })
        }
    });
    a.ui.plugin.add("draggable", "cursor", {
        start: function() {
            var b = a("body")
              , c = a(this).data("draggable").options;
            b.css("cursor") && (c._cursor = b.css("cursor"));
            b.css("cursor", c.cursor)
        },
        stop: function() {
            var b = a(this).data("draggable").options;
            b._cursor && a("body").css("cursor", b._cursor)
        }
    });
    a.ui.plugin.add("draggable", "opacity", {
        start: function(b, c) {
            var d = a(c.helper)
              , e = a(this).data("draggable").options;
            d.css("opacity") && (e._opacity = d.css("opacity"));
            d.css("opacity", e.opacity)
        },
        stop: function(b, c) {
            var d = a(this).data("draggable").options;
            d._opacity && a(c.helper).css("opacity", d._opacity)
        }
    });
    a.ui.plugin.add("draggable", "scroll", {
        start: function() {
            var b = a(this).data("draggable");
            b.scrollParent[0] != document && "HTML" != b.scrollParent[0].tagName && (b.overflowOffset = b.scrollParent.offset())
        },
        drag: function(b) {
            var c = a(this).data("draggable")
              , d = c.options
              , e = !1;
            if (c.scrollParent[0] != document && "HTML" != c.scrollParent[0].tagName) {
                if (!d.axis || "x" != d.axis)
                    c.overflowOffset.top + c.scrollParent[0].offsetHeight - b.pageY < d.scrollSensitivity ? c.scrollParent[0].scrollTop = e = c.scrollParent[0].scrollTop + d.scrollSpeed : b.pageY - c.overflowOffset.top < d.scrollSensitivity && (c.scrollParent[0].scrollTop = e = c.scrollParent[0].scrollTop - d.scrollSpeed);
                if (!d.axis || "y" != d.axis)
                    c.overflowOffset.left + c.scrollParent[0].offsetWidth - b.pageX < d.scrollSensitivity ? c.scrollParent[0].scrollLeft = e = c.scrollParent[0].scrollLeft + d.scrollSpeed : b.pageX - c.overflowOffset.left < d.scrollSensitivity && (c.scrollParent[0].scrollLeft = e = c.scrollParent[0].scrollLeft - d.scrollSpeed)
            } else {
                if (!d.axis || "x" != d.axis)
                    b.pageY - a(document).scrollTop() < d.scrollSensitivity ? e = a(document).scrollTop(a(document).scrollTop() - d.scrollSpeed) : a(window).height() - (b.pageY - a(document).scrollTop()) < d.scrollSensitivity && (e = a(document).scrollTop(a(document).scrollTop() + d.scrollSpeed));
                if (!d.axis || "y" != d.axis)
                    b.pageX - a(document).scrollLeft() < d.scrollSensitivity ? e = a(document).scrollLeft(a(document).scrollLeft() - d.scrollSpeed) : a(window).width() - (b.pageX - a(document).scrollLeft()) < d.scrollSensitivity && (e = a(document).scrollLeft(a(document).scrollLeft() + d.scrollSpeed))
            }
            !1 !== e && a.ui.ddmanager && !d.dropBehaviour && a.ui.ddmanager.prepareOffsets(c, b)
        }
    });
    a.ui.plugin.add("draggable", "snap", {
        start: function() {
            var b = a(this).data("draggable")
              , c = b.options;
            b.snapElements = [];
            a(c.snap.constructor != String ? c.snap.items || ":data(draggable)" : c.snap).each(function() {
                var c = a(this)
                  , e = c.offset();
                this != b.element[0] && b.snapElements.push({
                    item: this,
                    width: c.outerWidth(),
                    height: c.outerHeight(),
                    top: e.top,
                    left: e.left
                })
            })
        },
        drag: function(b, c) {
            for (var d = a(this).data("draggable"), e = d.options, f = e.snapTolerance, g = c.offset.left, h = g + d.helperProportions.width, i = c.offset.top, j = i + d.helperProportions.height, k = d.snapElements.length - 1; 0 <= k; k--) {
                var n = d.snapElements[k].left
                  , p = n + d.snapElements[k].width
                  , o = d.snapElements[k].top
                  , r = o + d.snapElements[k].height;
                if (n - f < g && g < p + f && o - f < i && i < r + f || n - f < g && g < p + f && o - f < j && j < r + f || n - f < h && h < p + f && o - f < i && i < r + f || n - f < h && h < p + f && o - f < j && j < r + f) {
                    if ("inner" != e.snapMode) {
                        var q = Math.abs(o - j) <= f
                          , s = Math.abs(r - i) <= f
                          , t = Math.abs(n - h) <= f
                          , v = Math.abs(p - g) <= f;
                        q && (c.position.top = d._convertPositionTo("relative", {
                            top: o - d.helperProportions.height,
                            left: 0
                        }).top - d.margins.top);
                        s && (c.position.top = d._convertPositionTo("relative", {
                            top: r,
                            left: 0
                        }).top - d.margins.top);
                        t && (c.position.left = d._convertPositionTo("relative", {
                            top: 0,
                            left: n - d.helperProportions.width
                        }).left - d.margins.left);
                        v && (c.position.left = d._convertPositionTo("relative", {
                            top: 0,
                            left: p
                        }).left - d.margins.left)
                    }
                    var x = q || s || t || v;
                    "outer" != e.snapMode && (q = Math.abs(o - i) <= f,
                    s = Math.abs(r - j) <= f,
                    t = Math.abs(n - g) <= f,
                    v = Math.abs(p - h) <= f,
                    q && (c.position.top = d._convertPositionTo("relative", {
                        top: o,
                        left: 0
                    }).top - d.margins.top),
                    s && (c.position.top = d._convertPositionTo("relative", {
                        top: r - d.helperProportions.height,
                        left: 0
                    }).top - d.margins.top),
                    t && (c.position.left = d._convertPositionTo("relative", {
                        top: 0,
                        left: n
                    }).left - d.margins.left),
                    v && (c.position.left = d._convertPositionTo("relative", {
                        top: 0,
                        left: p - d.helperProportions.width
                    }).left - d.margins.left));
                    !d.snapElements[k].snapping && (q || s || t || v || x) && d.options.snap.snap && d.options.snap.snap.call(d.element, b, a.extend(d._uiHash(), {
                        snapItem: d.snapElements[k].item
                    }));
                    d.snapElements[k].snapping = q || s || t || v || x
                } else
                    d.snapElements[k].snapping && d.options.snap.release && d.options.snap.release.call(d.element, b, a.extend(d._uiHash(), {
                        snapItem: d.snapElements[k].item
                    })),
                    d.snapElements[k].snapping = !1
            }
        }
    });
    a.ui.plugin.add("draggable", "stack", {
        start: function() {
            var b = a(this).data("draggable").options
              , b = a.makeArray(a(b.stack)).sort(function(b, c) {
                return (parseInt(a(b).css("zIndex"), 10) || 0) - (parseInt(a(c).css("zIndex"), 10) || 0)
            });
            if (b.length) {
                var c = parseInt(b[0].style.zIndex) || 0;
                a(b).each(function(a) {
                    this.style.zIndex = c + a
                });
                this[0].style.zIndex = c + b.length
            }
        }
    });
    a.ui.plugin.add("draggable", "zIndex", {
        start: function(b, c) {
            var d = a(c.helper)
              , e = a(this).data("draggable").options;
            d.css("zIndex") && (e._zIndex = d.css("zIndex"));
            d.css("zIndex", e.zIndex)
        },
        stop: function(b, c) {
            var d = a(this).data("draggable").options;
            d._zIndex && a(c.helper).css("zIndex", d._zIndex)
        }
    })
}
)(jQuery);
(function(a) {
    a.widget("ui.droppable", {
        widgetEventPrefix: "drop",
        options: {
            accept: "*",
            activeClass: !1,
            addClasses: !0,
            greedy: !1,
            hoverClass: !1,
            scope: "default",
            tolerance: "intersect"
        },
        _create: function() {
            var b = this.options
              , c = b.accept;
            this.isover = 0;
            this.isout = 1;
            this.accept = a.isFunction(c) ? c : function(a) {
                return a.is(c)
            }
            ;
            this.proportions = {
                width: this.element[0].offsetWidth,
                height: this.element[0].offsetHeight
            };
            a.ui.ddmanager.droppables[b.scope] = a.ui.ddmanager.droppables[b.scope] || [];
            a.ui.ddmanager.droppables[b.scope].push(this);
            b.addClasses && this.element.addClass("ui-droppable")
        },
        destroy: function() {
            for (var b = a.ui.ddmanager.droppables[this.options.scope], c = 0; c < b.length; c++)
                b[c] == this && b.splice(c, 1);
            return this.element.removeClass("ui-droppable ui-droppable-disabled").removeData("droppable").unbind(".droppable"),
            this
        },
        _setOption: function(b, c) {
            "accept" == b && (this.accept = a.isFunction(c) ? c : function(a) {
                return a.is(c)
            }
            );
            a.Widget.prototype._setOption.apply(this, arguments)
        },
        _activate: function(b) {
            var c = a.ui.ddmanager.current;
            this.options.activeClass && this.element.addClass(this.options.activeClass);
            c && this._trigger("activate", b, this.ui(c))
        },
        _deactivate: function(b) {
            var c = a.ui.ddmanager.current;
            this.options.activeClass && this.element.removeClass(this.options.activeClass);
            c && this._trigger("deactivate", b, this.ui(c))
        },
        _over: function(b) {
            var c = a.ui.ddmanager.current;
            if (c && (c.currentItem || c.element)[0] != this.element[0])
                this.accept.call(this.element[0], c.currentItem || c.element) && (this.options.hoverClass && this.element.addClass(this.options.hoverClass),
                this._trigger("over", b, this.ui(c)))
        },
        _out: function(b) {
            var c = a.ui.ddmanager.current;
            if (c && (c.currentItem || c.element)[0] != this.element[0])
                this.accept.call(this.element[0], c.currentItem || c.element) && (this.options.hoverClass && this.element.removeClass(this.options.hoverClass),
                this._trigger("out", b, this.ui(c)))
        },
        _drop: function(b, c) {
            var d = c || a.ui.ddmanager.current;
            if (!d || (d.currentItem || d.element)[0] == this.element[0])
                return !1;
            var e = !1;
            return this.element.find(":data(droppable)").not(".ui-draggable-dragging").each(function() {
                var b = a.data(this, "droppable");
                if (b.options.greedy && !b.options.disabled && b.options.scope == d.options.scope && b.accept.call(b.element[0], d.currentItem || d.element) && a.ui.intersect(d, a.extend(b, {
                    offset: b.element.offset()
                }), b.options.tolerance))
                    return e = !0,
                    !1
            }),
            e ? !1 : this.accept.call(this.element[0], d.currentItem || d.element) ? (this.options.activeClass && this.element.removeClass(this.options.activeClass),
            this.options.hoverClass && this.element.removeClass(this.options.hoverClass),
            this._trigger("drop", b, this.ui(d)),
            this.element) : !1
        },
        ui: function(a) {
            return {
                draggable: a.currentItem || a.element,
                helper: a.helper,
                position: a.position,
                offset: a.positionAbs
            }
        }
    });
    a.extend(a.ui.droppable, {
        version: "1.8.23"
    });
    a.ui.intersect = function(b, c, d) {
        if (!c.offset)
            return !1;
        var e = (b.positionAbs || b.position.absolute).left
          , f = e + b.helperProportions.width
          , g = (b.positionAbs || b.position.absolute).top
          , h = g + b.helperProportions.height
          , i = c.offset.left
          , j = i + c.proportions.width
          , k = c.offset.top
          , n = k + c.proportions.height;
        switch (d) {
        case "fit":
            return i <= e && f <= j && k <= g && h <= n;
        case "intersect":
            return i < e + b.helperProportions.width / 2 && f - b.helperProportions.width / 2 < j && k < g + b.helperProportions.height / 2 && h - b.helperProportions.height / 2 < n;
        case "pointer":
            return a.ui.isOver((b.positionAbs || b.position.absolute).top + (b.clickOffset || b.offset.click).top, (b.positionAbs || b.position.absolute).left + (b.clickOffset || b.offset.click).left, k, i, c.proportions.height, c.proportions.width);
        case "touch":
            return (g >= k && g <= n || h >= k && h <= n || g < k && h > n) && (e >= i && e <= j || f >= i && f <= j || e < i && f > j);
        default:
            return !1
        }
    }
    ;
    a.ui.ddmanager = {
        current: null,
        droppables: {
            "default": []
        },
        prepareOffsets: function(b, c) {
            var d = a.ui.ddmanager.droppables[b.options.scope] || []
              , e = c ? c.type : null
              , f = (b.currentItem || b.element).find(":data(droppable)").andSelf()
              , g = 0;
            a: for (; g < d.length; g++)
                if (!(d[g].options.disabled || b && !d[g].accept.call(d[g].element[0], b.currentItem || b.element))) {
                    for (var h = 0; h < f.length; h++)
                        if (f[h] == d[g].element[0]) {
                            d[g].proportions.height = 0;
                            continue a
                        }
                    d[g].visible = "none" != d[g].element.css("display");
                    d[g].visible && ("mousedown" == e && d[g]._activate.call(d[g], c),
                    d[g].offset = d[g].element.offset(),
                    d[g].proportions = {
                        width: d[g].element[0].offsetWidth,
                        height: d[g].element[0].offsetHeight
                    })
                }
        },
        drop: function(b, c) {
            var d = !1;
            return a.each(a.ui.ddmanager.droppables[b.options.scope] || [], function() {
                this.options && (!this.options.disabled && this.visible && a.ui.intersect(b, this, this.options.tolerance) && (d = this._drop.call(this, c) || d),
                !this.options.disabled && this.visible && this.accept.call(this.element[0], b.currentItem || b.element) && (this.isout = 1,
                this.isover = 0,
                this._deactivate.call(this, c)))
            }),
            d
        },
        dragStart: function(b, c) {
            b.element.parents(":not(body,html)").bind("scroll.droppable", function() {
                b.options.refreshPositions || a.ui.ddmanager.prepareOffsets(b, c)
            })
        },
        drag: function(b, c) {
            b.options.refreshPositions && a.ui.ddmanager.prepareOffsets(b, c);
            a.each(a.ui.ddmanager.droppables[b.options.scope] || [], function() {
                if (!this.options.disabled && !this.greedyChild && this.visible) {
                    var d = a.ui.intersect(b, this, this.options.tolerance);
                    if (d = !d && 1 == this.isover ? "isout" : d && 0 == this.isover ? "isover" : null) {
                        var e;
                        if (this.options.greedy) {
                            var f = this.element.parents(":data(droppable):eq(0)");
                            f.length && (e = a.data(f[0], "droppable"),
                            e.greedyChild = "isover" == d ? 1 : 0)
                        }
                        e && "isover" == d && (e.isover = 0,
                        e.isout = 1,
                        e._out.call(e, c));
                        this[d] = 1;
                        this["isout" == d ? "isover" : "isout"] = 0;
                        this["isover" == d ? "_over" : "_out"].call(this, c);
                        e && "isout" == d && (e.isout = 0,
                        e.isover = 1,
                        e._over.call(e, c))
                    }
                }
            })
        },
        dragStop: function(b, c) {
            b.element.parents(":not(body,html)").unbind("scroll.droppable");
            b.options.refreshPositions || a.ui.ddmanager.prepareOffsets(b, c)
        }
    }
}
)(jQuery);
(function(a) {
    a.widget("ui.sortable", a.ui.mouse, {
        widgetEventPrefix: "sort",
        ready: !1,
        options: {
            appendTo: "parent",
            axis: !1,
            connectWith: !1,
            containment: !1,
            cursor: "auto",
            cursorAt: !1,
            dropOnEmpty: !0,
            forcePlaceholderSize: !1,
            forceHelperSize: !1,
            grid: !1,
            handle: !1,
            helper: "original",
            items: "> *",
            opacity: !1,
            placeholder: !1,
            revert: !1,
            scroll: !0,
            scrollSensitivity: 20,
            scrollSpeed: 20,
            scope: "default",
            tolerance: "intersect",
            zIndex: 1E3
        },
        _create: function() {
            var a = this.options;
            this.containerCache = {};
            this.element.addClass("ui-sortable");
            this.refresh();
            this.floating = this.items.length ? "x" === a.axis || /left|right/.test(this.items[0].item.css("float")) || /inline|table-cell/.test(this.items[0].item.css("display")) : !1;
            this.offset = this.element.offset();
            this._mouseInit();
            this.ready = !0
        },
        destroy: function() {
            a.Widget.prototype.destroy.call(this);
            this.element.removeClass("ui-sortable ui-sortable-disabled");
            this._mouseDestroy();
            for (var b = this.items.length - 1; 0 <= b; b--)
                this.items[b].item.removeData(this.widgetName + "-item");
            return this
        },
        _setOption: function(b, c) {
            "disabled" === b ? (this.options[b] = c,
            this.widget()[c ? "addClass" : "removeClass"]("ui-sortable-disabled")) : a.Widget.prototype._setOption.apply(this, arguments)
        },
        _mouseCapture: function(b, c) {
            var d = this;
            if (this.reverting || this.options.disabled || "static" == this.options.type)
                return !1;
            this._refreshItems(b);
            var e = null
              , f = this;
            a(b.target).parents().each(function() {
                if (a.data(this, d.widgetName + "-item") == f)
                    return e = a(this),
                    !1
            });
            a.data(b.target, d.widgetName + "-item") == f && (e = a(b.target));
            if (!e)
                return !1;
            if (this.options.handle && !c) {
                var g = !1;
                a(this.options.handle, e).find("*").andSelf().each(function() {
                    this == b.target && (g = !0)
                });
                if (!g)
                    return !1
            }
            return this.currentItem = e,
            this._removeCurrentsFromItems(),
            !0
        },
        _mouseStart: function(b, c, d) {
            c = this.options;
            this.currentContainer = this;
            this.refreshPositions();
            this.helper = this._createHelper(b);
            this._cacheHelperProportions();
            this._cacheMargins();
            this.scrollParent = this.helper.scrollParent();
            this.offset = this.currentItem.offset();
            this.offset = {
                top: this.offset.top - this.margins.top,
                left: this.offset.left - this.margins.left
            };
            a.extend(this.offset, {
                click: {
                    left: b.pageX - this.offset.left,
                    top: b.pageY - this.offset.top
                },
                parent: this._getParentOffset(),
                relative: this._getRelativeOffset()
            });
            this.helper.css("position", "absolute");
            this.cssPosition = this.helper.css("position");
            this.originalPosition = this._generatePosition(b);
            this.originalPageX = b.pageX;
            this.originalPageY = b.pageY;
            c.cursorAt && this._adjustOffsetFromHelper(c.cursorAt);
            this.domPosition = {
                prev: this.currentItem.prev()[0],
                parent: this.currentItem.parent()[0]
            };
            this.helper[0] != this.currentItem[0] && this.currentItem.hide();
            this._createPlaceholder();
            c.containment && this._setContainment();
            c.cursor && (a("body").css("cursor") && (this._storedCursor = a("body").css("cursor")),
            a("body").css("cursor", c.cursor));
            c.opacity && (this.helper.css("opacity") && (this._storedOpacity = this.helper.css("opacity")),
            this.helper.css("opacity", c.opacity));
            c.zIndex && (this.helper.css("zIndex") && (this._storedZIndex = this.helper.css("zIndex")),
            this.helper.css("zIndex", c.zIndex));
            this.scrollParent[0] != document && "HTML" != this.scrollParent[0].tagName && (this.overflowOffset = this.scrollParent.offset());
            this._trigger("start", b, this._uiHash());
            this._preserveHelperProportions || this._cacheHelperProportions();
            if (!d)
                for (d = this.containers.length - 1; 0 <= d; d--)
                    this.containers[d]._trigger("activate", b, this._uiHash(this));
            return a.ui.ddmanager && (a.ui.ddmanager.current = this),
            a.ui.ddmanager && !c.dropBehaviour && a.ui.ddmanager.prepareOffsets(this, b),
            this.dragging = !0,
            this.helper.addClass("ui-sortable-helper"),
            this._mouseDrag(b),
            !0
        },
        _mouseDrag: function(b) {
            this.position = this._generatePosition(b);
            this.positionAbs = this._convertPositionTo("absolute");
            this.lastPositionAbs || (this.lastPositionAbs = this.positionAbs);
            if (this.options.scroll) {
                var c = this.options
                  , d = !1;
                this.scrollParent[0] != document && "HTML" != this.scrollParent[0].tagName ? (this.overflowOffset.top + this.scrollParent[0].offsetHeight - b.pageY < c.scrollSensitivity ? this.scrollParent[0].scrollTop = d = this.scrollParent[0].scrollTop + c.scrollSpeed : b.pageY - this.overflowOffset.top < c.scrollSensitivity && (this.scrollParent[0].scrollTop = d = this.scrollParent[0].scrollTop - c.scrollSpeed),
                this.overflowOffset.left + this.scrollParent[0].offsetWidth - b.pageX < c.scrollSensitivity ? this.scrollParent[0].scrollLeft = d = this.scrollParent[0].scrollLeft + c.scrollSpeed : b.pageX - this.overflowOffset.left < c.scrollSensitivity && (this.scrollParent[0].scrollLeft = d = this.scrollParent[0].scrollLeft - c.scrollSpeed)) : (b.pageY - a(document).scrollTop() < c.scrollSensitivity ? d = a(document).scrollTop(a(document).scrollTop() - c.scrollSpeed) : a(window).height() - (b.pageY - a(document).scrollTop()) < c.scrollSensitivity && (d = a(document).scrollTop(a(document).scrollTop() + c.scrollSpeed)),
                b.pageX - a(document).scrollLeft() < c.scrollSensitivity ? d = a(document).scrollLeft(a(document).scrollLeft() - c.scrollSpeed) : a(window).width() - (b.pageX - a(document).scrollLeft()) < c.scrollSensitivity && (d = a(document).scrollLeft(a(document).scrollLeft() + c.scrollSpeed)));
                !1 !== d && a.ui.ddmanager && !c.dropBehaviour && a.ui.ddmanager.prepareOffsets(this, b)
            }
            this.positionAbs = this._convertPositionTo("absolute");
            if (!this.options.axis || "y" != this.options.axis)
                this.helper[0].style.left = this.position.left + "px";
            if (!this.options.axis || "x" != this.options.axis)
                this.helper[0].style.top = this.position.top + "px";
            for (c = this.items.length - 1; 0 <= c; c--) {
                var d = this.items[c]
                  , e = d.item[0]
                  , f = this._intersectsWithPointer(d);
                if (f && e != this.currentItem[0] && this.placeholder[1 == f ? "next" : "prev"]()[0] != e && !a.ui.contains(this.placeholder[0], e) && ("semi-dynamic" == this.options.type ? !a.ui.contains(this.element[0], e) : 1)) {
                    this.direction = 1 == f ? "down" : "up";
                    if ("pointer" == this.options.tolerance || this._intersectsWithSides(d))
                        this._rearrange(b, d);
                    else
                        break;
                    this._trigger("change", b, this._uiHash());
                    break
                }
            }
            return this._contactContainers(b),
            a.ui.ddmanager && a.ui.ddmanager.drag(this, b),
            this._trigger("sort", b, this._uiHash()),
            this.lastPositionAbs = this.positionAbs,
            !1
        },
        _mouseStop: function(b, c) {
            if (b) {
                a.ui.ddmanager && !this.options.dropBehaviour && a.ui.ddmanager.drop(this, b);
                if (this.options.revert) {
                    var d = this
                      , e = d.placeholder.offset();
                    d.reverting = !0;
                    a(this.helper).animate({
                        left: e.left - this.offset.parent.left - d.margins.left + (this.offsetParent[0] == document.body ? 0 : this.offsetParent[0].scrollLeft),
                        top: e.top - this.offset.parent.top - d.margins.top + (this.offsetParent[0] == document.body ? 0 : this.offsetParent[0].scrollTop)
                    }, parseInt(this.options.revert, 10) || 500, function() {
                        d._clear(b)
                    })
                } else
                    this._clear(b, c);
                return !1
            }
        },
        cancel: function() {
            if (this.dragging) {
                this._mouseUp({
                    target: null
                });
                "original" == this.options.helper ? this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper") : this.currentItem.show();
                for (var b = this.containers.length - 1; 0 <= b; b--)
                    this.containers[b]._trigger("deactivate", null, this._uiHash(this)),
                    this.containers[b].containerCache.over && (this.containers[b]._trigger("out", null, this._uiHash(this)),
                    this.containers[b].containerCache.over = 0)
            }
            return this.placeholder && (this.placeholder[0].parentNode && this.placeholder[0].parentNode.removeChild(this.placeholder[0]),
            "original" != this.options.helper && this.helper && this.helper[0].parentNode && this.helper.remove(),
            a.extend(this, {
                helper: null,
                dragging: !1,
                reverting: !1,
                _noFinalSort: null
            }),
            this.domPosition.prev ? a(this.domPosition.prev).after(this.currentItem) : a(this.domPosition.parent).prepend(this.currentItem)),
            this
        },
        serialize: function(b) {
            var c = this._getItemsAsjQuery(b && b.connected)
              , d = [];
            return b = b || {},
            a(c).each(function() {
                var c = (a(b.item || this).attr(b.attribute || "id") || "").match(b.expression || /(.+)[-=_](.+)/);
                c && d.push((b.key || c[1] + "[]") + "=" + (b.key && b.expression ? c[1] : c[2]))
            }),
            !d.length && b.key && d.push(b.key + "="),
            d.join("&")
        },
        toArray: function(b) {
            var c = this._getItemsAsjQuery(b && b.connected)
              , d = [];
            return b = b || {},
            c.each(function() {
                d.push(a(b.item || this).attr(b.attribute || "id") || "")
            }),
            d
        },
        _intersectsWith: function(a) {
            var c = this.positionAbs.left
              , d = c + this.helperProportions.width
              , e = this.positionAbs.top
              , f = e + this.helperProportions.height
              , g = a.left
              , h = g + a.width
              , i = a.top
              , j = i + a.height
              , k = this.offset.click.top
              , n = this.offset.click.left;
            return "pointer" == this.options.tolerance || this.options.forcePointerForContainers || "pointer" != this.options.tolerance && this.helperProportions[this.floating ? "width" : "height"] > a[this.floating ? "width" : "height"] ? e + k > i && e + k < j && c + n > g && c + n < h : g < c + this.helperProportions.width / 2 && d - this.helperProportions.width / 2 < h && i < e + this.helperProportions.height / 2 && f - this.helperProportions.height / 2 < j
        },
        _intersectsWithPointer: function(b) {
            var c = "x" === this.options.axis || a.ui.isOverAxis(this.positionAbs.top + this.offset.click.top, b.top, b.height)
              , b = "y" === this.options.axis || a.ui.isOverAxis(this.positionAbs.left + this.offset.click.left, b.left, b.width)
              , c = c && b
              , b = this._getDragVerticalDirection()
              , d = this._getDragHorizontalDirection();
            return c ? this.floating ? d && "right" == d || "down" == b ? 2 : 1 : b && ("down" == b ? 2 : 1) : !1
        },
        _intersectsWithSides: function(b) {
            var c = a.ui.isOverAxis(this.positionAbs.top + this.offset.click.top, b.top + b.height / 2, b.height)
              , b = a.ui.isOverAxis(this.positionAbs.left + this.offset.click.left, b.left + b.width / 2, b.width)
              , d = this._getDragVerticalDirection()
              , e = this._getDragHorizontalDirection();
            return this.floating && e ? "right" == e && b || "left" == e && !b : d && ("down" == d && c || "up" == d && !c)
        },
        _getDragVerticalDirection: function() {
            var a = this.positionAbs.top - this.lastPositionAbs.top;
            return 0 != a && (0 < a ? "down" : "up")
        },
        _getDragHorizontalDirection: function() {
            var a = this.positionAbs.left - this.lastPositionAbs.left;
            return 0 != a && (0 < a ? "right" : "left")
        },
        refresh: function(a) {
            return this._refreshItems(a),
            this.refreshPositions(),
            this
        },
        _connectWith: function() {
            var a = this.options;
            return a.connectWith.constructor == String ? [a.connectWith] : a.connectWith
        },
        _getItemsAsjQuery: function(b) {
            var c = []
              , d = []
              , e = this._connectWith();
            if (e && b)
                for (b = e.length - 1; 0 <= b; b--)
                    for (var f = a(e[b]), g = f.length - 1; 0 <= g; g--) {
                        var h = a.data(f[g], this.widgetName);
                        h && h != this && !h.options.disabled && d.push([a.isFunction(h.options.items) ? h.options.items.call(h.element) : a(h.options.items, h.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"), h])
                    }
            d.push([a.isFunction(this.options.items) ? this.options.items.call(this.element, null, {
                options: this.options,
                item: this.currentItem
            }) : a(this.options.items, this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"), this]);
            for (b = d.length - 1; 0 <= b; b--)
                d[b][0].each(function() {
                    c.push(this)
                });
            return a(c)
        },
        _removeCurrentsFromItems: function() {
            for (var a = this.currentItem.find(":data(" + this.widgetName + "-item)"), c = 0; c < this.items.length; c++)
                for (var d = 0; d < a.length; d++)
                    a[d] == this.items[c].item[0] && this.items.splice(c, 1)
        },
        _refreshItems: function(b) {
            this.items = [];
            this.containers = [this];
            var c = this.items
              , d = [[a.isFunction(this.options.items) ? this.options.items.call(this.element[0], b, {
                item: this.currentItem
            }) : a(this.options.items, this.element), this]]
              , e = this._connectWith();
            if (e && this.ready)
                for (var f = e.length - 1; 0 <= f; f--)
                    for (var g = a(e[f]), h = g.length - 1; 0 <= h; h--) {
                        var i = a.data(g[h], this.widgetName);
                        i && i != this && !i.options.disabled && (d.push([a.isFunction(i.options.items) ? i.options.items.call(i.element[0], b, {
                            item: this.currentItem
                        }) : a(i.options.items, i.element), i]),
                        this.containers.push(i))
                    }
            for (f = d.length - 1; 0 <= f; f--) {
                b = d[f][1];
                e = d[f][0];
                h = 0;
                for (g = e.length; h < g; h++)
                    i = a(e[h]),
                    i.data(this.widgetName + "-item", b),
                    c.push({
                        item: i,
                        instance: b,
                        width: 0,
                        height: 0,
                        left: 0,
                        top: 0
                    })
            }
        },
        refreshPositions: function(b) {
            this.offsetParent && this.helper && (this.offset.parent = this._getParentOffset());
            for (var c = this.items.length - 1; 0 <= c; c--) {
                var d = this.items[c];
                if (!(d.instance != this.currentContainer && this.currentContainer && d.item[0] != this.currentItem[0])) {
                    var e = this.options.toleranceElement ? a(this.options.toleranceElement, d.item) : d.item;
                    b || (d.width = e.outerWidth(),
                    d.height = e.outerHeight());
                    e = e.offset();
                    d.left = e.left;
                    d.top = e.top
                }
            }
            if (this.options.custom && this.options.custom.refreshContainers)
                this.options.custom.refreshContainers.call(this);
            else
                for (c = this.containers.length - 1; 0 <= c; c--)
                    e = this.containers[c].element.offset(),
                    this.containers[c].containerCache.left = e.left,
                    this.containers[c].containerCache.top = e.top,
                    this.containers[c].containerCache.width = this.containers[c].element.outerWidth(),
                    this.containers[c].containerCache.height = this.containers[c].element.outerHeight();
            return this
        },
        _createPlaceholder: function(b) {
            var c = b || this
              , d = c.options;
            if (!d.placeholder || d.placeholder.constructor == String) {
                var e = d.placeholder;
                d.placeholder = {
                    element: function() {
                        var b = a(document.createElement(c.currentItem[0].nodeName)).addClass(e || c.currentItem[0].className + " ui-sortable-placeholder").removeClass("ui-sortable-helper")[0];
                        return e || (b.style.visibility = "hidden"),
                        b
                    },
                    update: function(a, b) {
                        if (!e || d.forcePlaceholderSize)
                            b.height() || b.height(c.currentItem.innerHeight() - parseInt(c.currentItem.css("paddingTop") || 0, 10) - parseInt(c.currentItem.css("paddingBottom") || 0, 10)),
                            b.width() || b.width(c.currentItem.innerWidth() - parseInt(c.currentItem.css("paddingLeft") || 0, 10) - parseInt(c.currentItem.css("paddingRight") || 0, 10))
                    }
                }
            }
            c.placeholder = a(d.placeholder.element.call(c.element, c.currentItem));
            c.currentItem.after(c.placeholder);
            d.placeholder.update(c, c.placeholder)
        },
        _contactContainers: function(b) {
            for (var c = null, d = null, e = this.containers.length - 1; 0 <= e; e--)
                if (!a.ui.contains(this.currentItem[0], this.containers[e].element[0]))
                    if (this._intersectsWith(this.containers[e].containerCache)) {
                        if (!c || !a.ui.contains(this.containers[e].element[0], c.element[0]))
                            c = this.containers[e],
                            d = e
                    } else
                        this.containers[e].containerCache.over && (this.containers[e]._trigger("out", b, this._uiHash(this)),
                        this.containers[e].containerCache.over = 0);
            if (c)
                if (1 === this.containers.length)
                    this.containers[d]._trigger("over", b, this._uiHash(this)),
                    this.containers[d].containerCache.over = 1;
                else if (this.currentContainer != this.containers[d]) {
                    for (var c = 1E4, e = null, f = this.positionAbs[this.containers[d].floating ? "left" : "top"], g = this.items.length - 1; 0 <= g; g--)
                        if (a.ui.contains(this.containers[d].element[0], this.items[g].item[0])) {
                            var h = this.containers[d].floating ? this.items[g].item.offset().left : this.items[g].item.offset().top;
                            Math.abs(h - f) < c && (c = Math.abs(h - f),
                            e = this.items[g],
                            this.direction = 0 < h - f ? "down" : "up")
                        }
                    if (e || this.options.dropOnEmpty)
                        this.currentContainer = this.containers[d],
                        e ? this._rearrange(b, e, null, !0) : this._rearrange(b, null, this.containers[d].element, !0),
                        this._trigger("change", b, this._uiHash()),
                        this.containers[d]._trigger("change", b, this._uiHash(this)),
                        this.options.placeholder.update(this.currentContainer, this.placeholder),
                        this.containers[d]._trigger("over", b, this._uiHash(this)),
                        this.containers[d].containerCache.over = 1
                }
        },
        _createHelper: function(b) {
            var c = this.options
              , b = a.isFunction(c.helper) ? a(c.helper.apply(this.element[0], [b, this.currentItem])) : "clone" == c.helper ? this.currentItem.clone() : this.currentItem;
            return b.parents("body").length || a("parent" != c.appendTo ? c.appendTo : this.currentItem[0].parentNode)[0].appendChild(b[0]),
            b[0] == this.currentItem[0] && (this._storedCSS = {
                width: this.currentItem[0].style.width,
                height: this.currentItem[0].style.height,
                position: this.currentItem.css("position"),
                top: this.currentItem.css("top"),
                left: this.currentItem.css("left")
            }),
            ("" == b[0].style.width || c.forceHelperSize) && b.width(this.currentItem.width()),
            ("" == b[0].style.height || c.forceHelperSize) && b.height(this.currentItem.height()),
            b
        },
        _adjustOffsetFromHelper: function(b) {
            "string" == typeof b && (b = b.split(" "));
            a.isArray(b) && (b = {
                left: +b[0],
                top: +b[1] || 0
            });
            "left"in b && (this.offset.click.left = b.left + this.margins.left);
            "right"in b && (this.offset.click.left = this.helperProportions.width - b.right + this.margins.left);
            "top"in b && (this.offset.click.top = b.top + this.margins.top);
            "bottom"in b && (this.offset.click.top = this.helperProportions.height - b.bottom + this.margins.top)
        },
        _getParentOffset: function() {
            this.offsetParent = this.helper.offsetParent();
            var b = this.offsetParent.offset();
            "absolute" == this.cssPosition && this.scrollParent[0] != document && a.ui.contains(this.scrollParent[0], this.offsetParent[0]) && (b.left += this.scrollParent.scrollLeft(),
            b.top += this.scrollParent.scrollTop());
            if (this.offsetParent[0] == document.body || this.offsetParent[0].tagName && "html" == this.offsetParent[0].tagName.toLowerCase() && a.browser.msie)
                b = {
                    top: 0,
                    left: 0
                };
            return {
                top: b.top + (parseInt(this.offsetParent.css("borderTopWidth"), 10) || 0),
                left: b.left + (parseInt(this.offsetParent.css("borderLeftWidth"), 10) || 0)
            }
        },
        _getRelativeOffset: function() {
            if ("relative" == this.cssPosition) {
                var a = this.currentItem.position();
                return {
                    top: a.top - (parseInt(this.helper.css("top"), 10) || 0) + this.scrollParent.scrollTop(),
                    left: a.left - (parseInt(this.helper.css("left"), 10) || 0) + this.scrollParent.scrollLeft()
                }
            }
            return {
                top: 0,
                left: 0
            }
        },
        _cacheMargins: function() {
            this.margins = {
                left: parseInt(this.currentItem.css("marginLeft"), 10) || 0,
                top: parseInt(this.currentItem.css("marginTop"), 10) || 0
            }
        },
        _cacheHelperProportions: function() {
            this.helperProportions = {
                width: this.helper.outerWidth(),
                height: this.helper.outerHeight()
            }
        },
        _setContainment: function() {
            var b = this.options;
            "parent" == b.containment && (b.containment = this.helper[0].parentNode);
            if ("document" == b.containment || "window" == b.containment)
                this.containment = [0 - this.offset.relative.left - this.offset.parent.left, 0 - this.offset.relative.top - this.offset.parent.top, a("document" == b.containment ? document : window).width() - this.helperProportions.width - this.margins.left, (a("document" == b.containment ? document : window).height() || document.body.parentNode.scrollHeight) - this.helperProportions.height - this.margins.top];
            if (!/^(document|window|parent)$/.test(b.containment)) {
                var c = a(b.containment)[0]
                  , b = a(b.containment).offset()
                  , d = "hidden" != a(c).css("overflow");
                this.containment = [b.left + (parseInt(a(c).css("borderLeftWidth"), 10) || 0) + (parseInt(a(c).css("paddingLeft"), 10) || 0) - this.margins.left, b.top + (parseInt(a(c).css("borderTopWidth"), 10) || 0) + (parseInt(a(c).css("paddingTop"), 10) || 0) - this.margins.top, b.left + (d ? Math.max(c.scrollWidth, c.offsetWidth) : c.offsetWidth) - (parseInt(a(c).css("borderLeftWidth"), 10) || 0) - (parseInt(a(c).css("paddingRight"), 10) || 0) - this.helperProportions.width - this.margins.left, b.top + (d ? Math.max(c.scrollHeight, c.offsetHeight) : c.offsetHeight) - (parseInt(a(c).css("borderTopWidth"), 10) || 0) - (parseInt(a(c).css("paddingBottom"), 10) || 0) - this.helperProportions.height - this.margins.top]
            }
        },
        _convertPositionTo: function(b, c) {
            c || (c = this.position);
            var d = "absolute" == b ? 1 : -1
              , e = "absolute" == this.cssPosition && (this.scrollParent[0] == document || !a.ui.contains(this.scrollParent[0], this.offsetParent[0])) ? this.offsetParent : this.scrollParent
              , f = /(html|body)/i.test(e[0].tagName);
            return {
                top: c.top + this.offset.relative.top * d + this.offset.parent.top * d - (a.browser.safari && "fixed" == this.cssPosition ? 0 : ("fixed" == this.cssPosition ? -this.scrollParent.scrollTop() : f ? 0 : e.scrollTop()) * d),
                left: c.left + this.offset.relative.left * d + this.offset.parent.left * d - (a.browser.safari && "fixed" == this.cssPosition ? 0 : ("fixed" == this.cssPosition ? -this.scrollParent.scrollLeft() : f ? 0 : e.scrollLeft()) * d)
            }
        },
        _generatePosition: function(b) {
            var c = this.options
              , d = "absolute" == this.cssPosition && (this.scrollParent[0] == document || !a.ui.contains(this.scrollParent[0], this.offsetParent[0])) ? this.offsetParent : this.scrollParent
              , e = /(html|body)/i.test(d[0].tagName);
            "relative" == this.cssPosition && (this.scrollParent[0] == document || this.scrollParent[0] == this.offsetParent[0]) && (this.offset.relative = this._getRelativeOffset());
            var f = b.pageX
              , g = b.pageY;
            this.originalPosition && (this.containment && (b.pageX - this.offset.click.left < this.containment[0] && (f = this.containment[0] + this.offset.click.left),
            b.pageY - this.offset.click.top < this.containment[1] && (g = this.containment[1] + this.offset.click.top),
            b.pageX - this.offset.click.left > this.containment[2] && (f = this.containment[2] + this.offset.click.left),
            b.pageY - this.offset.click.top > this.containment[3] && (g = this.containment[3] + this.offset.click.top)),
            c.grid && (g = this.originalPageY + Math.round((g - this.originalPageY) / c.grid[1]) * c.grid[1],
            g = this.containment ? g - this.offset.click.top < this.containment[1] || g - this.offset.click.top > this.containment[3] ? g - this.offset.click.top < this.containment[1] ? g + c.grid[1] : g - c.grid[1] : g : g,
            f = this.originalPageX + Math.round((f - this.originalPageX) / c.grid[0]) * c.grid[0],
            f = this.containment ? f - this.offset.click.left < this.containment[0] || f - this.offset.click.left > this.containment[2] ? f - this.offset.click.left < this.containment[0] ? f + c.grid[0] : f - c.grid[0] : f : f));
            return {
                top: g - this.offset.click.top - this.offset.relative.top - this.offset.parent.top + (a.browser.safari && "fixed" == this.cssPosition ? 0 : "fixed" == this.cssPosition ? -this.scrollParent.scrollTop() : e ? 0 : d.scrollTop()),
                left: f - this.offset.click.left - this.offset.relative.left - this.offset.parent.left + (a.browser.safari && "fixed" == this.cssPosition ? 0 : "fixed" == this.cssPosition ? -this.scrollParent.scrollLeft() : e ? 0 : d.scrollLeft())
            }
        },
        _rearrange: function(a, c, d, e) {
            d ? d[0].appendChild(this.placeholder[0]) : c.item[0].parentNode.insertBefore(this.placeholder[0], "down" == this.direction ? c.item[0] : c.item[0].nextSibling);
            this.counter = this.counter ? ++this.counter : 1;
            var f = this
              , g = this.counter;
            window.setTimeout(function() {
                g == f.counter && f.refreshPositions(!e)
            }, 0)
        },
        _clear: function(b, c) {
            this.reverting = !1;
            var d = [];
            !this._noFinalSort && this.currentItem.parent().length && this.placeholder.before(this.currentItem);
            this._noFinalSort = null;
            if (this.helper[0] == this.currentItem[0]) {
                for (var e in this._storedCSS)
                    if ("auto" == this._storedCSS[e] || "static" == this._storedCSS[e])
                        this._storedCSS[e] = "";
                this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")
            } else
                this.currentItem.show();
            this.fromOutside && !c && d.push(function(a) {
                this._trigger("receive", a, this._uiHash(this.fromOutside))
            });
            (this.fromOutside || this.domPosition.prev != this.currentItem.prev().not(".ui-sortable-helper")[0] || this.domPosition.parent != this.currentItem.parent()[0]) && !c && d.push(function(a) {
                this._trigger("update", a, this._uiHash())
            });
            if (!a.ui.contains(this.element[0], this.currentItem[0])) {
                c || d.push(function(a) {
                    this._trigger("remove", a, this._uiHash())
                });
                for (e = this.containers.length - 1; 0 <= e; e--)
                    a.ui.contains(this.containers[e].element[0], this.currentItem[0]) && !c && (d.push(function(a) {
                        return function(b) {
                            a._trigger("receive", b, this._uiHash(this))
                        }
                    }
                    .call(this, this.containers[e])),
                    d.push(function(a) {
                        return function(b) {
                            a._trigger("update", b, this._uiHash(this))
                        }
                    }
                    .call(this, this.containers[e])))
            }
            for (e = this.containers.length - 1; 0 <= e; e--)
                c || d.push(function(a) {
                    return function(b) {
                        a._trigger("deactivate", b, this._uiHash(this))
                    }
                }
                .call(this, this.containers[e])),
                this.containers[e].containerCache.over && (d.push(function(a) {
                    return function(b) {
                        a._trigger("out", b, this._uiHash(this))
                    }
                }
                .call(this, this.containers[e])),
                this.containers[e].containerCache.over = 0);
            this._storedCursor && a("body").css("cursor", this._storedCursor);
            this._storedOpacity && this.helper.css("opacity", this._storedOpacity);
            this._storedZIndex && this.helper.css("zIndex", "auto" == this._storedZIndex ? "" : this._storedZIndex);
            this.dragging = !1;
            if (this.cancelHelperRemoval) {
                if (!c) {
                    this._trigger("beforeStop", b, this._uiHash());
                    for (e = 0; e < d.length; e++)
                        d[e].call(this, b);
                    this._trigger("stop", b, this._uiHash())
                }
                return this.fromOutside = !1,
                !1
            }
            c || this._trigger("beforeStop", b, this._uiHash());
            this.placeholder[0].parentNode.removeChild(this.placeholder[0]);
            this.helper[0] != this.currentItem[0] && this.helper.remove();
            this.helper = null;
            if (!c) {
                for (e = 0; e < d.length; e++)
                    d[e].call(this, b);
                this._trigger("stop", b, this._uiHash())
            }
            return this.fromOutside = !1,
            !0
        },
        _trigger: function() {
            !1 === a.Widget.prototype._trigger.apply(this, arguments) && this.cancel()
        },
        _uiHash: function(b) {
            var c = b || this;
            return {
                helper: c.helper,
                placeholder: c.placeholder || a([]),
                position: c.position,
                originalPosition: c.originalPosition,
                offset: c.positionAbs,
                item: c.currentItem,
                sender: b ? b.element : null
            }
        }
    });
    a.extend(a.ui.sortable, {
        version: "1.8.23"
    })
}
)(jQuery);
(function(a) {
    var b = 0;
    a.widget("ui.autocomplete", {
        options: {
            appendTo: "body",
            autoFocus: !1,
            delay: 300,
            minLength: 1,
            position: {
                my: "left top",
                at: "left bottom",
                collision: "none"
            },
            source: null
        },
        pending: 0,
        _create: function() {
            var b = this, d = this.element[0].ownerDocument, e;
            this.isMultiLine = this.element.is("textarea");
            this.element.addClass("ui-autocomplete-input").attr("autocomplete", "off").attr({
                role: "textbox",
                "aria-autocomplete": "list",
                "aria-haspopup": "true"
            }).bind("keydown.autocomplete", function(d) {
                if (!b.options.disabled && !b.element.propAttr("readOnly")) {
                    e = !1;
                    var g = a.ui.keyCode;
                    switch (d.keyCode) {
                    case g.PAGE_UP:
                        b._move("previousPage", d);
                        break;
                    case g.PAGE_DOWN:
                        b._move("nextPage", d);
                        break;
                    case g.UP:
                        b._keyEvent("previous", d);
                        break;
                    case g.DOWN:
                        b._keyEvent("next", d);
                        break;
                    case g.ENTER:
                    case g.NUMPAD_ENTER:
                        b.menu.active && (e = !0,
                        d.preventDefault());
                    case g.TAB:
                        if (!b.menu.active)
                            break;
                        b.menu.select(d);
                        break;
                    case g.ESCAPE:
                        b.element.val(b.term);
                        b.close(d);
                        break;
                    default:
                        clearTimeout(b.searching),
                        b.searching = setTimeout(function() {
                            b.term != b.element.val() && (b.selectedItem = null,
                            b.search(null, d))
                        }, b.options.delay)
                    }
                }
            }).bind("keypress.autocomplete", function(a) {
                e && (e = !1,
                a.preventDefault())
            }).bind("focus.autocomplete", function() {
                b.options.disabled || (b.selectedItem = null,
                b.previous = b.element.val())
            }).bind("blur.autocomplete", function(a) {
                b.options.disabled || (clearTimeout(b.searching),
                b.closing = setTimeout(function() {
                    b.close(a);
                    b._change(a)
                }, 150))
            });
            this._initSource();
            this.menu = a("<ul></ul>").addClass("ui-autocomplete").appendTo(a(this.options.appendTo || "body", d)[0]).mousedown(function(d) {
                var e = b.menu.element[0];
                a(d.target).closest(".ui-menu-item").length || setTimeout(function() {
                    a(document).one("mousedown", function(d) {
                        d.target !== b.element[0] && d.target !== e && !a.ui.contains(e, d.target) && b.close()
                    })
                }, 1);
                setTimeout(function() {
                    clearTimeout(b.closing)
                }, 13)
            }).menu({
                focus: function(a, d) {
                    var e = d.item.data("item.autocomplete");
                    !1 !== b._trigger("focus", a, {
                        item: e
                    }) && /^key/.test(a.originalEvent.type) && b.element.val(e.value)
                },
                selected: function(a, e) {
                    var h = e.item.data("item.autocomplete")
                      , i = b.previous;
                    b.element[0] !== d.activeElement && (b.element.focus(),
                    b.previous = i,
                    setTimeout(function() {
                        b.previous = i;
                        b.selectedItem = h
                    }, 1));
                    !1 !== b._trigger("select", a, {
                        item: h
                    }) && b.element.val(h.value);
                    b.term = b.element.val();
                    b.close(a);
                    b.selectedItem = h
                },
                blur: function() {
                    b.menu.element.is(":visible") && b.element.val() !== b.term && b.element.val(b.term)
                }
            }).zIndex(this.element.zIndex() + 1).css({
                top: 0,
                left: 0
            }).hide().data("menu");
            a.fn.bgiframe && this.menu.element.bgiframe();
            b.beforeunloadHandler = function() {
                b.element.removeAttr("autocomplete")
            }
            ;
            a(window).bind("beforeunload", b.beforeunloadHandler)
        },
        destroy: function() {
            this.element.removeClass("ui-autocomplete-input").removeAttr("autocomplete").removeAttr("role").removeAttr("aria-autocomplete").removeAttr("aria-haspopup");
            this.menu.element.remove();
            a(window).unbind("beforeunload", this.beforeunloadHandler);
            a.Widget.prototype.destroy.call(this)
        },
        _setOption: function(b, d) {
            a.Widget.prototype._setOption.apply(this, arguments);
            "source" === b && this._initSource();
            "appendTo" === b && this.menu.element.appendTo(a(d || "body", this.element[0].ownerDocument)[0]);
            "disabled" === b && d && this.xhr && this.xhr.abort()
        },
        _initSource: function() {
            var b = this, d, e;
            a.isArray(this.options.source) ? (d = this.options.source,
            this.source = function(b, c) {
                c(a.ui.autocomplete.filter(d, b.term))
            }
            ) : "string" == typeof this.options.source ? (e = this.options.source,
            this.source = function(d, g) {
                b.xhr && b.xhr.abort();
                b.xhr = a.ajax({
                    url: e,
                    data: d,
                    dataType: "json",
                    success: function(a) {
                        g(a)
                    },
                    error: function() {
                        g([])
                    }
                })
            }
            ) : this.source = this.options.source
        },
        search: function(a, b) {
            a = null != a ? a : this.element.val();
            this.term = this.element.val();
            if (a.length < this.options.minLength)
                return this.close(b);
            clearTimeout(this.closing);
            return !1 === this._trigger("search", b) ? void 0 : this._search(a)
        },
        _search: function(a) {
            this.pending++;
            this.element.addClass("ui-autocomplete-loading");
            this.source({
                term: a
            }, this._response())
        },
        _response: function() {
            var a = this
              , d = ++b;
            return function(e) {
                d === b && a.__response(e);
                a.pending--;
                a.pending || a.element.removeClass("ui-autocomplete-loading")
            }
        },
        __response: function(a) {
            !this.options.disabled && a && a.length ? (a = this._normalize(a),
            this._suggest(a),
            this._trigger("open")) : this.close()
        },
        close: function(a) {
            clearTimeout(this.closing);
            this.menu.element.is(":visible") && (this.menu.element.hide(),
            this.menu.deactivate(),
            this._trigger("close", a))
        },
        _change: function(a) {
            this.previous !== this.element.val() && this._trigger("change", a, {
                item: this.selectedItem
            })
        },
        _normalize: function(b) {
            return b.length && b[0].label && b[0].value ? b : a.map(b, function(b) {
                return "string" == typeof b ? {
                    label: b,
                    value: b
                } : a.extend({
                    label: b.label || b.value,
                    value: b.value || b.label
                }, b)
            })
        },
        _suggest: function(b) {
            var d = this.menu.element.empty().zIndex(this.element.zIndex() + 1);
            this._renderMenu(d, b);
            this.menu.deactivate();
            this.menu.refresh();
            d.show();
            this._resizeMenu();
            d.position(a.extend({
                of: this.element
            }, this.options.position));
            this.options.autoFocus && this.menu.next(new a.Event("mouseover"))
        },
        _resizeMenu: function() {
            var a = this.menu.element;
            a.outerWidth(Math.max(a.width("").outerWidth() + 1, this.element.outerWidth()))
        },
        _renderMenu: function(b, d) {
            var e = this;
            a.each(d, function(a, d) {
                e._renderItem(b, d)
            })
        },
        _renderItem: function(b, d) {
            return a("<li></li>").data("item.autocomplete", d).append(a("<a></a>").text(d.label)).appendTo(b)
        },
        _move: function(a, b) {
            if (this.menu.element.is(":visible"))
                if (this.menu.first() && /^previous/.test(a) || this.menu.last() && /^next/.test(a))
                    this.element.val(this.term),
                    this.menu.deactivate();
                else
                    this.menu[a](b);
            else
                this.search(null, b)
        },
        widget: function() {
            return this.menu.element
        },
        _keyEvent: function(a, b) {
            if (!this.isMultiLine || this.menu.element.is(":visible"))
                this._move(a, b),
                b.preventDefault()
        }
    });
    a.extend(a.ui.autocomplete, {
        escapeRegex: function(a) {
            return a.replace(/[-[\]{}()*+?.,\\^$|#\s]/g, "\\$&")
        },
        filter: function(b, d) {
            var e = RegExp(a.ui.autocomplete.escapeRegex(d), "i");
            return a.grep(b, function(a) {
                return e.test(a.label || a.value || a)
            })
        }
    })
}
)(jQuery);
(function(a) {
    a.widget("ui.menu", {
        _create: function() {
            var b = this;
            this.element.addClass("ui-menu ui-widget ui-widget-content ui-corner-all").attr({
                role: "listbox",
                "aria-activedescendant": "ui-active-menuitem"
            }).click(function(c) {
                a(c.target).closest(".ui-menu-item a").length && (c.preventDefault(),
                b.select(c))
            });
            this.refresh()
        },
        refresh: function() {
            var b = this;
            this.element.children("li:not(.ui-menu-item):has(a)").addClass("ui-menu-item").attr("role", "menuitem").children("a").addClass("ui-corner-all").attr("tabindex", -1).mouseenter(function(c) {
                b.activate(c, a(this).parent())
            }).mouseleave(function() {
                b.deactivate()
            })
        },
        activate: function(a, c) {
            this.deactivate();
            if (this.hasScroll()) {
                var d = c.offset().top - this.element.offset().top
                  , e = this.element.scrollTop()
                  , f = this.element.height();
                0 > d ? this.element.scrollTop(e + d) : d >= f && this.element.scrollTop(e + d - f + c.height())
            }
            this.active = c.eq(0).children("a").addClass("ui-state-hover").attr("id", "ui-active-menuitem").end();
            this._trigger("focus", a, {
                item: c
            })
        },
        deactivate: function() {
            this.active && (this.active.children("a").removeClass("ui-state-hover").removeAttr("id"),
            this._trigger("blur"),
            this.active = null)
        },
        next: function(a) {
            this.move("next", ".ui-menu-item:first", a)
        },
        previous: function(a) {
            this.move("prev", ".ui-menu-item:last", a)
        },
        first: function() {
            return this.active && !this.active.prevAll(".ui-menu-item").length
        },
        last: function() {
            return this.active && !this.active.nextAll(".ui-menu-item").length
        },
        move: function(a, c, d) {
            this.active ? (a = this.active[a + "All"](".ui-menu-item").eq(0),
            a.length ? this.activate(d, a) : this.activate(d, this.element.children(c))) : this.activate(d, this.element.children(c))
        },
        nextPage: function(b) {
            if (this.hasScroll())
                if (!this.active || this.last())
                    this.activate(b, this.element.children(".ui-menu-item:first"));
                else {
                    var c = this.active.offset().top
                      , d = this.element.height()
                      , e = this.element.children(".ui-menu-item").filter(function() {
                        var b = a(this).offset().top - c - d + a(this).height();
                        return 10 > b && -10 < b
                    });
                    e.length || (e = this.element.children(".ui-menu-item:last"));
                    this.activate(b, e)
                }
            else
                this.activate(b, this.element.children(".ui-menu-item").filter(!this.active || this.last() ? ":first" : ":last"))
        },
        previousPage: function(b) {
            if (this.hasScroll())
                if (!this.active || this.first())
                    this.activate(b, this.element.children(".ui-menu-item:last"));
                else {
                    var c = this.active.offset().top
                      , d = this.element.height()
                      , e = this.element.children(".ui-menu-item").filter(function() {
                        var b = a(this).offset().top - c + d - a(this).height();
                        return 10 > b && -10 < b
                    });
                    e.length || (e = this.element.children(".ui-menu-item:first"));
                    this.activate(b, e)
                }
            else
                this.activate(b, this.element.children(".ui-menu-item").filter(!this.active || this.first() ? ":last" : ":first"))
        },
        hasScroll: function() {
            return this.element.height() < this.element[a.fn.prop ? "prop" : "attr"]("scrollHeight")
        },
        select: function(a) {
            this._trigger("selected", a, {
                item: this.active
            })
        }
    })
}
)(jQuery);
(function(a, b) {
    var c = {
        buttons: !0,
        height: !0,
        maxHeight: !0,
        maxWidth: !0,
        minHeight: !0,
        minWidth: !0,
        width: !0
    }
      , d = {
        maxHeight: !0,
        maxWidth: !0,
        minHeight: !0,
        minWidth: !0
    };
    a.widget("ui.dialog", {
        options: {
            autoOpen: !0,
            buttons: {},
            closeOnEscape: !0,
            closeText: "close",
            dialogClass: "",
            draggable: !0,
            hide: null,
            height: "auto",
            maxHeight: !1,
            maxWidth: !1,
            minHeight: 150,
            minWidth: 150,
            modal: !1,
            position: {
                my: "center",
                at: "center",
                collision: "fit",
                using: function(b) {
                    var c = a(this).css(b).offset().top;
                    0 > c && a(this).css("top", b.top - c)
                }
            },
            resizable: !0,
            show: null,
            stack: !0,
            title: "",
            width: 300,
            zIndex: 1E3
        },
        _create: function() {
            this.originalTitle = this.element.attr("title");
            "string" != typeof this.originalTitle && (this.originalTitle = "");
            this.options.title = this.options.title || this.originalTitle;
            var b = this
              , c = b.options
              , d = c.title || "&#160;"
              , h = a.ui.dialog.getTitleId(b.element)
              , i = (b.uiDialog = a("<div></div>")).appendTo(document.body).hide().addClass("ui-dialog ui-widget ui-widget-content ui-corner-all " + c.dialogClass).css({
                zIndex: c.zIndex
            }).attr("tabIndex", -1).css("outline", 0).keydown(function(d) {
                c.closeOnEscape && !d.isDefaultPrevented() && d.keyCode && d.keyCode === a.ui.keyCode.ESCAPE && (b.close(d),
                d.preventDefault())
            }).attr({
                role: "dialog",
                "aria-labelledby": h
            }).mousedown(function(a) {
                b.moveToTop(!1, a)
            });
            b.element.show().removeAttr("title").addClass("ui-dialog-content ui-widget-content").appendTo(i);
            var j = (b.uiDialogTitlebar = a("<div></div>")).addClass("ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix").prependTo(i)
              , k = a('<a href="#"></a>').addClass("ui-dialog-titlebar-close ui-corner-all").attr("role", "button").hover(function() {
                k.addClass("ui-state-hover")
            }, function() {
                k.removeClass("ui-state-hover")
            }).focus(function() {
                k.addClass("ui-state-focus")
            }).blur(function() {
                k.removeClass("ui-state-focus")
            }).click(function(a) {
                return b.close(a),
                !1
            }).appendTo(j);
            (b.uiDialogTitlebarCloseText = a("<span></span>")).addClass("ui-icon ui-icon-closethick").text(c.closeText).appendTo(k);
            a("<span></span>").addClass("ui-dialog-title").attr("id", h).html(d).prependTo(j);
            a.isFunction(c.beforeclose) && !a.isFunction(c.beforeClose) && (c.beforeClose = c.beforeclose);
            j.find("*").add(j).disableSelection();
            c.draggable && a.fn.draggable && b._makeDraggable();
            c.resizable && a.fn.resizable && b._makeResizable();
            b._createButtons(c.buttons);
            b._isOpen = !1;
            a.fn.bgiframe && i.bgiframe()
        },
        _init: function() {
            this.options.autoOpen && this.open()
        },
        destroy: function() {
            return this.overlay && this.overlay.destroy(),
            this.uiDialog.hide(),
            this.element.unbind(".dialog").removeData("dialog").removeClass("ui-dialog-content ui-widget-content").hide().appendTo("body"),
            this.uiDialog.remove(),
            this.originalTitle && this.element.attr("title", this.originalTitle),
            this
        },
        widget: function() {
            return this.uiDialog
        },
        close: function(b) {
            var c = this, d, h;
            return !1 === c._trigger("beforeClose", b) ? void 0 : (c.overlay && c.overlay.destroy(),
            c.uiDialog.unbind("keypress.ui-dialog"),
            c._isOpen = !1,
            c.options.hide ? c.uiDialog.hide(c.options.hide, function() {
                c._trigger("close", b)
            }) : (c.uiDialog.hide(),
            c._trigger("close", b)),
            a.ui.dialog.overlay.resize(),
            c.options.modal && (d = 0,
            a(".ui-dialog").each(function() {
                this !== c.uiDialog[0] && (h = a(this).css("z-index"),
                isNaN(h) || (d = Math.max(d, h)))
            }),
            a.ui.dialog.maxZ = d),
            c)
        },
        isOpen: function() {
            return this._isOpen
        },
        moveToTop: function(b, c) {
            var d = this.options, h;
            return d.modal && !b || !d.stack && !d.modal ? this._trigger("focus", c) : (d.zIndex > a.ui.dialog.maxZ && (a.ui.dialog.maxZ = d.zIndex),
            this.overlay && (a.ui.dialog.maxZ += 1,
            this.overlay.$el.css("z-index", a.ui.dialog.overlay.maxZ = a.ui.dialog.maxZ)),
            h = {
                scrollTop: this.element.scrollTop(),
                scrollLeft: this.element.scrollLeft()
            },
            a.ui.dialog.maxZ += 1,
            this.uiDialog.css("z-index", a.ui.dialog.maxZ),
            this.element.attr(h),
            this._trigger("focus", c),
            this)
        },
        open: function() {
            if (!this._isOpen) {
                var b = this.options
                  , c = this.uiDialog;
                return this.overlay = b.modal ? new a.ui.dialog.overlay(this) : null,
                this._size(),
                this._position(b.position),
                c.show(b.show),
                this.moveToTop(!0),
                b.modal && c.bind("keydown.ui-dialog", function(b) {
                    if (b.keyCode === a.ui.keyCode.TAB) {
                        var c = a(":tabbable", this)
                          , d = c.filter(":first")
                          , c = c.filter(":last");
                        if (b.target === c[0] && !b.shiftKey)
                            return d.focus(1),
                            !1;
                        if (b.target === d[0] && b.shiftKey)
                            return c.focus(1),
                            !1
                    }
                }),
                a(this.element.find(":tabbable").get().concat(c.find(".ui-dialog-buttonpane :tabbable").get().concat(c.get()))).eq(0).focus(),
                this._isOpen = !0,
                this._trigger("open"),
                this
            }
        },
        _createButtons: function(b) {
            var c = this
              , d = !1
              , h = a("<div></div>").addClass("ui-dialog-buttonpane ui-widget-content ui-helper-clearfix")
              , i = a("<div></div>").addClass("ui-dialog-buttonset").appendTo(h);
            c.uiDialog.find(".ui-dialog-buttonpane").remove();
            "object" == typeof b && null !== b && a.each(b, function() {
                return !(d = !0)
            });
            d && (a.each(b, function(b, d) {
                var d = a.isFunction(d) ? {
                    click: d,
                    text: b
                } : d
                  , e = a('<button type="button"></button>').click(function() {
                    d.click.apply(c.element[0], arguments)
                }).appendTo(i);
                a.each(d, function(a, b) {
                    "click" !== a && (a in e ? e[a](b) : e.attr(a, b))
                });
                a.fn.button && e.button()
            }),
            h.appendTo(c.uiDialog))
        },
        _makeDraggable: function() {
            function b(a) {
                return {
                    position: a.position,
                    offset: a.offset
                }
            }
            var c = this, d = c.options, h = a(document), i;
            c.uiDialog.draggable({
                cancel: ".ui-dialog-content, .ui-dialog-titlebar-close",
                handle: ".ui-dialog-titlebar",
                containment: "document",
                start: function(h, k) {
                    i = "auto" === d.height ? "auto" : a(this).height();
                    a(this).height(a(this).height()).addClass("ui-dialog-dragging");
                    c._trigger("dragStart", h, b(k))
                },
                drag: function(a, d) {
                    c._trigger("drag", a, b(d))
                },
                stop: function(j, k) {
                    d.position = [k.position.left - h.scrollLeft(), k.position.top - h.scrollTop()];
                    a(this).removeClass("ui-dialog-dragging").height(i);
                    c._trigger("dragStop", j, b(k));
                    a.ui.dialog.overlay.resize()
                }
            })
        },
        _makeResizable: function(c) {
            function d(a) {
                return {
                    originalPosition: a.originalPosition,
                    originalSize: a.originalSize,
                    position: a.position,
                    size: a.size
                }
            }
            var c = c === b ? this.options.resizable : c
              , g = this
              , h = g.options
              , i = g.uiDialog.css("position")
              , c = "string" == typeof c ? c : "n,e,s,w,se,sw,ne,nw";
            g.uiDialog.resizable({
                cancel: ".ui-dialog-content",
                containment: "document",
                alsoResize: g.element,
                maxWidth: h.maxWidth,
                maxHeight: h.maxHeight,
                minWidth: h.minWidth,
                minHeight: g._minHeight(),
                handles: c,
                start: function(b, c) {
                    a(this).addClass("ui-dialog-resizing");
                    g._trigger("resizeStart", b, d(c))
                },
                resize: function(a, b) {
                    g._trigger("resize", a, d(b))
                },
                stop: function(b, c) {
                    a(this).removeClass("ui-dialog-resizing");
                    h.height = a(this).height();
                    h.width = a(this).width();
                    g._trigger("resizeStop", b, d(c));
                    a.ui.dialog.overlay.resize()
                }
            }).css("position", i).find(".ui-resizable-se").addClass("ui-icon ui-icon-grip-diagonal-se")
        },
        _minHeight: function() {
            var a = this.options;
            return "auto" === a.height ? a.minHeight : Math.min(a.minHeight, a.height)
        },
        _position: function(b) {
            var c = [], d = [0, 0], h;
            if (b) {
                if ("string" == typeof b || "object" == typeof b && "0"in b)
                    c = b.split ? b.split(" ") : [b[0], b[1]],
                    1 === c.length && (c[1] = c[0]),
                    a.each(["left", "top"], function(a, b) {
                        +c[a] === c[a] && (d[a] = c[a],
                        c[a] = b)
                    }),
                    b = {
                        my: c.join(" "),
                        at: c.join(" "),
                        offset: d.join(" ")
                    };
                b = a.extend({}, a.ui.dialog.prototype.options.position, b)
            } else
                b = a.ui.dialog.prototype.options.position;
            (h = this.uiDialog.is(":visible")) || this.uiDialog.show();
            this.uiDialog.css({
                top: 0,
                left: 0
            }).position(a.extend({
                of: window
            }, b));
            h || this.uiDialog.hide()
        },
        _setOptions: function(b) {
            var f = this
              , g = {}
              , h = !1;
            a.each(b, function(a, b) {
                f._setOption(a, b);
                a in c && (h = !0);
                a in d && (g[a] = b)
            });
            h && this._size();
            this.uiDialog.is(":data(resizable)") && this.uiDialog.resizable("option", g)
        },
        _setOption: function(b, c) {
            var d = this.uiDialog;
            switch (b) {
            case "beforeclose":
                b = "beforeClose";
                break;
            case "buttons":
                this._createButtons(c);
                break;
            case "closeText":
                this.uiDialogTitlebarCloseText.text("" + c);
                break;
            case "dialogClass":
                d.removeClass(this.options.dialogClass).addClass("ui-dialog ui-widget ui-widget-content ui-corner-all " + c);
                break;
            case "disabled":
                c ? d.addClass("ui-dialog-disabled") : d.removeClass("ui-dialog-disabled");
                break;
            case "draggable":
                var h = d.is(":data(draggable)");
                h && !c && d.draggable("destroy");
                !h && c && this._makeDraggable();
                break;
            case "position":
                this._position(c);
                break;
            case "resizable":
                (h = d.is(":data(resizable)")) && !c && d.resizable("destroy");
                h && "string" == typeof c && d.resizable("option", "handles", c);
                !h && !1 !== c && this._makeResizable(c);
                break;
            case "title":
                a(".ui-dialog-title", this.uiDialogTitlebar).html("" + (c || "&#160;"))
            }
            a.Widget.prototype._setOption.apply(this, arguments)
        },
        _size: function() {
            var b = this.options, c, d, h = this.uiDialog.is(":visible");
            this.element.show().css({
                width: "auto",
                minHeight: 0,
                height: 0
            });
            b.minWidth > b.width && (b.width = b.minWidth);
            c = this.uiDialog.css({
                height: "auto",
                width: b.width
            }).height();
            d = Math.max(0, b.minHeight - c);
            "auto" === b.height ? a.support.minHeight ? this.element.css({
                minHeight: d,
                height: "auto"
            }) : (this.uiDialog.show(),
            b = this.element.css("height", "auto").height(),
            h || this.uiDialog.hide(),
            this.element.height(Math.max(b, d))) : this.element.height(Math.max(b.height - c, 0));
            this.uiDialog.is(":data(resizable)") && this.uiDialog.resizable("option", "minHeight", this._minHeight())
        }
    });
    a.extend(a.ui.dialog, {
        version: "1.8.23",
        uuid: 0,
        maxZ: 0,
        getTitleId: function(a) {
            a = a.attr("id");
            return a || (this.uuid += 1,
            a = this.uuid),
            "ui-dialog-title-" + a
        },
        overlay: function(b) {
            this.$el = a.ui.dialog.overlay.create(b)
        }
    });
    a.extend(a.ui.dialog.overlay, {
        instances: [],
        oldInstances: [],
        maxZ: 0,
        events: a.map("focus,mousedown,mouseup,keydown,keypress,click".split(","), function(a) {
            return a + ".dialog-overlay"
        }).join(" "),
        create: function(b) {
            0 === this.instances.length && (setTimeout(function() {
                a.ui.dialog.overlay.instances.length && a(document).bind(a.ui.dialog.overlay.events, function(b) {
                    if (a(b.target).zIndex() < a.ui.dialog.overlay.maxZ)
                        return !1
                })
            }, 1),
            a(document).bind("keydown.dialog-overlay", function(c) {
                b.options.closeOnEscape && !c.isDefaultPrevented() && c.keyCode && c.keyCode === a.ui.keyCode.ESCAPE && (b.close(c),
                c.preventDefault())
            }),
            a(window).bind("resize.dialog-overlay", a.ui.dialog.overlay.resize));
            var c = (this.oldInstances.pop() || a("<div></div>").addClass("ui-widget-overlay")).appendTo(document.body).css({
                width: this.width(),
                height: this.height()
            });
            return a.fn.bgiframe && c.bgiframe(),
            this.instances.push(c),
            c
        },
        destroy: function(b) {
            var c = a.inArray(b, this.instances);
            -1 != c && this.oldInstances.push(this.instances.splice(c, 1)[0]);
            0 === this.instances.length && a([document, window]).unbind(".dialog-overlay");
            b.remove();
            var d = 0;
            a.each(this.instances, function() {
                d = Math.max(d, this.css("z-index"))
            });
            this.maxZ = d
        },
        height: function() {
            var b, c;
            return a.browser.msie && 7 > a.browser.version ? (b = Math.max(document.documentElement.scrollHeight, document.body.scrollHeight),
            c = Math.max(document.documentElement.offsetHeight, document.body.offsetHeight),
            b < c ? a(window).height() + "px" : b + "px") : a(document).height() + "px"
        },
        width: function() {
            var b, c;
            return a.browser.msie ? (b = Math.max(document.documentElement.scrollWidth, document.body.scrollWidth),
            c = Math.max(document.documentElement.offsetWidth, document.body.offsetWidth),
            b < c ? a(window).width() + "px" : b + "px") : a(document).width() + "px"
        },
        resize: function() {
            var b = a([]);
            a.each(a.ui.dialog.overlay.instances, function() {
                b = b.add(this)
            });
            b.css({
                width: 0,
                height: 0
            }).css({
                width: a.ui.dialog.overlay.width(),
                height: a.ui.dialog.overlay.height()
            })
        }
    });
    a.extend(a.ui.dialog.overlay.prototype, {
        destroy: function() {
            a.ui.dialog.overlay.destroy(this.$el)
        }
    })
}
)(jQuery);
(function(a) {
    a.widget("ui.slider", a.ui.mouse, {
        widgetEventPrefix: "slide",
        options: {
            animate: !1,
            distance: 0,
            max: 100,
            min: 0,
            orientation: "horizontal",
            range: !1,
            step: 1,
            value: 0,
            values: null
        },
        _create: function() {
            var b = this
              , c = this.options
              , d = this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all")
              , e = c.values && c.values.length || 1
              , f = [];
            this._mouseSliding = this._keySliding = !1;
            this._animateOff = !0;
            this._handleIndex = null;
            this._detectOrientation();
            this._mouseInit();
            this.element.addClass("ui-slider ui-slider-" + this.orientation + " ui-widget ui-widget-content ui-corner-all" + (c.disabled ? " ui-slider-disabled ui-disabled" : ""));
            this.range = a([]);
            c.range && (!0 === c.range && (c.values || (c.values = [this._valueMin(), this._valueMin()]),
            c.values.length && 2 !== c.values.length && (c.values = [c.values[0], c.values[0]])),
            this.range = a("<div></div>").appendTo(this.element).addClass("ui-slider-range ui-widget-header" + ("min" === c.range || "max" === c.range ? " ui-slider-range-" + c.range : "")));
            for (var g = d.length; g < e; g += 1)
                f.push("<a class='ui-slider-handle ui-state-default ui-corner-all' href='#'></a>");
            this.handles = d.add(a(f.join("")).appendTo(b.element));
            this.handle = this.handles.eq(0);
            this.handles.add(this.range).filter("a").click(function(a) {
                a.preventDefault()
            }).hover(function() {
                c.disabled || a(this).addClass("ui-state-hover")
            }, function() {
                a(this).removeClass("ui-state-hover")
            }).focus(function() {
                c.disabled ? a(this).blur() : (a(".ui-slider .ui-state-focus").removeClass("ui-state-focus"),
                a(this).addClass("ui-state-focus"))
            }).blur(function() {
                a(this).removeClass("ui-state-focus")
            });
            this.handles.each(function(b) {
                a(this).data("index.ui-slider-handle", b)
            });
            this.handles.keydown(function(c) {
                var d = a(this).data("index.ui-slider-handle"), e, f, g;
                if (!b.options.disabled) {
                    switch (c.keyCode) {
                    case a.ui.keyCode.HOME:
                    case a.ui.keyCode.END:
                    case a.ui.keyCode.PAGE_UP:
                    case a.ui.keyCode.PAGE_DOWN:
                    case a.ui.keyCode.UP:
                    case a.ui.keyCode.RIGHT:
                    case a.ui.keyCode.DOWN:
                    case a.ui.keyCode.LEFT:
                        if (c.preventDefault(),
                        !b._keySliding && (b._keySliding = !0,
                        a(this).addClass("ui-state-active"),
                        e = b._start(c, d),
                        !1 === e))
                            return
                    }
                    e = b.options.step;
                    b.options.values && b.options.values.length ? f = g = b.values(d) : f = g = b.value();
                    switch (c.keyCode) {
                    case a.ui.keyCode.HOME:
                        g = b._valueMin();
                        break;
                    case a.ui.keyCode.END:
                        g = b._valueMax();
                        break;
                    case a.ui.keyCode.PAGE_UP:
                        g = b._trimAlignValue(f + (b._valueMax() - b._valueMin()) / 5);
                        break;
                    case a.ui.keyCode.PAGE_DOWN:
                        g = b._trimAlignValue(f - (b._valueMax() - b._valueMin()) / 5);
                        break;
                    case a.ui.keyCode.UP:
                    case a.ui.keyCode.RIGHT:
                        if (f === b._valueMax())
                            return;
                        g = b._trimAlignValue(f + e);
                        break;
                    case a.ui.keyCode.DOWN:
                    case a.ui.keyCode.LEFT:
                        if (f === b._valueMin())
                            return;
                        g = b._trimAlignValue(f - e)
                    }
                    b._slide(c, d, g)
                }
            }).keyup(function(c) {
                var d = a(this).data("index.ui-slider-handle");
                b._keySliding && (b._keySliding = !1,
                b._stop(c, d),
                b._change(c, d),
                a(this).removeClass("ui-state-active"))
            });
            this._refreshValue();
            this._animateOff = !1
        },
        destroy: function() {
            return this.handles.remove(),
            this.range.remove(),
            this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-slider-disabled ui-widget ui-widget-content ui-corner-all").removeData("slider").unbind(".slider"),
            this._mouseDestroy(),
            this
        },
        _mouseCapture: function(b) {
            var c = this.options, d, e, f, g, h, i, j, k, n;
            return c.disabled ? !1 : (this.elementSize = {
                width: this.element.outerWidth(),
                height: this.element.outerHeight()
            },
            this.elementOffset = this.element.offset(),
            d = {
                x: b.pageX,
                y: b.pageY
            },
            e = this._normValueFromMouse(d),
            f = this._valueMax() - this._valueMin() + 1,
            h = this,
            this.handles.each(function(b) {
                var c = Math.abs(e - h.values(b));
                f > c && (f = c,
                g = a(this),
                i = b)
            }),
            !0 === c.range && this.values(1) === c.min && (i += 1,
            g = a(this.handles[i])),
            j = this._start(b, i),
            !1 === j ? !1 : (this._mouseSliding = !0,
            h._handleIndex = i,
            g.addClass("ui-state-active").focus(),
            k = g.offset(),
            n = !a(b.target).parents().andSelf().is(".ui-slider-handle"),
            this._clickOffset = n ? {
                left: 0,
                top: 0
            } : {
                left: b.pageX - k.left - g.width() / 2,
                top: b.pageY - k.top - g.height() / 2 - (parseInt(g.css("borderTopWidth"), 10) || 0) - (parseInt(g.css("borderBottomWidth"), 10) || 0) + (parseInt(g.css("marginTop"), 10) || 0)
            },
            this.handles.hasClass("ui-state-hover") || this._slide(b, i, e),
            this._animateOff = !0,
            !0))
        },
        _mouseStart: function() {
            return !0
        },
        _mouseDrag: function(a) {
            var c = this._normValueFromMouse({
                x: a.pageX,
                y: a.pageY
            });
            return this._slide(a, this._handleIndex, c),
            !1
        },
        _mouseStop: function(a) {
            return this.handles.removeClass("ui-state-active"),
            this._mouseSliding = !1,
            this._stop(a, this._handleIndex),
            this._change(a, this._handleIndex),
            this._handleIndex = null,
            this._clickOffset = null,
            this._animateOff = !1,
            !1
        },
        _detectOrientation: function() {
            this.orientation = "vertical" === this.options.orientation ? "vertical" : "horizontal"
        },
        _normValueFromMouse: function(a) {
            var c, d, e, f, g;
            return "horizontal" === this.orientation ? (c = this.elementSize.width,
            d = a.x - this.elementOffset.left - (this._clickOffset ? this._clickOffset.left : 0)) : (c = this.elementSize.height,
            d = a.y - this.elementOffset.top - (this._clickOffset ? this._clickOffset.top : 0)),
            e = d / c,
            1 < e && (e = 1),
            0 > e && (e = 0),
            "vertical" === this.orientation && (e = 1 - e),
            f = this._valueMax() - this._valueMin(),
            g = this._valueMin() + e * f,
            this._trimAlignValue(g)
        },
        _start: function(a, c) {
            var d = {
                handle: this.handles[c],
                value: this.value()
            };
            return this.options.values && this.options.values.length && (d.value = this.values(c),
            d.values = this.values()),
            this._trigger("start", a, d)
        },
        _slide: function(a, c, d) {
            var e, f, g;
            this.options.values && this.options.values.length ? (e = this.values(c ? 0 : 1),
            2 === this.options.values.length && !0 === this.options.range && (0 === c && d > e || 1 === c && d < e) && (d = e),
            d !== this.values(c) && (f = this.values(),
            f[c] = d,
            g = this._trigger("slide", a, {
                handle: this.handles[c],
                value: d,
                values: f
            }),
            this.values(c ? 0 : 1),
            !1 !== g && this.values(c, d, !0))) : d !== this.value() && (g = this._trigger("slide", a, {
                handle: this.handles[c],
                value: d
            }),
            !1 !== g && this.value(d))
        },
        _stop: function(a, c) {
            var d = {
                handle: this.handles[c],
                value: this.value()
            };
            this.options.values && this.options.values.length && (d.value = this.values(c),
            d.values = this.values());
            this._trigger("stop", a, d)
        },
        _change: function(a, c) {
            if (!this._keySliding && !this._mouseSliding) {
                var d = {
                    handle: this.handles[c],
                    value: this.value()
                };
                this.options.values && this.options.values.length && (d.value = this.values(c),
                d.values = this.values());
                this._trigger("change", a, d)
            }
        },
        value: function(a) {
            if (arguments.length)
                this.options.value = this._trimAlignValue(a),
                this._refreshValue(),
                this._change(null, 0);
            else
                return this._value()
        },
        values: function(b, c) {
            var d, e, f;
            if (1 < arguments.length)
                this.options.values[b] = this._trimAlignValue(c),
                this._refreshValue(),
                this._change(null, b);
            else {
                if (!arguments.length)
                    return this._values();
                if (!a.isArray(arguments[0]))
                    return this.options.values && this.options.values.length ? this._values(b) : this.value();
                d = this.options.values;
                e = arguments[0];
                for (f = 0; f < d.length; f += 1)
                    d[f] = this._trimAlignValue(e[f]),
                    this._change(null, f);
                this._refreshValue()
            }
        },
        _setOption: function(b, c) {
            var d, e = 0;
            a.isArray(this.options.values) && (e = this.options.values.length);
            a.Widget.prototype._setOption.apply(this, arguments);
            switch (b) {
            case "disabled":
                c ? (this.handles.filter(".ui-state-focus").blur(),
                this.handles.removeClass("ui-state-hover"),
                this.handles.propAttr("disabled", !0),
                this.element.addClass("ui-disabled")) : (this.handles.propAttr("disabled", !1),
                this.element.removeClass("ui-disabled"));
                break;
            case "orientation":
                this._detectOrientation();
                this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-" + this.orientation);
                this._refreshValue();
                break;
            case "value":
                this._animateOff = !0;
                this._refreshValue();
                this._change(null, 0);
                this._animateOff = !1;
                break;
            case "values":
                this._animateOff = !0;
                this._refreshValue();
                for (d = 0; d < e; d += 1)
                    this._change(null, d);
                this._animateOff = !1
            }
        },
        _value: function() {
            var a = this.options.value;
            return a = this._trimAlignValue(a),
            a
        },
        _values: function(a) {
            var c, d;
            if (arguments.length)
                return c = this.options.values[a],
                c = this._trimAlignValue(c),
                c;
            c = this.options.values.slice();
            for (d = 0; d < c.length; d += 1)
                c[d] = this._trimAlignValue(c[d]);
            return c
        },
        _trimAlignValue: function(a) {
            if (a <= this._valueMin())
                return this._valueMin();
            if (a >= this._valueMax())
                return this._valueMax();
            var c = 0 < this.options.step ? this.options.step : 1
              , d = (a - this._valueMin()) % c
              , a = a - d;
            return 2 * Math.abs(d) >= c && (a += 0 < d ? c : -c),
            parseFloat(a.toFixed(5))
        },
        _valueMin: function() {
            return this.options.min
        },
        _valueMax: function() {
            return this.options.max
        },
        _refreshValue: function() {
            var b = this.options.range, c = this.options, d = this, e = this._animateOff ? !1 : c.animate, f, g = {}, h, i, j, k;
            this.options.values && this.options.values.length ? this.handles.each(function(b) {
                f = 100 * ((d.values(b) - d._valueMin()) / (d._valueMax() - d._valueMin()));
                g["horizontal" === d.orientation ? "left" : "bottom"] = f + "%";
                a(this).stop(1, 1)[e ? "animate" : "css"](g, c.animate);
                !0 === d.options.range && ("horizontal" === d.orientation ? (0 === b && d.range.stop(1, 1)[e ? "animate" : "css"]({
                    left: f + "%"
                }, c.animate),
                1 === b && d.range[e ? "animate" : "css"]({
                    width: f - h + "%"
                }, {
                    queue: !1,
                    duration: c.animate
                })) : (0 === b && d.range.stop(1, 1)[e ? "animate" : "css"]({
                    bottom: f + "%"
                }, c.animate),
                1 === b && d.range[e ? "animate" : "css"]({
                    height: f - h + "%"
                }, {
                    queue: !1,
                    duration: c.animate
                })));
                h = f
            }) : (i = this.value(),
            j = this._valueMin(),
            k = this._valueMax(),
            f = k !== j ? 100 * ((i - j) / (k - j)) : 0,
            g["horizontal" === d.orientation ? "left" : "bottom"] = f + "%",
            this.handle.stop(1, 1)[e ? "animate" : "css"](g, c.animate),
            "min" === b && "horizontal" === this.orientation && this.range.stop(1, 1)[e ? "animate" : "css"]({
                width: f + "%"
            }, c.animate),
            "max" === b && "horizontal" === this.orientation && this.range[e ? "animate" : "css"]({
                width: 100 - f + "%"
            }, {
                queue: !1,
                duration: c.animate
            }),
            "min" === b && "vertical" === this.orientation && this.range.stop(1, 1)[e ? "animate" : "css"]({
                height: f + "%"
            }, c.animate),
            "max" === b && "vertical" === this.orientation && this.range[e ? "animate" : "css"]({
                height: 100 - f + "%"
            }, {
                queue: !1,
                duration: c.animate
            }))
        }
    });
    a.extend(a.ui.slider, {
        version: "1.8.23"
    })
}
)(jQuery);
(function(a, b) {
    var c = 0
      , d = 0;
    a.widget("ui.tabs", {
        options: {
            add: null,
            ajaxOptions: null,
            cache: !1,
            cookie: null,
            collapsible: !1,
            disable: null,
            disabled: [],
            enable: null,
            event: "click",
            fx: null,
            idPrefix: "ui-tabs-",
            load: null,
            panelTemplate: "<div></div>",
            remove: null,
            select: null,
            show: null,
            spinner: "<em>Loading&#8230;</em>",
            tabTemplate: "<li><a href='#{href}'><span>#{label}</span></a></li>"
        },
        _create: function() {
            this._tabify(!0)
        },
        _setOption: function(a, b) {
            "selected" == a ? this.options.collapsible && b == this.options.selected || this.select(b) : (this.options[a] = b,
            this._tabify())
        },
        _tabId: function(a) {
            return a.title && a.title.replace(/\s/g, "_").replace(/[^\w\u00c0-\uFFFF-]/g, "") || this.options.idPrefix + ++c
        },
        _sanitizeSelector: function(a) {
            return a.replace(/:/g, "\\:")
        },
        _cookie: function() {
            var b = this.cookie || (this.cookie = this.options.cookie.name || "ui-tabs-" + ++d);
            return a.cookie.apply(null, [b].concat(a.makeArray(arguments)))
        },
        _ui: function(a, b) {
            return {
                tab: a,
                panel: b,
                index: this.anchors.index(a)
            }
        },
        _cleanup: function() {
            this.lis.filter(".ui-state-processing").removeClass("ui-state-processing").find("span:data(label.tabs)").each(function() {
                var b = a(this);
                b.html(b.data("label.tabs")).removeData("label.tabs")
            })
        },
        _tabify: function(c) {
            function d(b, c) {
                b.css("display", "");
                !a.support.opacity && c.opacity && b[0].style.removeAttribute("filter")
            }
            var g = this
              , h = this.options
              , i = /^#.+/;
            this.list = this.element.find("ol,ul").eq(0);
            this.lis = a(" > li:has(a[href])", this.list);
            this.anchors = this.lis.map(function() {
                return a("a", this)[0]
            });
            this.panels = a([]);
            this.anchors.each(function(b, c) {
                var d = a(c).attr("href"), e = d.split("#")[0], f;
                e && (e === location.toString().split("#")[0] || (f = a("base")[0]) && e === f.href) && (d = c.hash,
                c.href = d);
                i.test(d) ? g.panels = g.panels.add(g.element.find(g._sanitizeSelector(d))) : d && "#" !== d ? (a.data(c, "href.tabs", d),
                a.data(c, "load.tabs", d.replace(/#.*$/, "")),
                d = g._tabId(c),
                c.href = "#" + d,
                e = g.element.find("#" + d),
                e.length || (e = a(h.panelTemplate).attr("id", d).addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").insertAfter(g.panels[b - 1] || g.list),
                e.data("destroy.tabs", !0)),
                g.panels = g.panels.add(e)) : h.disabled.push(b)
            });
            c ? (this.element.addClass("ui-tabs ui-widget ui-widget-content ui-corner-all"),
            this.list.addClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all"),
            this.lis.addClass("ui-state-default ui-corner-top"),
            this.panels.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom"),
            h.selected === b ? (location.hash && this.anchors.each(function(a, b) {
                if (b.hash == location.hash)
                    return h.selected = a,
                    !1
            }),
            "number" != typeof h.selected && h.cookie && (h.selected = parseInt(g._cookie(), 10)),
            "number" != typeof h.selected && this.lis.filter(".ui-tabs-selected").length && (h.selected = this.lis.index(this.lis.filter(".ui-tabs-selected"))),
            h.selected = h.selected || (this.lis.length ? 0 : -1)) : null === h.selected && (h.selected = -1),
            h.selected = 0 <= h.selected && this.anchors[h.selected] || 0 > h.selected ? h.selected : 0,
            h.disabled = a.unique(h.disabled.concat(a.map(this.lis.filter(".ui-state-disabled"), function(a) {
                return g.lis.index(a)
            }))).sort(),
            -1 != a.inArray(h.selected, h.disabled) && h.disabled.splice(a.inArray(h.selected, h.disabled), 1),
            this.panels.addClass("ui-tabs-hide"),
            this.lis.removeClass("ui-tabs-selected ui-state-active"),
            0 <= h.selected && this.anchors.length && (g.element.find(g._sanitizeSelector(g.anchors[h.selected].hash)).removeClass("ui-tabs-hide"),
            this.lis.eq(h.selected).addClass("ui-tabs-selected ui-state-active"),
            g.element.queue("tabs", function() {
                g._trigger("show", null, g._ui(g.anchors[h.selected], g.element.find(g._sanitizeSelector(g.anchors[h.selected].hash))[0]))
            }),
            this.load(h.selected)),
            a(window).bind("unload", function() {
                g.lis.add(g.anchors).unbind(".tabs");
                g.lis = g.anchors = g.panels = null
            })) : h.selected = this.lis.index(this.lis.filter(".ui-tabs-selected"));
            this.element[h.collapsible ? "addClass" : "removeClass"]("ui-tabs-collapsible");
            h.cookie && this._cookie(h.selected, h.cookie);
            for (var c = 0, j; j = this.lis[c]; c++)
                a(j)[-1 != a.inArray(c, h.disabled) && !a(j).hasClass("ui-tabs-selected") ? "addClass" : "removeClass"]("ui-state-disabled");
            !1 === h.cache && this.anchors.removeData("cache.tabs");
            this.lis.add(this.anchors).unbind(".tabs");
            if ("mouseover" !== h.event) {
                var k = function(a, b) {
                    b.is(":not(.ui-state-disabled)") && b.addClass("ui-state-" + a)
                };
                this.lis.bind("mouseover.tabs", function() {
                    k("hover", a(this))
                });
                this.lis.bind("mouseout.tabs", function() {
                    a(this).removeClass("ui-state-hover")
                });
                this.anchors.bind("focus.tabs", function() {
                    k("focus", a(this).closest("li"))
                });
                this.anchors.bind("blur.tabs", function() {
                    a(this).closest("li").removeClass("ui-state-focus")
                })
            }
            var n, p;
            h.fx && (a.isArray(h.fx) ? (n = h.fx[0],
            p = h.fx[1]) : n = p = h.fx);
            var o = p ? function(b, c) {
                a(b).closest("li").addClass("ui-tabs-selected ui-state-active");
                c.hide().removeClass("ui-tabs-hide").animate(p, p.duration || "normal", function() {
                    d(c, p);
                    g._trigger("show", null, g._ui(b, c[0]))
                })
            }
            : function(b, c) {
                a(b).closest("li").addClass("ui-tabs-selected ui-state-active");
                c.removeClass("ui-tabs-hide");
                g._trigger("show", null, g._ui(b, c[0]))
            }
              , r = n ? function(a, b) {
                b.animate(n, n.duration || "normal", function() {
                    g.lis.removeClass("ui-tabs-selected ui-state-active");
                    b.addClass("ui-tabs-hide");
                    d(b, n);
                    g.element.dequeue("tabs")
                })
            }
            : function(a, b) {
                g.lis.removeClass("ui-tabs-selected ui-state-active");
                b.addClass("ui-tabs-hide");
                g.element.dequeue("tabs")
            }
            ;
            this.anchors.bind(h.event + ".tabs", function() {
                var b = this
                  , c = a(b).closest("li")
                  , d = g.panels.filter(":not(.ui-tabs-hide)")
                  , e = g.element.find(g._sanitizeSelector(b.hash));
                if (c.hasClass("ui-tabs-selected") && !h.collapsible || c.hasClass("ui-state-disabled") || c.hasClass("ui-state-processing") || g.panels.filter(":animated").length || !1 === g._trigger("select", null, g._ui(this, e[0])))
                    return this.blur(),
                    !1;
                h.selected = g.anchors.index(this);
                g.abort();
                if (h.collapsible) {
                    if (c.hasClass("ui-tabs-selected"))
                        return h.selected = -1,
                        h.cookie && g._cookie(h.selected, h.cookie),
                        g.element.queue("tabs", function() {
                            r(b, d)
                        }).dequeue("tabs"),
                        this.blur(),
                        !1;
                    if (!d.length)
                        return h.cookie && g._cookie(h.selected, h.cookie),
                        g.element.queue("tabs", function() {
                            o(b, e)
                        }),
                        g.load(g.anchors.index(this)),
                        this.blur(),
                        !1
                }
                h.cookie && g._cookie(h.selected, h.cookie);
                if (e.length)
                    d.length && g.element.queue("tabs", function() {
                        r(b, d)
                    }),
                    g.element.queue("tabs", function() {
                        o(b, e)
                    }),
                    g.load(g.anchors.index(this));
                else
                    throw "jQuery UI Tabs: Mismatching fragment identifier.";
                a.browser.msie && this.blur()
            });
            this.anchors.bind("click.tabs", function() {
                return !1
            })
        },
        _getIndex: function(a) {
            return "string" == typeof a && (a = this.anchors.index(this.anchors.filter("[href$='" + a + "']"))),
            a
        },
        destroy: function() {
            var b = this.options;
            return this.abort(),
            this.element.unbind(".tabs").removeClass("ui-tabs ui-widget ui-widget-content ui-corner-all ui-tabs-collapsible").removeData("tabs"),
            this.list.removeClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all"),
            this.anchors.each(function() {
                var b = a.data(this, "href.tabs");
                b && (this.href = b);
                var c = a(this).unbind(".tabs");
                a.each(["href", "load", "cache"], function(a, b) {
                    c.removeData(b + ".tabs")
                })
            }),
            this.lis.unbind(".tabs").add(this.panels).each(function() {
                a.data(this, "destroy.tabs") ? a(this).remove() : a(this).removeClass("ui-state-default ui-corner-top ui-tabs-selected ui-state-active ui-state-hover ui-state-focus ui-state-disabled ui-tabs-panel ui-widget-content ui-corner-bottom ui-tabs-hide")
            }),
            b.cookie && this._cookie(null, b.cookie),
            this
        },
        add: function(c, d, g) {
            g === b && (g = this.anchors.length);
            var h = this
              , i = this.options
              , d = a(i.tabTemplate.replace(/#\{href\}/g, c).replace(/#\{label\}/g, d))
              , c = c.indexOf("#") ? this._tabId(a("a", d)[0]) : c.replace("#", "");
            d.addClass("ui-state-default ui-corner-top").data("destroy.tabs", !0);
            var j = h.element.find("#" + c);
            return j.length || (j = a(i.panelTemplate).attr("id", c).data("destroy.tabs", !0)),
            j.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom ui-tabs-hide"),
            g >= this.lis.length ? (d.appendTo(this.list),
            j.appendTo(this.list[0].parentNode)) : (d.insertBefore(this.lis[g]),
            j.insertBefore(this.panels[g])),
            i.disabled = a.map(i.disabled, function(a) {
                return a >= g ? ++a : a
            }),
            this._tabify(),
            1 == this.anchors.length && (i.selected = 0,
            d.addClass("ui-tabs-selected ui-state-active"),
            j.removeClass("ui-tabs-hide"),
            this.element.queue("tabs", function() {
                h._trigger("show", null, h._ui(h.anchors[0], h.panels[0]))
            }),
            this.load(0)),
            this._trigger("add", null, this._ui(this.anchors[g], this.panels[g])),
            this
        },
        remove: function(b) {
            var b = this._getIndex(b)
              , c = this.options
              , d = this.lis.eq(b).remove()
              , h = this.panels.eq(b).remove();
            return d.hasClass("ui-tabs-selected") && 1 < this.anchors.length && this.select(b + (b + 1 < this.anchors.length ? 1 : -1)),
            c.disabled = a.map(a.grep(c.disabled, function(a) {
                return a != b
            }), function(a) {
                return a >= b ? --a : a
            }),
            this._tabify(),
            this._trigger("remove", null, this._ui(d.find("a")[0], h[0])),
            this
        },
        enable: function(b) {
            var b = this._getIndex(b)
              , c = this.options;
            return -1 == a.inArray(b, c.disabled) ? void 0 : (this.lis.eq(b).removeClass("ui-state-disabled"),
            c.disabled = a.grep(c.disabled, function(a) {
                return a != b
            }),
            this._trigger("enable", null, this._ui(this.anchors[b], this.panels[b])),
            this)
        },
        disable: function(a) {
            var a = this._getIndex(a)
              , b = this.options;
            return a != b.selected && (this.lis.eq(a).addClass("ui-state-disabled"),
            b.disabled.push(a),
            b.disabled.sort(),
            this._trigger("disable", null, this._ui(this.anchors[a], this.panels[a]))),
            this
        },
        select: function(a) {
            a = this._getIndex(a);
            if (-1 == a)
                if (this.options.collapsible && -1 != this.options.selected)
                    a = this.options.selected;
                else
                    return this;
            return this.anchors.eq(a).trigger(this.options.event + ".tabs"),
            this
        },
        load: function(b) {
            var b = this._getIndex(b)
              , c = this
              , d = this.options
              , h = this.anchors.eq(b)[0]
              , i = a.data(h, "load.tabs");
            this.abort();
            if (!i || 0 !== this.element.queue("tabs").length && a.data(h, "cache.tabs"))
                this.element.dequeue("tabs");
            else {
                this.lis.eq(b).addClass("ui-state-processing");
                if (d.spinner) {
                    var j = a("span", h);
                    j.data("label.tabs", j.html()).html(d.spinner)
                }
                return this.xhr = a.ajax(a.extend({}, d.ajaxOptions, {
                    url: i,
                    success: function(i, j) {
                        c.element.find(c._sanitizeSelector(h.hash)).html(i);
                        c._cleanup();
                        d.cache && a.data(h, "cache.tabs", !0);
                        c._trigger("load", null, c._ui(c.anchors[b], c.panels[b]));
                        try {
                            d.ajaxOptions.success(i, j)
                        } catch (p) {}
                    },
                    error: function(a, i) {
                        c._cleanup();
                        c._trigger("load", null, c._ui(c.anchors[b], c.panels[b]));
                        try {
                            d.ajaxOptions.error(a, i, b, h)
                        } catch (j) {}
                    }
                })),
                c.element.dequeue("tabs"),
                this
            }
        },
        abort: function() {
            return this.element.queue([]),
            this.panels.stop(!1, !0),
            this.element.queue("tabs", this.element.queue("tabs").splice(-2, 2)),
            this.xhr && (this.xhr.abort(),
            delete this.xhr),
            this._cleanup(),
            this
        },
        url: function(a, b) {
            return this.anchors.eq(a).removeData("cache.tabs").data("load.tabs", b),
            this
        },
        length: function() {
            return this.anchors.length
        }
    });
    a.extend(a.ui.tabs, {
        version: "1.8.23"
    });
    a.extend(a.ui.tabs.prototype, {
        rotation: null,
        rotate: function(a, b) {
            var c = this
              , d = this.options
              , i = c._rotate || (c._rotate = function(b) {
                clearTimeout(c.rotation);
                c.rotation = setTimeout(function() {
                    var a = d.selected;
                    c.select(++a < c.anchors.length ? a : 0)
                }, a);
                b && b.stopPropagation()
            }
            )
              , j = c._unrotate || (c._unrotate = b ? function() {
                i()
            }
            : function(a) {
                a.clientX && c.rotate(null)
            }
            );
            return a ? (this.element.bind("tabsshow", i),
            this.anchors.bind(d.event + ".tabs", j),
            i()) : (clearTimeout(c.rotation),
            this.element.unbind("tabsshow", i),
            this.anchors.unbind(d.event + ".tabs", j),
            delete this._rotate,
            delete this._unrotate),
            this
        }
    })
}
)(jQuery);
window.Modernizr = function(a, b, c) {
    function d() {
        h.input = function(a) {
            for (var b = 0, c = a.length; b < c; b++)
                t[a[b]] = a[b]in n;
            return t
        }("autocomplete,autofocus,list,placeholder,max,min,multiple,pattern,required,step".split(","));
        h.inputtypes = function(a) {
            for (var d = 0, e, f, g, h = a.length; d < h; d++)
                n.setAttribute("type", f = a[d]),
                (e = "text" !== n.type) && (n.value = p,
                n.style.cssText = "position:absolute;visibility:hidden;",
                /^range$/.test(f) && n.style.WebkitAppearance !== c ? (i.appendChild(n),
                g = b.defaultView,
                e = g.getComputedStyle && "textfield" !== g.getComputedStyle(n, null).WebkitAppearance && 0 !== n.offsetHeight,
                i.removeChild(n)) : /^(search|tel)$/.test(f) || (/^(url|email)$/.test(f) ? e = n.checkValidity && !1 === n.checkValidity() : /^color$/.test(f) ? (i.appendChild(n),
                e = n.value != p,
                i.removeChild(n)) : e = n.value != p)),
                s[a[d]] = !!e;
            return s
        }("search,tel,url,email,datetime,date,month,week,time,datetime-local,number,range,color".split(","))
    }
    function e(a, b) {
        var c = a.charAt(0).toUpperCase() + a.substr(1)
          , c = (a + " " + q.join(c + " ") + c).split(" ");
        return f(c, b)
    }
    function f(a, b) {
        for (var d in a)
            if (k[a[d]] !== c)
                return "pfx" == b ? a[d] : !0;
        return !1
    }
    function g(a, b) {
        return typeof a === b
    }
    var h = {}
      , i = b.documentElement;
    b.head || b.getElementsByTagName("head");
    var j = b.createElement("modernizr"), k = j.style, n = b.createElement("input"), p = ":)", o = Object.prototype.toString, r = ",-webkit-,-moz-,-o-,-ms-,-khtml-".split(","), q = ["Webkit", "Moz", "O", "ms", "Khtml"], j = {}, s = {}, t = {}, v = [], x = function(a, c, d, e) {
        var f, g = b.createElement("div");
        if (parseInt(d, 10))
            for (; d--; )
                f = b.createElement("div"),
                f.id = e ? e[d] : "modernizr" + (d + 1),
                g.appendChild(f);
        d = ["&shy;<style>", a, "</style>"].join("");
        g.id = "modernizr";
        g.innerHTML += d;
        i.appendChild(g);
        a = c(g, a);
        g.parentNode.removeChild(g);
        return !!a
    }, u = function() {
        var a = {
            select: "input",
            change: "input",
            submit: "form",
            reset: "form",
            error: "img",
            load: "img",
            abort: "img"
        };
        return function(d, e) {
            var e = e || b.createElement(a[d] || "div")
              , d = "on" + d
              , f = d in e;
            f || (e.setAttribute || (e = b.createElement("div")),
            e.setAttribute && e.removeAttribute && (e.setAttribute(d, ""),
            f = g(e[d], "function"),
            g(e[d], c) || (e[d] = c),
            e.removeAttribute(d)));
            return f
        }
    }(), y, E = {}.hasOwnProperty, z;
    !g(E, c) && !g(E.call, c) ? z = function(a, b) {
        return E.call(a, b)
    }
    : z = function(a, b) {
        return b in a && g(a.constructor.prototype[b], c)
    }
    ;
    (function(c, d) {
        var e = c.join("")
          , f = d.length;
        x(e, function(c, d) {
            for (var e = b.styleSheets[b.styleSheets.length - 1], e = e.cssRules && e.cssRules[0] ? e.cssRules[0].cssText : e.cssText || "", g = c.childNodes, i = {}; f--; )
                i[g[f].id] = g[f];
            h.touch = "ontouchstart"in a || 9 === i.touch.offsetTop;
            h.csstransforms3d = 9 === i.csstransforms3d.offsetLeft;
            h.generatedcontent = 1 <= i.generatedcontent.offsetHeight;
            h.fontface = /src/i.test(e) && 0 === e.indexOf(d.split(" ")[0])
        }, f, d)
    }
    )(['@font-face {font-family:"font";src:url("https://")}', ["@media (", r.join("touch-enabled),("), "modernizr){#touch{top:9px;position:absolute}}"].join(""), ["@media (", r.join("transform-3d),("), "modernizr){#csstransforms3d{left:9px;position:absolute}}"].join(""), ['#generatedcontent:after{content:"', p, '";visibility:hidden}'].join("")], ["fontface", "touch", "csstransforms3d", "generatedcontent"]);
    j.flexbox = function() {
        var a = b.createElement("div"), c = b.createElement("div"), d;
        d = "display:";
        a.style.cssText = (d + r.join("box;" + d)).slice(0, -d.length) + "width:42px;padding:0;";
        c.style.cssText = r.join("box-flex:1;") + "width:10px;";
        a.appendChild(c);
        i.appendChild(a);
        d = 42 === c.offsetWidth;
        a.removeChild(c);
        i.removeChild(a);
        return d
    }
    ;
    j.canvas = function() {
        var a = b.createElement("canvas");
        return !!a.getContext && !!a.getContext("2d")
    }
    ;
    j.canvastext = function() {
        return !!h.canvas && !!g(b.createElement("canvas").getContext("2d").fillText, "function")
    }
    ;
    j.webgl = function() {
        return !!a.WebGLRenderingContext
    }
    ;
    j.touch = function() {
        return h.touch
    }
    ;
    j.geolocation = function() {
        return !!navigator.geolocation
    }
    ;
    j.postmessage = function() {
        return !!a.postMessage
    }
    ;
    j.websqldatabase = function() {
        return !!a.openDatabase
    }
    ;
    j.indexedDB = function() {
        for (var b = -1, c = q.length; ++b < c; )
            if (a[q[b].toLowerCase() + "IndexedDB"])
                return !0;
        return !!a.indexedDB
    }
    ;
    j.hashchange = function() {
        return u("hashchange", a) && (b.documentMode === c || 7 < b.documentMode)
    }
    ;
    j.history = function() {
        return !!a.history && !!history.pushState
    }
    ;
    j.draganddrop = function() {
        return u("dragstart") && u("drop")
    }
    ;
    j.websockets = function() {
        for (var b = -1, c = q.length; ++b < c; )
            if (a[q[b] + "WebSocket"])
                return !0;
        return "WebSocket"in a
    }
    ;
    j.rgba = function() {
        k.cssText = "background-color:rgba(150,255,150,.5)";
        return !!~("" + k.backgroundColor).indexOf("rgba")
    }
    ;
    j.hsla = function() {
        k.cssText = "background-color:hsla(120,40%,100%,.5)";
        return !!~("" + k.backgroundColor).indexOf("rgba") || !!~("" + k.backgroundColor).indexOf("hsla")
    }
    ;
    j.multiplebgs = function() {
        k.cssText = "background:url(https://),url(https://),red url(https://)";
        return /(url\s*\(.*?){3}/.test(k.background)
    }
    ;
    j.backgroundsize = function() {
        return e("backgroundSize")
    }
    ;
    j.borderimage = function() {
        return e("borderImage")
    }
    ;
    j.borderradius = function() {
        return e("borderRadius")
    }
    ;
    j.boxshadow = function() {
        return e("boxShadow")
    }
    ;
    j.textshadow = function() {
        return "" === b.createElement("div").style.textShadow
    }
    ;
    j.opacity = function() {
        var a = r.join("opacity:.55;") + "";
        k.cssText = a;
        return /^0.55$/.test(k.opacity)
    }
    ;
    j.cssanimations = function() {
        return e("animationName")
    }
    ;
    j.csscolumns = function() {
        return e("columnCount")
    }
    ;
    j.cssgradients = function() {
        var a = ("background-image:" + r.join("gradient(linear,left top,right bottom,from(#9f9),to(white));background-image:") + r.join("linear-gradient(left top,#9f9, white);background-image:")).slice(0, -17);
        k.cssText = a;
        return !!~("" + k.backgroundImage).indexOf("gradient")
    }
    ;
    j.cssreflections = function() {
        return e("boxReflect")
    }
    ;
    j.csstransforms = function() {
        return !!f(["transformProperty", "WebkitTransform", "MozTransform", "OTransform", "msTransform"])
    }
    ;
    j.csstransforms3d = function() {
        var a = !!f(["perspectiveProperty", "WebkitPerspective", "MozPerspective", "OPerspective", "msPerspective"]);
        a && "webkitPerspective"in i.style && (a = h.csstransforms3d);
        return a
    }
    ;
    j.csstransitions = function() {
        return e("transitionProperty")
    }
    ;
    j.fontface = function() {
        return h.fontface
    }
    ;
    j.generatedcontent = function() {
        return h.generatedcontent
    }
    ;
    j.video = function() {
        var a = b.createElement("video")
          , c = !1;
        try {
            if (c = !!a.canPlayType)
                c = new Boolean(c),
                c.ogg = a.canPlayType('video/ogg; codecs="theora"'),
                c.h264 = a.canPlayType('video/mp4; codecs="avc1.42E01E"') || a.canPlayType('video/mp4; codecs="avc1.42E01E, mp4a.40.2"'),
                c.webm = a.canPlayType('video/webm; codecs="vp8, vorbis"')
        } catch (d) {}
        return c
    }
    ;
    j.audio = function() {
        var a = b.createElement("audio")
          , c = !1;
        try {
            if (c = !!a.canPlayType)
                c = new Boolean(c),
                c.ogg = a.canPlayType('audio/ogg; codecs="vorbis"'),
                c.mp3 = a.canPlayType("audio/mpeg;"),
                c.wav = a.canPlayType('audio/wav; codecs="1"'),
                c.m4a = a.canPlayType("audio/x-m4a;") || a.canPlayType("audio/aac;")
        } catch (d) {}
        return c
    }
    ;
    j.localstorage = function() {
        try {
            return !!localStorage.getItem
        } catch (a) {
            return !1
        }
    }
    ;
    j.sessionstorage = function() {
        try {
            return !!sessionStorage.getItem
        } catch (a) {
            return !1
        }
    }
    ;
    j.webworkers = function() {
        return !!a.Worker
    }
    ;
    j.applicationcache = function() {
        return !!a.applicationCache
    }
    ;
    j.svg = function() {
        return !!b.createElementNS && !!b.createElementNS("http://www.w3.org/2000/svg", "svg").createSVGRect
    }
    ;
    j.inlinesvg = function() {
        var a = b.createElement("div");
        a.innerHTML = "<svg/>";
        return "http://www.w3.org/2000/svg" == (a.firstChild && a.firstChild.namespaceURI)
    }
    ;
    j.smil = function() {
        return !!b.createElementNS && /SVG/.test(o.call(b.createElementNS("http://www.w3.org/2000/svg", "animate")))
    }
    ;
    j.svgclippaths = function() {
        return !!b.createElementNS && /SVG/.test(o.call(b.createElementNS("http://www.w3.org/2000/svg", "clipPath")))
    }
    ;
    for (var C in j)
        z(j, C) && (y = C.toLowerCase(),
        h[y] = j[C](),
        v.push((h[y] ? "" : "no-") + y));
    h.input || d();
    h.addTest = function(a, b) {
        if ("object" == typeof a)
            for (var d in a)
                z(a, d) && h.addTest(d, a[d]);
        else {
            a = a.toLowerCase();
            if (h[a] !== c)
                return;
            b = "boolean" == typeof b ? b : !!b();
            i.className += " " + (b ? "" : "no-") + a;
            h[a] = b
        }
        return h
    }
    ;
    k.cssText = "";
    j = n = null;
    a.attachEvent && function() {
        var a = b.createElement("div");
        a.innerHTML = "<elem></elem>";
        return 1 !== a.childNodes.length
    }() && function(a, b) {
        function d(a) {
            for (var b = -1; ++b < h; )
                a.createElement(g[b])
        }
        a.iepp = a.iepp || {};
        var e = a.iepp, f = e.html5elements || "abbr|article|aside|audio|canvas|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video", g = f.split("|"), h = g.length, i = RegExp("(^|\\s)(" + f + ")", "gi"), j = RegExp("<(/*)(" + f + ")", "gi"), k = /^\s*[\{\}]\s*$/, n = RegExp("(^|[^\\n]*?\\s)(" + f + ")([^\\n]*)({[\\n\\w\\W]*?})", "gi"), o = b.createDocumentFragment(), p = b.documentElement, f = p.firstChild, q = b.createElement("body"), r = b.createElement("style"), s = /print|all/, u;
        e.getCSS = function(a, b) {
            if (a + "" === c)
                return "";
            for (var d = -1, f = a.length, g, h = []; ++d < f; )
                g = a[d],
                g.disabled || (b = g.media || b,
                s.test(b) && h.push(e.getCSS(g.imports, b), g.cssText),
                b = "all");
            return h.join("")
        }
        ;
        e.parseCSS = function(a) {
            for (var b = [], c; null != (c = n.exec(a)); )
                b.push(((k.exec(c[1]) ? "\n" : c[1]) + c[2] + c[3]).replace(i, "$1.iepp_$2") + c[4]);
            return b.join("\n")
        }
        ;
        e.writeHTML = function() {
            var a = -1;
            for (u = u || b.body; ++a < h; )
                for (var c = b.getElementsByTagName(g[a]), d = c.length, e = -1; ++e < d; )
                    0 > c[e].className.indexOf("iepp_") && (c[e].className += " iepp_" + g[a]);
            o.appendChild(u);
            p.appendChild(q);
            q.className = u.className;
            q.id = u.id;
            q.innerHTML = u.innerHTML.replace(j, "<$1font")
        }
        ;
        e._beforePrint = function() {
            r.styleSheet.cssText = e.parseCSS(e.getCSS(b.styleSheets, "all"));
            e.writeHTML()
        }
        ;
        e.restoreHTML = function() {
            q.innerHTML = "";
            p.removeChild(q);
            p.appendChild(u)
        }
        ;
        e._afterPrint = function() {
            e.restoreHTML();
            r.styleSheet.cssText = ""
        }
        ;
        d(b);
        d(o);
        e.disablePP || (f.insertBefore(r, f.firstChild),
        r.media = "print",
        r.className = "iepp-printshim",
        a.attachEvent("onbeforeprint", e._beforePrint),
        a.attachEvent("onafterprint", e._afterPrint))
    }(a, b);
    h._version = "2.0.6";
    h._prefixes = r;
    h._domPrefixes = q;
    h.mq = function(b) {
        if (a.matchMedia)
            return matchMedia(b).matches;
        var c;
        x("@media " + b + " { #modernizr { position: absolute; } }", function(b) {
            c = "absolute" == (a.getComputedStyle ? getComputedStyle(b, null) : b.currentStyle).position
        });
        return c
    }
    ;
    h.hasEvent = u;
    h.testProp = function(a) {
        return f([a])
    }
    ;
    h.testAllProps = e;
    h.testStyles = x;
    h.prefixed = function(a) {
        return e(a, "pfx")
    }
    ;
    i.className = i.className.replace(/\bno-js\b/, "") + (" js " + v.join(" "));
    return h
}(this, this.document);
(function(a, b) {
    function c() {
        t(!0)
    }
    a.respond = {};
    respond.update = function() {}
    ;
    respond.mediaQueriesSupported = b;
    if (!b) {
        var d = a.document, e = d.documentElement, f = [], g = [], h = [], i = {}, j = d.getElementsByTagName("head")[0] || e, k = j.getElementsByTagName("link"), n = [], p = function() {
            for (var b = k.length, c = 0, d, e, f; c < b; c++)
                d = k[c],
                e = d.href,
                f = d.media,
                d = d.rel && "stylesheet" === d.rel.toLowerCase(),
                e && d && !i[e] && (!/^([a-zA-Z]+?:(\/\/)?(www\.)?)/.test(e) || e.replace(RegExp.$1, "").split("/")[0] === a.location.host ? n.push({
                    href: e,
                    media: f
                }) : i[e] = !0);
            o()
        }, o = function() {
            if (n.length) {
                var a = n.shift();
                v(a.href, function(b) {
                    r(b, a.href, a.media);
                    i[a.href] = !0;
                    o()
                })
            }
        }, r = function(a, b, c) {
            var d = a.match(/@media[^\{]+\{([^\{\}]+\{[^\}\{]+\})+/gi), e = d && d.length || 0, b = b.substring(0, b.lastIndexOf("/")), h = function(a) {
                return a.replace(/(url\()['"]?([^\/\)'"][^:\)'"]+)['"]?(\))/g, "$1" + b + "$2$3")
            }, i = !e && c, j = 0, k, n, o, p, q;
            b.length && (b += "/");
            for (i && (e = 1); j < e; j++) {
                k = 0;
                i ? (n = c,
                g.push(h(a))) : (n = d[j].match(/@media ([^\{]+)\{([\S\s]+?)$/) && RegExp.$1,
                g.push(RegExp.$2 && h(RegExp.$2)));
                p = n.split(",");
                for (q = p.length; k < q; k++)
                    o = p[k],
                    f.push({
                        media: o.match(/(only\s+)?([a-zA-Z]+)(\sand)?/) && RegExp.$2,
                        rules: g.length - 1,
                        minw: o.match(/\(min\-width:[\s]*([\s]*[0-9]+)px[\s]*\)/) && parseFloat(RegExp.$1),
                        maxw: o.match(/\(max\-width:[\s]*([\s]*[0-9]+)px[\s]*\)/) && parseFloat(RegExp.$1)
                    })
            }
            t()
        }, q, s, t = function(a) {
            var b = e.clientWidth
              , c = "CSS1Compat" === d.compatMode && b || d.body.clientWidth || b
              , b = {}
              , i = d.createDocumentFragment()
              , n = k[k.length - 1]
              , o = (new Date).getTime();
            if (a && q && 30 > o - q)
                clearTimeout(s),
                s = setTimeout(t, 30);
            else {
                q = o;
                for (var p in f)
                    if (a = f[p],
                    !a.minw && !a.maxw || (!a.minw || a.minw && c >= a.minw) && (!a.maxw || a.maxw && c <= a.maxw))
                        b[a.media] || (b[a.media] = []),
                        b[a.media].push(g[a.rules]);
                for (p in h)
                    h[p] && h[p].parentNode === j && j.removeChild(h[p]);
                for (p in b)
                    a = d.createElement("style"),
                    c = b[p].join("\n"),
                    a.type = "text/css",
                    a.media = p,
                    a.styleSheet ? a.styleSheet.cssText = c : a.appendChild(d.createTextNode(c)),
                    i.appendChild(a),
                    h.push(a);
                j.insertBefore(i, n.nextSibling)
            }
        }, v = function(a, b) {
            var c = x();
            c && (c.open("GET", a, !0),
            c.onreadystatechange = function() {
                4 == c.readyState && (200 == c.status || 304 == c.status) && b(c.responseText)
            }
            ,
            4 != c.readyState && c.send())
        }, x = function() {
            for (var a = !1, b = [function() {
                return new ActiveXObject("Microsoft.XMLHTTP")
            }
            , function() {
                return new XMLHttpRequest
            }
            ], c = b.length; c--; ) {
                try {
                    a = b[c]()
                } catch (d) {
                    continue
                }
                break
            }
            return function() {
                return a
            }
        }();
        p();
        respond.update = p;
        a.addEventListener ? a.addEventListener("resize", c, !1) : a.attachEvent && a.attachEvent("onresize", c)
    }
}
)(this, Modernizr.mq("only all"));
(function(a, b, c) {
    function d() {
        for (var a = 1, b = -1; r.length - ++b && (!r[b].s || (a = r[b].r)); )
            ;
        a && g()
    }
    function e(a) {
        var c = b.createElement("script"), e;
        c.src = a.s;
        c.onreadystatechange = c.onload = function() {
            !e && (!c.readyState || "loaded" == c.readyState || "complete" == c.readyState) && (e = 1,
            d(),
            c.onload = c.onreadystatechange = null)
        }
        ;
        n(function() {
            e || (e = 1,
            d())
        }, N.errorTimeout);
        a.e ? c.onload() : p.parentNode.insertBefore(c, p)
    }
    function f(a) {
        var c = b.createElement("link"), e;
        c.href = a.s;
        c.rel = "stylesheet";
        c.type = "text/css";
        if (!a.e && (u || s)) {
            var f = function(a) {
                n(function() {
                    if (!e)
                        try {
                            a.sheet.cssRules.length ? (e = 1,
                            d()) : f(a)
                        } catch (b) {
                            1E3 == b.code || "security" == b.message || "denied" == b.message ? (e = 1,
                            n(function() {
                                d()
                            }, 0)) : f(a)
                        }
                }, 0)
            };
            f(c)
        } else
            c.onload = function() {
                e || (e = 1,
                n(function() {
                    d()
                }, 0))
            }
            ,
            a.e && c.onload();
        n(function() {
            e || (e = 1,
            d())
        }, N.errorTimeout);
        !a.e && p.parentNode.insertBefore(c, p)
    }
    function g() {
        var a = r.shift();
        q = 1;
        a ? a.t ? n(function() {
            "c" == a.t ? f(a) : e(a)
        }, 0) : (a(),
        d()) : q = 0
    }
    function h(a, c, e, f, h, i) {
        function j() {
            !o && (!k.readyState || "loaded" == k.readyState || "complete" == k.readyState) && (s.r = o = 1,
            !q && d(),
            k.onload = k.onreadystatechange = null,
            n(function() {
                v.removeChild(k)
            }, 0))
        }
        var k = b.createElement(a)
          , o = 0
          , s = {
            t: e,
            s: c,
            e: i
        };
        k.src = k.data = c;
        !t && (k.style.display = "none");
        k.width = k.height = "0";
        "object" != a && (k.type = e);
        k.onload = k.onreadystatechange = j;
        "img" == a ? k.onerror = j : "script" == a && (k.onerror = function() {
            s.e = s.r = 1;
            g()
        }
        );
        r.splice(f, 0, s);
        v.insertBefore(k, t ? null : p);
        n(function() {
            o || (v.removeChild(k),
            s.r = s.e = o = 1,
            d())
        }, N.errorTimeout)
    }
    function i(a, b, c) {
        var d = "c" == b ? z : E;
        q = 0;
        b = b || "j";
        w(a) ? h(d, a, b, this.i++, k, c) : (r.splice(this.i++, 0, a),
        1 == r.length && g());
        return this
    }
    function j() {
        var a = N;
        a.loader = {
            load: i,
            i: 0
        };
        return a
    }
    var k = b.documentElement, n = a.setTimeout, p = b.getElementsByTagName("script")[0], o = {}.toString, r = [], q = 0, s = "MozAppearance"in k.style, t = s && !!b.createRange().compareNode, v = t ? k : p.parentNode, x = a.opera && "[object Opera]" == o.call(a.opera), u = "webkitAppearance"in k.style, y = u && "async"in b.createElement("script"), E = s ? "object" : x || y ? "img" : "script", z = u ? "img" : E, C = Array.isArray || function(a) {
        return "[object Array]" == o.call(a)
    }
    , w = function(a) {
        return "string" == typeof a
    }, H = function(a) {
        return "[object Function]" == o.call(a)
    }, L = [], I = {}, P, N;
    N = function(a) {
        function b(a) {
            var a = a.split("!"), c = L.length, d = a.pop(), e = a.length, d = {
                url: d,
                origUrl: d,
                prefixes: a
            }, f, g;
            for (g = 0; g < e; g++)
                (f = I[a[g]]) && (d = f(d));
            for (g = 0; g < c; g++)
                d = L[g](d);
            return d
        }
        function d(a, e, f, g, h) {
            var i = b(a)
              , k = i.autoCallback;
            if (!i.bypass) {
                e && (e = H(e) ? e : e[a] || e[g] || e[a.split("/").pop().split("?")[0]]);
                if (i.instead)
                    return i.instead(a, e, f, g, h);
                f.load(i.url, i.forceCSS || !i.forceJS && /css$/.test(i.url) ? "c" : c, i.noexec);
                (H(e) || H(k)) && f.load(function() {
                    j();
                    e && e(i.origUrl, h, g);
                    k && k(i.origUrl, h, g)
                })
            }
        }
        function e(a, b) {
            function c(a) {
                if (w(a))
                    d(a, h, b, 0, f);
                else if (Object(a) === a)
                    for (i in a)
                        a.hasOwnProperty(i) && d(a[i], h, b, i, f)
            }
            var f = !!a.test, g = a.load || a.both, h = a.callback, i;
            c(f ? a.yep : a.nope);
            c(g);
            a.complete && b.load(a.complete)
        }
        var f, g, h = this.yepnope.loader;
        if (w(a))
            d(a, 0, h, 0);
        else if (C(a))
            for (f = 0; f < a.length; f++)
                g = a[f],
                w(g) ? d(g, 0, h, 0) : C(g) ? N(g) : Object(g) === g && e(g, h);
        else
            Object(a) === a && e(a, h)
    }
    ;
    N.addPrefix = function(a, b) {
        I[a] = b
    }
    ;
    N.addFilter = function(a) {
        L.push(a)
    }
    ;
    N.errorTimeout = 1E4;
    null == b.readyState && b.addEventListener && (b.readyState = "loading",
    b.addEventListener("DOMContentLoaded", P = function() {
        b.removeEventListener("DOMContentLoaded", P, 0);
        b.readyState = "complete"
    }
    , 0));
    a.yepnope = j()
}
)(this, this.document);
Modernizr.load = function() {
    yepnope.apply(window, [].slice.call(arguments, 0))
}
;
var Conrec = function() {
    var a = function(a, b) {
        var c = a.x - b.x
          , d = a.y - b.y;
        return 1.0E-20 > c * c + d * d
    }
      , b = function(a) {
        for (var b = a.head; b; ) {
            var c = b.next;
            b.next = b.prev;
            b = b.prev = c
        }
        c = a.head;
        a.head = a.tail;
        a.tail = c
    }
      , c = function(a) {
        this.level = a;
        this.s = null;
        this.count = 0
    };
    c.prototype.remove_seq = function(a) {
        a.prev ? a.prev.next = a.next : this.s = a.next;
        a.next && (a.next.prev = a.prev);
        --this.count
    }
    ;
    c.prototype.addSegment = function(c, d) {
        for (var g = this.s, h = null, i = null, j = !1, k = !1; g && !(null == h && (a(c, g.head.p) ? (h = g,
        j = !0) : a(c, g.tail.p) && (h = g)),
        null == i && (a(d, g.head.p) ? (i = g,
        k = !0) : a(d, g.tail.p) && (i = g)),
        null != i && null != h); )
            g = g.next;
        switch ((null != h ? 1 : 0) | (null != i ? 2 : 0)) {
        case 0:
            h = {
                p: c,
                prev: null
            };
            i = {
                p: d,
                next: null
            };
            h.next = i;
            i.prev = h;
            h = {
                head: h,
                tail: i,
                next: this.s,
                prev: null,
                closed: !1
            };
            this.s && (this.s.prev = h);
            this.s = h;
            ++this.count;
            break;
        case 1:
            g = {
                p: d
            };
            j ? (g.next = h.head,
            g.prev = null,
            h.head.prev = g,
            h.head = g) : (g.next = null,
            g.prev = h.tail,
            h.tail.next = g,
            h.tail = g);
            break;
        case 2:
            g = {
                p: c
            };
            k ? (g.next = i.head,
            g.prev = null,
            i.head.prev = g,
            i.head = g) : (g.next = null,
            g.prev = i.tail,
            i.tail.next = g,
            i.tail = g);
            break;
        case 3:
            if (h === i) {
                g = {
                    p: h.tail.p,
                    next: h.head,
                    prev: null
                };
                h.head.prev = g;
                h.head = g;
                h.closed = !0;
                break
            }
            switch ((j ? 1 : 0) | (k ? 2 : 0)) {
            case 0:
                b(h);
            case 1:
                i.tail.next = h.head;
                h.head.prev = i.tail;
                i.tail = h.tail;
                this.remove_seq(h);
                break;
            case 3:
                b(h);
            case 2:
                h.tail.next = i.head,
                i.head.prev = h.tail,
                h.tail = i.tail,
                this.remove_seq(i)
            }
        }
    }
    ;
    var d = function(a) {
        if (a)
            this.drawContour = a;
        else {
            var b = this;
            b.contours = {};
            this.drawContour = function(a, d, e, j, k, n) {
                var p = b.contours[n];
                p || (p = b.contours[n] = new c(k));
                p.addSegment({
                    x: a,
                    y: d
                }, {
                    x: e,
                    y: j
                })
            }
            ;
            this.contourList = function() {
                var a = [], c = b.contours, d;
                for (d in c)
                    for (var e = c[d].s, k = c[d].level; e; ) {
                        var n = e.head
                          , p = [];
                        p.level = k;
                        for (p.k = d; n && n.p; )
                            p.push(n.p),
                            n = n.next;
                        a.push(p);
                        e = e.next
                    }
                a.sort(function(a, b) {
                    return b.k - a.k
                });
                return a
            }
        }
        this.h = Array(5);
        this.sh = Array(5);
        this.xh = Array(5);
        this.yh = Array(5)
    };
    d.prototype.contour = function(a, b, c, d) {
        var i = b.length - 1
          , j = c.length - 1
          , k = d.length
          , n = this.h
          , p = this.sh
          , o = this.xh
          , r = this.yh
          , q = this.drawContour;
        this.contours = {};
        for (var s = function(a, b) {
            return (n[b] * o[a] - n[a] * o[b]) / (n[b] - n[a])
        }, t = function(a, b) {
            return (n[b] * r[a] - n[a] * r[b]) / (n[b] - n[a])
        }, v, x, u, y, E = 0, z = 0, C = 0, w = 0, H = [0, 1, 1, 0], L = [0, 0, 1, 1], I = [[[0, 0, 8], [0, 2, 5], [7, 6, 9]], [[0, 3, 4], [1, 3, 1], [4, 3, 0]], [[9, 6, 7], [5, 2, 0], [8, 0, 0]]], P = j - 1; 0 <= P; P--)
            for (var N = 0; N <= i - 1; N++)
                if (v = Math.min(a[N][P], a[N][P + 1]),
                x = Math.min(a[N + 1][P], a[N + 1][P + 1]),
                j = Math.min(v, x),
                v = Math.max(a[N][P], a[N][P + 1]),
                x = Math.max(a[N + 1][P], a[N + 1][P + 1]),
                y = Math.max(v, x),
                y >= d[0] && j <= d[k - 1])
                    for (var A = 0; A < k; A++)
                        if (d[A] >= j && d[A] <= y) {
                            for (var J = 4; 0 <= J; J--)
                                0 < J ? (n[J] = a[N + H[J - 1]][P + L[J - 1]] - d[A],
                                o[J] = b[N + H[J - 1]],
                                r[J] = c[P + L[J - 1]]) : (n[0] = 0.25 * (n[1] + n[2] + n[3] + n[4]),
                                o[0] = 0.5 * (b[N] + b[N + 1]),
                                r[0] = 0.5 * (c[P] + c[P + 1])),
                                p[J] = 0 < n[J] ? 1 : 0 > n[J] ? -1 : 0;
                            for (J = 1; 4 >= J; J++)
                                if (v = J,
                                x = 4 != J ? J + 1 : 1,
                                u = I[p[v] + 1][p[0] + 1][p[x] + 1],
                                0 != u) {
                                    switch (u) {
                                    case 1:
                                        E = o[v];
                                        C = r[v];
                                        z = o[0];
                                        w = r[0];
                                        break;
                                    case 2:
                                        E = o[0];
                                        C = r[0];
                                        z = o[x];
                                        w = r[x];
                                        break;
                                    case 3:
                                        E = o[x];
                                        C = r[x];
                                        z = o[v];
                                        w = r[v];
                                        break;
                                    case 4:
                                        E = o[v];
                                        C = r[v];
                                        z = s(0, x);
                                        w = t(0, x);
                                        break;
                                    case 5:
                                        E = o[0];
                                        C = r[0];
                                        z = s(x, v);
                                        w = t(x, v);
                                        break;
                                    case 6:
                                        E = o[x];
                                        C = r[x];
                                        z = s(v, 0);
                                        w = t(v, 0);
                                        break;
                                    case 7:
                                        E = s(v, 0);
                                        C = t(v, 0);
                                        z = s(0, x);
                                        w = t(0, x);
                                        break;
                                    case 8:
                                        E = s(0, x);
                                        C = t(0, x);
                                        z = s(x, v);
                                        w = t(x, v);
                                        break;
                                    case 9:
                                        E = s(x, v),
                                        C = t(x, v),
                                        z = s(v, 0),
                                        w = t(v, 0)
                                    }
                                    q(E, C, z, w, d[A], A)
                                }
                        }
    }
    ;
    return d
}();
"undefined" !== typeof exports && (exports.Conrec = Conrec);
var dat = dat || {};
dat.gui = dat.gui || {};
dat.utils = dat.utils || {};
dat.controllers = dat.controllers || {};
dat.dom = dat.dom || {};
dat.color = dat.color || {};
dat.utils.css = function() {
    return {
        load: function(a, b) {
            var b = b || document
              , c = b.createElement("link");
            c.type = "text/css";
            c.rel = "stylesheet";
            c.href = a;
            b.getElementsByTagName("head")[0].appendChild(c)
        },
        inject: function(a, b) {
            var b = b || document
              , c = document.createElement("style");
            c.type = "text/css";
            c.innerHTML = a;
            b.getElementsByTagName("head")[0].appendChild(c)
        }
    }
}();
dat.utils.common = function() {
    var a = Array.prototype.forEach
      , b = Array.prototype.slice;
    return {
        BREAK: {},
        extend: function(a) {
            this.each(b.call(arguments, 1), function(b) {
                for (var e in b)
                    this.isUndefined(b[e]) || (a[e] = b[e])
            }, this);
            return a
        },
        defaults: function(a) {
            this.each(b.call(arguments, 1), function(b) {
                for (var e in b)
                    this.isUndefined(a[e]) && (a[e] = b[e])
            }, this);
            return a
        },
        compose: function() {
            var a = b.call(arguments);
            return function() {
                for (var d = b.call(arguments), e = a.length - 1; e >= 0; e--)
                    d = [a[e].apply(this, d)];
                return d[0]
            }
        },
        each: function(b, d, e) {
            if (a && b.forEach === a)
                b.forEach(d, e);
            else if (b.length === b.length + 0)
                for (var f = 0, g = b.length; f < g; f++) {
                    if (f in b && d.call(e, b[f], f) === this.BREAK)
                        break
                }
            else
                for (f in b)
                    if (d.call(e, b[f], f) === this.BREAK)
                        break
        },
        defer: function(a) {
            setTimeout(a, 0)
        },
        toArray: function(a) {
            return a.toArray ? a.toArray() : b.call(a)
        },
        isUndefined: function(a) {
            return a === void 0
        },
        isNull: function(a) {
            return a === null
        },
        isNaN: function(a) {
            return a !== a
        },
        isArray: Array.isArray || function(a) {
            return a.constructor === Array
        }
        ,
        isObject: function(a) {
            return a === Object(a)
        },
        isNumber: function(a) {
            return a === a + 0
        },
        isString: function(a) {
            return a === a + ""
        },
        isBoolean: function(a) {
            return a === false || a === true
        },
        isFunction: function(a) {
            return Object.prototype.toString.call(a) === "[object Function]"
        }
    }
}();
dat.controllers.Controller = function(a) {
    var b = function(a, b) {
        this.initialValue = a[b];
        this.domElement = document.createElement("div");
        this.object = a;
        this.property = b;
        this.__onFinishChange = this.__onChange = void 0
    };
    a.extend(b.prototype, {
        onChange: function(a) {
            this.__onChange = a;
            return this
        },
        onFinishChange: function(a) {
            this.__onFinishChange = a;
            return this
        },
        setValue: function(a) {
            this.object[this.property] = a;
            this.__onChange && this.__onChange.call(this, a);
            this.updateDisplay();
            return this
        },
        getValue: function() {
            return this.object[this.property]
        },
        updateDisplay: function() {
            return this
        },
        isModified: function() {
            return this.initialValue !== this.getValue()
        }
    });
    return b
}(dat.utils.common);
dat.dom.dom = function(a) {
    function b(b) {
        if (b === "0" || a.isUndefined(b))
            return 0;
        b = b.match(d);
        return !a.isNull(b) ? parseFloat(b[1]) : 0
    }
    var c = {};
    a.each({
        HTMLEvents: ["change"],
        MouseEvents: ["click", "mousemove", "mousedown", "mouseup", "mouseover"],
        KeyboardEvents: ["keydown"]
    }, function(b, d) {
        a.each(b, function(a) {
            c[a] = d
        })
    });
    var d = /(\d+(\.\d+)?)px/
      , e = {
        makeSelectable: function(a, b) {
            if (!(a === void 0 || a.style === void 0)) {
                a.onselectstart = b ? function() {
                    return false
                }
                : function() {}
                ;
                a.style.MozUserSelect = b ? "auto" : "none";
                a.style.KhtmlUserSelect = b ? "auto" : "none";
                a.unselectable = b ? "on" : "off"
            }
        },
        makeFullscreen: function(b, c, d) {
            a.isUndefined(c) && (c = true);
            a.isUndefined(d) && (d = true);
            b.style.position = "absolute";
            if (c) {
                b.style.left = 0;
                b.style.right = 0
            }
            if (d) {
                b.style.top = 0;
                b.style.bottom = 0
            }
        },
        fakeEvent: function(b, d, e, i) {
            var e = e || {}
              , j = c[d];
            if (!j)
                throw Error("Event type " + d + " not supported.");
            var k = document.createEvent(j);
            switch (j) {
            case "MouseEvents":
                k.initMouseEvent(d, e.bubbles || false, e.cancelable || true, window, e.clickCount || 1, 0, 0, e.x || e.clientX || 0, e.y || e.clientY || 0, false, false, false, false, 0, null);
                break;
            case "KeyboardEvents":
                j = k.initKeyboardEvent || k.initKeyEvent;
                a.defaults(e, {
                    cancelable: true,
                    ctrlKey: false,
                    altKey: false,
                    shiftKey: false,
                    metaKey: false,
                    keyCode: void 0,
                    charCode: void 0
                });
                j(d, e.bubbles || false, e.cancelable, window, e.ctrlKey, e.altKey, e.shiftKey, e.metaKey, e.keyCode, e.charCode);
                break;
            default:
                k.initEvent(d, e.bubbles || false, e.cancelable || true)
            }
            a.defaults(k, i);
            b.dispatchEvent(k)
        },
        bind: function(a, b, c, d) {
            a.addEventListener ? a.addEventListener(b, c, d || false) : a.attachEvent && a.attachEvent("on" + b, c);
            return e
        },
        unbind: function(a, b, c, d) {
            a.removeEventListener ? a.removeEventListener(b, c, d || false) : a.detachEvent && a.detachEvent("on" + b, c);
            return e
        },
        addClass: function(a, b) {
            if (a.className === void 0)
                a.className = b;
            else if (a.className !== b) {
                var c = a.className.split(/ +/);
                if (c.indexOf(b) == -1) {
                    c.push(b);
                    a.className = c.join(" ").replace(/^\s+/, "").replace(/\s+$/, "")
                }
            }
            return e
        },
        removeClass: function(a, b) {
            if (b) {
                if (a.className !== void 0)
                    if (a.className === b)
                        a.removeAttribute("class");
                    else {
                        var c = a.className.split(/ +/)
                          , d = c.indexOf(b);
                        if (d != -1) {
                            c.splice(d, 1);
                            a.className = c.join(" ")
                        }
                    }
            } else
                a.className = void 0;
            return e
        },
        hasClass: function(a, b) {
            return RegExp("(?:^|\\s+)" + b + "(?:\\s+|$)").test(a.className) || false
        },
        getWidth: function(a) {
            a = getComputedStyle(a);
            return b(a["border-left-width"]) + b(a["border-right-width"]) + b(a["padding-left"]) + b(a["padding-right"]) + b(a.width)
        },
        getHeight: function(a) {
            a = getComputedStyle(a);
            return b(a["border-top-width"]) + b(a["border-bottom-width"]) + b(a["padding-top"]) + b(a["padding-bottom"]) + b(a.height)
        },
        getOffset: function(a) {
            var b = {
                left: 0,
                top: 0
            };
            if (a.offsetParent) {
                do {
                    b.left = b.left + a.offsetLeft;
                    b.top = b.top + a.offsetTop
                } while (a = a.offsetParent)
            }
            return b
        },
        isActive: function(a) {
            return a === document.activeElement && (a.type || a.href)
        }
    };
    return e
}(dat.utils.common);
dat.controllers.OptionController = function(a, b, c) {
    var d = function(a, f, g) {
        d.superclass.call(this, a, f);
        var h = this;
        this.__select = document.createElement("select");
        if (c.isArray(g)) {
            var i = {};
            c.each(g, function(a) {
                i[a] = a
            });
            g = i
        }
        c.each(g, function(a, b) {
            var c = document.createElement("option");
            c.innerHTML = b;
            c.setAttribute("value", a);
            h.__select.appendChild(c)
        });
        this.updateDisplay();
        b.bind(this.__select, "change", function() {
            h.setValue(this.options[this.selectedIndex].value)
        });
        this.domElement.appendChild(this.__select)
    };
    d.superclass = a;
    c.extend(d.prototype, a.prototype, {
        setValue: function(a) {
            a = d.superclass.prototype.setValue.call(this, a);
            this.__onFinishChange && this.__onFinishChange.call(this, this.getValue());
            return a
        },
        updateDisplay: function() {
            this.__select.value = this.getValue();
            return d.superclass.prototype.updateDisplay.call(this)
        }
    });
    return d
}(dat.controllers.Controller, dat.dom.dom, dat.utils.common);
dat.controllers.NumberController = function(a, b) {
    var c = function(a, e, f) {
        c.superclass.call(this, a, e);
        f = f || {};
        this.__min = f.min;
        this.__max = f.max;
        this.__step = f.step;
        a = this.__impliedStep = b.isUndefined(this.__step) ? this.initialValue == 0 ? 1 : Math.pow(10, Math.floor(Math.log(this.initialValue) / Math.LN10)) / 10 : this.__step;
        a = a.toString();
        this.__precision = a.indexOf(".") > -1 ? a.length - a.indexOf(".") - 1 : 0
    };
    c.superclass = a;
    b.extend(c.prototype, a.prototype, {
        setValue: function(a) {
            if (this.__min !== void 0 && a < this.__min)
                a = this.__min;
            else if (this.__max !== void 0 && a > this.__max)
                a = this.__max;
            this.__step !== void 0 && a % this.__step != 0 && (a = Math.round(a / this.__step) * this.__step);
            return c.superclass.prototype.setValue.call(this, a)
        },
        min: function(a) {
            this.__min = a;
            return this
        },
        max: function(a) {
            this.__max = a;
            return this
        },
        step: function(a) {
            this.__step = a;
            return this
        }
    });
    return c
}(dat.controllers.Controller, dat.utils.common);
dat.controllers.NumberControllerBox = function(a, b, c) {
    var d = function(a, f, g) {
        function h() {
            var a = parseFloat(k.__input.value);
            c.isNaN(a) || k.setValue(a)
        }
        function i(a) {
            var b = n - a.clientY;
            k.setValue(k.getValue() + b * k.__impliedStep);
            n = a.clientY
        }
        function j() {
            b.unbind(window, "mousemove", i);
            b.unbind(window, "mouseup", j)
        }
        this.__truncationSuspended = false;
        d.superclass.call(this, a, f, g);
        var k = this, n;
        this.__input = document.createElement("input");
        this.__input.setAttribute("type", "text");
        b.bind(this.__input, "change", h);
        b.bind(this.__input, "blur", function() {
            h();
            k.__onFinishChange && k.__onFinishChange.call(k, k.getValue())
        });
        b.bind(this.__input, "mousedown", function(a) {
            b.bind(window, "mousemove", i);
            b.bind(window, "mouseup", j);
            n = a.clientY
        });
        b.bind(this.__input, "keydown", function(a) {
            if (a.keyCode === 13) {
                k.__truncationSuspended = true;
                this.blur();
                k.__truncationSuspended = false
            }
        });
        this.updateDisplay();
        this.domElement.appendChild(this.__input)
    };
    d.superclass = a;
    c.extend(d.prototype, a.prototype, {
        updateDisplay: function() {
            var a = this.__input, b;
            if (this.__truncationSuspended)
                b = this.getValue();
            else {
                b = this.getValue();
                var c = Math.pow(10, this.__precision);
                b = Math.round(b * c) / c
            }
            a.value = b;
            return d.superclass.prototype.updateDisplay.call(this)
        }
    });
    return d
}(dat.controllers.NumberController, dat.dom.dom, dat.utils.common);
dat.controllers.NumberControllerSlider = function(a, b, c, d, e) {
    var f = function(a, c, d, e, k) {
        function n(a) {
            a.preventDefault();
            var c = b.getOffset(o.__background)
              , d = b.getWidth(o.__background);
            o.setValue(o.__min + (o.__max - o.__min) * ((a.clientX - c.left) / (c.left + d - c.left)));
            return false
        }
        function p() {
            b.unbind(window, "mousemove", n);
            b.unbind(window, "mouseup", p);
            o.__onFinishChange && o.__onFinishChange.call(o, o.getValue())
        }
        f.superclass.call(this, a, c, {
            min: d,
            max: e,
            step: k
        });
        var o = this;
        this.__background = document.createElement("div");
        this.__foreground = document.createElement("div");
        b.bind(this.__background, "mousedown", function(a) {
            b.bind(window, "mousemove", n);
            b.bind(window, "mouseup", p);
            n(a)
        });
        b.addClass(this.__background, "slider");
        b.addClass(this.__foreground, "slider-fg");
        this.updateDisplay();
        this.__background.appendChild(this.__foreground);
        this.domElement.appendChild(this.__background)
    };
    f.superclass = a;
    f.useDefaultStyles = function() {
        c.inject(e)
    }
    ;
    d.extend(f.prototype, a.prototype, {
        updateDisplay: function() {
            this.__foreground.style.width = (this.getValue() - this.__min) / (this.__max - this.__min) * 100 + "%";
            return f.superclass.prototype.updateDisplay.call(this)
        }
    });
    return f
}(dat.controllers.NumberController, dat.dom.dom, dat.utils.css, dat.utils.common, ".slider {\n  box-shadow: inset 0 2px 4px rgba(0,0,0,0.15);\n  height: 1em;\n  border-radius: 1em;\n  background-color: #eee;\n  padding: 0 0.5em;\n  overflow: hidden;\n}\n\n.slider-fg {\n  padding: 1px 0 2px 0;\n  background-color: #aaa;\n  height: 1em;\n  margin-left: -0.5em;\n  padding-right: 0.5em;\n  border-radius: 1em 0 0 1em;\n}\n\n.slider-fg:after {\n  display: inline-block;\n  border-radius: 1em;\n  background-color: #fff;\n  border:  1px solid #aaa;\n  content: '';\n  float: right;\n  margin-right: -1em;\n  margin-top: -1px;\n  height: 0.9em;\n  width: 0.9em;\n}");
dat.controllers.FunctionController = function(a, b, c) {
    var d = function(a, c, g) {
        d.superclass.call(this, a, c);
        var h = this;
        this.__button = document.createElement("div");
        this.__button.innerHTML = g === void 0 ? "Fire" : g;
        b.bind(this.__button, "click", function(a) {
            a.preventDefault();
            h.fire();
            return false
        });
        b.addClass(this.__button, "button");
        this.domElement.appendChild(this.__button)
    };
    d.superclass = a;
    c.extend(d.prototype, a.prototype, {
        fire: function() {
            this.__onChange && this.__onChange.call(this);
            this.__onFinishChange && this.__onFinishChange.call(this, this.getValue());
            this.getValue().call(this.object)
        }
    });
    return d
}(dat.controllers.Controller, dat.dom.dom, dat.utils.common);
dat.controllers.BooleanController = function(a, b, c) {
    var d = function(a, c) {
        d.superclass.call(this, a, c);
        var g = this;
        this.__prev = this.getValue();
        this.__checkbox = document.createElement("input");
        this.__checkbox.setAttribute("type", "checkbox");
        b.bind(this.__checkbox, "change", function() {
            g.setValue(!g.__prev)
        }, false);
        this.domElement.appendChild(this.__checkbox);
        this.updateDisplay()
    };
    d.superclass = a;
    c.extend(d.prototype, a.prototype, {
        setValue: function(a) {
            a = d.superclass.prototype.setValue.call(this, a);
            this.__onFinishChange && this.__onFinishChange.call(this, this.getValue());
            this.__prev = this.getValue();
            return a
        },
        updateDisplay: function() {
            this.getValue() === true ? (this.__checkbox.setAttribute("checked", "checked"),
            this.__checkbox.checked = true) : this.__checkbox.checked = false;
            return d.superclass.prototype.updateDisplay.call(this)
        }
    });
    return d
}(dat.controllers.Controller, dat.dom.dom, dat.utils.common);
dat.color.toString = function(a) {
    return function(b) {
        if (b.a == 1 || a.isUndefined(b.a)) {
            for (b = b.hex.toString(16); b.length < 6; )
                b = "0" + b;
            return "#" + b
        }
        return "rgba(" + Math.round(b.r) + "," + Math.round(b.g) + "," + Math.round(b.b) + "," + b.a + ")"
    }
}(dat.utils.common);
dat.color.interpret = function(a, b) {
    var c, d, e = [{
        litmus: b.isString,
        conversions: {
            THREE_CHAR_HEX: {
                read: function(a) {
                    a = a.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);
                    return a === null ? false : {
                        space: "HEX",
                        hex: parseInt("0x" + a[1].toString() + a[1].toString() + a[2].toString() + a[2].toString() + a[3].toString() + a[3].toString())
                    }
                },
                write: a
            },
            SIX_CHAR_HEX: {
                read: function(a) {
                    a = a.match(/^#([A-F0-9]{6})$/i);
                    return a === null ? false : {
                        space: "HEX",
                        hex: parseInt("0x" + a[1].toString())
                    }
                },
                write: a
            },
            CSS_RGB: {
                read: function(a) {
                    a = a.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);
                    return a === null ? false : {
                        space: "RGB",
                        r: parseFloat(a[1]),
                        g: parseFloat(a[2]),
                        b: parseFloat(a[3])
                    }
                },
                write: a
            },
            CSS_RGBA: {
                read: function(a) {
                    a = a.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\,\s*(.+)\s*\)/);
                    return a === null ? false : {
                        space: "RGB",
                        r: parseFloat(a[1]),
                        g: parseFloat(a[2]),
                        b: parseFloat(a[3]),
                        a: parseFloat(a[4])
                    }
                },
                write: a
            }
        }
    }, {
        litmus: b.isNumber,
        conversions: {
            HEX: {
                read: function(a) {
                    return {
                        space: "HEX",
                        hex: a,
                        conversionName: "HEX"
                    }
                },
                write: function(a) {
                    return a.hex
                }
            }
        }
    }, {
        litmus: b.isArray,
        conversions: {
            RGB_ARRAY: {
                read: function(a) {
                    return a.length != 3 ? false : {
                        space: "RGB",
                        r: a[0],
                        g: a[1],
                        b: a[2]
                    }
                },
                write: function(a) {
                    return [a.r, a.g, a.b]
                }
            },
            RGBA_ARRAY: {
                read: function(a) {
                    return a.length != 4 ? false : {
                        space: "RGB",
                        r: a[0],
                        g: a[1],
                        b: a[2],
                        a: a[3]
                    }
                },
                write: function(a) {
                    return [a.r, a.g, a.b, a.a]
                }
            }
        }
    }, {
        litmus: b.isObject,
        conversions: {
            RGBA_OBJ: {
                read: function(a) {
                    return b.isNumber(a.r) && b.isNumber(a.g) && b.isNumber(a.b) && b.isNumber(a.a) ? {
                        space: "RGB",
                        r: a.r,
                        g: a.g,
                        b: a.b,
                        a: a.a
                    } : false
                },
                write: function(a) {
                    return {
                        r: a.r,
                        g: a.g,
                        b: a.b,
                        a: a.a
                    }
                }
            },
            RGB_OBJ: {
                read: function(a) {
                    return b.isNumber(a.r) && b.isNumber(a.g) && b.isNumber(a.b) ? {
                        space: "RGB",
                        r: a.r,
                        g: a.g,
                        b: a.b
                    } : false
                },
                write: function(a) {
                    return {
                        r: a.r,
                        g: a.g,
                        b: a.b
                    }
                }
            },
            HSVA_OBJ: {
                read: function(a) {
                    return b.isNumber(a.h) && b.isNumber(a.s) && b.isNumber(a.v) && b.isNumber(a.a) ? {
                        space: "HSV",
                        h: a.h,
                        s: a.s,
                        v: a.v,
                        a: a.a
                    } : false
                },
                write: function(a) {
                    return {
                        h: a.h,
                        s: a.s,
                        v: a.v,
                        a: a.a
                    }
                }
            },
            HSV_OBJ: {
                read: function(a) {
                    return b.isNumber(a.h) && b.isNumber(a.s) && b.isNumber(a.v) ? {
                        space: "HSV",
                        h: a.h,
                        s: a.s,
                        v: a.v
                    } : false
                },
                write: function(a) {
                    return {
                        h: a.h,
                        s: a.s,
                        v: a.v
                    }
                }
            }
        }
    }];
    return function() {
        d = false;
        var a = arguments.length > 1 ? b.toArray(arguments) : arguments[0];
        b.each(e, function(e) {
            if (e.litmus(a))
                return b.each(e.conversions, function(e, g) {
                    c = e.read(a);
                    if (d === false && c !== false)
                        return d = c,
                        c.conversionName = g,
                        c.conversion = e,
                        b.BREAK
                }),
                b.BREAK
        });
        return d
    }
}(dat.color.toString, dat.utils.common);
dat.GUI = dat.gui.GUI = function(a, b, c, d, e, f, g, h, i, j, k, n, p, o, r) {
    function q(a, b, c, f) {
        if (b[c] === void 0)
            throw Error("Object " + b + ' has no property "' + c + '"');
        f.color ? b = new k(b,c) : (b = [b, c].concat(f.factoryArgs),
        b = d.apply(a, b));
        if (f.before instanceof e)
            f.before = f.before.__li;
        v(a, b);
        o.addClass(b.domElement, "c");
        c = document.createElement("span");
        o.addClass(c, "property-name");
        c.innerHTML = b.property;
        var g = document.createElement("div");
        g.appendChild(c);
        g.appendChild(b.domElement);
        f = s(a, g, f.before);
        o.addClass(f, l.CLASS_CONTROLLER_ROW);
        o.addClass(f, typeof b.getValue());
        t(a, f, b);
        a.__controllers.push(b);
        return b
    }
    function s(a, b, c) {
        var d = document.createElement("li");
        b && d.appendChild(b);
        c ? a.__ul.insertBefore(d, params.before) : a.__ul.appendChild(d);
        a.onResize();
        return d
    }
    function t(a, b, c) {
        c.__li = b;
        c.__gui = a;
        r.extend(c, {
            options: function(b) {
                if (arguments.length > 1)
                    return c.remove(),
                    q(a, c.object, c.property, {
                        before: c.__li.nextElementSibling,
                        factoryArgs: [r.toArray(arguments)]
                    });
                if (r.isArray(b) || r.isObject(b))
                    return c.remove(),
                    q(a, c.object, c.property, {
                        before: c.__li.nextElementSibling,
                        factoryArgs: [b]
                    })
            },
            name: function(a) {
                c.__li.firstElementChild.firstElementChild.innerHTML = a;
                return c
            },
            listen: function() {
                c.__gui.listen(c);
                return c
            },
            remove: function() {
                c.__gui.remove(c);
                return c
            }
        });
        if (c instanceof i) {
            var d = new h(c.object,c.property,{
                min: c.__min,
                max: c.__max,
                step: c.__step
            });
            r.each(["updateDisplay", "onChange", "onFinishChange"], function(a) {
                var b = c[a]
                  , e = d[a];
                c[a] = d[a] = function() {
                    var a = Array.prototype.slice.call(arguments);
                    b.apply(c, a);
                    return e.apply(d, a)
                }
            });
            o.addClass(b, "has-slider");
            c.domElement.insertBefore(d.domElement, c.domElement.firstElementChild)
        } else if (c instanceof h) {
            var e = function(b) {
                return r.isNumber(c.__min) && r.isNumber(c.__max) ? (c.remove(),
                q(a, c.object, c.property, {
                    before: c.__li.nextElementSibling,
                    factoryArgs: [c.__min, c.__max, c.__step]
                })) : b
            };
            c.min = r.compose(e, c.min);
            c.max = r.compose(e, c.max)
        } else if (c instanceof f) {
            o.bind(b, "click", function() {
                o.fakeEvent(c.__checkbox, "click")
            });
            o.bind(c.__checkbox, "click", function(a) {
                a.stopPropagation()
            })
        } else if (c instanceof g) {
            o.bind(b, "click", function() {
                o.fakeEvent(c.__button, "click")
            });
            o.bind(b, "mouseover", function() {
                o.addClass(c.__button, "hover")
            });
            o.bind(b, "mouseout", function() {
                o.removeClass(c.__button, "hover")
            })
        } else if (c instanceof k) {
            o.addClass(b, "color");
            c.updateDisplay = r.compose(function(a) {
                b.style.borderLeftColor = c.__color.toString();
                return a
            }, c.updateDisplay);
            c.updateDisplay()
        }
        c.setValue = r.compose(function(b) {
            a.getRoot().__preset_select && c.isModified() && C(a.getRoot(), true);
            return b
        }, c.setValue)
    }
    function v(a, b) {
        var c = a.getRoot()
          , d = c.__rememberedObjects.indexOf(b.object);
        if (d != -1) {
            var e = c.__rememberedObjectIndecesToControllers[d];
            e === void 0 && (e = {},
            c.__rememberedObjectIndecesToControllers[d] = e);
            e[b.property] = b;
            if (c.load && c.load.remembered) {
                c = c.load.remembered;
                if (c[a.preset])
                    c = c[a.preset];
                else if (c[H])
                    c = c[H];
                else
                    return;
                if (c[d] && c[d][b.property] !== void 0) {
                    d = c[d][b.property];
                    b.initialValue = d;
                    b.setValue(d)
                }
            }
        }
    }
    function x(a) {
        var b = a.__save_row = document.createElement("li");
        o.addClass(a.domElement, "has-save");
        a.__ul.insertBefore(b, a.__ul.firstChild);
        o.addClass(b, "save-row");
        var c = document.createElement("span");
        c.innerHTML = "&nbsp;";
        o.addClass(c, "button gears");
        var d = document.createElement("span");
        d.innerHTML = "Save";
        o.addClass(d, "button");
        o.addClass(d, "save");
        var e = document.createElement("span");
        e.innerHTML = "New";
        o.addClass(e, "button");
        o.addClass(e, "save-as");
        var f = document.createElement("span");
        f.innerHTML = "Revert";
        o.addClass(f, "button");
        o.addClass(f, "revert");
        var g = a.__preset_select = document.createElement("select");
        a.load && a.load.remembered ? r.each(a.load.remembered, function(b, c) {
            z(a, c, c == a.preset)
        }) : z(a, H, false);
        o.bind(g, "change", function() {
            for (var b = 0; b < a.__preset_select.length; b++)
                a.__preset_select[b].innerHTML = a.__preset_select[b].value;
            a.preset = this.value
        });
        b.appendChild(g);
        b.appendChild(c);
        b.appendChild(d);
        b.appendChild(e);
        b.appendChild(f);
        if (L) {
            var b = document.getElementById("dg-save-locally")
              , h = document.getElementById("dg-local-explain");
            b.style.display = "block";
            b = document.getElementById("dg-local-storage");
            localStorage.getItem(document.location.href + ".isLocal") === "true" && b.setAttribute("checked", "checked");
            var i = function() {
                h.style.display = a.useLocalStorage ? "block" : "none"
            };
            i();
            o.bind(b, "change", function() {
                a.useLocalStorage = !a.useLocalStorage;
                i()
            })
        }
        var j = document.getElementById("dg-new-constructor");
        o.bind(j, "keydown", function(a) {
            a.metaKey && (a.which === 67 || a.keyCode == 67) && P.hide()
        });
        o.bind(c, "click", function() {
            j.innerHTML = JSON.stringify(a.getSaveObject(), void 0, 2);
            P.show();
            j.focus();
            j.select()
        });
        o.bind(d, "click", function() {
            a.save()
        });
        o.bind(e, "click", function() {
            var b = prompt("Enter a new preset name.");
            b && a.saveAs(b)
        });
        o.bind(f, "click", function() {
            a.revert()
        })
    }
    function u(a) {
        function b(f) {
            f.preventDefault();
            e = f.clientX;
            o.addClass(a.__closeButton, l.CLASS_DRAG);
            o.bind(window, "mousemove", c);
            o.bind(window, "mouseup", d);
            return false
        }
        function c(b) {
            b.preventDefault();
            a.width = a.width + (e - b.clientX);
            a.onResize();
            e = b.clientX;
            return false
        }
        function d() {
            o.removeClass(a.__closeButton, l.CLASS_DRAG);
            o.unbind(window, "mousemove", c);
            o.unbind(window, "mouseup", d)
        }
        a.__resize_handle = document.createElement("div");
        r.extend(a.__resize_handle.style, {
            width: "6px",
            marginLeft: "-3px",
            height: "200px",
            cursor: "ew-resize",
            position: "absolute"
        });
        var e;
        o.bind(a.__resize_handle, "mousedown", b);
        o.bind(a.__closeButton, "mousedown", b);
        a.domElement.insertBefore(a.__resize_handle, a.domElement.firstElementChild)
    }
    function y(a, b) {
        a.domElement.style.width = b + "px";
        if (a.__save_row && a.autoPlace)
            a.__save_row.style.width = b + "px";
        if (a.__closeButton)
            a.__closeButton.style.width = b + "px"
    }
    function E(a, b) {
        var c = {};
        r.each(a.__rememberedObjects, function(d, e) {
            var f = {};
            r.each(a.__rememberedObjectIndecesToControllers[e], function(a, c) {
                f[c] = b ? a.initialValue : a.getValue()
            });
            c[e] = f
        });
        return c
    }
    function z(a, b, c) {
        var d = document.createElement("option");
        d.innerHTML = b;
        d.value = b;
        a.__preset_select.appendChild(d);
        if (c)
            a.__preset_select.selectedIndex = a.__preset_select.length - 1
    }
    function C(a, b) {
        var c = a.__preset_select[a.__preset_select.selectedIndex];
        c.innerHTML = b ? c.value + "*" : c.value
    }
    function w(a) {
        a.length != 0 && n(function() {
            w(a)
        });
        r.each(a, function(a) {
            a.updateDisplay()
        })
    }
    a.inject(c);
    var H = "Default", L;
    try {
        L = "localStorage"in window && window.localStorage !== null
    } catch (I) {
        L = false
    }
    var P, N = true, A, J = false, F = [], l = function(a) {
        function b() {
            localStorage.setItem(document.location.href + ".gui", JSON.stringify(d.getSaveObject()))
        }
        function c() {
            var a = d.getRoot();
            a.width = a.width + 1;
            r.defer(function() {
                a.width = a.width - 1
            })
        }
        var d = this;
        this.domElement = document.createElement("div");
        this.__ul = document.createElement("ul");
        this.domElement.appendChild(this.__ul);
        o.addClass(this.domElement, "dg");
        this.__folders = {};
        this.__controllers = [];
        this.__rememberedObjects = [];
        this.__rememberedObjectIndecesToControllers = [];
        this.__listening = [];
        a = a || {};
        a = r.defaults(a, {
            autoPlace: true,
            width: l.DEFAULT_WIDTH
        });
        a = r.defaults(a, {
            resizable: a.autoPlace,
            hideable: a.autoPlace
        });
        if (r.isUndefined(a.load))
            a.load = {
                preset: H
            };
        else if (a.preset)
            a.load.preset = a.preset;
        r.isUndefined(a.parent) && a.hideable && F.push(this);
        a.resizable = r.isUndefined(a.parent) && a.resizable;
        if (a.autoPlace && r.isUndefined(a.scrollable))
            a.scrollable = true;
        var e = L && localStorage.getItem(document.location.href + ".isLocal") === "true";
        Object.defineProperties(this, {
            parent: {
                get: function() {
                    return a.parent
                }
            },
            scrollable: {
                get: function() {
                    return a.scrollable
                }
            },
            autoPlace: {
                get: function() {
                    return a.autoPlace
                }
            },
            preset: {
                get: function() {
                    return d.parent ? d.getRoot().preset : a.load.preset
                },
                set: function(b) {
                    d.parent ? d.getRoot().preset = b : a.load.preset = b;
                    for (b = 0; b < this.__preset_select.length; b++)
                        if (this.__preset_select[b].value == this.preset)
                            this.__preset_select.selectedIndex = b;
                    d.revert()
                }
            },
            width: {
                get: function() {
                    return a.width
                },
                set: function(b) {
                    a.width = b;
                    y(d, b)
                }
            },
            name: {
                get: function() {
                    return a.name
                },
                set: function(b) {
                    a.name = b;
                    if (g)
                        g.innerHTML = a.name
                }
            },
            closed: {
                get: function() {
                    return a.closed
                },
                set: function(b) {
                    a.closed = b;
                    a.closed ? o.addClass(d.__ul, l.CLASS_CLOSED) : o.removeClass(d.__ul, l.CLASS_CLOSED);
                    this.onResize();
                    if (d.__closeButton)
                        d.__closeButton.innerHTML = b ? l.TEXT_OPEN : l.TEXT_CLOSED
                }
            },
            load: {
                get: function() {
                    return a.load
                }
            },
            useLocalStorage: {
                get: function() {
                    return e
                },
                set: function(a) {
                    L && ((e = a) ? o.bind(window, "unload", b) : o.unbind(window, "unload", b),
                    localStorage.setItem(document.location.href + ".isLocal", a))
                }
            }
        });
        if (r.isUndefined(a.parent)) {
            a.closed = false;
            o.addClass(this.domElement, l.CLASS_MAIN);
            o.makeSelectable(this.domElement, false);
            if (L && e) {
                d.useLocalStorage = true;
                var f = localStorage.getItem(document.location.href + ".gui");
                if (f)
                    a.load = JSON.parse(f)
            }
            this.__closeButton = document.createElement("div");
            this.__closeButton.innerHTML = l.TEXT_CLOSED;
            o.addClass(this.__closeButton, l.CLASS_CLOSE_BUTTON);
            this.domElement.appendChild(this.__closeButton);
            o.bind(this.__closeButton, "click", function() {
                d.closed = !d.closed
            })
        } else {
            if (a.closed === void 0)
                a.closed = true;
            var g = document.createTextNode(a.name);
            o.addClass(g, "controller-name");
            f = s(d, g);
            o.addClass(this.__ul, l.CLASS_CLOSED);
            o.addClass(f, "title");
            o.bind(f, "click", function(a) {
                a.preventDefault();
                d.closed = !d.closed;
                return false
            });
            if (!a.closed)
                this.closed = false
        }
        a.autoPlace && (r.isUndefined(a.parent) && (N && (A = document.createElement("div"),
        o.addClass(A, "dg"),
        o.addClass(A, l.CLASS_AUTO_PLACE_CONTAINER),
        document.body.appendChild(A),
        N = false),
        A.appendChild(this.domElement),
        o.addClass(this.domElement, l.CLASS_AUTO_PLACE)),
        this.parent || y(d, a.width));
        o.bind(window, "resize", function() {
            d.onResize()
        });
        o.bind(this.__ul, "webkitTransitionEnd", function() {
            d.onResize()
        });
        o.bind(this.__ul, "transitionend", function() {
            d.onResize()
        });
        o.bind(this.__ul, "oTransitionEnd", function() {
            d.onResize()
        });
        this.onResize();
        a.resizable && u(this);
        d.getRoot();
        a.parent || c()
    };
    l.toggleHide = function() {
        J = !J;
        r.each(F, function(a) {
            a.domElement.style.zIndex = J ? -999 : 999;
            a.domElement.style.opacity = J ? 0 : 1
        })
    }
    ;
    l.CLASS_AUTO_PLACE = "a";
    l.CLASS_AUTO_PLACE_CONTAINER = "ac";
    l.CLASS_MAIN = "main";
    l.CLASS_CONTROLLER_ROW = "cr";
    l.CLASS_TOO_TALL = "taller-than-window";
    l.CLASS_CLOSED = "closed";
    l.CLASS_CLOSE_BUTTON = "close-button";
    l.CLASS_DRAG = "drag";
    l.DEFAULT_WIDTH = 245;
    l.TEXT_CLOSED = "Close Controls";
    l.TEXT_OPEN = "Open Controls";
    o.bind(window, "keydown", function(a) {
        document.activeElement.type !== "text" && (a.which === 72 || a.keyCode == 72) && l.toggleHide()
    }, false);
    r.extend(l.prototype, {
        add: function(a, b) {
            return q(this, a, b, {
                factoryArgs: Array.prototype.slice.call(arguments, 2)
            })
        },
        addColor: function(a, b) {
            return q(this, a, b, {
                color: true
            })
        },
        remove: function(a) {
            this.__ul.removeChild(a.__li);
            this.__controllers.slice(this.__controllers.indexOf(a), 1);
            var b = this;
            r.defer(function() {
                b.onResize()
            })
        },
        destroy: function() {
            this.autoPlace && A.removeChild(this.domElement)
        },
        addFolder: function(a) {
            if (this.__folders[a] !== void 0)
                throw Error('You already have a folder in this GUI by the name "' + a + '"');
            var b = {
                name: a,
                parent: this
            };
            b.autoPlace = this.autoPlace;
            if (this.load && this.load.folders && this.load.folders[a]) {
                b.closed = this.load.folders[a].closed;
                b.load = this.load.folders[a]
            }
            b = new l(b);
            this.__folders[a] = b;
            a = s(this, b.domElement);
            o.addClass(a, "folder");
            return b
        },
        open: function() {
            this.closed = false
        },
        close: function() {
            this.closed = true
        },
        onResize: function() {
            var a = this.getRoot();
            if (a.scrollable) {
                var b = o.getOffset(a.__ul).top
                  , c = 0;
                r.each(a.__ul.childNodes, function(b) {
                    a.autoPlace && b === a.__save_row || (c = c + o.getHeight(b))
                });
                window.innerHeight - b - 20 < c ? (o.addClass(a.domElement, l.CLASS_TOO_TALL),
                a.__ul.style.height = window.innerHeight - b - 20 + "px") : (o.removeClass(a.domElement, l.CLASS_TOO_TALL),
                a.__ul.style.height = "auto")
            }
            a.__resize_handle && r.defer(function() {
                a.__resize_handle.style.height = a.__ul.offsetHeight + "px"
            });
            if (a.__closeButton)
                a.__closeButton.style.width = a.width + "px"
        },
        remember: function() {
            if (r.isUndefined(P)) {
                P = new p;
                P.domElement.innerHTML = b
            }
            if (this.parent)
                throw Error("You can only call remember on a top level GUI.");
            var a = this;
            r.each(Array.prototype.slice.call(arguments), function(b) {
                a.__rememberedObjects.length == 0 && x(a);
                a.__rememberedObjects.indexOf(b) == -1 && a.__rememberedObjects.push(b)
            });
            this.autoPlace && y(this, this.width)
        },
        getRoot: function() {
            for (var a = this; a.parent; )
                a = a.parent;
            return a
        },
        getSaveObject: function() {
            var a = this.load;
            a.closed = this.closed;
            if (this.__rememberedObjects.length > 0) {
                a.preset = this.preset;
                if (!a.remembered)
                    a.remembered = {};
                a.remembered[this.preset] = E(this)
            }
            a.folders = {};
            r.each(this.__folders, function(b, c) {
                a.folders[c] = b.getSaveObject()
            });
            return a
        },
        save: function() {
            if (!this.load.remembered)
                this.load.remembered = {};
            this.load.remembered[this.preset] = E(this);
            C(this, false)
        },
        saveAs: function(a) {
            if (!this.load.remembered) {
                this.load.remembered = {};
                this.load.remembered[H] = E(this, true)
            }
            this.load.remembered[a] = E(this);
            this.preset = a;
            z(this, a, true)
        },
        revert: function(a) {
            r.each(this.__controllers, function(b) {
                this.getRoot().load.remembered ? v(a || this.getRoot(), b) : b.setValue(b.initialValue)
            }, this);
            r.each(this.__folders, function(a) {
                a.revert(a)
            });
            a || C(this.getRoot(), false)
        },
        listen: function(a) {
            var b = this.__listening.length == 0;
            this.__listening.push(a);
            b && w(this.__listening)
        }
    });
    return l
}(dat.utils.css, '<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n      \n    </div>\n    \n  </div>\n\n</div>', ".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity 0.1s linear;-o-transition:opacity 0.1s linear;-moz-transition:opacity 0.1s linear;transition:opacity 0.1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity 0.1s linear;-o-transition:opacity 0.1s linear;-moz-transition:opacity 0.1s linear;transition:opacity 0.1s linear;border:0;position:absolute;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-x:hidden}.dg.a.has-save ul{margin-top:27px}.dg.a.has-save ul.closed{margin-top:0}.dg.a .save-row{position:fixed;top:0;z-index:1002}.dg li{-webkit-transition:height 0.1s ease-out;-o-transition:height 0.1s ease-out;-moz-transition:height 0.1s ease-out;transition:height 0.1s ease-out}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;overflow:hidden;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li > *{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:9px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2fa1d6}.dg .cr.number input[type=text]{color:#2fa1d6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2fa1d6}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n", dat.controllers.factory = function(a, b, c, d, e, f, g) {
    return function(h, i, j, k) {
        var n = h[i];
        if (g.isArray(j) || g.isObject(j))
            return new a(h,i,j);
        if (g.isNumber(n))
            return g.isNumber(j) && g.isNumber(k) ? new c(h,i,j,k) : new b(h,i,{
                min: j,
                max: k
            });
        if (g.isString(n))
            return new d(h,i);
        if (g.isFunction(n))
            return new e(h,i,"");
        if (g.isBoolean(n))
            return new f(h,i)
    }
}(dat.controllers.OptionController, dat.controllers.NumberControllerBox, dat.controllers.NumberControllerSlider, dat.controllers.StringController = function(a, b, c) {
    var d = function(a, c) {
        function g() {
            h.setValue(h.__input.value)
        }
        d.superclass.call(this, a, c);
        var h = this;
        this.__input = document.createElement("input");
        this.__input.setAttribute("type", "text");
        b.bind(this.__input, "keyup", g);
        b.bind(this.__input, "change", g);
        b.bind(this.__input, "blur", function() {
            h.__onFinishChange && h.__onFinishChange.call(h, h.getValue())
        });
        b.bind(this.__input, "keydown", function(a) {
            a.keyCode === 13 && this.blur()
        });
        this.updateDisplay();
        this.domElement.appendChild(this.__input)
    };
    d.superclass = a;
    c.extend(d.prototype, a.prototype, {
        updateDisplay: function() {
            if (!b.isActive(this.__input))
                this.__input.value = this.getValue();
            return d.superclass.prototype.updateDisplay.call(this)
        }
    });
    return d
}(dat.controllers.Controller, dat.dom.dom, dat.utils.common), dat.controllers.FunctionController, dat.controllers.BooleanController, dat.utils.common), dat.controllers.Controller, dat.controllers.BooleanController, dat.controllers.FunctionController, dat.controllers.NumberControllerBox, dat.controllers.NumberControllerSlider, dat.controllers.OptionController, dat.controllers.ColorController = function(a, b, c, d, e) {
    function f(a, b, c, d) {
        a.style.background = "";
        e.each(i, function(e) {
            a.style.cssText = a.style.cssText + ("background: " + e + "linear-gradient(" + b + ", " + c + " 0%, " + d + " 100%); ")
        })
    }
    function g(a) {
        a.style.background = "";
        a.style.cssText = a.style.cssText + "background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);";
        a.style.cssText = a.style.cssText + "background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);";
        a.style.cssText = a.style.cssText + "background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);";
        a.style.cssText = a.style.cssText + "background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);";
        a.style.cssText = a.style.cssText + "background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"
    }
    var h = function(a, i) {
        function n(a) {
            q(a);
            b.bind(window, "mousemove", q);
            b.bind(window, "mouseup", p)
        }
        function p() {
            b.unbind(window, "mousemove", q);
            b.unbind(window, "mouseup", p)
        }
        function o() {
            var a = d(this.value);
            a !== false ? (t.__color.__state = a,
            t.setValue(t.__color.toOriginal())) : this.value = t.__color.toString()
        }
        function r() {
            b.unbind(window, "mousemove", s);
            b.unbind(window, "mouseup", r)
        }
        function q(a) {
            a.preventDefault();
            var c = b.getWidth(t.__saturation_field)
              , d = b.getOffset(t.__saturation_field)
              , e = (a.clientX - d.left + document.body.scrollLeft) / c
              , a = 1 - (a.clientY - d.top + document.body.scrollTop) / c;
            a > 1 ? a = 1 : a < 0 && (a = 0);
            e > 1 ? e = 1 : e < 0 && (e = 0);
            t.__color.v = a;
            t.__color.s = e;
            t.setValue(t.__color.toOriginal());
            return false
        }
        function s(a) {
            a.preventDefault();
            var c = b.getHeight(t.__hue_field)
              , d = b.getOffset(t.__hue_field)
              , a = 1 - (a.clientY - d.top + document.body.scrollTop) / c;
            a > 1 ? a = 1 : a < 0 && (a = 0);
            t.__color.h = a * 360;
            t.setValue(t.__color.toOriginal());
            return false
        }
        h.superclass.call(this, a, i);
        this.__color = new c(this.getValue());
        this.__temp = new c(0);
        var t = this;
        this.domElement = document.createElement("div");
        b.makeSelectable(this.domElement, false);
        this.__selector = document.createElement("div");
        this.__selector.className = "selector";
        this.__saturation_field = document.createElement("div");
        this.__saturation_field.className = "saturation-field";
        this.__field_knob = document.createElement("div");
        this.__field_knob.className = "field-knob";
        this.__field_knob_border = "2px solid ";
        this.__hue_knob = document.createElement("div");
        this.__hue_knob.className = "hue-knob";
        this.__hue_field = document.createElement("div");
        this.__hue_field.className = "hue-field";
        this.__input = document.createElement("input");
        this.__input.type = "text";
        this.__input_textShadow = "0 1px 1px ";
        b.bind(this.__input, "keydown", function(a) {
            a.keyCode === 13 && o.call(this)
        });
        b.bind(this.__input, "blur", o);
        b.bind(this.__selector, "mousedown", function() {
            b.addClass(this, "drag").bind(window, "mouseup", function() {
                b.removeClass(t.__selector, "drag")
            })
        });
        var v = document.createElement("div");
        e.extend(this.__selector.style, {
            width: "122px",
            height: "102px",
            padding: "3px",
            backgroundColor: "#222",
            boxShadow: "0px 1px 3px rgba(0,0,0,0.3)"
        });
        e.extend(this.__field_knob.style, {
            position: "absolute",
            width: "12px",
            height: "12px",
            border: this.__field_knob_border + (this.__color.v < 0.5 ? "#fff" : "#000"),
            boxShadow: "0px 1px 3px rgba(0,0,0,0.5)",
            borderRadius: "12px",
            zIndex: 1
        });
        e.extend(this.__hue_knob.style, {
            position: "absolute",
            width: "15px",
            height: "2px",
            borderRight: "4px solid #fff",
            zIndex: 1
        });
        e.extend(this.__saturation_field.style, {
            width: "100px",
            height: "100px",
            border: "1px solid #555",
            marginRight: "3px",
            display: "inline-block",
            cursor: "pointer"
        });
        e.extend(v.style, {
            width: "100%",
            height: "100%",
            background: "none"
        });
        f(v, "top", "rgba(0,0,0,0)", "#000");
        e.extend(this.__hue_field.style, {
            width: "15px",
            height: "100px",
            display: "inline-block",
            border: "1px solid #555",
            cursor: "ns-resize"
        });
        g(this.__hue_field);
        e.extend(this.__input.style, {
            outline: "none",
            textAlign: "center",
            color: "#fff",
            border: 0,
            fontWeight: "bold",
            textShadow: this.__input_textShadow + "rgba(0,0,0,0.7)"
        });
        b.bind(this.__saturation_field, "mousedown", n);
        b.bind(this.__field_knob, "mousedown", n);
        b.bind(this.__hue_field, "mousedown", function(a) {
            s(a);
            b.bind(window, "mousemove", s);
            b.bind(window, "mouseup", r)
        });
        this.__saturation_field.appendChild(v);
        this.__selector.appendChild(this.__field_knob);
        this.__selector.appendChild(this.__saturation_field);
        this.__selector.appendChild(this.__hue_field);
        this.__hue_field.appendChild(this.__hue_knob);
        this.domElement.appendChild(this.__input);
        this.domElement.appendChild(this.__selector);
        this.updateDisplay()
    };
    h.superclass = a;
    e.extend(h.prototype, a.prototype, {
        updateDisplay: function() {
            var a = d(this.getValue());
            if (a !== false) {
                var b = false;
                e.each(c.COMPONENTS, function(c) {
                    if (!e.isUndefined(a[c]) && !e.isUndefined(this.__color.__state[c]) && a[c] !== this.__color.__state[c])
                        return b = true,
                        {}
                }, this);
                b && e.extend(this.__color.__state, a)
            }
            e.extend(this.__temp.__state, this.__color.__state);
            this.__temp.a = 1;
            var g = this.__color.v < 0.5 || this.__color.s > 0.5 ? 255 : 0
              , h = 255 - g;
            e.extend(this.__field_knob.style, {
                marginLeft: 100 * this.__color.s - 7 + "px",
                marginTop: 100 * (1 - this.__color.v) - 7 + "px",
                backgroundColor: this.__temp.toString(),
                border: this.__field_knob_border + "rgb(" + g + "," + g + "," + g + ")"
            });
            this.__hue_knob.style.marginTop = (1 - this.__color.h / 360) * 100 + "px";
            this.__temp.s = 1;
            this.__temp.v = 1;
            f(this.__saturation_field, "left", "#fff", this.__temp.toString());
            e.extend(this.__input.style, {
                backgroundColor: this.__input.value = this.__color.toString(),
                color: "rgb(" + g + "," + g + "," + g + ")",
                textShadow: this.__input_textShadow + "rgba(" + h + "," + h + "," + h + ",.7)"
            })
        }
    });
    var i = ["-moz-", "-o-", "-webkit-", "-ms-", ""];
    return h
}(dat.controllers.Controller, dat.dom.dom, dat.color.Color = function(a, b, c, d) {
    function e(a, b, c) {
        Object.defineProperty(a, b, {
            get: function() {
                if (this.__state.space === "RGB")
                    return this.__state[b];
                g(this, b, c);
                return this.__state[b]
            },
            set: function(a) {
                if (this.__state.space !== "RGB") {
                    g(this, b, c);
                    this.__state.space = "RGB"
                }
                this.__state[b] = a
            }
        })
    }
    function f(a, b) {
        Object.defineProperty(a, b, {
            get: function() {
                if (this.__state.space === "HSV")
                    return this.__state[b];
                h(this);
                return this.__state[b]
            },
            set: function(a) {
                if (this.__state.space !== "HSV") {
                    h(this);
                    this.__state.space = "HSV"
                }
                this.__state[b] = a
            }
        })
    }
    function g(a, c, e) {
        if (a.__state.space === "HEX")
            a.__state[c] = b.component_from_hex(a.__state.hex, e);
        else if (a.__state.space === "HSV")
            d.extend(a.__state, b.hsv_to_rgb(a.__state.h, a.__state.s, a.__state.v));
        else
            throw "Corrupted color state";
    }
    function h(a) {
        var c = b.rgb_to_hsv(a.r, a.g, a.b);
        d.extend(a.__state, {
            s: c.s,
            v: c.v
        });
        if (d.isNaN(c.h)) {
            if (d.isUndefined(a.__state.h))
                a.__state.h = 0
        } else
            a.__state.h = c.h
    }
    var i = function() {
        this.__state = a.apply(this, arguments);
        if (this.__state === false)
            throw "Failed to interpret color arguments";
        this.__state.a = this.__state.a || 1
    };
    i.COMPONENTS = ["r", "g", "b", "h", "s", "v", "hex", "a"];
    d.extend(i.prototype, {
        toString: function() {
            return c(this)
        },
        toOriginal: function() {
            return this.__state.conversion.write(this)
        }
    });
    e(i.prototype, "r", 2);
    e(i.prototype, "g", 1);
    e(i.prototype, "b", 0);
    f(i.prototype, "h");
    f(i.prototype, "s");
    f(i.prototype, "v");
    Object.defineProperty(i.prototype, "a", {
        get: function() {
            return this.__state.a
        },
        set: function(a) {
            this.__state.a = a
        }
    });
    Object.defineProperty(i.prototype, "hex", {
        get: function() {
            if (!this.__state.space !== "HEX")
                this.__state.hex = b.rgb_to_hex(this.r, this.g, this.b);
            return this.__state.hex
        },
        set: function(a) {
            this.__state.space = "HEX";
            this.__state.hex = a
        }
    });
    return i
}(dat.color.interpret, dat.color.math = function() {
    var a;
    return {
        hsv_to_rgb: function(a, c, d) {
            var e = a / 60 - Math.floor(a / 60)
              , f = d * (1 - c)
              , g = d * (1 - e * c)
              , c = d * (1 - (1 - e) * c)
              , a = [[d, c, f], [g, d, f], [f, d, c], [f, g, d], [c, f, d], [d, f, g]][Math.floor(a / 60) % 6];
            return {
                r: a[0] * 255,
                g: a[1] * 255,
                b: a[2] * 255
            }
        },
        rgb_to_hsv: function(a, c, d) {
            var e = Math.min(a, c, d)
              , f = Math.max(a, c, d)
              , e = f - e;
            if (f == 0)
                return {
                    h: NaN,
                    s: 0,
                    v: 0
                };
            a = (a == f ? (c - d) / e : c == f ? 2 + (d - a) / e : 4 + (a - c) / e) / 6;
            a < 0 && (a = a + 1);
            return {
                h: a * 360,
                s: e / f,
                v: f / 255
            }
        },
        rgb_to_hex: function(a, c, d) {
            a = this.hex_with_component(0, 2, a);
            a = this.hex_with_component(a, 1, c);
            return this.hex_with_component(a, 0, d)
        },
        component_from_hex: function(a, c) {
            return a >> c * 8 & 255
        },
        hex_with_component: function(b, c, d) {
            return d << (a = c * 8) | b & ~(255 << a)
        }
    }
}(), dat.color.toString, dat.utils.common), dat.color.interpret, dat.utils.common), dat.utils.requestAnimationFrame = function() {
    return window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.oRequestAnimationFrame || window.msRequestAnimationFrame || function(a) {
        window.setTimeout(a, 1E3 / 60)
    }
}(), dat.dom.CenteredDiv = function(a, b) {
    var c = function() {
        this.backgroundElement = document.createElement("div");
        b.extend(this.backgroundElement.style, {
            backgroundColor: "rgba(0,0,0,0.8)",
            top: 0,
            left: 0,
            display: "none",
            zIndex: "1000",
            opacity: 0,
            WebkitTransition: "opacity 0.2s linear"
        });
        a.makeFullscreen(this.backgroundElement);
        this.backgroundElement.style.position = "fixed";
        this.domElement = document.createElement("div");
        b.extend(this.domElement.style, {
            position: "fixed",
            display: "none",
            zIndex: "1001",
            opacity: 0,
            WebkitTransition: "-webkit-transform 0.2s ease-out, opacity 0.2s linear"
        });
        document.body.appendChild(this.backgroundElement);
        document.body.appendChild(this.domElement);
        var c = this;
        a.bind(this.backgroundElement, "click", function() {
            c.hide()
        })
    };
    c.prototype.show = function() {
        var a = this;
        this.backgroundElement.style.display = "block";
        this.domElement.style.display = "block";
        this.domElement.style.opacity = 0;
        this.domElement.style.webkitTransform = "scale(1.1)";
        this.layout();
        b.defer(function() {
            a.backgroundElement.style.opacity = 1;
            a.domElement.style.opacity = 1;
            a.domElement.style.webkitTransform = "scale(1)"
        })
    }
    ;
    c.prototype.hide = function() {
        var b = this
          , c = function() {
            b.domElement.style.display = "none";
            b.backgroundElement.style.display = "none";
            a.unbind(b.domElement, "webkitTransitionEnd", c);
            a.unbind(b.domElement, "transitionend", c);
            a.unbind(b.domElement, "oTransitionEnd", c)
        };
        a.bind(this.domElement, "webkitTransitionEnd", c);
        a.bind(this.domElement, "transitionend", c);
        a.bind(this.domElement, "oTransitionEnd", c);
        this.backgroundElement.style.opacity = 0;
        this.domElement.style.opacity = 0;
        this.domElement.style.webkitTransform = "scale(1.1)"
    }
    ;
    c.prototype.layout = function() {
        this.domElement.style.left = window.innerWidth / 2 - a.getWidth(this.domElement) / 2 + "px";
        this.domElement.style.top = window.innerHeight / 2 - a.getHeight(this.domElement) / 2 + "px"
    }
    ;
    return c
}(dat.dom.dom, dat.utils.common), dat.dom.dom, dat.utils.common);
(function(a) {
    function b() {}
    for (var c = ["assert", "count", "debug", "dir", "dirxml", "error", "exception", "group", "groupCollapsed", "groupEnd", "info", "log", "timeStamp", "profile", "profileEnd", "time", "timeEnd", "trace", "warn"], d; d = c.pop(); )
        a[d] = a[d] || b
}
)(function() {
    try {
        console.log();
        return window.console
    } catch (a) {
        return window.console = {}
    }
}());
var VG = VG || {
    REVISION: "1"
};
VG.Bus = $({});
var toRadians = function(a) {
    return a / 57.29577951308232
}
  , firstWv = function(a, b) {
    var c = Math.atan(Math.sin(a * (3.141592653589793 / b)) / Math.cos(a * (3.141592653589793 / b)));
    c < 0 && (c = c + 3.141592653589793);
    return c * (b / 3.141592653589793)
}
  , nextInt = function(a) {
    return Math.floor(Math.random() * a)
}
  , clamp = function(a, b, c) {
    return a > c ? c : a < b ? b : a
}
  , getBearing = function(a, b) {
    var c = (new VG.Vector(a.x,a.y,0)).normalize();
    if (Math.sqrt(Math.pow(c.x, 2) + Math.pow(c.y, 2)) < 1.0E-5)
        return 0;
    var d = b !== void 0 ? b : new VG.Vector(0,1,0)
      , e = d.dot(c)
      , e = Math.acos(e);
    d.y * c.x - d.x * c.y < 0 && (e = 2 * Math.PI - e);
    return e * 180 / Math.PI
}
  , getBearingInPlane = function(a, b, c) {
    b = (new VG.Matrix4).rotateY(-toRadians(b));
    c = (new VG.Matrix4).rotateZ(+toRadians(a)).multiplyVector(c);
    c = b.multiplyVector(c);
    c.normalize();
    return firstWv(getBearing(c), 360)
}
  , getRakeVector = function(a, b, c) {
    var c = (new VG.Matrix4).rotateZ(-toRadians(c))
      , b = (new VG.Matrix4).rotateY(toRadians(b))
      , a = (new VG.Matrix4).rotateZ(-toRadians(a))
      , d = new VG.Vector(0,1,0)
      , d = c.multiplyVector(d)
      , d = b.multiplyVector(d)
      , d = a.multiplyVector(d);
    d.normalize();
    return d
}
  , getStrikeAndDipFromNormal = function(a) {
    a = (new VG.Vector).copy(a).normalize();
    if (Math.sqrt(Math.pow(a.x, 2) + Math.pow(a.y, 2)) < 1.0E-5)
        return [0, 0];
    var b = Array(2);
    b[0] = getBearing(a) - 90;
    b[0] = b[0] < 0 ? b[0] + 360 : b[0];
    b[1] = 90 - Math.asin(a.z) * 180 / Math.PI;
    return b[1] > 90 ? getStrikeAndDipFromNormal(a.negate()) : b
}
  , getTrendAndPlungeFromVector = function(a) {
    a = (new VG.Vector).copy(a).normalize();
    if (abs(a.z) === 1)
        return [0, 90];
    if (Math.sqrt(Math.pow(a.x, 2) + Math.pow(a.y, 2)) < 1.0E-5)
        return [0, 0];
    var b = Array(2);
    b[0] = getBearing(a);
    b[0] = b[0] < 0 ? b[0] + 360 : b[0];
    b[1] = -(Math.asin(a.z) * 180 / Math.PI);
    b[1] = b[1] < 0 ? 0 : b[1] > 90 ? 90 : b[1];
    return b
}
  , getVectorFromTrendAndPlunge = function(a, b) {
    var c = (new VG.Matrix4).rotateZ(toRadians(-a))
      , d = new VG.Vector(0,Math.cos(toRadians(b)),-Math.sin(toRadians(b)));
    return c.multiplyVector(d)
}
  , inTriangle = function(a, b, c, d) {
    var e = new VG.Vector
      , f = new VG.Vector
      , g = new VG.Vector;
    e.sub(c, a);
    f.sub(b, a);
    g.sub(d, a);
    a = e.dot(e);
    b = e.dot(f);
    e = e.dot(g);
    c = f.dot(f);
    f = f.dot(g);
    g = 1 / (a * c - b * b);
    c = (c * e - b * f) * g;
    f = (a * f - b * e) * g;
    return c + 1.0E-5 >= 0 && f + 1.0E-5 >= 0 && c + f - 2.0E-5 <= 1
}
  , forAll = function(a, b) {
    if (a instanceof Array || a instanceof Float32Array)
        for (var c = 0; c < a.length; c++)
            b(a[c], c)
}
  , setAll = function(a, b) {
    if (typeof a === "number")
        return b(a, 0);
    if (a instanceof VG.Matrix) {
        for (var c = 1; c <= a.matrix.length; c++)
            a.matrix[c - 1] = b(a.matrix[c - 1], c - 1, a.matrix, a.ind2sub(c));
        return a
    }
    if (a instanceof Array) {
        for (var c = Array(a.length), d = 0; d < a.length; d++)
            c[d] = b(a[d], d, c);
        return c
    }
    throw "setAll: only number matrix, and array implemented";
}
  , loopAll = function(a, b, c) {
    if (typeof a === "number")
        return b(a, c);
    if (a instanceof VG.Matrix) {
        var d = a.matrix[0];
        c !== void 0 && (d = c);
        for (c = 1; c <= a.matrix.length; c++)
            d = b(a.matrix[c - 1], d);
        return d
    }
    if (a instanceof Array) {
        d = a[0];
        c !== void 0 && (d = c);
        for (c = 0; c < a.length; c++)
            d = b(a[c], d);
        return d
    }
    throw "setAll: only number matrix, and array implemented";
}
  , max = function(a) {
    return loopAll(a, Math.max)
}
  , min = function(a) {
    return loopAll(a, Math.min)
}
  , minIg = function(a, b) {
    return loopAll(a, function(a, d) {
        return d === b ? a : a < d && a !== b ? a : d
    })
}
  , maxIg = function(a, b) {
    return loopAll(a, function(a, d) {
        return d === b ? a : a > d && a !== b ? a : d
    })
}
  , sum = function(a) {
    return loopAll(a, function(a, c) {
        return a + c
    }, 0)
}
  , prod = function(a) {
    return loopAll(a, function(a, c) {
        return a * c
    }, 1)
}
  , cumsum = function(a) {
    return setAll(a, function(a, c, d) {
        return c > 0 ? a + d[c - 1] : a
    })
}
  , abs = function(a) {
    return setAll(a, function(a) {
        return Math.abs(a)
    })
}
  , log = function(a) {
    return setAll(a, function(a) {
        return Math.log(a)
    })
}
  , log10 = function(a) {
    return setAll(a, function(a) {
        return Math.log(a) / 2.302585092994046
    })
}
  , unique = function(a, b) {
    for (var c = [], d = setAll(Array(a.length), function() {
        return 0
    }), e = 0; e < a.length; e++) {
        if (d[e] === 0)
            for (var f = e + 1; f < a.length; f++)
                d[f] === 0 && (d[f] = isequal(a[e], a[f], b) ? 1 : 0);
        d[e] === 0 && c.push(a[e])
    }
    return c
}
  , find = function(a, b) {
    var c = [];
    if (typeof b === "function")
        forAll(a, function(a, e) {
            b(a, e) && c.push(e + 1)
        });
    else if (typeof b === "number")
        forAll(a, function(a, e) {
            a === b && c.push(e + 1)
        });
    else
        throw "find: v must be a number or a function";
    return c
}
  , vcat = function(a) {
    function b() {
        var b = new VG.Matrix(null,[d, e]);
        for (h = 0; h < a.length; h++)
            if (a[h]instanceof VG.Matrix)
                for (var c = 1; c <= a[h].sizeDim(1); c++) {
                    for (var f = 1; f <= a[h].sizeDim(2); f++) {
                        var g = a[h].getIJ([c, f]);
                        b.setIJ([i, f], g)
                    }
                    i = i + 1
                }
            else
                throw "vcat: can only cat Matrix and Sparse";
        return b
    }
    function c() {
        var b = new VG.Sparse;
        b.allocate([d, e], g);
        for (h = 0; h < a.length; h++) {
            var c = 1;
            if (a[h]instanceof VG.Sparse)
                for (; c <= a[h].sizeDim(1); c++) {
                    var f = a[h].getRow(c);
                    if (f.length > 0)
                        for (var p = a[h].getRowCol(c), o = 0; o < f.length; o++)
                            b.construct(i, p[o], f[o]);
                    i = i + 1
                }
            else if (a[h]instanceof VG.Matrix)
                for (; c <= a[h].sizeDim(1); c++) {
                    for (f = 1; f <= a[h].sizeDim(2); f++) {
                        p = a[h].getIJ([c, f]);
                        p !== 0 && b.construct(i, f, p)
                    }
                    i = i + 1
                }
            else
                throw "vcat: can only cat Matrix and Sparse";
        }
        return b
    }
    for (var d = 0, e = a[0].sizeDim(2), f = false, g = 0, h = 0; h < a.length; h++) {
        d = d + a[h].sizeDim(1);
        if (e !== a[h].sizeDim(2))
            throw "vcat: dim(2) must remain the same";
        if (!a[h].is2D())
            throw "vcat: must be 2D matrix";
        f = f || a[h]instanceof VG.Sparse;
        g = g + a[h].nnz()
    }
    var i = 1;
    return f ? c() : b()
}
  , hcat = function(a) {
    for (var b = a[0].sizeDim(1), c = 0; c < a.length; c++) {
        if (b !== a[c].sizeDim(1))
            throw "hcat: dim(1) must remain the same";
        if (!a[c].is2D())
            throw "vcat: must be 2D matrix";
    }
    for (c = 0; c < a.length; c++)
        a[c].transpose();
    b = vcat(a).transpose();
    for (c = 0; c < a.length; c++)
        a[c].transpose();
    return b
}
  , isequal = function(a, b, c) {
    function d() {
        if (a.length !== b.length)
            return false;
        for (var c = a.length, d = 0; d < c; d++)
            if (!f(a[d], b[d]))
                return false;
        return true
    }
    function e() {
        if (a.size.length !== b.size.length || a.numel() !== b.numel())
            return false;
        for (var c = 1; c <= a.size.length; c++)
            if (a.sizeDim(c) !== b.sizeDim(c))
                return false;
        for (var c = a.numel(), d = 1; d <= c; d++)
            if (!f(a.get(d), b.get(d)))
                return false;
        return true
    }
    if (a === b)
        return true;
    var f;
    f = c === void 0 ? function(a, b) {
        return a === b
    }
    : function(a, b) {
        return Math.abs(a - b) <= c
    }
    ;
    if ((a instanceof VG.Matrix || a instanceof VG.Sparse) && (b instanceof VG.Matrix || b instanceof VG.Sparse))
        return e();
    if (a instanceof Array && b instanceof Array)
        return d();
    if ((a instanceof THREE.Vector3 || a instanceof VG.Vector) && (b instanceof THREE.Vector3 || b instanceof VG.Vector))
        return f(a.x, b.x) && f(a.y, b.y) && f(a.z, b.z) ? true : false;
    if (typeof a === "number" && typeof b === "number")
        return f(a, b)
}
  , isNumber = function(a) {
    return !isNaN(parseFloat(a)) && isFinite(a)
}
  , KeyCodes = {
    KEY_LEFT: 37,
    KEY_UP: 38,
    KEY_RIGHT: 39,
    KEY_DOWN: 40
}
  , emailRegExp = "^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\\.[A-Za-z]{2,}$"
  , rgbToHex = function(a, b, c) {
    return "#" + (16777216 + (a << 16) + (b << 8) + c).toString(16).slice(1)
}
  , hexToRgb = function(a) {
    return (a = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a)) ? {
        r: parseInt(a[1], 16),
        g: parseInt(a[2], 16),
        b: parseInt(a[3], 16)
    } : null
}
  , strip_tags = function(a, b) {
    var c = $("<div>").html(a);
    c.children().not(b).each(function() {
        var a = $(this).contents();
        $(this).replaceWith(a)
    });
    return c.html()
}
  , linspace = function(a, b, c) {
    for (var d = [], b = (b - a) / (c - 1), e = 0; e < c; e++)
        d.push(a + b * e);
    return d
}
  , spaceArray = function(a, b, c) {
    for (var a = [a], d = 0; a[d] + b <= c; ) {
        a.push(a[d] + b);
        d++
    }
    return a
};
VG.Timer = function(a) {
    this.run = a
}
;
VG.Timer.prototype = {
    constructor: VG.Timer,
    schedule: function(a) {
        var b = this;
        this.timer = setTimeout(function() {
            b.run()
        }, a)
    },
    scheduleRepeating: function(a) {
        var b = this;
        this.timer = setInterval(function() {
            b.run()
        }, a)
    },
    cancel: function() {
        try {
            clearTimeout(this.timer)
        } catch (a) {}
        try {
            clearInterval(this.timer)
        } catch (b) {}
        return this
    },
    fire: function() {
        this.run();
        return this
    }
};
VG.NumberFormat = function(a, b) {
    this.formatString = a === void 0 ? "0.00" : a;
    this.units = b === void 0 ? "" : b
}
;
VG.NumberFormat.prototype = {
    constructor: VG.NumberFormat,
    format: function(a) {
        if (a instanceof Array)
            return this.arrayFormat(a);
        if (this.formatString.indexOf("E") !== -1)
            return this.exponentialFormat(a);
        var b = this.formatString
          , c = false;
        if (b.indexOf("+") !== -1) {
            b = b.replace("+", "");
            c = true
        }
        if (!b || isNaN(+a))
            return a;
        var a = b.charAt(0) === "-" ? -a : +a
          , d = a < 0 ? a = -a : 0
          , e = b.match(/[^\d\-\+#]/g)
          , f = e && e[e.length - 1] || "."
          , e = e && e[1] && e[0] || ","
          , b = b.split(f)
          , a = a.toFixed(b[1] && b[1].length)
          , a = a.toString()
          , g = b[1] && b[1].lastIndexOf("0")
          , h = a.split(".");
        if (!h[1] || h[1] && h[1].length <= g)
            a = (+a).toFixed(g + 1);
        g = b[0].split(e);
        b[0] = g.join("");
        var i = b[0] && b[0].indexOf("0");
        if (i > -1)
            for (; h[0].length < b[0].length - i; )
                h[0] = "0" + h[0];
        else
            +h[0] === 0 && (h[0] = "");
        a = a.split(".");
        a[0] = h[0];
        if (h = g[1] && g[g.length - 1].length) {
            for (var g = a[0], i = "", j = g.length % h, k = 0, n = g.length; k < n; k++) {
                i = i + g.charAt(k);
                !((k - j + 1) % h) && k < n - h && (i = i + e)
            }
            a[0] = i
        }
        a[1] = b[1] && a[1] ? f + a[1] : "";
        return this.addUnits((d ? "-" : c ? "+" : "") + a[0] + a[1])
    },
    arrayFormat: function(a) {
        for (var b = this.units, c = this.units = "", d = 0; d < a.length; d++)
            c = c + (this.format(a[d]) + "-");
        c = c.slice(0, -1);
        this.units = b;
        return c = this.addUnits(c)
    },
    exponentialFormat: function(a) {
        var b = this.formatString
          , c = this.units;
        this.units = "";
        var d = Math.floor(Math.log(Math.abs(a)) / Math.log(10))
          , a = d !== 0 ? a / Math.pow(10, d) : a;
        this.formatString = b.split("E")[0];
        a = this.format(a);
        this.formatString = b.split("E")[1];
        d = this.format(d);
        this.formatString = b;
        this.units = c;
        return this.addUnits(a + "E" + d)
    },
    addUnits: function(a) {
        return this.units instanceof Array ? this.units[0] + a + this.units[1] : a + this.units
    }
};
VG.NumberFormat.StrikeDip = function(a, b, c) {
    var c = c === void 0 ? 0 : c, d;
    if (c > 0) {
        for (decimalStr = "."; decimalStr.length <= c; )
            decimalStr = decimalStr + "0";
        c = new VG.NumberFormat("000" + decimalStr,"\u00ba");
        d = new VG.NumberFormat("00" + decimalStr,"\u00ba")
    } else {
        c = VG.NumberFormat.Strike();
        d = VG.NumberFormat.Dip()
    }
    return c.format(a) + " / " + d.format(b)
}
;
VG.NumberFormat.Strike = function() {
    return new VG.NumberFormat("000","\u00ba")
}
;
VG.NumberFormat.Rake = function() {
    return new VG.NumberFormat("+000","\u00ba")
}
;
VG.NumberFormat.Dip = function() {
    return new VG.NumberFormat("00","\u00ba")
}
;
VG.NumberFormat.Length = function() {
    return new VG.NumberFormat("0.0","")
}
;
VG.NumberFormat.Money = function() {
    return new VG.NumberFormat("#0.00",["$", ""])
}
;
VG.NumberFormat.USD = function() {
    return new VG.NumberFormat("#0.00",["$", "USD"])
}
;
VG.NumberFormat.Scientific = function() {
    return new VG.NumberFormat("0.00E00","")
}
;
VG.ThreeUtils = {
    loadDataURITexture: function(a, b) {
        var c = document.createElement("img");
        c.src = a;
        var d = new THREE.Texture(c);
        c.onload = function() {
            d.needsUpdate = true;
            b && b.render()
        }
        ;
        return d
    },
    cutPatch: function(a, b, c, d, e, f) {
        for (var g = a.vertices, a = a.faces, h = g.length, i = -1, j = false; !j; ) {
            i = i + 1;
            if (i === 3)
                return;
            var k = b.getDistance(c[i]);
            d && k >= 0 ? j = true : !d && k <= 0 && (j = true)
        }
        j = Array(3);
        for (k = 0; k < 3; k++) {
            j[k] = c[i];
            i = i + 1;
            i === 3 && (i = 0)
        }
        c = b.bisectPoints(j[0], j[1]);
        i = b.bisectPoints(j[0], j[2]);
        b = b.bisectPoints(j[1], j[2]);
        d && c !== null && f.push(c);
        d && i !== null && f.push(i);
        d && b !== null && f.push(b);
        if (c !== null && i !== null) {
            g.push(new THREE.Vector3(j[0].x,j[0].y,j[0].z));
            g.push(new THREE.Vector3(c.x,c.y,c.z));
            g.push(new THREE.Vector3(i.x,i.y,i.z));
            VG.ThreeUtils.pushFace(g, a, e, h, h + 1, h + 2)
        } else if (c !== null && b !== null) {
            g.push(new THREE.Vector3(j[0].x,j[0].y,j[0].z));
            g.push(new THREE.Vector3(c.x,c.y,c.z));
            g.push(new THREE.Vector3(j[2].x,j[2].y,j[2].z));
            g.push(new THREE.Vector3(b.x,b.y,b.z));
            VG.ThreeUtils.pushFace(g, a, e, h, h + 1, h + 2);
            VG.ThreeUtils.pushFace(g, a, e, h + 1, h + 2, h + 3)
        } else if (i !== null && b !== null) {
            g.push(new THREE.Vector3(j[0].x,j[0].y,j[0].z));
            g.push(new THREE.Vector3(j[1].x,j[1].y,j[1].z));
            g.push(new THREE.Vector3(i.x,i.y,i.z));
            g.push(new THREE.Vector3(b.x,b.y,b.z));
            VG.ThreeUtils.pushFace(g, a, e, h, h + 1, h + 2);
            VG.ThreeUtils.pushFace(g, a, e, h + 1, h + 2, h + 3)
        } else if (c === null && i === null && b === null) {
            g.push(new THREE.Vector3(j[0].x,j[0].y,j[0].z));
            g.push(new THREE.Vector3(j[1].x,j[1].y,j[1].z));
            g.push(new THREE.Vector3(j[2].x,j[2].y,j[2].z));
            VG.ThreeUtils.pushFace(g, a, e, h, h + 1, h + 2)
        }
    },
    cutLine: function(a, b, c, d) {
        for (var e = 0; e < c.length - 1; e++) {
            b.onThisSideOfPlane(c[e], d) && a.push((new THREE.Vector3).copy(c[e]));
            var f = b.bisectPoints(c[e], c[e + 1]);
            f !== null && a.push((new THREE.Vector3).copy(f))
        }
        a.length > 0 && a.push(a[0].clone())
    },
    pushFace: function(a, b, c, d, e, f) {
        var g = (new THREE.Vector3).copy(a[d])
          , h = (new THREE.Vector3).copy(a[e])
          , a = (new THREE.Vector3).copy(a[f])
          , h = (new THREE.Vector3).copy(h).subSelf(g)
          , g = (new THREE.Vector3).copy(a).subSelf(g)
          , g = (new THREE.Vector3).cross(h, g);
        (new THREE.Vector3).copy(c).dot(g) >= 0 ? b.push(new THREE.Face3(d,e,f)) : b.push(new THREE.Face3(e,d,f))
    }
};
VG.Matrix = function(a, b) {
    this.set(a, b)
}
;
VG.Matrix.prototype = {
    constructor: VG.Matrix,
    set: function(a, b) {
        b = b || [1, 1];
        this.setSize(b);
        this.init();
        a ? this.copy(a) : this.zeros();
        return this
    },
    init: function() {
        var a = this.numel();
        this.matrix = new Float32Array(a)
    },
    copy: function(a) {
        if (a.length !== this.matrix.length)
            throw "Copy: Matrix length must be equal to prod(size);";
        for (var b = 0; b < this.matrix.length; b++)
            this.matrix[b] = a[b]
    },
    setSize: function(a) {
        this.size = Array(a.length);
        for (var b = 0; b < a.length; b++)
            this.size[b] = a[b];
        return this
    },
    setIJ: function(a, b) {
        this.matrix[this.sub2ind(a) - 1] = b
    },
    setAll: function(a) {
        for (var b = 1; b <= this.matrix.length; b++)
            this.matrix[b - 1] = a(this.matrix[b - 1], b, this.ind2sub(b))
    },
    forAll: function(a) {
        for (var b = 1; b <= this.matrix.length; b++)
            a(this.matrix[b - 1], b, this.ind2sub(b))
    },
    get: function(a) {
        return this.matrix[a - 1]
    },
    getIJ: function(a) {
        for (var b = 0; b < a.length; b++)
            if (a[b] > this.size[b])
                throw "getIJ: Index out of bounds.";
        return this.matrix[this.sub2ind(a) - 1]
    },
    getRowArray: function(a) {
        if (this.is2D()) {
            for (var b = this.sizeDim(2), c = Array(b), d = 1; d <= b; d++)
                c[d - 1] = this.getIJ([a, d]);
            return c
        }
        throw "GetRow: Row not defined over two dimensions";
    },
    getRow: function(a) {
        return new VG.Matrix(this.getRowArray(a),[1, this.sizeDim(2)])
    },
    getColArray: function(a) {
        if (this.is2D()) {
            for (var b = Array(this.sizeDim(1)), c = 1; c <= this.sizeDim(1); c++)
                b[c - 1] = this.getIJ([c, a]);
            return b
        }
        throw "GetCol: Column not defined over two dimensions";
    },
    getCol: function(a) {
        return new VG.Matrix(this.getColArray(a),[this.sizeDim(1), 1])
    },
    reshape: function(a) {
        var b = this.size
          , c = this.numel();
        this.size = a;
        a = this.numel();
        if (c == a)
            return this;
        this.size = b;
        throw "CangeSize: Number of elements must not change.";
    },
    numel: function() {
        return prod(this.size)
    },
    nnz: function() {
        return loopAll(this, function(a, b) {
            return a == 0 ? b : b + 1
        }, 0)
    },
    sizeDim: function(a) {
        if (a <= this.size.length && a > 0)
            return this.size[a - 1];
        if (a <= 0)
            throw "sizeDim: dimension must be > 0";
        return 0
    },
    is2D: function() {
        return this.size.length == 2
    },
    is3D: function() {
        return this.size.length == 3
    },
    ind2sub: function(a) {
        for (var b = this.size, c = Array(b.length), d = b.length, b = this.cumprod(), d = d - 1; d >= 0; d--) {
            var e = (a - 1) % b[d] + 1;
            c[d] = (a - e) / b[d] + 1;
            a = e
        }
        return c
    },
    sub2ind: function(a) {
        var b = this.size;
        if (a.length == b.length) {
            for (var c = this.cumprod(), d = 0, e = 0; e < b.length; e++)
                d = d + (a[e] - 1) * c[e];
            return d + 1
        }
        throw "sub2ind: ij.length must equal size.length";
    },
    cumprod: function() {
        for (var a = this.size, b = Array(a.length), c = b[0] = 1; c < a.length; c++)
            b[c] = b[c - 1] * a[c - 1];
        return b
    },
    multiply: function(a) {
        if (!this.is2D() || !a.is2D())
            throw "Multiply: Both matrices must be 2D";
        if (this.sizeDim(2) != a.sizeDim(1))
            throw "Multiply: Check sizes of mats. Can not multiply.";
        for (var b = new VG.Matrix(Array(this.sizeDim(1) * a.sizeDim(2)),[this.sizeDim(1), a.sizeDim(2)]), c = 1; c <= a.sizeDim(2); c++)
            for (var d = 1; d <= this.sizeDim(1); d++) {
                for (var e = 0, f = 1; f <= this.sizeDim(2); f++)
                    e = e + this.getIJ([d, f]) * a.getIJ([f, c]);
                b.setIJ([d, c], e)
            }
        return b
    },
    squeeze: function() {
        for (var a = 0, b = 0; b < this.size.length; b++)
            this.size[b] != 1 && (a = a + 1);
        a = Array(Math.max(a, 2));
        a[0] = 1;
        a[1] = 1;
        for (var c = 0, b = 0; b < this.size.length; b++)
            if (this.size[b] != 1) {
                a[c] = this.size[b];
                c = c + 1
            }
        this.size = a;
        return this
    },
    transpose: function() {
        if (this.is2D()) {
            this.permute([2, 1]);
            return this
        }
        throw "Transpose: Transpose only works in 2D";
    },
    permute: function(a) {
        if (this.size.length != a.length)
            throw "Permute: length(dim) must equal length(size)";
        for (var b = Array(this.size.length), c = 0; c < this.size.length; c++)
            b[a[c] - 1] = this.size[c];
        var d = this
          , c = new VG.Matrix(null,b)
          , e = this.size;
        c.setSize(b);
        c.setAll(function(b, c, h) {
            b = Array(e.length);
            for (c = 0; c < a.length; c++)
                b[a[c] - 1] = h[c];
            return d.getIJ(b)
        });
        this.size = b;
        this.matrix = c.matrix;
        return this
    },
    flipDim: function(a) {
        var b = new VG.Matrix(this.matrix,this.size);
        this.setAll(function(c, d, e) {
            e[a - 1] = b.sizeDim(a) - (e[a - 1] - 1);
            return b.getIJ(e)
        });
        return this
    },
    repmat: function(a) {
        for (var b = new VG.Matrix(this.matrix,this.size), c = 0; c < a.length; c++)
            this.size[c] = this.size[c] * a[c];
        this.init();
        this.setAll(function(c, e, f) {
            for (c = 0; c < a.length; c++)
                f[c] = (f[c] - 1) % b.size[c] + 1;
            return b.getIJ(f)
        });
        return this
    },
    zeros: function() {
        this.setAll(function() {
            return 0
        });
        return this
    },
    ones: function() {
        this.setAll(function() {
            return 1
        });
        return this
    },
    log: function() {
        this.setAll(function(a) {
            return Math.log(a)
        });
        return this
    },
    log10: function() {
        this.setAll(function(a) {
            return Math.log(a) / Math.log(10)
        });
        return this
    },
    scalarMultiply: function(a) {
        this.setAll(function(b) {
            return b * a
        });
        return this
    },
    scalarAdd: function(a) {
        this.setAll(function(b) {
            return b + a
        });
        return this
    },
    min: function() {
        var a = this.matrix[0];
        this.forAll(function(b) {
            a = b < a ? b : a
        });
        return a
    },
    max: function() {
        var a = this.matrix[0];
        this.forAll(function(b) {
            a = b > a ? b : a
        });
        return a
    },
    toNestedArray: function() {
        for (var a = [], b = 1; b <= this.sizeDim(1); b++) {
            for (var c = [], d = 1; d <= this.sizeDim(2); d++)
                c.push(this.getIJ([b, d]));
            a.push(c)
        }
        return a
    },
    toNestedArrayJI: function() {
        for (var a = [], b = 1; b <= this.sizeDim(2); b++) {
            for (var c = [], d = 1; d <= this.sizeDim(1); d++)
                c.push(this.getIJ([d, b]));
            a.push(c)
        }
        return a
    },
    toString: function() {
        if (!this.is2D())
            throw "toString: Only 2D is implemented.";
        for (var a = "[", b = 1; b <= this.sizeDim(1); b++) {
            for (var c = 1; c <= this.sizeDim(2); c++)
                a = a + (this.getIJ([b, c]) + ",");
            a = a.slice(0, -1) + ";"
        }
        return a.slice(0, -1) + "]"
    },
    fromVectorArray: function(a) {
        for (var b = new VG.Matrix(null,[a.length, 1, 3]), c = 1; c <= a.length; c++) {
            b.setIJ([c, 1, 1], a[c - 1].x);
            b.setIJ([c, 1, 2], a[c - 1].y);
            b.setIJ([c, 1, 3], a[c - 1].z)
        }
        return b
    }
};
var eye = function(a) {
    a = new VG.Matrix(null,[a, a]);
    a.setAll(function(a, c, d) {
        return d[0] == d[1] ? 1 : 0
    });
    return a
}
  , kron = function(a, b) {
    if (!a.is2D() || !b.is2D())
        throw "Kron: A and B must be 2D arrays";
    if (a instanceof VG.Matrix && b instanceof VG.Matrix) {
        var c = new VG.Matrix(null,[a.sizeDim(1) * b.sizeDim(1), a.sizeDim(2) * b.sizeDim(2)]);
        c.setAll(function(c, d, e) {
            var c = e[0]
              , e = e[1]
              , d = c % b.sizeDim(1)
              , f = e % b.sizeDim(2);
            return a.getIJ([Math.floor((c - 1) / a.sizeDim(1)) + 1, Math.floor((e - 1) / a.sizeDim(2)) + 1]) * b.getIJ([d == 0 ? b.sizeDim(1) : d, f == 0 ? b.sizeDim(2) : f])
        });
        return c
    }
    c = new VG.Sparse;
    c.size = [a.sizeDim(1) * b.sizeDim(1), a.sizeDim(2) * b.sizeDim(2)];
    c.rind = [];
    c.cind = [];
    c.A = [];
    var d = 1;
    c.rind.push(1);
    for (var e = 1; e <= c.size[0]; e++) {
        for (var f = 1; f <= c.size[1]; f++) {
            var g = e % b.sizeDim(1)
              , h = f % b.sizeDim(2)
              , g = a.getIJ([Math.floor((e - 1) / a.sizeDim(1)) + 1, Math.floor((f - 1) / a.sizeDim(2)) + 1]) * b.getIJ([g == 0 ? b.sizeDim(1) : g, h == 0 ? b.sizeDim(2) : h]);
            if (g != 0) {
                c.cind.push(f);
                c.A.push(g);
                d = d + 1
            }
        }
        c.rind.push(d)
    }
    return c
}
  , kron3 = function(a, b, c) {
    return new kron(a,kron(b, c))
}
  , triu = function(a) {
    if (a instanceof VG.Matrix) {
        if (!a.is2D())
            throw "triu: must be 2D";
        for (var b = new VG.Matrix(null,a.size), c = 1; c <= b.sizeDim(1); c++)
            for (var d = c; d <= b.sizeDim(2); d++)
                b.setIJ([c, d], a.getIJ([c, d]));
        return b
    }
    if (a instanceof VG.Sparse) {
        if (!a.is2D())
            throw "triu: must be 2D";
        b = (new VG.Sparse).allocate(a.size, a.nnz());
        for (c = 1; c <= b.sizeDim(1); c++) {
            var e = a.getRow(c);
            if (e.length > 0)
                for (var f = a.getRowCol(c), g = find(f, function(a) {
                    return a >= c ? true : false
                }), d = 0; d < g.length; d++)
                    b.construct(c, f[g[d] - 1], e[g[d] - 1])
        }
        b.clean();
        return b
    }
    throw "triu: must be a matrix";
}
  , tril = function(a) {
    if (a instanceof VG.Matrix || a instanceof VG.Sparse) {
        if (!a.is2D())
            throw "tril: must be 2D";
        a.transpose();
        var b = triu(a).transpose();
        a.transpose();
        return b
    }
    throw "tril: must be a matrix";
};
VG.Octree = function(a, b) {
    this.blkSize = b;
    this.blocks = new VG.Matrix(null,a);
    this.blocks.matrix = Array(prod(a))
}
;
VG.Octree.prototype = {
    constructor: VG.Octree,
    create: function(a) {
        for (var b = a.length, c = 0; c < b; c++)
            this.setIJ(a[c][0], a[c][1], a[c][2], a[c][3], a[c][4])
    },
    setIJ: function(a, b, c, d, e) {
        if (d == this.blkSize) {
            a = (a - 1) / this.blkSize + 1;
            b = (b - 1) / this.blkSize + 1;
            c = (c - 1) / this.blkSize + 1;
            this.blocks.setIJ([a, b, c], e)
        } else {
            var f = Math.floor((a - 1) / this.blkSize) + 1
              , g = Math.floor((b - 1) / this.blkSize) + 1
              , h = Math.floor((c - 1) / this.blkSize) + 1
              , i = this.blocks.getIJ([f, g, h]);
            if (typeof i == "number" || i == void 0) {
                i = new VG.Octree([2, 2, 2],this.blkSize / 2);
                this.blocks.setIJ([f, g, h], i)
            }
            a = a - (f - 1) * this.blkSize;
            b = b - (g - 1) * this.blkSize;
            c = c - (h - 1) * this.blkSize;
            i.setIJ(a, b, c, d, e)
        }
        return this
    },
    getIJ: function(a) {
        var b = a[0]
          , c = a[1]
          , a = a[2]
          , d = Math.floor((b - 1) / this.blkSize) + 1
          , e = Math.floor((c - 1) / this.blkSize) + 1
          , f = Math.floor((a - 1) / this.blkSize) + 1
          , g = this.blocks.getIJ([d, e, f]);
        if (g == void 0)
            return null;
        if (typeof g == "number")
            return g;
        if (g instanceof VG.Octree) {
            b = b - (d - 1) * this.blkSize;
            c = c - (e - 1) * this.blkSize;
            a = a - (f - 1) * this.blkSize;
            return g.getIJ([b, c, a])
        }
        throw "Octree:getIJ: Not defined.";
    }
};
VG.Sparse = function() {
    this.size = [0, 0];
    this.A = [0];
    this.rind = [0];
    this.cind = [0]
}
;
VG.Sparse.prototype = {
    constructor: VG.Sparse,
    allocate: function(a, b) {
        this.A = Array(b);
        this.size = [a[0], a[1]];
        this.cind = Array(b);
        this.rind = setAll(Array(a[0] + 1), function() {
            return 1
        });
        this._nextEnt = 0;
        return this
    },
    construct: function(a, b, c) {
        this.A[this._nextEnt] = c;
        this.cind[this._nextEnt] = b;
        this.rind = setAll(this.rind, function(b, c) {
            return c < a ? b : b + 1
        });
        this._nextEnt = this._nextEnt + 1;
        return this
    },
    clean: function() {
        if (!(this._nextEnt >= this.A.length)) {
            var a = this._nextEnt - this.A.length;
            this.A = this.A.slice(0, a);
            this.cind = this.cind.slice(0, a)
        }
    },
    getIJ: function(a) {
        if (a.length != 2)
            throw "getIJ: length of IJ must equal 2";
        var b = a[0]
          , a = a[1];
        if (!(b > this.size[0] || a > this.size[1])) {
            var c = this.cind.slice(this.rind[b - 1] - 1, this.rind[b] - 1)
              , a = find(c, a);
            return a.length == 1 ? this.A[a - 1 + this.rind[b - 1] - 1] : 0
        }
    },
    getRow: function(a) {
        if (a <= this.sizeDim(1) && a > 0)
            return this.A.slice(this.rind[a - 1] - 1, this.rind[a] - 1)
    },
    getRowCol: function(a) {
        if (a <= this.sizeDim(1) && a > 0)
            return this.cind.slice(this.rind[a - 1] - 1, this.rind[a] - 1)
    },
    sizeDim: function(a) {
        if (a <= this.size.length && a > 0)
            return this.size[a - 1];
        if (a <= 0)
            throw "sizeDim: dimension must be > 0";
        return 0
    },
    is2D: function() {
        return this.size.length == 2
    },
    is3D: function() {
        return this.size.length == 3
    },
    numel: function() {
        return this.size[0] * this.size[1]
    },
    nnz: function() {
        return this.A.length
    },
    multiply: function(a) {
        if (a.sizeDim(1) != this.sizeDim(2))
            throw "multiply: dimensions must agree";
        for (var b = [], c = 1; c <= a.sizeDim(2); c++)
            for (var d = 1; d <= a.sizeDim(1); d++) {
                var e = this.getRow(d);
                if (e.length > 0) {
                    for (var f = this.getRowCol(d), g = 0, h = 0; h < e.length; h++)
                        g = g + e[h] * a.getIJ([f[h], c]);
                    b.push(g)
                }
            }
        return new VG.Matrix(b,[this.sizeDim(1), a.sizeDim(2)])
    },
    transpose: function() {
        for (var a = this.triplet(), b = [this.size[1], this.size[0]], b = (new VG.Sparse).allocate(b, this.nnz()), c = 1; c <= b.sizeDim(1); c++)
            for (var d = find(this.cind, c), e = 0; e < d.length; e++) {
                var f = a.getIJ([d[e], 1]);
                b.construct(c, f, this.A[d[e] - 1])
            }
        this.A = b.A;
        this.rind = b.rind;
        this.cind = b.cind;
        this.size = b.size;
        return this
    },
    triplet: function() {
        for (var a = new VG.Matrix(null,[this.A.length, 3]), b = 1, c = 1; c <= this.sizeDim(1); c++)
            for (var d = this.rind[c] - this.rind[c - 1], e = 0; e < d; e++) {
                a.setIJ([b, 1], c);
                a.setIJ([b, 2], this.cind[b - 1]);
                a.setIJ([b, 3], this.A[b - 1]);
                b = b + 1
            }
        return a
    },
    full: function() {
        for (var a = Array(this.size[0] * this.size[1]), b = 0, c = 1; c <= this.size[1]; c++)
            for (var d = 1; d <= this.size[0]; d++) {
                a[b] = this.getIJ([d, c]);
                b = b + 1
            }
        return new VG.Matrix(a,this.size)
    }
};
var sparse = function(a) {
    if (!(a instanceof VG.Matrix))
        throw "sparse: input must be a matrix";
    if (!a.is2D())
        throw "sparse: matrix must be 2D";
    var b = new VG.Sparse;
    b.size[0] = a.sizeDim(1);
    b.size[1] = a.sizeDim(2);
    b.rind = [];
    b.cind = [];
    b.A = [];
    var c = 1;
    b.rind.push(c);
    for (var d = 1; d <= b.sizeDim(1); d++) {
        for (var e = 1; e <= b.sizeDim(2); e++) {
            var f = a.getIJ([d, e]);
            if (f != 0) {
                b.cind.push(e);
                b.A.push(f);
                c = c + 1
            }
        }
        b.rind.push(c)
    }
    return b
}
  , sdiag = function(a) {
    if (a instanceof VG.Matrix) {
        if (a.sizeDim(2) != 1)
            throw "sdiag: vector must be an array or a column vector";
        a = a.matrix
    }
    var b = a.length
      , c = new VG.Sparse;
    c.size = [b, b];
    c.A = Array(b);
    c.cind = Array(b);
    c.rind = Array(b + 1);
    for (var d = 0; d < b; d++) {
        c.A[d] = a[d];
        c.cind[d] = d + 1;
        c.rind[d] = d + 1
    }
    c.rind[b] = b + 1;
    return c
}
  , spdiags = function(a, b, c) {
    if (c.length != 2)
        throw "spdiags: size must equal 2";
    if (!a.is2D())
        throw "spdiags: matrix must be 2D";
    if (a.sizeDim(2) != b.length)
        throw "spdiags: matrix columns must equal number of diagonals";
    if (b.join() !== b.sort().join())
        throw "spdiags: diagonals must be sorted.";
    var d = new VG.Sparse
      , e = c[0]
      , f = c[1]
      , c = e >= f ? 1 : 0;
    d.size[0] = e;
    d.size[1] = f;
    d.rind = [];
    d.cind = [];
    d.A = [];
    e = 1;
    d.rind.push(e);
    for (f = 1; f <= d.sizeDim(1); f++) {
        for (var g = 0; g < b.length; g++) {
            var h = b[g]
              , i = f + h;
            if (i <= d.sizeDim(2) && i > 0) {
                d.cind.push(i);
                d.A.push(a.getIJ([f + c * h, g + 1]));
                e = e + 1
            }
        }
        d.rind.push(e)
    }
    return d
}
  , speye = function(a) {
    for (var b = Array(a), c = 0; c < a; c++)
        b[c] = 1;
    return sdiag(b)
}
  , spy = function(a) {
    if (!a.is2D())
        throw "toString: Only 2D is implemented.";
    for (var b = "", c = 1; c <= a.sizeDim(1); c++) {
        for (var d = 1; d <= a.sizeDim(2); d++)
            b = a.getIJ([c, d]) == 0 ? b + " " : b + "*";
        b = b + "\n"
    }
    console.log(b)
};
VG.Plane = function() {
    this.type = "";
    this.D = this.C = this.B = this.A = 0;
    this.centroid = new VG.Vector;
    this.normal = new VG.Vector;
    this.planepts = [];
    this.dip = this.strike = 0
}
;
VG.Plane.prototype = {
    constructor: VG.Plane,
    from3Points: function(a, b, c) {
        this.type = "points";
        this.planepts[0] = new VG.Vector(a);
        this.planepts[1] = new VG.Vector(b);
        this.planepts[2] = new VG.Vector(c);
        this.centroid = new VG.Vector(this.planepts[0]);
        this.centroid.addSelf(this.planepts[1]);
        this.centroid.addSelf(this.planepts[2]);
        this.centroid.divideScalar(3);
        var d = new VG.Vector
          , e = new VG.Vector
          , f = new VG.Vector;
        d.sub(b, a);
        e.sub(c, a);
        d.normalize();
        e.normalize();
        f.cross(d, e);
        f.normalize();
        this.normal.copy(f);
        this.A = f.x;
        this.B = f.y;
        this.C = f.z;
        this.calcD(a);
        a = getStrikeAndDipFromNormal(this.normal);
        this.strike = a[0];
        this.dip = a[1];
        return this
    },
    fromStrikeAndDip: function(a, b, c) {
        c = c || new VG.Vector;
        this.type = "SandD";
        this.strike = a;
        this.dip = b;
        this.centroid.copy(c);
        this.A = Math.sin((a + 90) * Math.PI / 180) * Math.sin(b * Math.PI / 180);
        this.B = Math.cos((a + 90) * Math.PI / 180) * Math.sin(b * Math.PI / 180);
        this.C = Math.cos(b * Math.PI / 180);
        this.normal.set(this.A, this.B, this.C).normalize();
        this.calcD(c);
        return this
    },
    fromNormalAndPoint: function(a, b) {
        b = b || new VG.Vector;
        this.type = "normal";
        this.normal.copy(a).normalize();
        this.A = this.normal.x;
        this.B = this.normal.y;
        this.C = this.normal.z;
        this.calcD(b);
        this.centroid = new VG.Vector(b);
        return this
    },
    bisectPoints: function(a, b) {
        if (this.getDistance(a) >= 0 && this.getDistance(b) >= 0 || this.getDistance(a) <= 0 && this.getDistance(b) <= 0)
            return null;
        var c = (new VG.Vector).copy(b);
        c.subSelf(a);
        c.normalize();
        var d = (this.A * a.x + this.B * a.y + this.C * a.z - this.D) / (-this.A * c.x - this.B * c.y - this.C * c.z);
        return new VG.Vector(a.x + d * c.x,a.y + d * c.y,a.z + d * c.z)
    },
    calcD: function(a) {
        this.D = -(this.A * -a.x + this.B * -a.y + this.C * -a.z)
    },
    getDistance: function(a) {
        a = this.A * a.x + this.B * a.y + this.C * a.z - this.D;
        Math.abs(a) < 1.0E-6 && (a = 0);
        return a
    },
    onThisSideOfPlane: function(a, b) {
        var c = this.getDistance(a);
        return b && c >= 0 ? true : !b && c <= 0 ? true : false
    },
    getDistanceCentroid: function(a) {
        var b = (new VG.Vector).copy(this.centroid);
        b.subSelf(a);
        return b.length()
    }
};
VG.Vector = function(a, b, c) {
    this.x = a || 0;
    this.y = b || 0;
    this.z = c || 0
}
;
VG.Vector.prototype = {
    constructor: VG.Vector,
    set: function(a, b, c) {
        this.x = a;
        this.y = b;
        this.z = c;
        return this
    },
    setX: function(a) {
        this.x = a;
        return this
    },
    setY: function(a) {
        this.y = a;
        return this
    },
    setZ: function(a) {
        this.z = a;
        return this
    },
    copy: function(a) {
        this.x = a.x;
        this.y = a.y;
        this.z = a.z;
        return this
    },
    add: function(a, b) {
        this.x = a.x + b.x;
        this.y = a.y + b.y;
        this.z = a.z + b.z;
        return this
    },
    addSelf: function(a) {
        this.x = this.x + a.x;
        this.y = this.y + a.y;
        this.z = this.z + a.z;
        return this
    },
    addScalar: function(a) {
        this.x = this.x + a;
        this.y = this.y + a;
        this.z = this.z + a;
        return this
    },
    sub: function(a, b) {
        this.x = a.x - b.x;
        this.y = a.y - b.y;
        this.z = a.z - b.z;
        return this
    },
    subSelf: function(a) {
        this.x = this.x - a.x;
        this.y = this.y - a.y;
        this.z = this.z - a.z;
        return this
    },
    multiply: function(a, b) {
        this.x = a.x * b.x;
        this.y = a.y * b.y;
        this.z = a.z * b.z;
        return this
    },
    multiplySelf: function(a) {
        this.x = this.x * a.x;
        this.y = this.y * a.y;
        this.z = this.z * a.z;
        return this
    },
    multiplyScalar: function(a) {
        this.x = this.x * a;
        this.y = this.y * a;
        this.z = this.z * a;
        return this
    },
    divideSelf: function(a) {
        this.x = this.x / a.x;
        this.y = this.y / a.y;
        this.z = this.z / a.z;
        return this
    },
    divideScalar: function(a) {
        if (a) {
            this.x = this.x / a;
            this.y = this.y / a;
            this.z = this.z / a
        } else
            this.z = this.y = this.x = 0;
        return this
    },
    negate: function() {
        return this.multiplyScalar(-1)
    },
    dot: function(a) {
        return this.x * a.x + this.y * a.y + this.z * a.z
    },
    lengthSq: function() {
        return this.x * this.x + this.y * this.y + this.z * this.z
    },
    length: function() {
        return Math.sqrt(this.lengthSq())
    },
    lengthManhattan: function() {
        return Math.abs(this.x) + Math.abs(this.y) + Math.abs(this.z)
    },
    normalize: function() {
        return this.divideScalar(this.length())
    },
    setLength: function(a) {
        return this.normalize().multiplyScalar(a)
    },
    lerpSelf: function(a, b) {
        this.x = this.x + (a.x - this.x) * b;
        this.y = this.y + (a.y - this.y) * b;
        this.z = this.z + (a.z - this.z) * b;
        return this
    },
    cross: function(a, b) {
        this.x = a.y * b.z - a.z * b.y;
        this.y = a.z * b.x - a.x * b.z;
        this.z = a.x * b.y - a.y * b.x;
        return this
    },
    crossSelf: function(a) {
        var b = this.x
          , c = this.y
          , d = this.z;
        this.x = c * a.z - d * a.y;
        this.y = d * a.x - b * a.z;
        this.z = b * a.y - c * a.x;
        return this
    },
    distanceTo: function(a) {
        return Math.sqrt(this.distanceToSquared(a))
    },
    distanceToSquared: function(a) {
        return (new THREE.Vector3).sub(this, a).lengthSq()
    },
    getPositionFromMatrix: function(a) {
        this.x = a.elements[12];
        this.y = a.elements[13];
        this.z = a.elements[14];
        return this
    },
    getRotationFromMatrix: function(a, b) {
        var c = b ? b.x : 1
          , d = b ? b.y : 1
          , e = b ? b.z : 1
          , f = a.elements[0] / c
          , g = a.elements[4] / d
          , c = a.elements[1] / c
          , d = a.elements[5] / d
          , h = a.elements[9] / e
          , i = a.elements[10] / e;
        this.y = Math.asin(a.elements[8] / e);
        e = Math.cos(this.y);
        if (Math.abs(e) > 1.0E-5) {
            this.x = Math.atan2(-h / e, i / e);
            this.z = Math.atan2(-g / e, f / e)
        } else {
            this.x = 0;
            this.z = Math.atan2(c, d)
        }
        return this
    },
    getScaleFromMatrix: function(a) {
        var b = this.set(a.elements[0], a.elements[1], a.elements[2]).length()
          , c = this.set(a.elements[4], a.elements[5], a.elements[6]).length()
          , a = this.set(a.elements[8], a.elements[9], a.elements[10]).length();
        this.x = b;
        this.y = c;
        this.z = a
    },
    equals: function(a) {
        return a.x === this.x && a.y === this.y && a.z === this.z
    },
    isZero: function() {
        return this.lengthSq() < 1.0E-4
    },
    clone: function() {
        return new THREE.Vector3(this.x,this.y,this.z)
    }
};
VG.Matrix4 = function(a, b, c, d, e, f, g, h, i, j, k, n, p, o, r, q) {
    this.elements = new Float32Array(16);
    this.set(a !== void 0 ? a : 1, b || 0, c || 0, d || 0, e || 0, f !== void 0 ? f : 1, g || 0, h || 0, i || 0, j || 0, k !== void 0 ? k : 1, n || 0, p || 0, o || 0, r || 0, q !== void 0 ? q : 1)
}
;
VG.Matrix4.prototype = {
    constructor: VG.Matrix4,
    set: function(a, b, c, d, e, f, g, h, i, j, k, n, p, o, r, q) {
        var s = this.elements;
        s[0] = a;
        s[4] = b;
        s[8] = c;
        s[12] = d;
        s[1] = e;
        s[5] = f;
        s[9] = g;
        s[13] = h;
        s[2] = i;
        s[6] = j;
        s[10] = k;
        s[14] = n;
        s[3] = p;
        s[7] = o;
        s[11] = r;
        s[15] = q;
        return this
    },
    identity: function() {
        this.set(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1);
        return this
    },
    copy: function(a) {
        a = a.elements;
        this.set(a[0], a[4], a[8], a[12], a[1], a[5], a[9], a[13], a[2], a[6], a[10], a[14], a[3], a[7], a[11], a[15]);
        return this
    },
    lookAt: function(a, b, c) {
        var d = this.elements
          , e = VG.Matrix4.__v1
          , f = VG.Matrix4.__v2
          , g = VG.Matrix4.__v3;
        g.sub(a, b).normalize();
        if (g.length() === 0)
            g.z = 1;
        e.cross(c, g).normalize();
        if (e.length() === 0) {
            g.x = g.x + 1.0E-4;
            e.cross(c, g).normalize()
        }
        f.cross(g, e);
        d[0] = e.x;
        d[4] = f.x;
        d[8] = g.x;
        d[1] = e.y;
        d[5] = f.y;
        d[9] = g.y;
        d[2] = e.z;
        d[6] = f.z;
        d[10] = g.z;
        return this
    },
    multiply: function(a, b) {
        var c = a.elements
          , d = b.elements
          , e = this.elements
          , f = c[0]
          , g = c[4]
          , h = c[8]
          , i = c[12]
          , j = c[1]
          , k = c[5]
          , n = c[9]
          , p = c[13]
          , o = c[2]
          , r = c[6]
          , q = c[10]
          , s = c[14]
          , t = c[3]
          , v = c[7]
          , x = c[11]
          , c = c[15]
          , u = d[0]
          , y = d[4]
          , E = d[8]
          , z = d[12]
          , C = d[1]
          , w = d[5]
          , H = d[9]
          , L = d[13]
          , I = d[2]
          , P = d[6]
          , N = d[10]
          , A = d[14]
          , J = d[3]
          , F = d[7]
          , l = d[11]
          , d = d[15];
        e[0] = f * u + g * C + h * I + i * J;
        e[4] = f * y + g * w + h * P + i * F;
        e[8] = f * E + g * H + h * N + i * l;
        e[12] = f * z + g * L + h * A + i * d;
        e[1] = j * u + k * C + n * I + p * J;
        e[5] = j * y + k * w + n * P + p * F;
        e[9] = j * E + k * H + n * N + p * l;
        e[13] = j * z + k * L + n * A + p * d;
        e[2] = o * u + r * C + q * I + s * J;
        e[6] = o * y + r * w + q * P + s * F;
        e[10] = o * E + r * H + q * N + s * l;
        e[14] = o * z + r * L + q * A + s * d;
        e[3] = t * u + v * C + x * I + c * J;
        e[7] = t * y + v * w + x * P + c * F;
        e[11] = t * E + v * H + x * N + c * l;
        e[15] = t * z + v * L + x * A + c * d;
        return this
    },
    multiplySelf: function(a) {
        return this.multiply(this, a)
    },
    multiplyToArray: function(a, b, c) {
        var d = this.elements;
        this.multiply(a, b);
        c[0] = d[0];
        c[1] = d[1];
        c[2] = d[2];
        c[3] = d[3];
        c[4] = d[4];
        c[5] = d[5];
        c[6] = d[6];
        c[7] = d[7];
        c[8] = d[8];
        c[9] = d[9];
        c[10] = d[10];
        c[11] = d[11];
        c[12] = d[12];
        c[13] = d[13];
        c[14] = d[14];
        c[15] = d[15];
        return this
    },
    multiplyScalar: function(a) {
        var b = this.elements;
        b[0] = b[0] * a;
        b[4] = b[4] * a;
        b[8] = b[8] * a;
        b[12] = b[12] * a;
        b[1] = b[1] * a;
        b[5] = b[5] * a;
        b[9] = b[9] * a;
        b[13] = b[13] * a;
        b[2] = b[2] * a;
        b[6] = b[6] * a;
        b[10] = b[10] * a;
        b[14] = b[14] * a;
        b[3] = b[3] * a;
        b[7] = b[7] * a;
        b[11] = b[11] * a;
        b[15] = b[15] * a;
        return this
    },
    multiplyVector: function(a) {
        var b = this.elements
          , c = a.x
          , d = a.y
          , e = a.z
          , f = 1 / (b[3] * c + b[7] * d + b[11] * e + b[15]);
        a.x = (b[0] * c + b[4] * d + b[8] * e + b[12]) * f;
        a.y = (b[1] * c + b[5] * d + b[9] * e + b[13]) * f;
        a.z = (b[2] * c + b[6] * d + b[10] * e + b[14]) * f;
        return a
    },
    multiplyMatrix: function(a) {
        if (a.sizeDim(3) !== 3)
            throw "multiplyMatrix: sizeDim(3) must equal 3";
        for (var b = 1; b <= a.sizeDim(1); b++)
            for (var c = 1; c <= a.sizeDim(2); c++) {
                var d = new VG.Vector(a.getIJ([b, c, 1]),a.getIJ([b, c, 2]),a.getIJ([b, c, 3]))
                  , d = this.multiplyVector(d);
                a.setIJ([b, c, 1], d.x);
                a.setIJ([b, c, 2], d.y);
                a.setIJ([b, c, 3], d.z)
            }
        return a
    },
    multiplyVector3Array: function(a) {
        for (var b = VG.Matrix4.__v1, c = 0, d = a.length; c < d; c = c + 3) {
            b.x = a[c];
            b.y = a[c + 1];
            b.z = a[c + 2];
            this.multiplyVector3(b);
            a[c] = b.x;
            a[c + 1] = b.y;
            a[c + 2] = b.z
        }
        return a
    },
    rotateAxis: function(a) {
        var b = this.elements
          , c = a.x
          , d = a.y
          , e = a.z;
        a.x = c * b[0] + d * b[4] + e * b[8];
        a.y = c * b[1] + d * b[5] + e * b[9];
        a.z = c * b[2] + d * b[6] + e * b[10];
        a.normalize();
        return a
    },
    determinant: function() {
        var a = this.elements
          , b = a[0]
          , c = a[4]
          , d = a[8]
          , e = a[12]
          , f = a[1]
          , g = a[5]
          , h = a[9]
          , i = a[13]
          , j = a[2]
          , k = a[6]
          , n = a[10]
          , p = a[14]
          , o = a[3]
          , r = a[7]
          , q = a[11]
          , a = a[15];
        return e * h * k * o - d * i * k * o - e * g * n * o + c * i * n * o + d * g * p * o - c * h * p * o - e * h * j * r + d * i * j * r + e * f * n * r - b * i * n * r - d * f * p * r + b * h * p * r + e * g * j * q - c * i * j * q - e * f * k * q + b * i * k * q + c * f * p * q - b * g * p * q - d * g * j * a + c * h * j * a + d * f * k * a - b * h * k * a - c * f * n * a + b * g * n * a
    },
    transpose: function() {
        var a = this.elements, b;
        b = a[1];
        a[1] = a[4];
        a[4] = b;
        b = a[2];
        a[2] = a[8];
        a[8] = b;
        b = a[6];
        a[6] = a[9];
        a[9] = b;
        b = a[3];
        a[3] = a[12];
        a[12] = b;
        b = a[7];
        a[7] = a[13];
        a[13] = b;
        b = a[11];
        a[11] = a[14];
        a[14] = b;
        return this
    },
    flattenToArray: function(a) {
        var b = this.elements;
        a[0] = b[0];
        a[1] = b[1];
        a[2] = b[2];
        a[3] = b[3];
        a[4] = b[4];
        a[5] = b[5];
        a[6] = b[6];
        a[7] = b[7];
        a[8] = b[8];
        a[9] = b[9];
        a[10] = b[10];
        a[11] = b[11];
        a[12] = b[12];
        a[13] = b[13];
        a[14] = b[14];
        a[15] = b[15];
        return a
    },
    flattenToArrayOffset: function(a, b) {
        var c = this.elements;
        a[b] = c[0];
        a[b + 1] = c[1];
        a[b + 2] = c[2];
        a[b + 3] = c[3];
        a[b + 4] = c[4];
        a[b + 5] = c[5];
        a[b + 6] = c[6];
        a[b + 7] = c[7];
        a[b + 8] = c[8];
        a[b + 9] = c[9];
        a[b + 10] = c[10];
        a[b + 11] = c[11];
        a[b + 12] = c[12];
        a[b + 13] = c[13];
        a[b + 14] = c[14];
        a[b + 15] = c[15];
        return a
    },
    getPosition: function() {
        var a = this.elements;
        return VG.Matrix4.__v1.set(a[12], a[13], a[14])
    },
    setPosition: function(a) {
        var b = this.elements;
        b[12] = a.x;
        b[13] = a.y;
        b[14] = a.z;
        return this
    },
    getColumnX: function() {
        var a = this.elements;
        return VG.Matrix4.__v1.set(a[0], a[1], a[2])
    },
    getColumnY: function() {
        var a = this.elements;
        return VG.Matrix4.__v1.set(a[4], a[5], a[6])
    },
    getColumnZ: function() {
        var a = this.elements;
        return VG.Matrix4.__v1.set(a[8], a[9], a[10])
    },
    getInverse: function(a) {
        var b = this.elements
          , c = a.elements
          , d = c[0]
          , e = c[4]
          , f = c[8]
          , g = c[12]
          , h = c[1]
          , i = c[5]
          , j = c[9]
          , k = c[13]
          , n = c[2]
          , p = c[6]
          , o = c[10]
          , r = c[14]
          , q = c[3]
          , s = c[7]
          , t = c[11]
          , c = c[15];
        b[0] = j * r * s - k * o * s + k * p * t - i * r * t - j * p * c + i * o * c;
        b[4] = g * o * s - f * r * s - g * p * t + e * r * t + f * p * c - e * o * c;
        b[8] = f * k * s - g * j * s + g * i * t - e * k * t - f * i * c + e * j * c;
        b[12] = g * j * p - f * k * p - g * i * o + e * k * o + f * i * r - e * j * r;
        b[1] = k * o * q - j * r * q - k * n * t + h * r * t + j * n * c - h * o * c;
        b[5] = f * r * q - g * o * q + g * n * t - d * r * t - f * n * c + d * o * c;
        b[9] = g * j * q - f * k * q - g * h * t + d * k * t + f * h * c - d * j * c;
        b[13] = f * k * n - g * j * n + g * h * o - d * k * o - f * h * r + d * j * r;
        b[2] = i * r * q - k * p * q + k * n * s - h * r * s - i * n * c + h * p * c;
        b[6] = g * p * q - e * r * q - g * n * s + d * r * s + e * n * c - d * p * c;
        b[10] = e * k * q - g * i * q + g * h * s - d * k * s - e * h * c + d * i * c;
        b[14] = g * i * n - e * k * n - g * h * p + d * k * p + e * h * r - d * i * r;
        b[3] = j * p * q - i * o * q - j * n * s + h * o * s + i * n * t - h * p * t;
        b[7] = e * o * q - f * p * q + f * n * s - d * o * s - e * n * t + d * p * t;
        b[11] = f * i * q - e * j * q - f * h * s + d * j * s + e * h * t - d * i * t;
        b[15] = e * j * n - f * i * n + f * h * p - d * j * p - e * h * o + d * i * o;
        this.multiplyScalar(1 / a.determinant());
        return this
    },
    setRotationFromEuler: function(a, b) {
        var c = this.elements
          , d = a.x
          , e = a.y
          , f = a.z
          , g = Math.cos(d)
          , d = Math.sin(d)
          , h = Math.cos(e)
          , e = Math.sin(e)
          , i = Math.cos(f)
          , f = Math.sin(f);
        if (b === void 0 || b === "XYZ") {
            var j = g * i
              , k = g * f
              , n = d * i
              , p = d * f;
            c[0] = h * i;
            c[4] = -h * f;
            c[8] = e;
            c[1] = k + n * e;
            c[5] = j - p * e;
            c[9] = -d * h;
            c[2] = p - j * e;
            c[6] = n + k * e;
            c[10] = g * h
        } else if (b === "YXZ") {
            j = h * i;
            k = h * f;
            n = e * i;
            p = e * f;
            c[0] = j + p * d;
            c[4] = n * d - k;
            c[8] = g * e;
            c[1] = g * f;
            c[5] = g * i;
            c[9] = -d;
            c[2] = k * d - n;
            c[6] = p + j * d;
            c[10] = g * h
        } else if (b === "ZXY") {
            j = h * i;
            k = h * f;
            n = e * i;
            p = e * f;
            c[0] = j - p * d;
            c[4] = -g * f;
            c[8] = n + k * d;
            c[1] = k + n * d;
            c[5] = g * i;
            c[9] = p - j * d;
            c[2] = -g * e;
            c[6] = d;
            c[10] = g * h
        } else if (b === "ZYX") {
            j = g * i;
            k = g * f;
            n = d * i;
            p = d * f;
            c[0] = h * i;
            c[4] = n * e - k;
            c[8] = j * e + p;
            c[1] = h * f;
            c[5] = p * e + j;
            c[9] = k * e - n;
            c[2] = -e;
            c[6] = d * h;
            c[10] = g * h
        } else if (b === "YZX") {
            j = g * h;
            k = g * e;
            n = d * h;
            p = d * e;
            c[0] = h * i;
            c[4] = p - j * f;
            c[8] = n * f + k;
            c[1] = f;
            c[5] = g * i;
            c[9] = -d * i;
            c[2] = -e * i;
            c[6] = k * f + n;
            c[10] = j - p * f
        } else if (b === "XZY") {
            j = g * h;
            k = g * e;
            n = d * h;
            p = d * e;
            c[0] = h * i;
            c[4] = -f;
            c[8] = e * i;
            c[1] = j * f + p;
            c[5] = g * i;
            c[9] = k * f - n;
            c[2] = n * f - k;
            c[6] = d * i;
            c[10] = p * f + j
        }
        return this
    },
    extractRotation: function(a) {
        var b = this.elements
          , a = a.elements
          , c = VG.Matrix4.__v1
          , d = 1 / c.set(a[0], a[1], a[2]).length()
          , e = 1 / c.set(a[4], a[5], a[6]).length()
          , c = 1 / c.set(a[8], a[9], a[10]).length();
        b[0] = a[0] * d;
        b[1] = a[1] * d;
        b[2] = a[2] * d;
        b[4] = a[4] * e;
        b[5] = a[5] * e;
        b[6] = a[6] * e;
        b[8] = a[8] * c;
        b[9] = a[9] * c;
        b[10] = a[10] * c;
        return this
    },
    translate: function(a) {
        var b = this.elements
          , c = a.x
          , d = a.y
          , a = a.z;
        b[12] = b[0] * c + b[4] * d + b[8] * a + b[12];
        b[13] = b[1] * c + b[5] * d + b[9] * a + b[13];
        b[14] = b[2] * c + b[6] * d + b[10] * a + b[14];
        b[15] = b[3] * c + b[7] * d + b[11] * a + b[15];
        return this
    },
    rotateX: function(a) {
        var b = this.elements
          , c = b[4]
          , d = b[5]
          , e = b[6]
          , f = b[7]
          , g = b[8]
          , h = b[9]
          , i = b[10]
          , j = b[11]
          , k = Math.cos(a)
          , a = Math.sin(a);
        b[4] = k * c + a * g;
        b[5] = k * d + a * h;
        b[6] = k * e + a * i;
        b[7] = k * f + a * j;
        b[8] = k * g - a * c;
        b[9] = k * h - a * d;
        b[10] = k * i - a * e;
        b[11] = k * j - a * f;
        return this
    },
    rotateY: function(a) {
        var b = this.elements
          , c = b[0]
          , d = b[1]
          , e = b[2]
          , f = b[3]
          , g = b[8]
          , h = b[9]
          , i = b[10]
          , j = b[11]
          , k = Math.cos(a)
          , a = Math.sin(a);
        b[0] = k * c - a * g;
        b[1] = k * d - a * h;
        b[2] = k * e - a * i;
        b[3] = k * f - a * j;
        b[8] = k * g + a * c;
        b[9] = k * h + a * d;
        b[10] = k * i + a * e;
        b[11] = k * j + a * f;
        return this
    },
    rotateZ: function(a) {
        var b = this.elements
          , c = b[0]
          , d = b[1]
          , e = b[2]
          , f = b[3]
          , g = b[4]
          , h = b[5]
          , i = b[6]
          , j = b[7]
          , k = Math.cos(a)
          , a = Math.sin(a);
        b[0] = k * c + a * g;
        b[1] = k * d + a * h;
        b[2] = k * e + a * i;
        b[3] = k * f + a * j;
        b[4] = k * g - a * c;
        b[5] = k * h - a * d;
        b[6] = k * i - a * e;
        b[7] = k * j - a * f;
        return this
    },
    rotateByAxis: function(a, b) {
        var c = this.elements;
        if (a.x === 1 && a.y === 0 && a.z === 0)
            return this.rotateX(b);
        if (a.x === 0 && a.y === 1 && a.z === 0)
            return this.rotateY(b);
        if (a.x === 0 && a.y === 0 && a.z === 1)
            return this.rotateZ(b);
        var d = a.x
          , e = a.y
          , f = a.z
          , g = Math.sqrt(d * d + e * e + f * f)
          , d = d / g
          , e = e / g
          , f = f / g
          , g = d * d
          , h = e * e
          , i = f * f
          , j = Math.cos(b)
          , k = Math.sin(b)
          , n = 1 - j
          , p = d * e * n
          , o = d * f * n
          , n = e * f * n
          , d = d * k
          , r = e * k
          , k = f * k
          , f = g + (1 - g) * j
          , g = p + k
          , e = o - r
          , p = p - k
          , h = h + (1 - h) * j
          , k = n + d
          , o = o + r
          , n = n - d
          , i = i + (1 - i) * j
          , j = c[0]
          , d = c[1]
          , r = c[2]
          , q = c[3]
          , s = c[4]
          , t = c[5]
          , v = c[6]
          , x = c[7]
          , u = c[8]
          , y = c[9]
          , E = c[10]
          , z = c[11];
        c[0] = f * j + g * s + e * u;
        c[1] = f * d + g * t + e * y;
        c[2] = f * r + g * v + e * E;
        c[3] = f * q + g * x + e * z;
        c[4] = p * j + h * s + k * u;
        c[5] = p * d + h * t + k * y;
        c[6] = p * r + h * v + k * E;
        c[7] = p * q + h * x + k * z;
        c[8] = o * j + n * s + i * u;
        c[9] = o * d + n * t + i * y;
        c[10] = o * r + n * v + i * E;
        c[11] = o * q + n * x + i * z;
        return this
    },
    scale: function(a) {
        var b = this.elements
          , c = a.x
          , d = a.y
          , a = a.z;
        b[0] = b[0] * c;
        b[4] = b[4] * d;
        b[8] = b[8] * a;
        b[1] = b[1] * c;
        b[5] = b[5] * d;
        b[9] = b[9] * a;
        b[2] = b[2] * c;
        b[6] = b[6] * d;
        b[10] = b[10] * a;
        b[3] = b[3] * c;
        b[7] = b[7] * d;
        b[11] = b[11] * a;
        return this
    },
    getMaxScaleOnAxis: function() {
        var a = this.elements;
        return Math.sqrt(Math.max(a[0] * a[0] + a[1] * a[1] + a[2] * a[2], Math.max(a[4] * a[4] + a[5] * a[5] + a[6] * a[6], a[8] * a[8] + a[9] * a[9] + a[10] * a[10])))
    },
    makeTranslation: function(a, b, c) {
        this.set(1, 0, 0, a, 0, 1, 0, b, 0, 0, 1, c, 0, 0, 0, 1);
        return this
    },
    makeRotationX: function(a) {
        var b = Math.cos(a)
          , a = Math.sin(a);
        this.set(1, 0, 0, 0, 0, b, -a, 0, 0, a, b, 0, 0, 0, 0, 1);
        return this
    },
    makeRotationY: function(a) {
        var b = Math.cos(a)
          , a = Math.sin(a);
        this.set(b, 0, a, 0, 0, 1, 0, 0, -a, 0, b, 0, 0, 0, 0, 1);
        return this
    },
    makeRotationZ: function(a) {
        var b = Math.cos(a)
          , a = Math.sin(a);
        this.set(b, -a, 0, 0, a, b, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1);
        return this
    },
    makeRotationAxis: function(a, b) {
        var c = Math.cos(b)
          , d = Math.sin(b)
          , e = 1 - c
          , f = a.x
          , g = a.y
          , h = a.z
          , i = e * f
          , j = e * g;
        this.set(i * f + c, i * g - d * h, i * h + d * g, 0, i * g + d * h, j * g + c, j * h - d * f, 0, i * h - d * g, j * h + d * f, e * h * h + c, 0, 0, 0, 0, 1);
        return this
    },
    makeScale: function(a, b, c) {
        this.set(a, 0, 0, 0, 0, b, 0, 0, 0, 0, c, 0, 0, 0, 0, 1);
        return this
    },
    makeFrustum: function(a, b, c, d, e, f) {
        var g = this.elements;
        g[0] = 2 * e / (b - a);
        g[4] = 0;
        g[8] = (b + a) / (b - a);
        g[12] = 0;
        g[1] = 0;
        g[5] = 2 * e / (d - c);
        g[9] = (d + c) / (d - c);
        g[13] = 0;
        g[2] = 0;
        g[6] = 0;
        g[10] = -(f + e) / (f - e);
        g[14] = -2 * f * e / (f - e);
        g[3] = 0;
        g[7] = 0;
        g[11] = -1;
        g[15] = 0;
        return this
    },
    makePerspective: function(a, b, c, d) {
        var a = c * Math.tan(a * Math.PI / 360)
          , e = -a;
        return this.makeFrustum(e * b, a * b, e, a, c, d)
    },
    makeOrthographic: function(a, b, c, d, e, f) {
        var g = this.elements
          , h = b - a
          , i = c - d
          , j = f - e;
        g[0] = 2 / h;
        g[4] = 0;
        g[8] = 0;
        g[12] = -((b + a) / h);
        g[1] = 0;
        g[5] = 2 / i;
        g[9] = 0;
        g[13] = -((c + d) / i);
        g[2] = 0;
        g[6] = 0;
        g[10] = -2 / j;
        g[14] = -((f + e) / j);
        g[3] = 0;
        g[7] = 0;
        g[11] = 0;
        g[15] = 1;
        return this
    },
    clone: function() {
        var a = this.elements;
        return new VG.Matrix4(a[0],a[4],a[8],a[12],a[1],a[5],a[9],a[13],a[2],a[6],a[10],a[14],a[3],a[7],a[11],a[15])
    }
};
VG.Matrix4.__v1 = new VG.Vector;
VG.Matrix4.__v2 = new VG.Vector;
VG.Matrix4.__v3 = new VG.Vector;
VG.Matrix4.__m1 = new VG.Matrix4;
VG.Matrix4.__m2 = new VG.Matrix4;
var ddx = function(a, b) {
    var c = a.length;
    if (b == "nodal") {
        var d = (new VG.Matrix(a,[c, 1])).repmat([1, 2]);
        d.setAll(function(a, b, c) {
            return c[1] == 1 ? -1 / a : 1 / a
        });
        return spdiags(d, [0, 1], [c, c + 1])
    }
    if (b == "ccn") {
        var e = setAll(a.slice(0, -1), function(b, c) {
            return (b + a[c + 1]) / 2
        })
          , d = (new VG.Matrix(e,[c - 1, 1])).repmat([1, 2]);
        d.setAll(function(a, b, c) {
            return c[1] == 1 ? -1 / a : 1 / a
        });
        e = (new VG.Sparse).allocate([1, c], 0);
        return vcat([e, spdiags(d, [0, 1], [c - 1, c]), e])
    }
    if (b == "ccd") {
        e = setAll(a.slice(0, -1), function(b, c) {
            return (b + a[c + 1]) / 2
        });
        d = (new VG.Matrix(e,[c - 1, 1])).repmat([1, 2]);
        d.setAll(function(a, b, c) {
            return c[1] == 1 ? -1 / a : 1 / a
        });
        var f = (new VG.Sparse).allocate([1, c], 1).construct(1, 1, 2 / e[0])
          , e = (new VG.Sparse).allocate([1, c], 1).construct(1, c, -2 / e[c - 2]);
        return vcat([f, spdiags(d, [0, 1], [c - 1, c]), e])
    }
    if (b == "ccdBC") {
        e = setAll(a.slice(0, -1), function(b, c) {
            return (b + a[c + 1]) / 2
        });
        d = (new VG.Sparse).allocate([c + 1, 2], 2);
        d.construct(1, 1, -2 / e[0]);
        d.construct(c + 1, 2, 2 / e[c - 2]);
        return d
    }
};
VG.Delauny = function(a) {
    a !== void 0 && this.triangulate(a)
}
;
VG.Delauny.prototype = {
    constructor: VG.Delauny,
    interp: function(a) {
        for (var b = 0; b < this.triangles.length; b++)
            if (this.triangles[b].inside(a, true))
                return this.triangles[b].interp(a, new VG.Vector(0,0,1));
        this.vertices.sort(function(b, c) {
            b.__dist = Math.sqrt(Math.pow(b.x - a.x, 2) + Math.pow(b.y - a.y, 2));
            c.__dist = Math.sqrt(Math.pow(c.x - a.x, 2) + Math.pow(c.y - a.y, 2));
            return b.__dist - c.__dist
        });
        for (var c = min([20, this.vertices.length]), d = 0, e = 0, b = 0; b < c; b++)
            d = d + 1 / Math.pow(this.vertices[b].__dist, 1.3);
        for (b = 0; b < c; b++)
            var f = 1 / Math.pow(this.vertices[b].__dist, 1.3)
              , e = e + f * this.vertices[b].z / d;
        return a.clone().setZ(e)
    },
    drawCanvas: function(a) {
        for (var b = this.triangles.length; b; )
            this.triangles[--b].drawCanvas(a)
    },
    triangulate: function(a) {
        function b(a) {
            var b = a.length, c, d, e, f, g;
            a: for (; b; ) {
                d = a[--b];
                c = a[--b];
                for (e = b; e; ) {
                    g = a[--e];
                    f = a[--e];
                    if (c === f && d === g || c === g && d === f) {
                        a.splice(b, 2);
                        a.splice(e, 2);
                        b = b - 2;
                        continue a
                    }
                }
            }
        }
        this.vertices = a;
        if (a.length < 3)
            return [];
        a.sort(function(a, b) {
            return b.x - a.x
        });
        for (var c = a.length - 1, d = a[c].x, e = a[0].x, f = a[c].y, g = f; c--; ) {
            if (a[c].y < f)
                f = a[c].y;
            if (a[c].y > g)
                g = a[c].y
        }
        for (var h = e - d, i = g - f, c = h > i ? h : i, h = (e + d) * 0.5, i = (g + f) * 0.5, f = [new VG.Triangle({
            x: h - 20 * c,
            y: i - c,
            __sentinel: true
        },{
            x: h,
            y: i + 20 * c,
            __sentinel: true
        },{
            x: h + 20 * c,
            y: i - c,
            __sentinel: true
        })], g = [], d = [], c = a.length; c--; ) {
            d.length = 0;
            for (e = f.length; e--; ) {
                h = a[c].x - f[e].x;
                if (h > 0 && h * h > f[e].r) {
                    g.push(f[e]);
                    f.splice(e, 1)
                } else {
                    i = a[c].y - f[e].y;
                    if (!(h * h + i * i > f[e].r)) {
                        d.push(f[e].a, f[e].b, f[e].b, f[e].c, f[e].c, f[e].a);
                        f.splice(e, 1)
                    }
                }
            }
            b(d);
            for (e = d.length; e; ) {
                i = d[--e];
                h = d[--e];
                f.push(new VG.Triangle(h,i,a[c]))
            }
        }
        Array.prototype.push.apply(g, f);
        for (c = g.length; c--; )
            (g[c].a.__sentinel || g[c].b.__sentinel || g[c].c.__sentinel) && g.splice(c, 1);
        this.triangles = g;
        this.open = f;
        return g
    }
};
VG.Triangle = function(a, b, c) {
    this.a = a;
    this.b = b;
    this.c = c;
    var d = b.x - a.x
      , e = b.y - a.y
      , f = c.x - a.x
      , g = c.y - a.y
      , h = d * (a.x + b.x) + e * (a.y + b.y)
      , i = f * (a.x + c.x) + g * (a.y + c.y)
      , j = 2 * (d * (c.y - b.y) - e * (c.x - b.x));
    if (Math.abs(j) < 1.0E-6) {
        d = Math.min(a.x, b.x, c.x);
        e = Math.min(a.y, b.y, c.y);
        f = (Math.max(a.x, b.x, c.x) - d) * 0.5;
        a = (Math.max(a.y, b.y, c.y) - e) * 0.5;
        this.x = d + f;
        this.y = e + a
    } else {
        this.x = (g * h - e * i) / j;
        this.y = (d * i - f * h) / j;
        f = this.x - a.x;
        a = this.y - a.y
    }
    this.r = f * f + a * a
}
;
VG.Triangle.prototype = {
    constructor: VG.Triangle,
    inside: function(a, b) {
        var c = new VG.Vector
          , d = new VG.Vector
          , e = new VG.Vector
          , f = new VG.Vector(this.a.x,this.a.y,b === true ? 0 : this.a.z)
          , g = new VG.Vector(this.b.x,this.b.y,b === true ? 0 : this.b.z)
          , h = new VG.Vector(this.c.x,this.c.y,b === true ? 0 : this.c.z)
          , i = new VG.Vector(a.x,a.y,b === true ? 0 : a.z);
        c.sub(h, f);
        d.sub(g, f);
        e.sub(i, f);
        f = c.dot(c);
        g = c.dot(d);
        c = c.dot(e);
        h = d.dot(d);
        d = d.dot(e);
        e = 1 / (f * h - g * g);
        h = (h * c - g * d) * e;
        d = (f * d - g * c) * e;
        return h + 1.0E-5 >= 0 && d + 1.0E-5 >= 0 && h + d - 2.0E-5 <= 1
    },
    getZ: function() {
        var a = 0
          , b = 0;
        if (this.a.z !== void 0) {
            b = b + 1;
            a = a + this.a.z
        }
        if (this.b.z !== void 0) {
            b = b + 1;
            a = a + this.b.z
        }
        if (this.c.z !== void 0) {
            b = b + 1;
            a = a + this.c.z
        }
        return a / b
    },
    interp: function(a, b) {
        var c = this.normal()
          , b = b === void 0 ? c.clone() : b.clone().normalize()
          , d = b.dot(c);
        if (d === 0)
            return null;
        c = (new VG.Vector).sub(this.a, a).dot(c) / d;
        return a.clone().addSelf(b.setLength(c))
    },
    normal: function() {
        var a = (new VG.Vector).sub(this.b, this.a).normalize()
          , b = (new VG.Vector).sub(this.c, this.a).normalize();
        return (new VG.Vector).cross(a, b).normalize()
    },
    drawCanvas: function(a) {
        a.beginPath();
        a.moveTo(this.a.x, this.a.y);
        a.lineTo(this.b.x, this.b.y);
        a.lineTo(this.c.x, this.c.y);
        a.closePath();
        a.stroke()
    }
};
VG.ColorMap = {
    numberOfDefaults: 13,
    getColorMap: function(a) {
        switch (a) {
        case 0:
            return VG.ColorMap.Jet();
        case 1:
            return VG.ColorMap.HSV();
        case 2:
            return VG.ColorMap.Hot();
        case 3:
            return VG.ColorMap.Cool();
        case 4:
            return VG.ColorMap.Spring();
        case 5:
            return VG.ColorMap.Summer();
        case 6:
            return VG.ColorMap.Autumn();
        case 7:
            return VG.ColorMap.Winter();
        case 8:
            return VG.ColorMap.Gray();
        case 9:
            return VG.ColorMap.Bone();
        case 10:
            return VG.ColorMap.Copper();
        case 11:
            return VG.ColorMap.Pink();
        case 12:
            return VG.ColorMap.Lines();
        default:
            return null
        }
    },
    Jet: function() {
        return new VG.Matrix([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.0625, 0.125, 0.1875, 0.25, 0.3125, 0.375, 0.4375, 0.5, 0.5625, 0.625, 0.6875, 0.75, 0.8125, 0.875, 0.9375, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0.9375, 0.875, 0.8125, 0.75, 0.6875, 0.625, 0.5625, 0.5, 0, 0, 0, 0, 0, 0, 0, 0, 0.0625, 0.125, 0.1875, 0.25, 0.3125, 0.375, 0.4375, 0.5, 0.5625, 0.625, 0.6875, 0.75, 0.8125, 0.875, 0.9375, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0.9375, 0.875, 0.8125, 0.75, 0.6875, 0.625, 0.5625, 0.5, 0.4375, 0.375, 0.3125, 0.25, 0.1875, 0.125, 0.0625, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.5625, 0.625, 0.6875, 0.75, 0.8125, 0.875, 0.9375, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0.9375, 0.875, 0.8125, 0.75, 0.6875, 0.625, 0.5625, 0.5, 0.4375, 0.375, 0.3125, 0.25, 0.1875, 0.125, 0.0625, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],[64, 3])
    },
    HSV: function() {
        return new VG.Matrix([1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0.9688, 0.875, 0.7812, 0.6875, 0.5938, 0.5, 0.4062, 0.3125, 0.2188, 0.125, 0.0312, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.0312, 0.125, 0.2188, 0.3125, 0.4062, 0.5, 0.5938, 0.6875, 0.7812, 0.875, 0.9688, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0.0938, 0.1875, 0.2812, 0.375, 0.4688, 0.5625, 0.6562, 0.75, 0.8438, 0.9375, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0.9062, 0.8125, 0.7188, 0.625, 0.5312, 0.4375, 0.3438, 0.25, 0.1562, 0.0625, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.0625, 0.1562, 0.25, 0.3438, 0.4375, 0.5312, 0.625, 0.7188, 0.8125, 0.9062, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0.9375, 0.8438, 0.75, 0.6562, 0.5625, 0.4688, 0.375, 0.2812, 0.1875, 0.0938],[64, 3])
    },
    Hot: function() {
        return new VG.Matrix([0.0417, 0.0833, 0.125, 0.1667, 0.2083, 0.25, 0.2917, 0.3333, 0.375, 0.4167, 0.4583, 0.5, 0.5417, 0.5833, 0.625, 0.6667, 0.7083, 0.75, 0.7917, 0.8333, 0.875, 0.9167, 0.9583, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.0417, 0.0833, 0.125, 0.1667, 0.2083, 0.25, 0.2917, 0.3333, 0.375, 0.4167, 0.4583, 0.5, 0.5417, 0.5833, 0.625, 0.6667, 0.7083, 0.75, 0.7917, 0.8333, 0.875, 0.9167, 0.9583, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.0625, 0.125, 0.1875, 0.25, 0.3125, 0.375, 0.4375, 0.5, 0.5625, 0.625, 0.6875, 0.75, 0.8125, 0.875, 0.9375, 1],[64, 3])
    },
    Cool: function() {
        return new VG.Matrix([0, 0.0159, 0.0317, 0.0476, 0.0635, 0.0794, 0.0952, 0.1111, 0.127, 0.1429, 0.1587, 0.1746, 0.1905, 0.2063, 0.2222, 0.2381, 0.254, 0.2698, 0.2857, 0.3016, 0.3175, 0.3333, 0.3492, 0.3651, 0.381, 0.3968, 0.4127, 0.4286, 0.4444, 0.4603, 0.4762, 0.4921, 0.5079, 0.5238, 0.5397, 0.5556, 0.5714, 0.5873, 0.6032, 0.619, 0.6349, 0.6508, 0.6667, 0.6825, 0.6984, 0.7143, 0.7302, 0.746, 0.7619, 0.7778, 0.7937, 0.8095, 0.8254, 0.8413, 0.8571, 0.873, 0.8889, 0.9048, 0.9206, 0.9365, 0.9524, 0.9683, 0.9841, 1, 1, 0.9841, 0.9683, 0.9524, 0.9365, 0.9206, 0.9048, 0.8889, 0.873, 0.8571, 0.8413, 0.8254, 0.8095, 0.7937, 0.7778, 0.7619, 0.746, 0.7302, 0.7143, 0.6984, 0.6825, 0.6667, 0.6508, 0.6349, 0.619, 0.6032, 0.5873, 0.5714, 0.5556, 0.5397, 0.5238, 0.5079, 0.4921, 0.4762, 0.4603, 0.4444, 0.4286, 0.4127, 0.3968, 0.381, 0.3651, 0.3492, 0.3333, 0.3175, 0.3016, 0.2857, 0.2698, 0.254, 0.2381, 0.2222, 0.2063, 0.1905, 0.1746, 0.1587, 0.1429, 0.127, 0.1111, 0.0952, 0.0794, 0.0635, 0.0476, 0.0317, 0.0159, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],[64, 3])
    },
    Spring: function() {
        return new VG.Matrix([1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0.0159, 0.0317, 0.0476, 0.0635, 0.0794, 0.0952, 0.1111, 0.127, 0.1429, 0.1587, 0.1746, 0.1905, 0.2063, 0.2222, 0.2381, 0.254, 0.2698, 0.2857, 0.3016, 0.3175, 0.3333, 0.3492, 0.3651, 0.381, 0.3968, 0.4127, 0.4286, 0.4444, 0.4603, 0.4762, 0.4921, 0.5079, 0.5238, 0.5397, 0.5556, 0.5714, 0.5873, 0.6032, 0.619, 0.6349, 0.6508, 0.6667, 0.6825, 0.6984, 0.7143, 0.7302, 0.746, 0.7619, 0.7778, 0.7937, 0.8095, 0.8254, 0.8413, 0.8571, 0.873, 0.8889, 0.9048, 0.9206, 0.9365, 0.9524, 0.9683, 0.9841, 1, 1, 0.9841, 0.9683, 0.9524, 0.9365, 0.9206, 0.9048, 0.8889, 0.873, 0.8571, 0.8413, 0.8254, 0.8095, 0.7937, 0.7778, 0.7619, 0.746, 0.7302, 0.7143, 0.6984, 0.6825, 0.6667, 0.6508, 0.6349, 0.619, 0.6032, 0.5873, 0.5714, 0.5556, 0.5397, 0.5238, 0.5079, 0.4921, 0.4762, 0.4603, 0.4444, 0.4286, 0.4127, 0.3968, 0.381, 0.3651, 0.3492, 0.3333, 0.3175, 0.3016, 0.2857, 0.2698, 0.254, 0.2381, 0.2222, 0.2063, 0.1905, 0.1746, 0.1587, 0.1429, 0.127, 0.1111, 0.0952, 0.0794, 0.0635, 0.0476, 0.0317, 0.0159, 0],[64, 3])
    },
    Summer: function() {
        return new VG.Matrix([0, 0.0159, 0.0317, 0.0476, 0.0635, 0.0794, 0.0952, 0.1111, 0.127, 0.1429, 0.1587, 0.1746, 0.1905, 0.2063, 0.2222, 0.2381, 0.254, 0.2698, 0.2857, 0.3016, 0.3175, 0.3333, 0.3492, 0.3651, 0.381, 0.3968, 0.4127, 0.4286, 0.4444, 0.4603, 0.4762, 0.4921, 0.5079, 0.5238, 0.5397, 0.5556, 0.5714, 0.5873, 0.6032, 0.619, 0.6349, 0.6508, 0.6667, 0.6825, 0.6984, 0.7143, 0.7302, 0.746, 0.7619, 0.7778, 0.7937, 0.8095, 0.8254, 0.8413, 0.8571, 0.873, 0.8889, 0.9048, 0.9206, 0.9365, 0.9524, 0.9683, 0.9841, 1, 0.5, 0.5079, 0.5159, 0.5238, 0.5317, 0.5397, 0.5476, 0.5556, 0.5635, 0.5714, 0.5794, 0.5873, 0.5952, 0.6032, 0.6111, 0.619, 0.627, 0.6349, 0.6429, 0.6508, 0.6587, 0.6667, 0.6746, 0.6825, 0.6905, 0.6984, 0.7063, 0.7143, 0.7222, 0.7302, 0.7381, 0.746, 0.754, 0.7619, 0.7698, 0.7778, 0.7857, 0.7937, 0.8016, 0.8095, 0.8175, 0.8254, 0.8333, 0.8413, 0.8492, 0.8571, 0.8651, 0.873, 0.881, 0.8889, 0.8968, 0.9048, 0.9127, 0.9206, 0.9286, 0.9365, 0.9444, 0.9524, 0.9603, 0.9683, 0.9762, 0.9841, 0.9921, 1, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4],[64, 3])
    },
    Autumn: function() {
        return new VG.Matrix([1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0.0159, 0.0317, 0.0476, 0.0635, 0.0794, 0.0952, 0.1111, 0.127, 0.1429, 0.1587, 0.1746, 0.1905, 0.2063, 0.2222, 0.2381, 0.254, 0.2698, 0.2857, 0.3016, 0.3175, 0.3333, 0.3492, 0.3651, 0.381, 0.3968, 0.4127, 0.4286, 0.4444, 0.4603, 0.4762, 0.4921, 0.5079, 0.5238, 0.5397, 0.5556, 0.5714, 0.5873, 0.6032, 0.619, 0.6349, 0.6508, 0.6667, 0.6825, 0.6984, 0.7143, 0.7302, 0.746, 0.7619, 0.7778, 0.7937, 0.8095, 0.8254, 0.8413, 0.8571, 0.873, 0.8889, 0.9048, 0.9206, 0.9365, 0.9524, 0.9683, 0.9841, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],[64, 3])
    },
    Winter: function() {
        return new VG.Matrix([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.0159, 0.0317, 0.0476, 0.0635, 0.0794, 0.0952, 0.1111, 0.127, 0.1429, 0.1587, 0.1746, 0.1905, 0.2063, 0.2222, 0.2381, 0.254, 0.2698, 0.2857, 0.3016, 0.3175, 0.3333, 0.3492, 0.3651, 0.381, 0.3968, 0.4127, 0.4286, 0.4444, 0.4603, 0.4762, 0.4921, 0.5079, 0.5238, 0.5397, 0.5556, 0.5714, 0.5873, 0.6032, 0.619, 0.6349, 0.6508, 0.6667, 0.6825, 0.6984, 0.7143, 0.7302, 0.746, 0.7619, 0.7778, 0.7937, 0.8095, 0.8254, 0.8413, 0.8571, 0.873, 0.8889, 0.9048, 0.9206, 0.9365, 0.9524, 0.9683, 0.9841, 1, 1, 0.9921, 0.9841, 0.9762, 0.9683, 0.9603, 0.9524, 0.9444, 0.9365, 0.9286, 0.9206, 0.9127, 0.9048, 0.8968, 0.8889, 0.881, 0.873, 0.8651, 0.8571, 0.8492, 0.8413, 0.8333, 0.8254, 0.8175, 0.8095, 0.8016, 0.7937, 0.7857, 0.7778, 0.7698, 0.7619, 0.754, 0.746, 0.7381, 0.7302, 0.7222, 0.7143, 0.7063, 0.6984, 0.6905, 0.6825, 0.6746, 0.6667, 0.6587, 0.6508, 0.6429, 0.6349, 0.627, 0.619, 0.6111, 0.6032, 0.5952, 0.5873, 0.5794, 0.5714, 0.5635, 0.5556, 0.5476, 0.5397, 0.5317, 0.5238, 0.5159, 0.5079, 0.5],[64, 3])
    },
    Gray: function() {
        return new VG.Matrix([0, 0.0159, 0.0317, 0.0476, 0.0635, 0.0794, 0.0952, 0.1111, 0.127, 0.1429, 0.1587, 0.1746, 0.1905, 0.2063, 0.2222, 0.2381, 0.254, 0.2698, 0.2857, 0.3016, 0.3175, 0.3333, 0.3492, 0.3651, 0.381, 0.3968, 0.4127, 0.4286, 0.4444, 0.4603, 0.4762, 0.4921, 0.5079, 0.5238, 0.5397, 0.5556, 0.5714, 0.5873, 0.6032, 0.619, 0.6349, 0.6508, 0.6667, 0.6825, 0.6984, 0.7143, 0.7302, 0.746, 0.7619, 0.7778, 0.7937, 0.8095, 0.8254, 0.8413, 0.8571, 0.873, 0.8889, 0.9048, 0.9206, 0.9365, 0.9524, 0.9683, 0.9841, 1, 0, 0.0159, 0.0317, 0.0476, 0.0635, 0.0794, 0.0952, 0.1111, 0.127, 0.1429, 0.1587, 0.1746, 0.1905, 0.2063, 0.2222, 0.2381, 0.254, 0.2698, 0.2857, 0.3016, 0.3175, 0.3333, 0.3492, 0.3651, 0.381, 0.3968, 0.4127, 0.4286, 0.4444, 0.4603, 0.4762, 0.4921, 0.5079, 0.5238, 0.5397, 0.5556, 0.5714, 0.5873, 0.6032, 0.619, 0.6349, 0.6508, 0.6667, 0.6825, 0.6984, 0.7143, 0.7302, 0.746, 0.7619, 0.7778, 0.7937, 0.8095, 0.8254, 0.8413, 0.8571, 0.873, 0.8889, 0.9048, 0.9206, 0.9365, 0.9524, 0.9683, 0.9841, 1, 0, 0.0159, 0.0317, 0.0476, 0.0635, 0.0794, 0.0952, 0.1111, 0.127, 0.1429, 0.1587, 0.1746, 0.1905, 0.2063, 0.2222, 0.2381, 0.254, 0.2698, 0.2857, 0.3016, 0.3175, 0.3333, 0.3492, 0.3651, 0.381, 0.3968, 0.4127, 0.4286, 0.4444, 0.4603, 0.4762, 0.4921, 0.5079, 0.5238, 0.5397, 0.5556, 0.5714, 0.5873, 0.6032, 0.619, 0.6349, 0.6508, 0.6667, 0.6825, 0.6984, 0.7143, 0.7302, 0.746, 0.7619, 0.7778, 0.7937, 0.8095, 0.8254, 0.8413, 0.8571, 0.873, 0.8889, 0.9048, 0.9206, 0.9365, 0.9524, 0.9683, 0.9841, 1],[64, 3])
    },
    Bone: function() {
        return new VG.Matrix([0, 0.0139, 0.0278, 0.0417, 0.0556, 0.0694, 0.0833, 0.0972, 0.1111, 0.125, 0.1389, 0.1528, 0.1667, 0.1806, 0.1944, 0.2083, 0.2222, 0.2361, 0.25, 0.2639, 0.2778, 0.2917, 0.3056, 0.3194, 0.3333, 0.3472, 0.3611, 0.375, 0.3889, 0.4028, 0.4167, 0.4306, 0.4444, 0.4583, 0.4722, 0.4861, 0.5, 0.5139, 0.5278, 0.5417, 0.5556, 0.5694, 0.5833, 0.5972, 0.6111, 0.625, 0.6389, 0.6528, 0.6745, 0.6962, 0.7179, 0.7396, 0.7613, 0.783, 0.8047, 0.8264, 0.8481, 0.8698, 0.8915, 0.9132, 0.9349, 0.9566, 0.9783, 1, 0, 0.0139, 0.0278, 0.0417, 0.0556, 0.0694, 0.0833, 0.0972, 0.1111, 0.125, 0.1389, 0.1528, 0.1667, 0.1806, 0.1944, 0.2083, 0.2222, 0.2361, 0.25, 0.2639, 0.2778, 0.2917, 0.3056, 0.3194, 0.3385, 0.3576, 0.3767, 0.3958, 0.4149, 0.434, 0.4531, 0.4722, 0.4913, 0.5104, 0.5295, 0.5486, 0.5677, 0.5868, 0.6059, 0.625, 0.6441, 0.6632, 0.6823, 0.7014, 0.7205, 0.7396, 0.7587, 0.7778, 0.7917, 0.8056, 0.8194, 0.8333, 0.8472, 0.8611, 0.875, 0.8889, 0.9028, 0.9167, 0.9306, 0.9444, 0.9583, 0.9722, 0.9861, 1, 0.0052, 0.0243, 0.0434, 0.0625, 0.0816, 0.1007, 0.1198, 0.1389, 0.158, 0.1771, 0.1962, 0.2153, 0.2344, 0.2535, 0.2726, 0.2917, 0.3108, 0.3299, 0.349, 0.3681, 0.3872, 0.4062, 0.4253, 0.4444, 0.4583, 0.4722, 0.4861, 0.5, 0.5139, 0.5278, 0.5417, 0.5556, 0.5694, 0.5833, 0.5972, 0.6111, 0.625, 0.6389, 0.6528, 0.6667, 0.6806, 0.6944, 0.7083, 0.7222, 0.7361, 0.75, 0.7639, 0.7778, 0.7917, 0.8056, 0.8194, 0.8333, 0.8472, 0.8611, 0.875, 0.8889, 0.9028, 0.9167, 0.9306, 0.9444, 0.9583, 0.9722, 0.9861, 1],[64, 3])
    },
    Copper: function() {
        return new VG.Matrix([0, 0.0198, 0.0397, 0.0595, 0.0794, 0.0992, 0.119, 0.1389, 0.1587, 0.1786, 0.1984, 0.2183, 0.2381, 0.2579, 0.2778, 0.2976, 0.3175, 0.3373, 0.3571, 0.377, 0.3968, 0.4167, 0.4365, 0.4563, 0.4762, 0.496, 0.5159, 0.5357, 0.5556, 0.5754, 0.5952, 0.6151, 0.6349, 0.6548, 0.6746, 0.6944, 0.7143, 0.7341, 0.754, 0.7738, 0.7937, 0.8135, 0.8333, 0.8532, 0.873, 0.8929, 0.9127, 0.9325, 0.9524, 0.9722, 0.9921, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0.0124, 0.0248, 0.0372, 0.0496, 0.062, 0.0744, 0.0868, 0.0992, 0.1116, 0.124, 0.1364, 0.1488, 0.1612, 0.1736, 0.186, 0.1984, 0.2108, 0.2232, 0.2356, 0.248, 0.2604, 0.2728, 0.2852, 0.2976, 0.31, 0.3224, 0.3348, 0.3472, 0.3596, 0.372, 0.3844, 0.3968, 0.4092, 0.4216, 0.434, 0.4464, 0.4588, 0.4712, 0.4836, 0.496, 0.5084, 0.5208, 0.5332, 0.5456, 0.558, 0.5704, 0.5828, 0.5952, 0.6076, 0.62, 0.6324, 0.6448, 0.6572, 0.6696, 0.682, 0.6944, 0.7068, 0.7192, 0.7316, 0.744, 0.7564, 0.7688, 0.7812, 0, 0.0079, 0.0158, 0.0237, 0.0316, 0.0395, 0.0474, 0.0553, 0.0632, 0.0711, 0.079, 0.0869, 0.0948, 0.1027, 0.1106, 0.1185, 0.1263, 0.1342, 0.1421, 0.15, 0.1579, 0.1658, 0.1737, 0.1816, 0.1895, 0.1974, 0.2053, 0.2132, 0.2211, 0.229, 0.2369, 0.2448, 0.2527, 0.2606, 0.2685, 0.2764, 0.2843, 0.2922, 0.3001, 0.308, 0.3159, 0.3238, 0.3317, 0.3396, 0.3475, 0.3554, 0.3633, 0.3712, 0.379, 0.3869, 0.3948, 0.4027, 0.4106, 0.4185, 0.4264, 0.4343, 0.4422, 0.4501, 0.458, 0.4659, 0.4738, 0.4817, 0.4896, 0.4975],[64, 3])
    },
    Pink: function() {
        return new VG.Matrix([0.1179, 0.1959, 0.2507, 0.2955, 0.3343, 0.3691, 0.4009, 0.4303, 0.4579, 0.4839, 0.5085, 0.532, 0.5546, 0.5762, 0.5971, 0.6172, 0.6367, 0.6557, 0.6741, 0.692, 0.7094, 0.7265, 0.7431, 0.7594, 0.7664, 0.7732, 0.78, 0.7868, 0.7935, 0.8001, 0.8067, 0.8133, 0.8197, 0.8262, 0.8325, 0.8389, 0.8452, 0.8514, 0.8576, 0.8637, 0.8698, 0.8759, 0.8819, 0.8879, 0.8938, 0.8997, 0.9056, 0.9114, 0.9172, 0.923, 0.9287, 0.9344, 0.94, 0.9456, 0.9512, 0.9567, 0.9623, 0.9677, 0.9732, 0.9786, 0.984, 0.9894, 0.9947, 1, 0, 0.1029, 0.1455, 0.1782, 0.2057, 0.23, 0.252, 0.2722, 0.291, 0.3086, 0.3253, 0.3412, 0.3563, 0.3709, 0.3849, 0.3984, 0.4115, 0.4241, 0.4364, 0.4484, 0.46, 0.4714, 0.4825, 0.4933, 0.5175, 0.5407, 0.5628, 0.5842, 0.6048, 0.6247, 0.644, 0.6627, 0.6809, 0.6986, 0.7159, 0.7328, 0.7493, 0.7655, 0.7813, 0.7968, 0.812, 0.827, 0.8416, 0.856, 0.8702, 0.8842, 0.8979, 0.9114, 0.9172, 0.923, 0.9287, 0.9344, 0.94, 0.9456, 0.9512, 0.9567, 0.9623, 0.9677, 0.9732, 0.9786, 0.984, 0.9894, 0.9947, 1, 0, 0.1029, 0.1455, 0.1782, 0.2057, 0.23, 0.252, 0.2722, 0.291, 0.3086, 0.3253, 0.3412, 0.3563, 0.3709, 0.3849, 0.3984, 0.4115, 0.4241, 0.4364, 0.4484, 0.46, 0.4714, 0.4825, 0.4933, 0.504, 0.5143, 0.5245, 0.5345, 0.5443, 0.554, 0.5634, 0.5727, 0.5819, 0.5909, 0.5998, 0.6086, 0.6172, 0.6257, 0.6341, 0.6424, 0.6506, 0.6587, 0.6667, 0.6746, 0.6824, 0.6901, 0.6977, 0.7052, 0.7272, 0.7485, 0.7692, 0.7893, 0.809, 0.8282, 0.8469, 0.8653, 0.8832, 0.9008, 0.9181, 0.9351, 0.9517, 0.9681, 0.9842, 1],[64, 3])
    },
    Lines: function() {
        return new VG.Matrix([0, 0, 1, 0, 0.75, 0.75, 0.25, 0, 0, 1, 0, 0.75, 0.75, 0.25, 0, 0, 1, 0, 0.75, 0.75, 0.25, 0, 0, 1, 0, 0.75, 0.75, 0.25, 0, 0, 1, 0, 0.75, 0.75, 0.25, 0, 0, 1, 0, 0.75, 0.75, 0.25, 0, 0, 1, 0, 0.75, 0.75, 0.25, 0, 0, 1, 0, 0.75, 0.75, 0.25, 0, 0, 1, 0, 0.75, 0.75, 0.25, 0, 0, 0.5, 0, 0.75, 0, 0.75, 0.25, 0, 0.5, 0, 0.75, 0, 0.75, 0.25, 0, 0.5, 0, 0.75, 0, 0.75, 0.25, 0, 0.5, 0, 0.75, 0, 0.75, 0.25, 0, 0.5, 0, 0.75, 0, 0.75, 0.25, 0, 0.5, 0, 0.75, 0, 0.75, 0.25, 0, 0.5, 0, 0.75, 0, 0.75, 0.25, 0, 0.5, 0, 0.75, 0, 0.75, 0.25, 0, 0.5, 0, 0.75, 0, 0.75, 0.25, 0, 1, 0, 0, 0.75, 0.75, 0, 0.25, 1, 0, 0, 0.75, 0.75, 0, 0.25, 1, 0, 0, 0.75, 0.75, 0, 0.25, 1, 0, 0, 0.75, 0.75, 0, 0.25, 1, 0, 0, 0.75, 0.75, 0, 0.25, 1, 0, 0, 0.75, 0.75, 0, 0.25, 1, 0, 0, 0.75, 0.75, 0, 0.25, 1, 0, 0, 0.75, 0.75, 0, 0.25, 1, 0, 0, 0.75, 0.75, 0, 0.25, 1],[64, 3])
    }
};
VG.ColorBar = function(a, b, c) {
    this.colorMap = a || VG.ColorMap.Jet;
    this.setCLim(b != void 0 ? b : 0, c != void 0 ? c : 1);
    this.ignoreValue = null;
    this.numberFormat = new VG.NumberFormat("0.00");
    this.updateHandlers = [];
    this.showingColorBars = false
}
;
VG.ColorBar.prototype = {
    constructor: VG.ColorBar,
    setCLim: function(a, b) {
        this.caxis = [a, b];
        this.range = b - a
    },
    getHex: function(a) {
        a = this.getColor(a);
        return rgbToHex(Math.floor(a[0] * 255), Math.floor(a[1] * 255), Math.floor(a[2] * 255))
    },
    getColor: function(a) {
        if (this.ignoreValue != null && abs(a - this.ignoreValue) < 1.0E-13)
            return [0, 0, 0];
        var b = (a - this.caxis[0]) / this.range
          , c = this.colorMap.sizeDim(1)
          , a = Math.floor(b * c)
          , d = Math.ceil(b * c)
          , a = Math.min(Math.max(a, 1), c)
          , d = Math.min(Math.max(d, 1), c)
          , a = this.colorMap.getRowArray(a)
          , e = this.colorMap.getRowArray(d)
          , d = d - b * c
          , b = a[0] * d + e[0] * (1 - d)
          , c = a[1] * d + e[1] * (1 - d)
          , a = a[2] * d + e[2] * (1 - d)
          , b = Math.min(Math.max(b, 0), 1)
          , c = Math.min(Math.max(c, 0), 1)
          , a = Math.min(Math.max(a, 0), 1);
        return [b, c, a]
    },
    createViewer: function(a, b, c) {
        var d = this;
        this.logScale = a;
        c = c === void 0 ? 7 : c;
        a = $("<div>");
        if (b)
            for (var e = VG.ColorMap.numberOfDefaults - 1; e >= 0; e--) {
                var f = this.createBar(VG.ColorMap.getColorMap(e), 25, c);
                f.hide();
                f.click(function(a) {
                    return function() {
                        d.colorMap = VG.ColorMap.getColorMap(a);
                        d.fireColorBarChangeEvent();
                        d.showingColorBars = false
                    }
                }(e));
                a.append(f)
            }
        e = this.createBar(this.colorMap, 25, c);
        if (b) {
            e.css({
                cursor: "pointer"
            });
            e.click(function() {
                d.toggleShowColorBars()
            })
        }
        a.append(e);
        a.css({
            top: "50%",
            "margin-top": -c * this.colorMap.sizeDim(1) / 2,
            right: 25,
            position: "absolute",
            overflow: "visible",
            height: c * this.colorMap.sizeDim(1),
            width: b ? 140 : 60
        });
        for (c = 0; c <= 100; c = c + 25)
            this.createText(c, a, b);
        this.hoverValue = $("<div>");
        this.hoverValue.addClass("hoverValue");
        a.append(this.hoverValue);
        return this.panel = a
    },
    addLabel: function(a) {
        this.panel !== void 0 && this.panel.append($("<div>").html(a).addClass("colorBarLabel"))
    },
    alignTop: function() {
        this.panel.css({
            "margin-top": ""
        })
    },
    addHandler: function(a) {
        this.updateHandlers.push(a)
    },
    fireColorBarChangeEvent: function() {
        for (var a = 0; a < this.updateHandlers.length; a++)
            this.updateHandlers[a]()
    },
    setHoverValue: function(a) {
        a = (a - this.caxis[0]) / this.range;
        a >= 0 && a <= 1 && this.hoverValue.css({
            bottom: a * 100 + "%"
        })
    },
    toggleShowColorBars: function() {
        var a = $(".colorBar");
        if (this.showingColorBars) {
            for (c = 0; c < a.length; c++)
                $(a[c]).stop().animate({
                    left: 0
                });
            this.showingColorBars = false;
            (new VG.Timer(function() {
                a.hide();
                a.last().show()
            }
            )).schedule(600)
        } else {
            a.show();
            this.showingColorBars = true;
            for (var b = 35 * VG.ColorMap.numberOfDefaults, c = 0; c < a.length; c++) {
                $(a[c]).stop().animate({
                    left: -b
                });
                b = b - 35
            }
        }
    },
    createBar: function(a, b, c) {
        for (var d = $("<table>"), e = a.sizeDim(1); e > 0; e--) {
            var f = $("<tr>");
            f.html("<td></td>");
            var g = a.getRow(e);
            f.css({
                height: c,
                width: b,
                "font-size": c,
                "background-color": rgbToHex(Math.floor(g.get(1) * 255), Math.floor(g.get(2) * 255), Math.floor(g.get(3) * 255))
            });
            d.append(f)
        }
        d.addClass("colorBar");
        d.css({
            width: b + 2,
            height: c * a.sizeDim(1)
        });
        return d
    },
    createText: function(a, b, c) {
        var d = this
          , e = this.range * (a / 100) + this.caxis[0];
        this.logScale && (e = Math.pow(10, e));
        if (c && (a == 0 || a == 100)) {
            var f = $("<input>");
            f.attr("value", this.numberFormat.format(e));
            f.addClass("hoverTextBox");
            a == 0 ? f.blur(function() {
                var a = parseFloat(f.val());
                if (isNaN(a))
                    f.attr("value", d.getFormattedMin(d.logScale));
                else {
                    d.logScale && (a = log10(a));
                    d.setCLim(a, d.caxis[1]);
                    d.fireColorBarChangeEvent()
                }
            }) : a == 100 && f.blur(function() {
                var a = parseFloat(f.val());
                if (isNaN(a))
                    f.attr("value", d.getFormattedMax(d.logScale));
                else {
                    d.logScale && (a = log10(a));
                    d.setCLim(d.caxis[0], a);
                    d.fireColorBarChangeEvent()
                }
            });
            f.css({
                position: "absolute",
                bottom: a + "%",
                left: 30,
                "font-size": 12,
                "margin-bottom": -8
            });
            b.append(f)
        } else {
            c = $("<div>");
            c.html(this.numberFormat.format(e));
            c.css({
                position: "absolute",
                bottom: a + "%",
                left: 34,
                "font-size": 12,
                "margin-bottom": -6
            });
            b.append(c)
        }
    },
    getFormattedMin: function() {
        return this.logScale ? this.numberFormat.format(Math.pow(10, this.caxis[0])) : this.numberFormat.format(this.caxis[0])
    },
    getFormattedMax: function() {
        return this.logScale ? this.numberFormat.format(Math.pow(10, this.caxis[1])) : this.numberFormat.format(this.caxis[1])
    }
};
VG.Canvas = function(a, b) {
    this.canvas = document.createElement("canvas");
    this.context = this.canvas.getContext("2d");
    this.setSize(a, b);
    this.res = 1
}
;
VG.Canvas.prototype = {
    constructor: VG.Canvas,
    colorPixels: function(a) {
        for (var b = 0; b < this.canvas.width; b = b + this.res)
            for (var c = 0; c < this.canvas.height; c = c + this.res) {
                var d = a(b + this.res / 2, c + this.res / 2, b / this.res, c / this.res);
                this.context.fillStyle = "rgb(" + Math.floor(d[0] * 255) + "," + Math.floor(d[1] * 255) + "," + Math.floor(d[2] * 255) + ")";
                this.context.fillRect(b, c, this.res, this.res);
                this.context.fill()
            }
        return this.canvas.toDataURL("image/png")
    },
    setSize: function(a, b) {
        this.canvas.width = a ? a : 100;
        this.canvas.height = b ? b : 100
    },
    writeText: function(a, b) {
        this.context.font = b + "pt Helvetica";
        this.context.fillStyle = "#abc789";
        this.canvas.width = this.context.measureText(a).width;
        this.canvas.height = b * 1.3 * 96 / 72;
        this.context.font = b + "pt Helvetica";
        this.context.fillStyle = "#000000";
        this.context.fillText(a, 0, b * 96 / 72)
    }
};
VG.Login = function() {
    this.info = {
        sessionID: $.cookie("sid")
    };
    var a = this;
    $(VG.Bus).bind("loginInfoChangeEvent", function(b, c) {
        a.info = c;
        if (c !== null && c.sessionID !== void 0) {
            $.cookie("sid", c.sessionID, {
                expires: 30
            });
            $(VG.Bus).trigger("login", [c]);
            $("#loginInfo").html(c.firstName + " " + c.lastName)
        } else {
            $.cookie("sid", null);
            $("#loginInfo").html("")
        }
    });
    $(VG.Bus).bind("loginFailedEvent", function() {
        (new VG.Notify("Login Failed","The username/password combination was not recognized.")).subTheme("Error")
    });
    this.passiveLogin()
}
;
VG.Login.prototype = {
    constructor: VG.Login,
    createRegisterBox: function(a) {
        var b = new VG.Input(a)
          , c = this;
        b.addTextInput(["First Name", "firstname"], "");
        b.addTextInput(["Last Name", "lastname"], "");
        b.addTextInput(["Organization", "university"], "");
        b.addOptionInput(["I am a", "usertype"], ["Student", "Teacher", "Professional", "Avid Enthusiast"]);
        var d = b.addTextInput("Email", "", emailRegExp, false, "Email in use");
        d.element.change(function() {
            c.checkEmail(d.getValue())
        });
        $(VG.Bus).bind("emailInUseEvent", function() {
            b.setError(4, "Email in use")
        });
        $(VG.Bus).bind("emailNotFoundEvent", function() {
            b.clearError(4);
            b.checkList[4].validate()
        });
        b.addTextInput("Password", "", null, true);
        b.addButton("Create Account", function(a, b) {
            b && c.register(a)
        });
        return b
    },
    createLoginBox: function(a, b) {
        if (this.info !== null && this.info.sessionID !== null)
            return this.createLogoutBox(a);
        var c = new VG.Input(a)
          , d = this;
        c.addTextInput("Email", "", emailRegExp);
        c.addTextInput("Password", "", null, true);
        c.addButton("Login", function(a, b) {
            if (b) {
                d.login(a.email, a.password);
                VG.Notify.closeAll()
            }
        });
        if (b) {
            c.addText("Don't have an account?");
            c.addButton("Sign Up", function() {
                VG.Notify.closeAll();
                (new VG.Notify("Sign Up","",d.createRegisterBox().panel)).subTheme("Warn")
            })
        }
        return c
    },
    createLogoutBox: function(a) {
        a = new VG.Input(a);
        a.addText("You are currently logged in.");
        var b = this;
        a.addButton("Logout", function() {
            b.logout();
            VG.Notify.closeAll()
        });
        return a
    },
    register: function(a) {
        $.getJSON("loginService", {
            requestType: "register",
            firstName: a.firstname,
            lastName: a.lastname,
            emailAddress: a.email,
            password: a.password,
            university: a.university,
            userDescription: a.usertype
        }, function(a) {
            if (a === null)
                $(VG.Bus).trigger("emailInUseEvent");
            else {
                VG.Notify.closeAll();
                $(VG.Bus).trigger("loginInfoChangeEvent", [a])
            }
        })
    },
    checkEmail: function(a) {
        $.getJSON("loginService", {
            requestType: "checkEmail",
            emailAddress: a
        }, function(a) {
            a !== null ? $(VG.Bus).trigger("emailInUseEvent") : $(VG.Bus).trigger("emailNotFoundEvent")
        })
    },
    resetPassword: function(a) {
        $.getJSON("loginService", {
            requestType: "checkEmail",
            emailAddress: a
        }, function(a) {
            a === null ? $(VG.Bus).trigger("emailNotFoundEvent") : $(VG.Bus).trigger("passwordResetEvent")
        })
    },
    login: function(a, b) {
        $.getJSON("loginService", {
            requestType: "validate",
            emailAddress: a,
            password: b
        }, function(a) {
            $(VG.Bus).trigger("loginInfoChangeEvent", [a]);
            a === null && $(VG.Bus).trigger("loginFailedEvent")
        })
    },
    passiveLogin: function() {
        this.info = {
            sessionID: $.cookie("sid")
        };
        this.info.sessionID !== null && $.getJSON("loginService", {
            requestType: "validate",
            sessionID: this.info.sessionID
        }, function(a) {
            $(VG.Bus).trigger("loginInfoChangeEvent", [a])
        })
    },
    logout: function() {
        this.info.sessionID === null && $.cookie("sid") === null || $.getJSON("loginService", {
            requestType: "logout",
            sessionID: this.info.sessionID
        }, function(a) {
            $(VG.Bus).trigger("logoutEvent", [a])
        })
    },
    isLoggedIn: function() {
        return !(this.info === null || this.info.sessionID === void 0 || this.info.sessionID === null || this.info.sessionID.length === 0)
    }
};
VG.Request = function(a, b, c) {
    this.success = b;
    this.fail = c === void 0 ? function() {
        VG.Notify.Error()
    }
    : c;
    this.loginInfo = a === void 0 ? {} : a;
    this.url = "requestData";
    var d = this;
    this.response = function(a) {
        a === null ? d.fail() : d.success(a)
    }
}
;
VG.Request.prototype = {
    constructor: VG.Request,
    groupData: function(a) {
        a !== void 0 && a.length === 8 ? this.getListByProperty("group", "code", "string", a) : a !== void 0 && a === "ALL" ? $.getJSON(this.url, {
            requestType: "getList",
            entityName: "group"
        }, this.response) : a !== void 0 ? $.getJSON(this.url, {
            requestType: "getbyid",
            entityName: "group",
            id: a,
            sid: this.loginInfo.sessionID
        }, this.response) : $.getJSON(this.url, {
            requestType: "getListByUser",
            entityName: "group",
            sid: this.loginInfo.sessionID
        }, this.response)
    },
    groupMemberData: function(a) {
        this.getListByProperty("groupMember", "code", "string", a)
    },
    getListByProperty: function(a, b, c, d) {
        $.getJSON(this.url, {
            requestType: "getListByProperty",
            entityName: a,
            property: b,
            propertyType: c,
            equalsThis: d,
            sid: this.loginInfo.sessionID
        }, this.response)
    }
};
VG.GeologyMaterial = function(a) {
    a.computeCentroids();
    a.computeVertexNormals();
    a.computeFaceNormals();
    var b = new THREE.MeshBasicMaterial({
        color: 65280
    });
    return new THREE.Mesh(a,b)
}
;
VG.FaultObject = function(a, b, c, d, e, f, g) {
    this.type = "fault";
    this.niceName = "Faulting Event";
    this.numberDefaults = 6;
    this.defaultNames = ["Normal Fault", "Reverse Fault", "Thrust Fault", "Left-lateral Strike-slip Fault", "Right-lateral Strike-slip Fault", "Random Fault"];
    this.set(a, b, c, d, e, f, g)
}
;
VG.FaultObject.prototype = {
    constructor: VG.FaultObject,
    set: function(a, b, c, d, e, f, g) {
        this.strike = a === void 0 ? 0 : a;
        this.dip = b === void 0 ? 90 : b;
        this.rake = c === void 0 ? 90 : c;
        this.slip = d === void 0 ? 10 : d;
        this.point = e === void 0 ? new VG.Vector(0,0,0) : e;
        this.center = g === void 0 ? new VG.Vector(0,0,0) : g;
        this.length = f === void 0 ? 0 : f;
        this.update()
    },
    colorXYZ: function(a) {
        a = this.plane.getDistance(a);
        return Math.abs(a) <= 0.5 ? [0, 0, 0.75] : null
    },
    update: function() {
        this.plane = new VG.Plane;
        this.plane.fromStrikeAndDip(this.strike, this.dip, this.point);
        this.direction = getRakeVector(this.strike, this.dip, this.rake).negate()
    },
    moment: function(a, b) {
        var b = b === void 0 ? 3E10 : b
          , c = (a[1] - a[0]) / Math.sin(toRadians(this.dip));
        return b * this.length * c * this.slip
    },
    magnitude: function(a, b) {
        return 2 / 3 * log10(this.moment(a, b)) - 6.03
    },
    name: function() {
        if (this.slip === 0)
            return "";
        var a = -this.rake + (this.rake > 0 ? 360 : 0);
        return Math.abs(a - 90) <= 30 ? "Normal Fault" : Math.abs(a - 270) <= 30 ? this.dip <= 30 ? "Thrust Fault" : "Reverse Fault" : Math.abs(a - 180) <= 30 ? "Right-lateral Strike-Slip Fault" : a <= 15 || a >= 345 ? "Left-lateral Strike-Slip Fault" : (a >= 270 || a <= 90 ? "Left-lateral " : "Right-lateral ") + (a <= 180 ? "Normal " : "Reverse ") + "Oblique Fault"
    }
};
VG.FaultObject.getDefault = function(a) {
    switch (a) {
    case 0:
        return VG.FaultObject.normalFault();
    case 1:
        return VG.FaultObject.reverseFault();
    case 2:
        return VG.FaultObject.thrustFault();
    case 3:
        return VG.FaultObject.leftLateralFault();
    case 4:
        return VG.FaultObject.rightLateralFault();
    case 5:
        return VG.FaultObject.random();
    default:
        return null
    }
}
;
VG.FaultObject.normalFault = function() {
    return new VG.FaultObject(nextInt(360),nextInt(90),90,nextInt(30) + 20,new VG.Vector)
}
;
VG.FaultObject.reverseFault = function() {
    return new VG.FaultObject(nextInt(360),nextInt(60) + 30,270,nextInt(30) + 20,new VG.Vector)
}
;
VG.FaultObject.thrustFault = function() {
    return new VG.FaultObject(nextInt(360),nextInt(10) + 20,270,nextInt(30) + 20,new VG.Vector)
}
;
VG.FaultObject.leftLateralFault = function() {
    return new VG.FaultObject(nextInt(360),nextInt(90),0,nextInt(30) + 20,new VG.Vector)
}
;
VG.FaultObject.rightLateralFault = function() {
    return new VG.FaultObject(nextInt(360),nextInt(90),180,nextInt(30) + 20,new VG.Vector)
}
;
VG.FaultObject.random = function() {
    return new VG.FaultObject(nextInt(360),nextInt(90),nextInt(360),nextInt(30) + 20,new VG.Vector)
}
;
VG.Orient = function(a, b, c, d, e, f) {
    this.id = b;
    this.r = Raphael(b, c, d);
    this.fault = a !== void 0 ? a : new VG.FaultObject(0,50,270,0,new VG.Vector,100,new VG.Vector);
    this.translate = function(a, b, c) {
        if (a === "pixels" || a === "units")
            return {
                center: b.clone(),
                length: c
            }
    }
    ;
    this.isMoving = false;
    this.createControls();
    this.dipToRight = true;
    this.recalculate();
    this.moving = e;
    this.change = f !== void 0 ? f : e;
    var g = this;
    this.changeTimer = new VG.Timer(function() {
        g.change()
    }
    )
}
;
VG.Orient.prototype = {
    constructor: VG.Orient,
    createControls: function() {
        var a = this;
        this.path = [["M", 0, 0], ["L", 0, 0]];
        this.dipPath = [["M", 0, 0], ["L", 0, 0]];
        this.faultLine = this.r.path(this.path).attr({
            stroke: "#333",
            "stroke-width": 4,
            "stroke-linecap": "round"
        });
        var b = {
            fill: "#000",
            "fill-opacity": 0,
            stroke: "#000",
            "stroke-dasharray": ". ",
            "stroke-width": 2
        };
        this.dipLine = this.r.path(this.dipPath).attr(b);
        var c = this.r.set(this.newDisk(0, 0, b, {
            "fill-opacity": 0.1
        }, "move"), this.newDisk(0, 0), this.newDisk(0, 0), this.newDisk(0, 0), this.newDisk(0, 0));
        c[0].update = function(a, b) {
            var f = this.attr("cx") + a
              , g = this.attr("cy") + b;
            this.attr({
                cx: f,
                cy: g
            });
            c[1].update(a, b, false);
            c[2].update(a, b, false);
            c[3].recalculate()
        }
        ;
        c[0].recalculate = function() {
            var b = a.midpoint();
            this.attr({
                cx: b.x,
                cy: b.y,
                r: a.radius() + 14
            });
            c[3].recalculate();
            a.calculateParams()
        }
        ;
        c[1].update = function(b, e, f) {
            b = this.attr("cx") + b;
            e = this.attr("cy") + e;
            this.attr({
                cx: b,
                cy: e
            });
            a.path[0][1] = b;
            a.path[0][2] = e;
            a.faultLine.attr({
                path: a.path
            });
            f && c[0].recalculate()
        }
        ;
        c[2].update = function(b, e, f) {
            b = this.attr("cx") + b;
            e = this.attr("cy") + e;
            this.attr({
                cx: b,
                cy: e
            });
            a.path[1][1] = b;
            a.path[1][2] = e;
            a.faultLine.attr({
                path: a.path
            });
            f && c[0].recalculate()
        }
        ;
        c[3].update = function(b, c) {
            var f = a.line().normalize()
              , g = (new VG.Vector(b,c,0)).dot(f)
              , g = new VG.Vector(this.attr("cx") + b - g * f.x,this.attr("cy") + c - g * f.y,0)
              , g = a.midpoint().subSelf(g)
              , h = -1;
            (new VG.Vector).cross(new VG.Vector(0,0,1), f).dot(g) > 0 && (h = 1);
            a.dipToRight = h === 1;
            a.dip = Math.min(Math.max(-90, h * g.length()), 90);
            this.recalculate()
        }
        ;
        c[3].recalculate = function() {
            var b = a.line().crossSelf(new VG.Vector(0,0,1)).normalize()
              , e = a.midpoint()
              , f = (new VG.Vector).copy(b).multiplyScalar(a.dip).addSelf(e);
            this.attr({
                cx: f.x,
                cy: f.y
            });
            a.dipPath[0][1] = e.x - 90 * b.x;
            a.dipPath[0][2] = e.y - 90 * b.y;
            a.dipPath[1][1] = e.x + 90 * b.x;
            a.dipPath[1][2] = e.y + 90 * b.y;
            a.dipLine.attr({
                path: a.dipPath
            });
            c[4].recalculate();
            a.calculateParams()
        }
        ;
        c[4].update = function(b, c) {
            var f = this.attr("cx") + b
              , g = this.attr("cy") + c
              , h = (new VG.Vector).sub(a.endpoint(a.strikeEndpoint()), a.midpoint()).normalize()
              , f = (new VG.Vector(f,g,0)).subSelf(a.midpoint()).normalize();
            a.fault.rake = 360 - getBearing(f, h);
            if (a.fault.rake > 180)
                a.fault.rake = a.fault.rake - 360;
            a.fault.rake = -a.fault.rake;
            this.dx = this.dy = 0;
            this.recalculate()
        }
        ;
        c[4].recalculate = function() {
            var b = a.endpoint(a.strikeEndpoint()).subSelf(a.midpoint()).normalize()
              , b = (new VG.Matrix4).rotateZ(-toRadians(a.fault.rake)).multiplyVector(b);
            b.setLength(a.radius() + 14).addSelf(a.midpoint());
            this.attr({
                cx: b.x,
                cy: b.y
            })
        }
        ;
        c.drag(function(b, c) {
            a.isMoving = true;
            this.update(b - (this.dx || 0), c - (this.dy || 0), true);
            this.dx = b;
            this.dy = c;
            a.update()
        }, function() {
            this.dx = this.dy = 0;
            a.update()
        }, function() {
            a.isMoving = false
        });
        this.controls = c
    },
    newDisk: function(a, b, c, d, e) {
        var f = this
          , c = c === void 0 ? {
            r: 7,
            fill: "#aaa",
            stroke: "#000",
            "stroke-width": 1
        } : c
          , d = d === void 0 ? {
            r: 15,
            fill: "#0000ff",
            stroke: "#fff",
            "stroke-width": 2.5
        } : d;
        return this.r.circle(a, b, 7).attr(c).mouseover(function() {
            $("#" + f.id).css({
                cursor: e === void 0 ? "pointer" : e
            });
            this.animate(d, 200)
        }).mouseout(function() {
            $("#" + f.id).css({
                cursor: "auto"
            });
            this.animate(c, 200)
        })
    },
    endpoint: function(a) {
        if (a == 0)
            return new VG.Vector(this.path[0][1],this.path[0][2],0);
        if (a == 1)
            return new VG.Vector(this.path[1][1],this.path[1][2],0)
    },
    strikeEndpoint: function() {
        return this.dipToRight ? 1 : 0
    },
    line: function() {
        return (new VG.Vector).sub(this.endpoint(0), this.endpoint(1))
    },
    midpoint: function() {
        return (new VG.Vector).add(this.endpoint(0), this.endpoint(1)).multiplyScalar(0.5)
    },
    radius: function() {
        return this.line().length() / 2
    },
    recalculate: function() {
        if (!this.isMoving) {
            var a = this.translate("pixels", this.fault.center, this.fault.length);
            this.dip = 90 - this.fault.dip;
            this.dipToRight = true;
            var b = 360 - this.fault.strike
              , c = (new VG.Matrix4).rotateZ(-toRadians(b)).multiplyVector(new VG.Vector(0,1,0)).setLength(a.length / 2)
              , b = this.endpoint(0).subSelf(a.center).subSelf(c)
              , a = this.endpoint(1).subSelf(a.center).subSelf(c.negate());
            this.controls[1].update(-b.x, -b.y, false);
            this.controls[2].update(-a.x, -a.y, false);
            this.controls[0].recalculate()
        }
    },
    calculateParams: function() {
        if (this.isMoving) {
            this.fault.strike = firstWv((this.dipToRight ? 360 : 180) - getBearing(this.line().negate(), new VG.Vector(0,-1,0)), 360);
            var a = this.translate("units", this.midpoint(), this.line().length());
            this.fault.length = a.length;
            this.fault.center.x = a.center.x;
            this.fault.center.y = a.center.y
        }
    },
    update: function() {
        this.fault.dip = 90 - Math.abs(this.dip);
        this.changeTimer.cancel().schedule(500);
        this.moving()
    },
    resize: function(a, b) {
        a = a === void 0 ? $(window).width() : a;
        b = b === void 0 ? $(window).height() : b;
        this.r.setSize(a, b)
    },
    showReduced: function(a) {
        if (a) {
            this.dipLine.hide();
            this.controls[3].hide();
            this.controls[4].hide()
        } else {
            this.dipLine.show();
            this.controls[3].show();
            this.controls[4].show()
        }
    },
    setVisible: function(a) {
        $(this.r.canvas).css({
            display: a ? "" : "none"
        })
    }
};
VG.Topography = function() {}
;
VG.Topography.prototype = {
    constructor: VG.Topography,
    fromMatrix: function(a, b, c) {
        this.dims = b;
        this.size = [b[1] - b[0], b[3] - b[2], b[5] - b[4]];
        this.dtl = c;
        this.center = new VG.Vector((b[0] + b[1]) / 2,(b[2] + b[3]) / 2,(b[4] + b[5]) / 2);
        this.topo = new VG.Matrix(a,[this.size[0] / c, this.size[1] / c]);
        a = linspace(b[0], b[1], this.size[1] / c);
        b = linspace(b[2], b[3], this.size[0] / c);
        this.X = new VG.Matrix(a,[1, a.length]);
        this.Y = new VG.Matrix(b,[b.length, 1]);
        return this
    },
    getModel: function(a) {
        function b(a) {
            var b = f.Delauny.interp(a.clone()).z;
            if (a.z > b)
                a.z = b;
            return a
        }
        var c, d, e, f = this, g = new THREE.Object3D, h = [];
        c = VG.Geometries.Surface4(null, {
            XData: this.X,
            YData: this.Y,
            ZData: this.topo
        }, function(a) {
            h.push(a.clone());
            return a
        });
        this.Delauny = new VG.Delauny(h);
        c = new THREE.Mesh(c,a());
        g.add(c);
        c = new VG.Vector(this.dims[0],this.dims[2],this.dims[4]);
        d = new VG.Vector(this.size[0],0,0);
        e = new VG.Vector(0,this.size[1],0);
        c = new THREE.Mesh(VG.Geometries.Plane(c, d, e, 2, 2),a());
        g.add(c);
        c = new VG.Vector(this.dims[1],this.dims[2],this.dims[4]);
        d = new VG.Vector(-this.size[0],0,0);
        e = new VG.Vector(0,0,this.size[2]);
        c = new THREE.Mesh(VG.Geometries.Plane(c, d, e, this.size[0] / this.dtl - 1, 1, b),a());
        g.add(c);
        c = new VG.Vector(this.dims[0],this.dims[3],this.dims[4]);
        d = new VG.Vector(this.size[0],0,0);
        e = new VG.Vector(0,0,this.size[2]);
        c = new THREE.Mesh(VG.Geometries.Plane(c, d, e, this.size[0] / this.dtl - 1, 1, b),a());
        g.add(c);
        c = new VG.Vector(this.dims[0],this.dims[2],this.dims[4]);
        d = new VG.Vector(0,this.size[1],0);
        e = new VG.Vector(0,0,this.size[2]);
        c = new THREE.Mesh(VG.Geometries.Plane(c, d, e, this.size[1] / this.dtl - 1, 1, b),a());
        g.add(c);
        c = new VG.Vector(this.dims[1],this.dims[3],this.dims[4]);
        d = new VG.Vector(0,-this.size[1],0);
        e = new VG.Vector(0,0,this.size[2]);
        a = new THREE.Mesh(VG.Geometries.Plane(c, d, e, this.size[1] / this.dtl - 1, 1, b),a());
        g.add(a);
        this.modFunction = b;
        this.contour(g);
        return g
    },
    contour: function(a) {
        function b(a) {
            var b = new THREE.Geometry, c;
            for (c = 0; c < a.length; c++) {
                var d = new VG.Vector(a[c].x,a[c].y,a.level);
                d.z = d.z + 0.1;
                b.vertices.push(d)
            }
            a = new THREE.LineBasicMaterial({
                color: 0,
                linewidth: 3
            });
            return new THREE.Line(b,a)
        }
        var c = new Conrec;
        this.topo.min();
        this.topo.max();
        var d = spaceArray(this.dims[4] + 0.3, 10, this.dims[5] + 0.3);
        c.contour(this.topo.toNestedArrayJI(), this.X.matrix, this.Y.matrix, d);
        c = c.contourList();
        for (d = 0; d < c.length; d++)
            a.add(b(c[d]))
    }
};
VG.CrossSection = function(a, b, c) {
    this.context = a;
    this.colorProgram = b;
    this.topography = c;
    this.objects = [];
    this.active = false;
    this.gatheredPoints = [];
    var d = this;
    this.startHandler = function() {
        if (d.active) {
            var b = a.getIntersects();
            b.length > 0 && d.gatheredPoints.push(b[0].point.clone())
        }
    }
    ;
    this.moveHandler = function() {
        return d.active ? false : true
    }
    ;
    this.endHandler = function() {
        if (d.active && d.gatheredPoints.length === 2) {
            d.active = false;
            d.newXS(d.gatheredPoints[0], d.gatheredPoints[1]);
            d.gatheredPoints = []
        }
    }
    ;
    this.hoverHandler = function() {
        return d.active ? false : true
    }
    ;
    this.context.startHandlers.push(this.startHandler);
    this.context.hoverHandlers.push(this.hoverHandler);
    this.context.moveHandlers.push(this.moveHandler);
    this.context.endHandlers.push(this.endHandler)
}
;
VG.CrossSection.prototype = {
    constructor: VG.CrossSection,
    init: function(a) {
        this.cancel();
        a === true && this.removeAll();
        this.context.cameraControler.turnViewTo2D(30);
        this.active = true;
        this.gatheredPoints = []
    },
    cancel: function() {
        this.active = false;
        this.gatheredPoints = [];
        return this
    },
    removeLast: function() {
        var a = this.objects.length - 1;
        this.context.removeObject(this.objects[a], true);
        this.objects.splice(a, 1);
        return this
    },
    removeAll: function() {
        for (var a = 0; a < this.objects.length; a++)
            this.context.removeObject(this.objects[a], false);
        this.objects = [];
        return this
    },
    newXS: function(a, b) {
        var c = this.topography.dims[4]
          , d = this.topography.dims[5]
          , e = this.topography.size[2]
          , f = new THREE.Vector3(a.x,a.y,c)
          , g = (new THREE.Vector3(b.x,b.y,c)).subSelf(f)
          , h = new THREE.Vector3(0,0,e)
          , f = VG.Geometries.Plane(f, g, h, Math.round(g.length() / this.topography.dtl), 1, this.topography.modFunction)
          , h = this.colorProgram()
          , f = new THREE.Mesh(f,h);
        f.doubleSided = true;
        var i = new THREE.Geometry;
        i.vertices.push(new THREE.Vector3(a.x,a.y,c));
        i.vertices.push(new THREE.Vector3(a.x,a.y,d + e));
        h = new THREE.Geometry;
        h.vertices.push(new THREE.Vector3(b.x,b.y,c));
        h.vertices.push(new THREE.Vector3(b.x,b.y,d + e));
        d = new THREE.LineBasicMaterial({
            color: 0,
            linewidth: 3
        });
        c = new THREE.Line(i,d);
        d = new THREE.Line(h,d);
        h = new THREE.Object3D;
        h.add(f);
        h.add(c);
        h.add(d);
        this.objects.push(h);
        this.context.addObject(h, false);
        this.context.animateObject(f, new THREE.Vector3(0,0,e));
        this.context.cameraControler.turnViewTo(-80, 0, getBearing(g) - 90)
    }
};
VG.Drill = function(a, b, c) {
    this.context = a;
    this.colorProgram = b;
    this.topography = c;
    this.drillWidth = 2.5;
    this.objects = [];
    this.active = false;
    this.gatheredPoints = [];
    var d = this;
    this.startHandler = function() {
        if (d.active) {
            var b = a.getIntersects();
            b.length > 0 && d.gatheredPoints.push(b[0].point.clone())
        }
    }
    ;
    this.moveHandler = function() {
        return d.active ? false : true
    }
    ;
    this.endHandler = function() {
        if (d.active && d.gatheredPoints.length === 1) {
            d.active = false;
            d.newDR(d.gatheredPoints[0]);
            d.gatheredPoints = []
        }
    }
    ;
    this.hoverHandler = function() {
        return d.active ? false : true
    }
    ;
    this.context.startHandlers.push(this.startHandler);
    this.context.hoverHandlers.push(this.hoverHandler);
    this.context.moveHandlers.push(this.moveHandler);
    this.context.endHandlers.push(this.endHandler)
}
;
VG.Drill.prototype = {
    constructor: VG.Drill,
    init: function(a) {
        this.cancel();
        a === true && this.removeAll();
        this.context.cameraControler.turnViewTo2D(30);
        this.active = true;
        this.gatheredPoints = []
    },
    cancel: function() {
        this.active = false;
        this.gatheredPoints = [];
        return this
    },
    removeLast: function() {
        var a = this.objects.length - 1;
        this.context.removeObject(this.objects[a], true);
        this.objects.splice(a, 1);
        return this
    },
    removeAll: function() {
        for (var a = 0; a < this.objects.length; a++)
            this.context.removeObject(this.objects[a], false);
        this.objects = [];
        return this
    },
    newDR: function(a) {
        var b = this.topography.dims[4]
          , c = this.topography.dims[5]
          , d = this.topography.size[2]
          , e = [0, 0.1, this.drillWidth, this.drillWidth, 0]
          , f = [c, c, c, b, b]
          , g = new THREE.Matrix4
          , e = VG.Geometries.Cylinder(new VG.Vector(a.x,a.y,0), e, f, g, 10, this.topography.modFunction)
          , f = this.colorProgram()
          , e = new THREE.Mesh(e,f)
          , f = new THREE.Geometry;
        f.vertices.push(new THREE.Vector3(a.x,a.y,b));
        f.vertices.push(new THREE.Vector3(a.x,a.y,c + d));
        b = new THREE.LineBasicMaterial({
            color: 0,
            linewidth: 3
        });
        b = new THREE.Line(f,b);
        c = new THREE.Object3D;
        c.add(e);
        c.add(b);
        this.objects.push(c);
        this.context.addObject(c, false);
        this.context.animateObject(e, new THREE.Vector3(0,0,d));
        this.context.cameraControler.turnViewTo(-80, 0, getBearing((new THREE.Vector3).subSelf(a)))
    }
};
var Detector = {
    canvas: !!window.CanvasRenderingContext2D,
    webgl: function() {
        try {
            return !!window.WebGLRenderingContext && !!document.createElement("canvas").getContext("experimental-webgl")
        } catch (a) {
            return false
        }
    }(),
    workers: !!window.Worker,
    fileapi: window.File && window.FileReader && window.FileList && window.Blob,
    ismac: -1 != window.navigator.userAgent.toLowerCase().indexOf("mac"),
    isIE: -1 != window.navigator.userAgent.toLowerCase().indexOf("msie"),
    getWebGLErrorMessage: function() {
        var a = document.createElement("div");
        a.id = "webgl-error-message";
        a.style.fontFamily = "monospace";
        a.style.fontSize = "13px";
        a.style.fontWeight = "normal";
        a.style.textAlign = "center";
        a.style.background = "#fff";
        a.style.color = "#000";
        a.style.padding = "1.5em";
        a.style.width = "400px";
        a.style.margin = "5em auto 0";
        if (!this.webgl)
            a.innerHTML = window.WebGLRenderingContext ? 'Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br />\nFind out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.' : 'Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br/>\nFind out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.';
        return a
    },
    addGetWebGLMessage: function(a) {
        var b, c, a = a || {};
        b = a.parent !== void 0 ? a.parent : document.body;
        a = a.id !== void 0 ? a.id : "oldie";
        c = Detector.getWebGLErrorMessage();
        c.id = a;
        b.appendChild(c)
    }
};
VG.ThreePanel = function(a, b) {
    var c = this
      , d = false;
    a === void 0 && (d = true);
    a = a !== void 0 ? a : $(window).width();
    b = b !== void 0 ? b : $(window).height();
    this.panel = $("<div>").addClass("ThreePanel").attr({
        tabindex: 0
    });
    this.cameraControler = new VG.CameraControler;
    this.cameraControler.aspectRatio = a / b;
    if (Detector.webgl)
        this.renderer = new THREE.WebGLRenderer({
            preserveDrawingBuffer: true
        });
    else if (Detector.canvas)
        this.renderer = new THREE.CanvasRenderer;
    else
        return;
    this.setSize(a, b);
    this.resizeTimer = new VG.Timer(function() {
        c.setSize()
    }
    );
    d && $(window).resize(function() {
        c.resizeTimer.cancel();
        c.resizeTimer.schedule(500)
    });
    this.scene = new THREE.Scene;
    this.camera = new THREE.CombinedCamera(this.width,this.height,50,0.1,1E6,-2E3,1E5);
    this.scene.add(this.camera);
    $(this.panel).append($(this.renderer.domElement).width(a).height(b).addClass("threeCanvas"));
    this.startHandlers = [];
    this.endHandlers = [];
    this.moveHandlers = [];
    this.hoverHandlers = [];
    this.scrollHandlers = [];
    this.preRenderHandlers = [];
    this.keyHandlers = [];
    this.escHandlers = [];
    this.defaultKeys = this.zoomEnabled = true;
    $(this.panel).hammer({
        prevent_default: true
    }).bind("dragstart", function(a) {
        console.log(a);
        c.mousedown(a.originalEvent)
    }).bind("drag", function(a) {
        c.mousemove(a.originalEvent)
    }).bind("mousemove", function(a) {
        c.mousemove(a)
    }).bind("dragend", function(a) {
        c.mouseup(a.originalEvent)
    }).bind("tap", function(a) {
        c.mousedown(a.originalEvent)
    }).bind("release", function(a) {
        c.mouseup(a.originalEvent)
    });
    this.panel.get(0).onmousewheel = function(a) {
        c.scroll(a)
    }
    ;
    this.panel.keydown(function(a) {
        c.keydown(a)
    });
    this.threeDivs = []
}
;
VG.ThreePanel.prototype = {
    constructor: VG.ThreePanel,
    setSize: function(a, b) {
        this.width = a !== void 0 ? a : $(window).width();
        this.height = b !== void 0 ? b : $(window).height();
        this.renderer.setSize(this.width, this.height);
        $(this.panel).width(this.width).height(this.height);
        $(this.renderer.domElement).width(this.width).height(this.height);
        this.cameraControler.aspectRatio = this.width / this.height;
        if (this.doAnimate) {
            if (this.camera instanceof THREE.OrthographicCamera) {
                this.camera.left = -this.cameraControler.getWidth() / 2;
                this.camera.right = +this.cameraControler.getWidth() / 2;
                this.camera.bottom = -this.cameraControler.getHeight() / 2;
                this.camera.top = +this.cameraControler.getHeight() / 2
            } else
                this.camera.setSize(this.width, this.height);
            this.camera.updateProjectionMatrix();
            this.cameraControler.fakeChanged()
        }
    },
    start: function() {
        this.doAnimate = true;
        this.cameraControler.fakeChanged();
        this.renderer.render(this.scene, this.camera);
        var a = this;
        this.timer = setInterval(function() {
            a.animate()
        }, 1E3 / 60)
    },
    stop: function() {
        this.doAnimate = false;
        clearInterval(this.timer)
    },
    animate: function() {
        if (this.doAnimate) {
            if (this.camera instanceof THREE.OrthographicCamera) {
                this.camera.left = -this.cameraControler.getWidth() / 2;
                this.camera.right = +this.cameraControler.getWidth() / 2;
                this.camera.bottom = -this.cameraControler.getHeight() / 2;
                this.camera.top = +this.cameraControler.getHeight() / 2
            } else
                this.camera.setSize(this.width, this.height);
            var a = this.cameraControler.getPositionAndUpDirection();
            this.camera.position.copy(a[0]);
            this.camera.lookAt(this.cameraControler.getCameraTarget());
            this.camera.up.copy(a[1]);
            this.camera.updateProjectionMatrix();
            for (a = 0; a < this.preRenderHandlers.length; a++)
                this.preRenderHandlers[a](this.cameraControler);
            for (a = 0; a < this.threeDivs.length; a++)
                this.threeDivs[a].updatePosition();
            this.cameraControler.renderNow() && this.render()
        }
    },
    animateObject: function(a, b, c) {
        var c = c === void 0 ? 200 : c, d = 0, e, f = this.cameraControler, g = (b.x - a.position.x) / c, h = (b.y - a.position.y) / c, i = (b.z - a.position.z) / c;
        return e = setInterval(function() {
            if (d > c) {
                clearInterval(e);
                f.renderContinuous = false
            } else {
                f.renderContinuous = true;
                a.position.set(a.position.x + g, a.position.y + h, a.position.z + i);
                d = d + 1
            }
        }, 1E3 / 60)
    },
    changeCamera: function(a) {
        this.scene.remove(this.camera);
        this.camera = a;
        this.scene.add(this.camera)
    },
    preEvent: function(a) {
        a.preventDefault();
        a.stopPropagation();
        $(this.panel).focus()
    },
    mousedown: function(a) {
        this.preEvent(a);
        this.mouseDown = true;
        this.mouseDownX = a.pageX;
        this.mouseDownY = a.pageY;
        for (var b = 0; b < this.startHandlers.length; b++)
            this.startHandlers[b](a)
    },
    mouseup: function(a) {
        this.preEvent(a);
        this.mouseDown = false;
        for (var b = 0; b < this.endHandlers.length; b++)
            this.endHandlers[b](a)
    },
    mousemove: function(a) {
        this.preEvent(a);
        this.intersects = null;
        var b = a.pageX
          , c = a.pageY
          , d = b - this.mouseDownX
          , e = c - this.mouseDownY;
        this.mouseDownX = b;
        this.mouseDownY = c;
        if (this.mouseDown) {
            if (this.moveHandlers.length > 0)
                for (var f = this.cameraControler.getReverseRotationMatrix().multiplyVector3(new THREE.Vector3(d,-e,0)), b = 0; b < this.moveHandlers.length; b++)
                    if (c = this.moveHandlers[b](f, a))
                        $(this.panel).css({
                            cursor: ""
                        });
                    else {
                        $(this.panel).css({
                            cursor: "crosshair"
                        });
                        this.cameraControler.fakeChanged();
                        return
                    }
            this.cameraControler.incrementRotationX(e);
            this.cameraControler.incrementRotationZ(d)
        } else {
            d = true;
            for (b = 0; b < this.hoverHandlers.length; b++)
                (c = this.hoverHandlers[b](a)) || (d = false);
            d ? $(this.panel).css({
                cursor: ""
            }) : $(this.panel).css({
                cursor: "crosshair"
            })
        }
    },
    keydown: function(a) {
        for (var b = 0; b < this.keyHandlers.length; b++) {
            var c = this.keyHandlers[b](a);
            if (!c) {
                this.cameraControler.fakeChanged();
                return
            }
        }
        if (this.defaultKeys) {
            b = this.cameraControler;
            switch (a.keyCode) {
            case 82:
                b.turnViewTo2D();
                break;
            case 51:
                b.turnViewTo3D();
                break;
            case 37:
                b.turnViewTo(NaN, NaN, b.rotationZ - 20);
                break;
            case 38:
                b.turnViewTo(b.rotationX - 20, NaN, NaN);
                break;
            case 39:
                b.turnViewTo(NaN, NaN, b.rotationZ + 20);
                break;
            case 40:
                b.turnViewTo(b.rotationX + 20, NaN, NaN);
                break;
            case 27:
                for (b = 0; b < this.escHandlers.length; b++) {
                    c = this.escHandlers[b](a);
                    if (!c)
                        break
                }
            }
        }
    },
    scroll: function(a) {
        if (this.zoomEnabled || this.scrollHandlers.length !== 0) {
            this.preEvent(a);
            for (var a = -a.wheelDeltaY, b = 0; b < this.scrollHandlers.length; b++)
                if (!this.scrollHandlers[b](a)) {
                    this.cameraControler.fakeChanged();
                    return
                }
            this.zoomEnabled && this.cameraControler.doZoom(a)
        }
    },
    setFocus: function(a) {
        a ? this.panel.focus() : this.panel.blur()
    },
    addObject: function(a, b) {
        this.scene.add(a);
        b && this.cameraControler.fakeChanged()
    },
    removeObject: function(a, b) {
        this.scene.remove(a);
        b && this.cameraControler.fakeChanged()
    },
    render: function() {
        this.renderer.render(this.scene, this.camera)
    },
    registerThreeDiv: function(a) {
        this.threeDivs.push(a);
        this.panel.append(a.div)
    },
    getFirstPointIntersects: function() {
        var a = this.getIntersects();
        return a.length > 0 ? a[0].point : null
    },
    getIntersects: function() {
        this.intersects == null && this.intersectScene();
        return this.intersects
    },
    intersectScene: function() {
        var a = new THREE.Projector
          , b = this.panel.offset().left
          , c = this.panel.offset().top
          , b = new THREE.Vector3((this.mouseDownX - b - 1) / this.width * 2 - 1,-((this.mouseDownY - c + 1) / this.height) * 2 + 1,0.5);
        a.unprojectVector(b, this.camera);
        a = new THREE.Ray(this.camera.position,b.subSelf(this.camera.position).normalize());
        b = [];
        for (c = 1; c < this.scene.children.length; c++) {
            for (var d = this.scene.children[c], e = a.intersectObject(d), f = 0; f < e.length; f++)
                b.push(e[f]);
            d = d.children;
            for (e = 0; e < d.length; e++)
                for (var g = a.intersectObject(d[e]), f = 0; f < g.length; f++)
                    b.push(g[f])
        }
        b.length > 0 && b.sort(function(a, b) {
            return a.distance - b.distance
        });
        return this.intersects = b
    },
    getImage: function() {
        return this.renderer.domElement.toDataURL()
    }
};
VG.ThreeDiv = function(a, b, c) {
    this.camera = a.camera;
    this.container = $(a.renderer.domElement);
    this.position = c;
    this.cameraControler = a.cameraControler;
    this.div = $("<div>");
    this.div.css("position", "absolute");
    this.div.attr("class", "threeTextDiv");
    this.div.append(b);
    this.visible = true;
    a.registerThreeDiv(this)
}
;
VG.ThreeDiv.prototype = {
    constructor: VG.ThreeDiv,
    updatePosition: function() {
        if (this.visible) {
            var a = this.position.clone()
              , b = new THREE.Matrix4;
            b.multiply(this.camera.projectionMatrix, this.camera.matrixWorldInverse);
            b.multiplyVector3(a);
            b = (a.x + 1) * this.container.width() / 2 + this.container.offset().left;
            a = (-a.y + 1) * this.container.height() / 2 + this.container.offset().top - this.div.height() / 2;
            b = b - this.div.width() / 2;
            this.div.css({
                top: a,
                left: b
            });
            this.div.show()
        } else
            this.div.hide()
    },
    setPosition: function(a) {
        this.position = a.clone()
    }
};
VG.Geometries = {
    Surface4: function(a, b, c) {
        var d = b.XData
          , e = b.YData
          , f = b.ZData
          , g = b.CData
          , h = false
          , i = false;
        d.sizeDim(1) === 1 && (h = true);
        e.sizeDim(2) === 1 && (i = true);
        for (var j = 0, k = 0, n = 0, p = new THREE.Geometry, o = p.vertices, r = p.faces, q = 1; q <= f.sizeDim(2); q++)
            for (var s = 1; s <= f.sizeDim(1); s++) {
                var t = new THREE.Vector3;
                t.set(d.getIJ([h ? 1 : s, q]), e.getIJ([s, i ? 1 : q]), f.getIJ([s, q]));
                c !== void 0 && (t = c(t));
                o.push(t);
                j++;
                if (q < f.sizeDim(2) && s < f.sizeDim(1)) {
                    if (b.FaceColor != void 0 && b.FaceColor != null && b.FaceColor.equals("interp")) {
                        t = [];
                        t.push(new THREE.Color(a.getHex(g.getIJ([s + 1, q]))));
                        t.push(new THREE.Color(a.getHex(g.getIJ([s, q]))));
                        t.push(new THREE.Color(a.getHex(g.getIJ([s, q + 1]))));
                        t.push(new THREE.Color(a.getHex(g.getIJ([s + 1, q + 1]))));
                        r.push(new THREE.Face4(n + 1,n,n + f.sizeDim(1),n + f.sizeDim(1) + 1,null,t))
                    } else if (g != null) {
                        t = (g.getIJ([s, q]) + g.getIJ([s, q + 1]) + g.getIJ([s + 1, q]) + g.getIJ([s + 1, q + 1])) / 4;
                        t = new THREE.Color(a.getHex(t));
                        r.push(THREE.Face4(n + 1, n, n + f.sizeDim(1), n + f.sizeDim(1) + 1, null, t))
                    } else
                        r.push(new THREE.Face4(n + 1,n,n + f.sizeDim(1),n + f.sizeDim(1) + 1));
                    k++
                }
                n = n + 1
            }
        p.computeCentroids();
        p.computeFaceNormals();
        p.computeVertexNormals();
        return p
    },
    Cylinder: function(a, b, c, d, e, f) {
        var g = Math.PI * 2 / e, h, i;
        h = new VG.Matrix(null,[b.length, e + 1]);
        i = new VG.Matrix(null,[b.length, e + 1]);
        for (var e = new VG.Matrix(null,[b.length, e + 1]), j = 0, k = Math.PI * 2; k >= -1.0E-5; k = k - g) {
            for (var n = 0; n < b.length; n++) {
                var p = new THREE.Vector3(b[n] * Math.cos(k),b[n] * Math.sin(k),c[n])
                  , p = d.multiplyVector3(p);
                p.addSelf(a);
                h.setIJ([n + 1, j + 1], p.x);
                i.setIJ([n + 1, j + 1], p.y);
                e.setIJ([n + 1, j + 1], p.z)
            }
            j++
        }
        return VG.Geometries.Surface4(null, {
            XData: h,
            YData: i,
            ZData: e
        }, f)
    },
    Arrow: function(a, b, c) {
        var d = b.clone().subSelf(a)
          , e = d.length();
        d.normalize();
        a.clone();
        var f = getBearing(d)
          , b = new THREE.Matrix4;
        b.setRotationFromEuler(new THREE.Vector3(-Math.PI / 2 + Math.asin(d.z),0,-toRadians(f)), "ZYX");
        d = c * 3;
        c = [0, c, c, d, 0];
        e = [0, 0, e - d, e - d, e];
        return VG.Geometries.Cylinder(new VG.Vector, c, e, b, 10, function(b) {
            return b.addSelf(a)
        })
    },
    NorthArrow: function(a, b) {
        var c = [0, a, 0]
          , d = [-1.5 * a, 0, 4 * a]
          , e = new THREE.Matrix4;
        e.setRotationFromEuler(new THREE.Vector3(-Math.PI / 2,0,0), "XYZ");
        c = VG.Geometries.Cylinder(new THREE.Vector3, c, d, e, 10);
        c = new THREE.Mesh(c,new THREE.MeshBasicMaterial({
            color: 3342336
        }));
        c.position.copy(b);
        return c
    },
    Plane: function(a, b, c, d, e, f) {
        for (var g = 0, h = 0, i = 0, j = new THREE.Geometry, k = j.vertices, n = j.faces, p = b.length(), o = c.length(), r = 0; r <= e; r++)
            for (var q = 0; q <= d; q++) {
                var s = (new THREE.Vector3).copy(a).addSelf(b.clone().setLength(q / d * p)).addSelf(c.clone().setLength(r / e * o));
                f !== void 0 && (s = f(s));
                k.push(s);
                g++;
                if (r < e && q < d) {
                    n.push(new THREE.Face4(i + 1,i,i + d + 1,i + d + 2));
                    h++
                }
                i = i + 1
            }
        j.computeCentroids();
        j.computeFaceNormals();
        j.computeVertexNormals();
        return j
    }
};
VG.CameraControler = function() {
    this.defaultZoomIncrement = 0.02;
    this.minZoom = 0.75;
    this.maxZoom = 4E3;
    this.height = this.width = 500;
    this.zoom = this.aspectRatio = 1;
    this.rotationZ = this.rotationY = this.rotationX = 0;
    this.cameraRadius = 100;
    this.cameraTarget = new THREE.Vector3(0,0,0);
    this.restrictRotation = true;
    this.changed = this.renderContinuous = false;
    this.frameCnt = 0
}
;
VG.CameraControler.prototype = {
    constructor: VG.CameraControler,
    setSize: function(a) {
        this.height = a;
        this.width = a * this.aspectRatio;
        return this
    },
    getHeight: function() {
        return this.height / this.zoom
    },
    getWidth: function() {
        return this.width / this.zoom
    },
    getCameraRadius: function() {
        return Math.max(this.cameraRadius - this.zoom, 0)
    },
    setCameraRadius: function(a) {
        this.cameraRadius = a;
        this.defaultZoomIncrement = this.cameraRadius / 50;
        return this
    },
    setCameraTarget: function(a, b, c) {
        this.changed = true;
        a instanceof VG.Vector || a instanceof THREE.Vector3 ? this.cameraTarget.copy(a) : this.cameraTarget.set(a, b, c);
        return this
    },
    getCameraTarget: function() {
        return this.cameraTarget.clone()
    },
    turnViewTo2D: function(a) {
        return this.turnViewTo(0, 0, 0, a)
    },
    turnViewTo3D: function(a) {
        return this.turnViewTo(-70, 0, 50, a)
    },
    turnViewTo: function(a, b, c, d) {
        var d = d === void 0 ? 60 : d, e = isNaN(a) ? 0 : (a - this.rotationX) / d, f = isNaN(b) ? 0 : (b - this.rotationY) / d, g = isNaN(c) ? 0 : (c - this.rotationZ) / d, h = 0, i, j = this;
        i = setInterval(function() {
            if (h > d || abs(e) > 0 && j.restrictRotation && clamp(j.rotationX + e, -180, 0) === j.rotationX) {
                clearInterval(i);
                j.renderContinuous = false
            } else {
                j.renderContinuous = true;
                j.setRotationX(j.restrictRotation ? clamp(j.rotationX + e, -180, 0) : j.rotationX + e);
                j.setRotationY(j.rotationY + f);
                j.setRotationZ(j.rotationZ + g);
                h = h + 1
            }
        }, 1E3 / 60);
        this.renderContinuous = true;
        return i
    },
    setRotations: function(a, b, c) {
        this.changed = true;
        if (a instanceof VG.Vector || a instanceof THREE.Vector3) {
            this.setRotationX(a.x);
            this.setRotationY(a.y);
            this.setRotationZ(a.z)
        } else {
            this.setRotationX(a);
            this.setRotationY(b);
            this.setRotationZ(c)
        }
        return this
    },
    incrementRotationX: function(a) {
        this.changed = true;
        this.rotationX = this.rotationX + a;
        if (this.restrictRotation)
            this.rotationX = clamp(this.rotationX, -180, 0);
        return this
    },
    incrementRotationY: function(a) {
        this.changed = true;
        this.rotationY = this.rotationY + a;
        return this
    },
    incrementRotationZ: function(a) {
        this.changed = true;
        this.rotationZ = this.rotationZ + a;
        return this
    },
    setRotationX: function(a) {
        this.changed = true;
        this.rotationX = a;
        return this
    },
    setRotationY: function(a) {
        this.changed = true;
        this.rotationY = a;
        return this
    },
    setRotationZ: function(a) {
        this.changed = true;
        this.rotationZ = a;
        return this
    },
    getPositionAndUpDirection: function() {
        var a = this.getReverseRotationMatrix()
          , b = a.multiplyVector3(new THREE.Vector3(0,0,this.getCameraRadius()));
        b.addSelf(this.getCameraTarget());
        a = a.multiplyVector3(new THREE.Vector3(0,1,0));
        a.normalize();
        return [b, a]
    },
    doZoom: function(a) {
        this.changed = true;
        a = a * this.defaultZoomIncrement;
        this.zoom = Math.max(this.minZoom, Math.min(this.cameraRadius * 0.95, this.zoom - a));
        return this
    },
    getRadiantRotationX: function() {
        return toRadians(this.rotationX)
    },
    getRadiantRotationY: function() {
        return toRadians(this.rotationY)
    },
    getRadiantRotationZ: function() {
        return toRadians(this.rotationZ)
    },
    getRotationVector: function() {
        return new THREE.Vector3(toRadians(this.rotationX),toRadians(this.rotationY),toRadians(this.rotationZ))
    },
    getReverseRotationMatrix: function() {
        var a = new THREE.Matrix4;
        a.setRotationFromEuler(this.getReverseRotationVector(), "ZYX");
        return a
    },
    getReverseRotationVector: function() {
        return new THREE.Vector3(-toRadians(this.rotationX),-toRadians(this.rotationY),-toRadians(this.rotationZ))
    },
    is2D: function() {
        return this.rotationX === 0 || this.rotationX === -180
    },
    fakeChanged: function() {
        this.changed = true;
        this.frameCnt = 0;
        return this
    },
    renderNow: function() {
        var a = this.changed || this.renderContinuous;
        if (this.frameCnt > 5)
            this.changed = false;
        this.frameCnt++;
        return a
    }
};
VG.Axes = function(a, b) {
    this.context = a;
    this.info = b;
    var c = this;
    a.preRenderHandlers.push(function(a) {
        c.calculateAxesView(a)
    });
    if (b != null) {
        this.xrange = b.XLim.get(2) - b.XLim.get(1);
        this.yrange = b.YLim.get(2) - b.YLim.get(1);
        this.zrange = b.ZLim.get(2) - b.ZLim.get(1);
        a.cameraControler.setSize(max([this.xrange, this.yrange, this.zrange]) * 1.5);
        a.cameraControler.setCameraTarget(b.CameraTarget.get(1), b.CameraTarget.get(2), b.CameraTarget.get(3));
        var d = a.cameraControler.getCameraTarget().subSelf(new THREE.Vector3(b.CameraPosition.get(1),b.CameraPosition.get(2),b.CameraPosition.get(3))).length();
        a.cameraControler.setCameraRadius(d);
        a.cameraControler.setRotationZ(-b.View.get(1));
        a.cameraControler.setRotationX(b.View.get(2) - 90);
        this.box = new THREE.Mesh(new THREE.CubeGeometry(this.xrange,this.yrange,this.zrange),new THREE.MeshBasicMaterial({
            color: 0,
            wireframe: true
        }));
        this.box.visible = b.Box == "on";
        this.box.position.copy(a.cameraControler.getCameraTarget());
        a.addObject(this.box, false);
        d = b.Box == "on" ? this.xrange / 350 : 0;
        this.background = new THREE.Mesh(new THREE.CubeGeometry(this.xrange + d,this.yrange + d,this.zrange + d),new THREE.MeshBasicMaterial({
            color: b.Color != null ? b.Color : 16777215
        }));
        this.background.visible = b.Color != null;
        this.background.position.copy(a.cameraControler.getCameraTarget());
        this.background.flipSided = true;
        a.addObject(this.background, false);
        var e, f, g = new THREE.Vector3, h = new THREE.Vector3, i, j;
        this.XAxis = [];
        this.YAxis = [];
        this.ZAxis = [];
        this.XAxisText = [];
        this.YAxisText = [];
        this.ZAxisText = [];
        d = b.XColor;
        e = b.XTick;
        i = b.XTickLabel.split("\n");
        f = new THREE.Vector3(1,0,0);
        j = (this.xrange + this.yrange + this.zrange) / 3 * b.TickLength.get(2);
        h = h.clone();
        h.set(0, b.YLim.get(1), b.ZLim.get(1));
        g = g.clone();
        g.set(0, -j, 0);
        this.XAxis.push(this.createAxes(d, e, i, f, g, h, this.XAxisText));
        h = h.clone();
        h.set(0, b.YLim.get(2), b.ZLim.get(1));
        g = g.clone();
        g.set(0, j, 0);
        this.XAxis.push(this.createAxes(d, e, i, f, g, h, this.XAxisText));
        h = h.clone();
        h.set(0, b.YLim.get(1), b.ZLim.get(2));
        g = g.clone();
        g.set(0, -j, 0);
        this.XAxis.push(this.createAxes(d, e, i, f, g, h, this.XAxisText));
        h = h.clone();
        h.set(0, b.YLim.get(2), b.ZLim.get(2));
        g = g.clone();
        g.set(0, j, 0);
        this.XAxis.push(this.createAxes(d, e, i, f, g, h, this.XAxisText));
        d = b.YColor;
        e = b.YTick;
        i = b.YTickLabel.split("\n");
        f = new THREE.Vector3(0,1,0);
        h = h.clone();
        h.set(b.XLim.get(1), 0, b.ZLim.get(1));
        g = g.clone();
        g.set(-j, 0, 0);
        this.YAxis.push(this.createAxes(d, e, i, f, g, h, this.YAxisText));
        h = h.clone();
        h.set(b.XLim.get(2), 0, b.ZLim.get(1));
        g = g.clone();
        g.set(j, 0, 0);
        this.YAxis.push(this.createAxes(d, e, i, f, g, h, this.YAxisText));
        h = h.clone();
        h.set(b.XLim.get(1), 0, b.ZLim.get(2));
        g = g.clone();
        g.set(-j, 0, 0);
        this.YAxis.push(this.createAxes(d, e, i, f, g, h, this.YAxisText));
        h = h.clone();
        h.set(b.XLim.get(2), 0, b.ZLim.get(2));
        g = g.clone();
        g.set(j, 0, 0);
        this.YAxis.push(this.createAxes(d, e, i, f, g, h, this.YAxisText));
        d = b.ZColor;
        e = b.ZTick;
        i = b.ZTickLabel.split("\n");
        f = new THREE.Vector3(0,0,1);
        h = h.clone();
        h.set(b.XLim.get(1), b.YLim.get(1), 0);
        g = g.clone();
        g.set(-1, 0, 0);
        g.normalize().multiplyScalar(j);
        this.ZAxis.push(this.createAxes(d, e, i, f, g, h, this.ZAxisText));
        h = h.clone();
        h.set(b.XLim.get(2), b.YLim.get(1), 0);
        g = g.clone();
        g.set(0, -1, 0);
        g.normalize().multiplyScalar(j);
        this.ZAxis.push(this.createAxes(d, e, i, f, g, h, this.ZAxisText));
        h = h.clone();
        h.set(b.XLim.get(1), b.YLim.get(2), 0);
        g = g.clone();
        g.set(0, 1, 0);
        g.normalize().multiplyScalar(j);
        this.ZAxis.push(this.createAxes(d, e, i, f, g, h, this.ZAxisText));
        h = h.clone();
        h.set(b.XLim.get(2), b.YLim.get(2), 0);
        g = g.clone();
        g.set(1, 0, 0);
        g.normalize().multiplyScalar(j);
        this.ZAxis.push(this.createAxes(d, e, i, f, g, h, this.ZAxisText))
    }
}
;
VG.Axes.prototype = {
    constructor: VG.Axes,
    createAxes: function(a, b, c, d, e, f, g) {
        if (b != null) {
            for (var h = new THREE.Object3D, i = [], j = 1; j <= b.numel(); j++) {
                var k = new THREE.Geometry
                  , n = k.vertices
                  , p = d.clone().multiplyScalar(b.get(j)).addSelf(f);
                n.push(p);
                n.push(p.clone().addSelf(e));
                k = new THREE.Line(k,new THREE.LineBasicMaterial({
                    color: a
                }));
                h.add(k);
                p = new VG.ThreeDiv(this.context,c[j - 1],p.clone().addSelf(e).addSelf(e));
                i.push(p)
            }
            this.context.addObject(h, false);
            g.push(i);
            return h
        }
        return null
    },
    calculateAxesView: function(a) {
        var b = Math.acos(Math.cos(a.getRadiantRotationZ())) * 180 / Math.PI, c = Math.acos(Math.cos(a.getRadiantRotationX())) * 180 / Math.PI, d = a.is2D(), e, f, g, h, i = b <= 90 || b >= 270;
        e = c <= 90 ? i ? true : false : false;
        f = c <= 90 ? i ? false : true : false;
        h = c > 90 ? i ? true : false : false;
        g = c > 90 ? i ? false : true : false;
        b = [e, f, h, g];
        e = [e, f, h, g];
        this.switchAxes(this.XAxis, this.XAxisText, b, e);
        a = Math.asin(Math.sin(a.getRadiantRotationZ())) * 180 / Math.PI >= 0;
        e = c <= 90 ? a ? true : false : false;
        f = c <= 90 ? a ? false : true : false;
        h = c > 90 ? a ? true : false : false;
        g = c > 90 ? a ? false : true : false;
        b = [e, f, h, g];
        e = [e, f, h, g];
        this.switchAxes(this.YAxis, this.YAxisText, b, e);
        e = d ? false : !a && i ? true : false;
        f = d ? false : !a && !i ? true : false;
        g = d ? false : a && !i ? true : false;
        h = d ? false : a && i ? true : false;
        b = [e, f, h, g];
        e = [e, f, h, g];
        this.switchAxes(this.ZAxis, this.ZAxisText, b, e);
        c = this.info.Visible == "on";
        this.background.visible = c && this.info.Color != null;
        this.box.visible = c && (d || this.info.Box == "on")
    },
    switchAxes: function(a, b, c, d) {
        for (var e = this.info.Visible == "on", f = 0; f < c.length; f++)
            for (var g = a[f].children, h = 0; h < g.length; h++)
                g[h].visible = e && c[f];
        for (f = 0; f < d.length; f++) {
            g = b[f];
            for (h = 0; h < g.length; h++)
                g[h].visible = e && d[f]
        }
    }
};
VG.AxesObjectInfo = function() {}
;
VG.AxesObjectInfo.prototype = {
    constructor: VG.AxesObjectInfo,
    fromMeshData: function(a) {
        this.XLim = new VG.Matrix([0, a.size[0]],[1, 2]);
        this.YLim = new VG.Matrix([0, a.size[1]],[1, 2]);
        this.ZLim = new VG.Matrix([0, a.size[2]],[1, 2]);
        this.CameraTarget = new VG.Matrix([a.size[0] / 2, a.size[1] / 2, a.size[2] / 2],[1, 3]);
        var b = max(a.size);
        this.CameraPosition = new VG.Matrix([this.CameraTarget.get(1), this.CameraTarget.get(2), this.CameraTarget.get(3) + b * 2],[1, 3]);
        this.View = new VG.Matrix([0, 0],[1, 2]);
        this.Visible = this.Box = "on";
        this.ZColor = this.YColor = this.XColor = 0;
        var b = this.XLim.get(2)
          , c = this.YLim.get(2)
          , d = this.ZLim.get(2);
        this.XTick = new VG.Matrix([0, b * 0.25, b * 0.5, b * 0.75, b],[1, 5]);
        this.YTick = new VG.Matrix([0, c * 0.25, c * 0.5, c * 0.75, c],[1, 5]);
        this.ZTick = new VG.Matrix([0, d * 0.25, d * 0.5, d * 0.75, d],[1, 5]);
        var e = function(a) {
            a = Math.round(a * 10) / 10;
            return "" + a
        };
        this.XTickLabel = e(b * 0 + a.top[0]) + "\n" + e(b * 0.25 + a.top[0]) + "\n" + e(b * 0.5 + a.top[0]) + "\n" + e(b * 0.75 + a.top[0]) + "\n" + e(b * 1 + a.top[0]);
        this.YTickLabel = e(c * 0 + a.top[1]) + "\n" + e(c * 0.25 + a.top[1]) + "\n" + e(c * 0.5 + a.top[1]) + "\n" + e(c * 0.75 + a.top[1]) + "\n" + e(c * 1 + a.top[1]);
        this.ZTickLabel = e(d * 1 + a.top[2]) + "\n" + e(d * 0.75 + a.top[2]) + "\n" + e(d * 0.5 + a.top[2]) + "\n" + e(d * 0.25 + a.top[2]) + "\n" + e(d * 0 + a.top[2]);
        this.TickLength = new VG.Matrix([0.01, 0.03],[1, 2]);
        return this
    }
};
VG.Alt = function(a, b) {
    this.element = a;
    this.alt = $("<div>").addClass("altTip");
    this.showTimer = new VG.Timer(function() {
        c.show()
    }
    );
    this.changeString(b);
    var c = this;
    $(this.element).bind({
        mouseover: function(a) {
            c.mouseover(a)
        },
        mouseleave: function(a) {
            c.mouseleave(a)
        },
        mousemove: function(a) {
            c.mousemove(a)
        }
    })
}
;
VG.Alt.prototype = {
    constructor: VG.Alt,
    mouseover: function(a) {
        this.x = a.pageX;
        this.y = a.pageY;
        this.showTimer.schedule(700)
    },
    mouseleave: function() {
        this.showTimer.cancel();
        this.hide()
    },
    mousemove: function(a) {
        this.x = a.pageX;
        this.y = a.pageY
    },
    changeString: function(a) {
        this.alt.html(a)
    },
    hide: function() {
        this.alt.remove()
    },
    show: function() {
        $("body").append(this.alt);
        this.updatePosition()
    },
    updatePosition: function() {
        if (this.alt.parent().length > 0) {
            var a = $(window).width()
              , b = $(window).height()
              , c = $(this.alt).width()
              , d = $(this.alt).height()
              , e = this.x
              , f = this.y;
            this.x + c * 1.3 > a && (e = e - c * 1.3);
            this.y + d * 2 > b && (f = f - d * 2);
            $(this.alt).css({
                top: f + "px",
                left: e + "px"
            })
        }
    }
};
VG.Slider = function(a, b, c) {
    if (c.range == void 0)
        c.range = "min";
    if (c.animate == void 0)
        c.animate = true;
    if (c.step == void 0)
        c.step = 0.1;
    this.container = a.length > 0 ? $(a) : $("<div>");
    this.isRange = c.range === true ? true : false;
    this.numberFormat = new VG.NumberFormat("000");
    var d = this;
    this.slideHandlers = [];
    c.slide !== void 0 && this.slideHandlers.push(c.slide);
    c.slide = function(a, b) {
        for (var c = d.slideHandlers.length - 1; c >= 0; c--)
            d.slideHandlers[c](a, b);
        d.setText()
    }
    ;
    this.changeHandlers = [];
    c.change !== void 0 ? this.changeHandlers.push(c.change) : this.changeHandlers.push(c.slide);
    c.change = function(a, b) {
        if (d.firedFromTextBox) {
            for (var c = d.slideHandlers.length - 1; c >= 0; c--)
                d.slideHandlers[c](a, b);
            d.firedFromTextBox = false
        }
        for (c = d.changeHandlers.length - 1; c >= 0; c--)
            d.changeHandlers[c](a, b);
        d.setText()
    }
    ;
    this.label = $("<span>").addClass("ui-slider-text").html(b + ":").width(65).height(16);
    this.container.append(this.label);
    this.slider = $("<div>").slider(c).width(200);
    this.container.append(this.slider);
    this.text = $("<input>").addClass("hoverTextBox").width(60).height(13).css({
        position: "relative",
        top: -4
    });
    this.container.append(this.text);
    this.text.change(function() {
        d.parseText($(d.text).attr("value"))
    });
    this.options = c;
    this.setText()
}
;
VG.Slider.prototype = {
    constructor: VG.Slider,
    setText: function() {
        this.isRange ? this.text.attr("value", this.numberFormat.format(this.values())) : this.text.attr("value", this.numberFormat.format(this.value()))
    },
    setNumberFormat: function(a) {
        this.numberFormat = a;
        this.setText()
    },
    value: function(a) {
        if (a == void 0)
            return $(this.slider).slider("value");
        $(this.slider).slider("value", a);
        this.setText()
    },
    values: function(a) {
        if (a == void 0)
            return $(this.slider).slider("values");
        $(this.slider).slider("values", a);
        this.setText()
    },
    parseText: function(a) {
        if (this.isRange)
            try {
                if (a.split("-").length == 2) {
                    var b = parseFloat(a.split("-")[0])
                      , c = parseFloat(a.split("-")[1]);
                    if (!isNaN(b) && !isNaN(c)) {
                        this.firedFromTextBox = true;
                        this.values([Math.min(b, c), Math.max(b, c)])
                    }
                }
            } catch (d) {}
        else
            try {
                var e = parseFloat(a);
                if (!isNaN(e)) {
                    this.firedFromTextBox = true;
                    this.value(e)
                }
            } catch (f) {}
        this.setText()
    }
};
VG.Input = function(a, b) {
    this.panel = a === void 0 ? $("<div>") : $("#" + a);
    this.widths = b === void 0 ? [100, 200, 100] : b;
    this.panel.addClass("ui-input").width(sum(this.widths));
    this.checkList = [];
    this.goFlags = []
}
;
VG.Input.prototype = {
    constructor: VG.Input,
    validate: function() {
        for (var a = 0; a < this.checkList.length; a++)
            this.checkList[a].validate();
        for (a = 0; a < this.goFlags.length; a++)
            if (!this.goFlags[a]) {
                this.checkList[a].element.focus();
                return false
            }
        return true
    },
    getValues: function() {
        for (var a = 0, b = {}; a < this.checkList.length; a++)
            b[this.checkList[a].getJSONid()] = this.checkList[a].getValue();
        return b
    },
    createContainer: function() {
        return $("<div>").addClass("ui-input-container").width(sum(this.widths)).height(40)
    },
    addText: function(a) {
        var b = this.createContainer().height("")
          , a = $("<span>").addClass("ui-input-text").html(a).width(sum(this.widths)).height(16);
        b.append(a);
        this.panel.append(b);
        return b
    },
    addTextInput: function(a, b, c, d, e) {
        a instanceof Array || (a = [a, a.replace(" ", "").toLowerCase()]);
        var c = c === void 0 ? null : c
          , b = b === void 0 ? "" : b
          , d = d === void 0 ? false : d
          , e = e === void 0 ? null : e
          , f = this.checkList.length
          , g = this
          , h = this.createContainer()
          , i = $("<span>").addClass("ui-input-text").html(a[0] + ":").width(this.widths[0]).height(16);
        h.append(i);
        var j = $("<input>").addClass("textBox").width(this.widths[1] - 12).val(b);
        d && j.attr("type", "password");
        h.append(j);
        var k = $("<div>").addClass("ui-input-error").width(this.widths[2] - 5).height(13);
        h.append(k);
        var n = {
            container: h,
            label: i,
            element: j,
            error: k,
            getName: function() {
                return a[0]
            },
            getJSONid: function() {
                return a[1]
            },
            getValue: function() {
                return $(j).val()
            },
            validate: function() {
                $(j).val().length === 0 ? g.setError(f, "Must not be empty") : c !== null && !$(j).val().match(c) ? g.setError(f, a[0] + " not valid") : d && $(j).val().length < 4 ? g.setError(f, "Must be at least 4 characters") : e !== null && k.html() === e ? g.setError(f, e) : g.clearError(f);
                return g.goFlags[f]
            }
        };
        j.change(function() {
            n.validate()
        });
        this.checkList.push(n);
        this.goFlags.push(true);
        this.panel.append(h);
        return n
    },
    addOptionInput: function(a, b) {
        a instanceof Array || (a = [a, a.replace(" ", "").toLowerCase()]);
        var c = this.checkList.length
          , d = this
          , e = this.createContainer()
          , f = $("<span>").addClass("ui-input-text").html(a[0] + ":").width(this.widths[0]).height(16);
        e.append(f);
        var g = $("<select>").addClass("optionBox").width(this.widths[1] - 12);
        g.append($("<option>").html(" "));
        for (var h = 0; h < b.length; h++)
            g.append($("<option>").html(b[h]));
        e.append(g);
        h = $("<div>").addClass("ui-input-error").width(this.widths[2] - 5).height(13);
        e.append(h);
        var i = {
            container: e,
            label: f,
            element: g,
            error: h,
            getName: function() {
                return a[0]
            },
            getJSONid: function() {
                return a[1]
            },
            getValue: function() {
                return $(g).val()
            },
            validate: function() {
                $(g).val().length === 0 ? d.setError(c, "Select an Option") : d.clearError(c);
                return d.goFlags[c]
            }
        };
        g.change(function() {
            i.validate()
        });
        this.checkList.push(i);
        this.goFlags.push(true);
        this.panel.append(e);
        return i
    },
    setError: function(a, b) {
        this.checkList[a].error.html(b);
        this.goFlags[a] = false;
        var c = this.checkList[a].element;
        if (c.attr("class").split(" ").length === 1) {
            var d = c.attr("class");
            c.attr("class", d + " " + d + "-Error")
        }
    },
    clearError: function(a) {
        this.checkList[a].error.html("");
        this.goFlags[a] = true;
        a = this.checkList[a].element;
        if (a.attr("class").split(" ").length === 2) {
            var b = a.attr("class").split(" ")[0];
            a.attr("class", b)
        }
    },
    addButton: function(a, b) {
        var c = this
          , d = this.createContainer().css({
            "text-align": "right"
        })
          , e = $("<button>");
        e.attr("type", "button").addClass("ui-input-button").html(a).css({
            "margin-right": this.widths[2]
        }).click(function() {
            var a = c.validate()
              , d = c.getValues();
            b(d, a)
        });
        d.append(e);
        this.panel.append(d)
    }
};
VG.Spinner = function(a, b, c, d, e, f) {
    var g = d || 12
      , d = f || "#333"
      , f = Math.max(b, c) || 15
      , b = Math.min(b, c) || 0.5 * f
      , h = e || 0.2 * f
      , e = f + h
      , c = f + h
      , i = Raphael(a, f * 2 + h * 2, f * 2 + h * 2)
      , j = []
      , k = []
      , a = 2 * Math.PI / g
      , h = {
        stroke: d,
        "stroke-width": h,
        "stroke-linecap": "round"
    };
    Raphael.getColor.reset();
    for (var n = 0; n < g; n++) {
        var p = a * n - Math.PI / 2
          , o = Math.cos(p)
          , p = Math.sin(p);
        k[n] = 1 / g * n;
        j[n] = i.path([["M", e + b * o, c + b * p], ["L", e + f * o, c + f * p]]).attr(h);
        d === "rainbow" && j[n].attr("stroke", Raphael.getColor())
    }
    var r;
    (function s() {
        k.unshift(k.pop());
        for (var a = 0; a < g; a++)
            j[a].attr("opacity", k[a]);
        i.safari();
        r = setTimeout(s, 1E3 / g)
    }
    )();
    return function() {
        clearTimeout(r);
        i.remove()
    }
}
;
VG.Icon = function(a, b, c, d, e, f, g) {
    f = f !== void 0 ? f : {
        fill: "#333",
        stroke: "none"
    };
    g = g !== void 0 ? g : {
        stroke: "#fff",
        "stroke-width": 3,
        "stroke-linejoin": "round",
        opacity: 0
    };
    this.element = typeof a === "string" ? $("#" + a).get(0) : a;
    this.r = Raphael(this.element, c, c);
    var h = this.r.path(VG.Icon.paths[b]).attr(g).translate(0, -2)
      , i = this.r.path(VG.Icon.paths[b]).attr(f).translate(0, -2);
    this.r.rect(0, 0, c, c).attr({
        fill: "#000",
        opacity: 0
    }).click(function(a) {
        a.preventDefault();
        a.stopPropagation();
        d(a)
    }).hover(function() {
        i.stop().animate({
            fill: "90-#0050af-#002c62"
        }, 200);
        h.stop().animate({
            opacity: 1
        }, 200)
    }, function() {
        i.stop().attr({
            fill: f.fill
        });
        h.stop().attr({
            opacity: 0
        })
    });
    this.stroke = h;
    this.icon = i;
    this.r.setViewBox(0, 0, 50, 50, false);
    if (e !== void 0) {
        a = {};
        if (e instanceof Array) {
            a = e[1];
            e = e[0]
        }
        a.gravity = a.gravity === void 0 ? "nw" : a.gravity;
        a.delayIn = a.delayIn === void 0 ? 250 : a.delayIn;
        a.delayOut = a.delayOut === void 0 ? 250 : a.delayOut;
        a.fade = a.fade === void 0 ? true : a.fade;
        $(this.element).attr({
            title: e
        }).tipsy(a)
    }
}
;
VG.Icon.prototype = {
    constructor: VG.Icon,
    addAlt: function(a) {
        this.alt = new VG.Alt(this.element,a)
    }
};
VG.Icon.paths = {
    undo: "M12.981,9.073V6.817l-12.106,6.99l12.106,6.99v-2.422c3.285-0.002,9.052,0.28,9.052,2.269c0,2.78-6.023,4.263-6.023,4.263v2.132c0,0,13.53,0.463,13.53-9.823C29.54,9.134,17.952,8.831,12.981,9.073z",
    refresh: "M24.083,15.5c-0.009,4.739-3.844,8.574-8.583,8.583c-4.741-0.009-8.577-3.844-8.585-8.583c0.008-4.741,3.844-8.577,8.585-8.585c1.913,0,3.665,0.629,5.09,1.686l-1.782,1.783l8.429,2.256l-2.26-8.427l-1.89,1.89c-2.072-1.677-4.717-2.688-7.587-2.688C8.826,3.418,3.418,8.826,3.416,15.5C3.418,22.175,8.826,27.583,15.5,27.583S27.583,22.175,27.583,15.5H24.083z",
    page2: "M23.024,5.673c-1.744-1.694-3.625-3.051-5.168-3.236c-0.084-0.012-0.171-0.019-0.263-0.021H7.438c-0.162,0-0.322,0.063-0.436,0.18C6.889,2.71,6.822,2.87,6.822,3.033v25.75c0,0.162,0.063,0.317,0.18,0.435c0.117,0.116,0.271,0.179,0.436,0.179h18.364c0.162,0,0.317-0.062,0.434-0.179c0.117-0.117,0.182-0.272,0.182-0.435V11.648C26.382,9.659,24.824,7.49,23.024,5.673zM22.157,6.545c0.805,0.786,1.529,1.676,2.069,2.534c-0.468-0.185-0.959-0.322-1.42-0.431c-1.015-0.228-2.008-0.32-2.625-0.357c0.003-0.133,0.004-0.283,0.004-0.446c0-0.869-0.055-2.108-0.356-3.2c-0.003-0.01-0.005-0.02-0.009-0.03C20.584,5.119,21.416,5.788,22.157,6.545zM25.184,28.164H8.052V3.646h9.542v0.002c0.416-0.025,0.775,0.386,1.05,1.326c0.25,0.895,0.313,2.062,0.312,2.871c0.002,0.593-0.027,0.991-0.027,0.991l-0.049,0.652l0.656,0.007c0.003,0,1.516,0.018,3,0.355c1.426,0.308,2.541,0.922,2.645,1.617c0.004,0.062,0.005,0.124,0.004,0.182V28.164z",
    page: "M23.024,5.673c-1.744-1.694-3.625-3.051-5.168-3.236c-0.084-0.012-0.171-0.019-0.263-0.021H7.438c-0.162,0-0.322,0.063-0.436,0.18C6.889,2.71,6.822,2.87,6.822,3.033v25.75c0,0.162,0.063,0.317,0.18,0.435c0.117,0.116,0.271,0.179,0.436,0.179h18.364c0.162,0,0.317-0.062,0.434-0.179c0.117-0.117,0.182-0.272,0.182-0.435V11.648C26.382,9.659,24.824,7.49,23.024,5.673zM25.184,28.164H8.052V3.646h9.542v0.002c0.416-0.025,0.775,0.386,1.05,1.326c0.25,0.895,0.313,2.062,0.312,2.871c0.002,0.593-0.027,0.991-0.027,0.991l-0.049,0.652l0.656,0.007c0.003,0,1.516,0.018,3,0.355c1.426,0.308,2.541,0.922,2.645,1.617c0.004,0.062,0.005,0.124,0.004,0.182V28.164z",
    location: "M16,3.5c-4.142,0-7.5,3.358-7.5,7.5c0,4.143,7.5,18.121,7.5,18.121S23.5,15.143,23.5,11C23.5,6.858,20.143,3.5,16,3.5z M16,14.584c-1.979,0-3.584-1.604-3.584-3.584S14.021,7.416,16,7.416S19.584,9.021,19.584,11S17.979,14.584,16,14.584z",
    key: "M18.386,16.009l0.009-0.006l-0.58-0.912c1.654-2.226,1.876-5.319,0.3-7.8c-2.043-3.213-6.303-4.161-9.516-2.118c-3.212,2.042-4.163,6.302-2.12,9.517c1.528,2.402,4.3,3.537,6.944,3.102l0.424,0.669l0.206,0.045l0.779-0.447l-0.305,1.377l2.483,0.552l-0.296,1.325l1.903,0.424l-0.68,3.06l1.406,0.313l-0.424,1.906l4.135,0.918l0.758-3.392L18.386,16.009z M10.996,8.944c-0.685,0.436-1.593,0.233-2.029-0.452C8.532,7.807,8.733,6.898,9.418,6.463s1.594-0.233,2.028,0.452C11.883,7.6,11.68,8.509,10.996,8.944z",
    zoomout: "M22.646,19.307c0.96-1.583,1.523-3.435,1.524-5.421C24.169,8.093,19.478,3.401,13.688,3.399C7.897,3.401,3.204,8.093,3.204,13.885c0,5.789,4.693,10.481,10.484,10.481c1.987,0,3.839-0.563,5.422-1.523l7.128,7.127l3.535-3.537L22.646,19.307zM13.688,20.369c-3.582-0.008-6.478-2.904-6.484-6.484c0.006-3.582,2.903-6.478,6.484-6.486c3.579,0.008,6.478,2.904,6.484,6.486C20.165,17.465,17.267,20.361,13.688,20.369zM8.854,11.884v4.001l9.665-0.001v-3.999L8.854,11.884z",
    zoomin: "M22.646,19.307c0.96-1.583,1.523-3.435,1.524-5.421C24.169,8.093,19.478,3.401,13.688,3.399C7.897,3.401,3.204,8.093,3.204,13.885c0,5.789,4.693,10.481,10.484,10.481c1.987,0,3.839-0.563,5.422-1.523l7.128,7.127l3.535-3.537L22.646,19.307zM13.688,20.369c-3.582-0.008-6.478-2.904-6.484-6.484c0.006-3.582,2.903-6.478,6.484-6.486c3.579,0.008,6.478,2.904,6.484,6.486C20.165,17.465,17.267,20.361,13.688,20.369zM15.687,9.051h-4v2.833H8.854v4.001h2.833v2.833h4v-2.834h2.832v-3.999h-2.833V9.051z",
    cross: "M24.778,21.419 19.276,15.917 24.777,10.415 21.949,7.585 16.447,13.087 10.945,7.585 8.117,10.415 13.618,15.917 8.116,21.419 10.946,24.248 16.447,18.746 21.948,24.248z",
    run: "M17.41,20.395l-0.778-2.723c0.228-0.2,0.442-0.414,0.644-0.643l2.721,0.778c0.287-0.418,0.534-0.862,0.755-1.323l-2.025-1.96c0.097-0.288,0.181-0.581,0.241-0.883l2.729-0.684c0.02-0.252,0.039-0.505,0.039-0.763s-0.02-0.51-0.039-0.762l-2.729-0.684c-0.061-0.302-0.145-0.595-0.241-0.883l2.026-1.96c-0.222-0.46-0.469-0.905-0.756-1.323l-2.721,0.777c-0.201-0.228-0.416-0.442-0.644-0.643l0.778-2.722c-0.418-0.286-0.863-0.534-1.324-0.755l-1.96,2.026c-0.287-0.097-0.581-0.18-0.883-0.241l-0.683-2.73c-0.253-0.019-0.505-0.039-0.763-0.039s-0.51,0.02-0.762,0.039l-0.684,2.73c-0.302,0.061-0.595,0.144-0.883,0.241l-1.96-2.026C7.048,3.463,6.604,3.71,6.186,3.997l0.778,2.722C6.736,6.919,6.521,7.134,6.321,7.361L3.599,6.583C3.312,7.001,3.065,7.446,2.844,7.907l2.026,1.96c-0.096,0.288-0.18,0.581-0.241,0.883l-2.73,0.684c-0.019,0.252-0.039,0.505-0.039,0.762s0.02,0.51,0.039,0.763l2.73,0.684c0.061,0.302,0.145,0.595,0.241,0.883l-2.026,1.96c0.221,0.46,0.468,0.905,0.755,1.323l2.722-0.778c0.2,0.229,0.415,0.442,0.643,0.643l-0.778,2.723c0.418,0.286,0.863,0.533,1.323,0.755l1.96-2.026c0.288,0.097,0.581,0.181,0.883,0.241l0.684,2.729c0.252,0.02,0.505,0.039,0.763,0.039s0.51-0.02,0.763-0.039l0.683-2.729c0.302-0.061,0.596-0.145,0.883-0.241l1.96,2.026C16.547,20.928,16.992,20.681,17.41,20.395zM11.798,15.594c-1.877,0-3.399-1.522-3.399-3.399s1.522-3.398,3.399-3.398s3.398,1.521,3.398,3.398S13.675,15.594,11.798,15.594zM27.29,22.699c0.019-0.547-0.06-1.104-0.23-1.654l1.244-1.773c-0.188-0.35-0.4-0.682-0.641-0.984l-2.122,0.445c-0.428-0.364-0.915-0.648-1.436-0.851l-0.611-2.079c-0.386-0.068-0.777-0.105-1.173-0.106l-0.974,1.936c-0.279,0.054-0.558,0.128-0.832,0.233c-0.257,0.098-0.497,0.22-0.727,0.353L17.782,17.4c-0.297,0.262-0.568,0.545-0.813,0.852l0.907,1.968c-0.259,0.495-0.437,1.028-0.519,1.585l-1.891,1.06c0.019,0.388,0.076,0.776,0.164,1.165l2.104,0.519c0.231,0.524,0.541,0.993,0.916,1.393l-0.352,2.138c0.32,0.23,0.66,0.428,1.013,0.6l1.715-1.32c0.536,0.141,1.097,0.195,1.662,0.15l1.452,1.607c0.2-0.057,0.399-0.118,0.596-0.193c0.175-0.066,0.34-0.144,0.505-0.223l0.037-2.165c0.455-0.339,0.843-0.747,1.152-1.206l2.161-0.134c0.152-0.359,0.279-0.732,0.368-1.115L27.29,22.699zM23.127,24.706c-1.201,0.458-2.545-0.144-3.004-1.345s0.143-2.546,1.344-3.005c1.201-0.458,2.547,0.144,3.006,1.345C24.931,22.902,24.328,24.247,23.127,24.706z",
    video: "M27.188,4.875v1.094h-4.5V4.875H8.062v1.094h-4.5V4.875h-1v21.25h1v-1.094h4.5v1.094h14.625v-1.094h4.5v1.094h1.25V4.875H27.188zM8.062,23.719h-4.5v-3.125h4.5V23.719zM8.062,19.281h-4.5v-3.125h4.5V19.281zM8.062,14.844h-4.5v-3.125h4.5V14.844zM8.062,10.406h-4.5V7.281h4.5V10.406zM11.247,20.59V9.754l9.382,5.418L11.247,20.59zM27.188,23.719h-4.5v-3.125h4.5V23.719zM27.188,19.281h-4.5v-3.125h4.5V19.281zM27.188,14.844h-4.5v-3.125h4.5V14.844zM27.188,10.406h-4.5V7.281h4.5V10.406z",
    roseChart: "M19.764,23.046c1.033,0,2.066-0.394,2.853-1.182l0.547,0.612c0.891-0.891,1.441-2.121,1.441-3.481  l6.05,0.057c0-2.807-1.069-5.614-3.208-7.756l1.75-1.714c-2.423-2.419-5.767-3.918-9.461-3.918l0.024,9.364  c-1.034,0-2.065,0.395-2.855,1.182l-0.621-0.686c-0.89,0.891-1.439,2.121-1.439,3.48l-6.033-0.025c0,2.808,1.07,5.615,3.212,7.757  L10.31,28.43c2.419,2.421,5.764,3.921,9.458,3.921L19.764,23.046z M35.196,19.008c0,8.541-6.924,15.462-15.46,15.462  c-8.541,0-15.461-6.925-15.461-15.462c0-8.54,6.924-15.461,15.461-15.461C28.272,3.547,35.196,10.469,35.196,19.008z M19.734,4.925  c-7.776,0-14.08,6.304-14.08,14.081c0,7.777,6.304,14.083,14.08,14.083c7.777,0,14.085-6.304,14.085-14.083  C33.819,11.228,27.511,4.925,19.734,4.925z",
    histogram: "M7.824,30.332h-3.91V14.627h3.91V30.332z M14.701,6.515h-3.912V30.33h3.91L14.701,6.515  L14.701,6.515z M21.576,11.094h-3.914v19.238h3.914V11.094z M28.45,25.356h-3.911v4.974h3.911V25.356z M35.326,9.132h-3.912v21.2  h3.912V9.132z",
    plane: "M8.696,29.839c-3.019-3.018-4.535-6.986-4.532-10.938l0,0c-0.003-3.957,1.513-7.926,4.532-10.939  l0,0c3.019-3.018,6.987-4.536,10.939-4.534l0,0c3.955-0.001,7.922,1.516,10.941,4.535l0,0c3.016,3.016,4.532,6.987,4.532,10.939l0,0  c0,3.952-1.517,7.92-4.532,10.938l0,0c-3.016,3.014-6.983,4.531-10.938,4.531l0,0C15.683,34.37,11.715,32.86,8.696,29.839  L8.696,29.839z M10.806,10.072c-2.44,2.44-3.655,5.625-3.655,8.83l0,0c0,3.2,1.215,6.384,3.655,8.825l0,0  c2.444,2.441,5.63,3.653,8.833,3.658l0,0c3.201-0.005,6.384-1.217,8.824-3.658l0,0c2.44-2.44,3.654-5.627,3.657-8.825l0,0  c-0.004-3.201-1.221-6.388-3.657-8.83l0,0c-2.439-2.443-5.63-3.659-8.828-3.659l0,0C16.435,6.417,13.25,7.63,10.806,10.072  L10.806,10.072z M29.757,11.574c-0.176-0.24-0.739-0.892-0.739-0.892c-0.087,4.633-2.067,8.86-5.412,12.209l0,0  c-3.245,3.251-7.956,5.392-12.142,5.452c0,0,0.729,0.589,0.938,0.74c0.259,0.189,0.933,0.609,0.931,0.609  c4.102-0.562,8.267-2.698,11.332-5.746l0,0c3.148-3.149,5.185-7.104,5.692-11.436C30.357,12.509,29.919,11.797,29.757,11.574z   M17.757,14.144c-0.796-0.795-2.082-0.795-2.878,0c-0.792,0.796-0.792,2.083,0,2.874c0.796,0.797,2.082,0.797,2.875,0  C18.55,16.224,18.55,14.94,17.757,14.144z",
    rake: "M8.697,29.839c-3.021-3.018-4.537-6.986-4.534-10.938l0,0C4.16,14.944,5.676,10.975,8.697,7.961  l0,0c3.019-3.02,6.985-4.538,10.939-4.535l0,0c3.953-0.001,7.921,1.516,10.942,4.535l0,0c3.014,3.016,4.53,6.985,4.53,10.939l0,0  c0,3.952-1.517,7.92-4.53,10.938l0,0c-3.018,3.015-6.985,4.531-10.937,4.531l0,0C15.684,34.37,11.715,32.86,8.697,29.839  L8.697,29.839z M10.806,10.072c-2.44,2.44-3.655,5.625-3.655,8.83l0,0c0,3.2,1.215,6.384,3.655,8.825l0,0  c2.444,2.441,5.63,3.653,8.833,3.658l0,0c3.198-0.005,6.384-1.217,8.824-3.658l0,0c2.44-2.44,3.653-5.627,3.656-8.825l0,0  c-0.004-3.201-1.22-6.388-3.656-8.83l0,0c-2.44-2.443-5.63-3.659-8.828-3.659l0,0C16.435,6.417,13.25,7.63,10.806,10.072  L10.806,10.072z M29.757,11.574c-0.176-0.24-0.739-0.892-0.739-0.892c-0.087,4.633-2.067,8.86-5.412,12.209l0,0  c-3.245,3.251-7.956,5.392-12.142,5.452c0,0,0.729,0.589,0.938,0.74c0.259,0.189,0.933,0.609,0.933,0.609  c4.1-0.562,8.266-2.698,11.329-5.746l0,0c3.147-3.149,5.186-7.104,5.69-11.436C30.357,12.509,29.919,11.797,29.757,11.574z   M17.757,14.144c-0.796-0.795-2.082-0.795-2.878,0c-0.792,0.796-0.792,2.083,0,2.874c0.796,0.797,2.082,0.797,2.878,0  C18.552,16.224,18.552,14.94,17.757,14.144z M29.89,15.394c-0.79-0.797-2.079-0.797-2.873,0c-0.794,0.795-0.794,2.081,0,2.874  c0.794,0.794,2.079,0.794,2.873,0C30.684,17.475,30.684,16.189,29.89,15.394z",
    line: "M8.697,29.839c-3.021-3.018-4.537-6.986-4.535-10.938l0,0c-0.001-3.957,1.514-7.926,4.535-10.939  l0,0c3.016-3.018,6.985-4.536,10.938-4.534l0,0c3.955-0.001,7.922,1.516,10.941,4.535l0,0c3.016,3.016,4.532,6.987,4.532,10.939l0,0  c0,3.954-1.517,7.92-4.532,10.938l0,0c-3.016,3.014-6.983,4.531-10.936,4.531l0,0C15.684,34.37,11.715,32.86,8.697,29.839  L8.697,29.839z M10.806,10.072c-2.44,2.44-3.655,5.625-3.655,8.83l0,0c0,3.2,1.216,6.384,3.655,8.825l0,0  c2.444,2.441,5.628,3.653,8.834,3.658l0,0c3.197-0.005,6.382-1.217,8.821-3.658l0,0c2.439-2.44,3.655-5.627,3.657-8.825l0,0  c-0.004-3.201-1.218-6.388-3.657-8.83l0,0c-2.44-2.443-5.629-3.659-8.829-3.659l0,0C16.435,6.417,13.25,7.63,10.806,10.072  L10.806,10.072z M17.757,14.144c-0.796-0.795-2.082-0.795-2.878,0c-0.792,0.796-0.792,2.083,0,2.874  c0.796,0.797,2.082,0.797,2.878,0C18.552,16.224,18.552,14.94,17.757,14.144z",
    smallCircle: "M8.697,29.839c-3.021-3.018-4.537-6.986-4.534-10.938l0,0  C4.16,14.944,5.676,10.975,8.697,7.961l0,0c3.019-3.02,6.985-4.538,10.939-4.535l0,0c3.953-0.001,7.921,1.516,10.942,4.535l0,0  c3.014,3.016,4.53,6.985,4.53,10.939l0,0c0,3.952-1.517,7.92-4.53,10.938l0,0c-3.018,3.015-6.985,4.531-10.937,4.531l0,0  C15.684,34.37,11.715,32.86,8.697,29.839L8.697,29.839z M10.806,10.072c-2.44,2.44-3.655,5.625-3.655,8.83l0,0  c0,3.2,1.215,6.384,3.655,8.825l0,0c2.444,2.441,5.63,3.653,8.833,3.658l0,0c3.198-0.005,6.384-1.217,8.824-3.658l0,0  c2.44-2.44,3.653-5.627,3.656-8.825l0,0c-0.004-3.201-1.22-6.388-3.656-8.83l0,0c-2.44-2.443-5.63-3.659-8.828-3.659l0,0  C16.435,6.417,13.25,7.63,10.806,10.072L10.806,10.072z M23.135,15.569c1.585,1.543,3.841,1.931,4.987,0.782  c1.161-1.162,0.815-3.392-0.778-4.982c-1.59-1.593-3.822-1.94-4.984-0.78C21.213,11.735,21.598,13.982,23.135,15.569l0.505-0.629  c-1.047-1.152-1.317-2.756-0.502-3.57c0.848-0.849,2.475-0.597,3.639,0.568c1.162,1.162,1.416,2.79,0.562,3.636  c-0.849,0.85-2.538,0.528-3.702-0.634",
    calculator: "M31.819,30.461c0,2.399-1.944,4.343-4.343,4.343H11.908c-2.396,0-4.342-1.943-4.342-4.343V7.963  c0-2.398,1.945-4.344,4.342-4.344h15.568c2.398,0,4.343,1.945,4.343,4.344V30.461z M28.963,7.502c0-0.798-0.648-1.447-1.448-1.447  H11.869c-0.799,0-1.448,0.649-1.448,1.447v3.24c0,0.799,0.649,1.447,1.448,1.447h15.646c0.802,0,1.448-0.648,1.448-1.447V7.502z   M15.031,28.403c0-0.37-0.298-0.667-0.667-0.667h-2.549c-0.369,0-0.667,0.3-0.667,0.667v2.55c0,0.369,0.298,0.666,0.667,0.666h2.549  c0.37,0,0.667-0.3,0.667-0.666V28.403z M21.63,28.403c0-0.37-0.295-0.667-0.665-0.667h-2.549c-0.367,0-0.667,0.3-0.667,0.667v2.55  c0,0.369,0.299,0.666,0.667,0.666h2.549c0.372,0,0.665-0.3,0.665-0.666V28.403z M28.235,28.403c0-0.37-0.301-0.667-0.667-0.667  h-2.552c-0.365,0-0.665,0.3-0.665,0.667v2.55c0,0.369,0.3,0.666,0.665,0.666h2.552c0.366,0,0.667-0.3,0.667-0.666V28.403z   M15.031,22.122c0-0.366-0.298-0.666-0.667-0.666h-2.549c-0.369,0-0.667,0.3-0.667,0.666v2.553c0,0.366,0.298,0.663,0.667,0.663  h2.549c0.37,0,0.667-0.3,0.667-0.663V22.122z M21.63,22.122c0-0.366-0.295-0.666-0.665-0.666h-2.549c-0.367,0-0.667,0.3-0.667,0.666  v2.553c0,0.366,0.299,0.663,0.667,0.663h2.549c0.372,0,0.665-0.3,0.665-0.663V22.122z M28.235,22.122  c0-0.366-0.301-0.666-0.667-0.666h-2.552c-0.365,0-0.665,0.3-0.665,0.666v2.553c0,0.366,0.3,0.663,0.665,0.663h2.552  c0.366,0,0.667-0.3,0.667-0.663V22.122z M15.031,15.843c0-0.367-0.298-0.666-0.667-0.666h-2.549c-0.369,0-0.667,0.299-0.667,0.666  v2.553c0,0.366,0.298,0.665,0.667,0.665h2.549c0.37,0,0.667-0.299,0.667-0.665V15.843z M21.63,15.843  c0-0.367-0.295-0.666-0.665-0.666h-2.549c-0.367,0-0.667,0.299-0.667,0.666v2.553c0,0.366,0.299,0.665,0.667,0.665h2.549  c0.372,0,0.665-0.299,0.665-0.665V15.843z M28.235,15.843c0-0.367-0.301-0.666-0.667-0.666h-2.552c-0.365,0-0.665,0.299-0.665,0.666  v2.553c0,0.366,0.3,0.665,0.665,0.665h2.552c0.366,0,0.667-0.299,0.667-0.665V15.843z",
    save: "M11.672,13.522h12.341V4.839h2.56l6.403,6.68v18.069c0,1.816-1.349,3.287-3.02,3.287H10.229  c-1.669,0-3.02-1.471-3.02-3.287V8.124c0-1.814,1.351-3.285,3.02-3.285h1.442L11.672,13.522L11.672,13.522z M21.968,11.685h-2.66  V6.792h2.66V11.685z M27.731,19.499c0-0.874-0.653-1.579-1.463-1.579H12.861c-0.81,0-1.464,0.706-1.464,1.579v8.568  c0,0.874,0.652,1.579,1.464,1.579h13.407c0.81,0,1.463-0.705,1.463-1.579V19.499z M25.802,20.617H13.328v1.13h12.474V20.617  L25.802,20.617z M25.802,23.219H13.328v1.132h12.474V23.219L25.802,23.219z M25.802,25.821H13.328v1.13h12.474V25.821L25.802,25.821  z",
    trash: "M29.984,10.846v20.318c0,3.686-2.504,3.557-5.59,3.557H13.966c-3.085,0-5.588,0.129-5.588-3.557  V10.846 M14.391,14.775c0-0.86-0.584-1.557-1.304-1.557l0,0c-0.719,0-1.304,0.699-1.304,1.557v15.572c0,0.863,0.585,1.56,1.304,1.56  l0,0c0.72,0,1.304-0.696,1.304-1.56V14.775z M20.486,14.923c0-0.86-0.584-1.557-1.305-1.557l0,0c-0.721,0-1.304,0.697-1.304,1.557  v15.574c0,0.86,0.583,1.554,1.304,1.554l0,0c0.721,0,1.305-0.693,1.305-1.554V14.923z M26.573,14.923  c0-0.86-0.582-1.557-1.302-1.557l0,0c-0.722,0-1.304,0.697-1.304,1.557v15.574c0,0.86,0.584,1.554,1.304,1.554l0,0  c0.722,0,1.302-0.693,1.302-1.554V14.923z M21.544,5.957c0-1.474-1.011-2.648-2.243-2.648c-1.235,0-2.262,1.176-2.262,2.648l0,0  c-2.363,0-4.793,0-4.793,0c-2.894,0-4.667-0.094-4.667,2.311v1.645h23.202V8.268c0-2.405-1.534-2.311-4.428-2.311  C26.353,5.957,21.544,5.957,21.544,5.957L21.544,5.957z",
    copy: "M25.911,34.197c0,0.16-0.064,0.31-0.176,0.425c-0.116,0.112-0.27,0.173-0.428,0.173H7.393  c-0.161,0-0.311-0.061-0.426-0.173c-0.112-0.115-0.175-0.268-0.175-0.425V9.073c0-0.161,0.066-0.317,0.175-0.43  C7.079,8.532,7.235,8.47,7.393,8.47h5.513l0.013,0.001V4.114c0-0.16,0.067-0.315,0.175-0.427c0.112-0.113,0.27-0.175,0.426-0.175  h9.909c0.089,0.003,0.171,0.008,0.257,0.022c1.503,0.18,3.337,1.504,5.039,3.156c1.758,1.776,3.278,3.889,3.312,5.833v16.714  c0,0.163-0.062,0.313-0.176,0.428c-0.115,0.114-0.267,0.17-0.424,0.17h-5.561v-1.199h4.957h0.002V12.521  c0-0.057,0-0.117-0.004-0.178c-0.102-0.677-1.191-1.276-2.579-1.578c-1.45-0.328-2.927-0.344-2.928-0.344l-0.642-0.006l0.05-0.638  c0,0,0.026-0.388,0.023-0.968c0.005-0.786-0.058-1.925-0.3-2.799c-0.27-0.919-0.621-1.319-1.026-1.294V4.714h-9.309v3.715  l-0.06,0.043h3.241c0.09,0.003,0.173,0.009,0.256,0.021c1.505,0.181,3.343,1.504,5.04,3.156c1.759,1.775,3.28,3.891,3.314,5.831   M24.708,33.592V17.479c0-0.056,0-0.117-0.003-0.176c-0.103-0.679-1.192-1.278-2.58-1.579c-1.45-0.328-2.927-0.346-2.928-0.346  l-0.64-0.006l0.048-0.636c0,0,0.029-0.39,0.028-0.969c0.001-0.788-0.062-1.928-0.303-2.799c-0.271-0.918-0.621-1.319-1.028-1.294  V9.673h-9.31v23.919h16.713H24.708L24.708,33.592z",
    paste: "M25.646,5.637c2.015,0.123,3.586,1.797,3.586,3.841v3.603c0,0-1.168-0.852-1.918-1.356  c-1.036-0.7-2.225-0.727-2.225-0.727l-8.9-0.044c0,0-0.473,0.087-0.65,0.262c-0.175,0.175-0.229,0.658-0.229,0.658v18.65h-3.02  c-2.126,0-3.848-1.725-3.848-3.852V9.478c0-2.03,1.57-3.691,3.559-3.839v2.845h13.642V5.637H25.646z M24.396,7.315V5.676  c0-1.51-1.226-2.006-2.735-2.006h-5.649c-1.511,0-2.734,0.495-2.734,2.006v1.639H24.396z M29.804,14.375  c-1.497-1.453-3.107-2.616-4.432-2.774c-0.072-0.013-0.145-0.017-0.226-0.02H16.44c-0.138,0-0.276,0.055-0.373,0.154  c-0.096,0.099-0.154,0.235-0.154,0.375v22.079c0,0.141,0.054,0.271,0.154,0.373c0.101,0.099,0.232,0.155,0.373,0.155h15.747  c0.139,0,0.271-0.055,0.373-0.155c0.101-0.097,0.155-0.232,0.155-0.373V19.498C32.68,17.792,31.345,15.934,29.804,14.375z   M31.524,33.656H16.838v-21.02h8.184v0.001c0.354-0.022,0.664,0.331,0.9,1.137c0.213,0.767,0.268,1.769,0.268,2.461  c0,0.506-0.024,0.85-0.024,0.85l-0.044,0.56l0.566,0.005c0,0,1.297,0.015,2.568,0.304c1.224,0.264,2.179,0.79,2.271,1.387  c0,0.053,0,0.107,0,0.156v14.159H31.524L31.524,33.656z",
    selectAll: "M25.446,15.306l5.957-5.956l-1.072-1.069l-4.885,4.884l-2.931-2.931l-1.067,1.07  L25.446,15.306z M25.446,29.297l5.957-5.955l-1.072-1.068l-4.885,4.884l-2.931-2.932l-1.067,1.071L25.446,29.297z M35.275,34.601  H4.269V3.591h31.007V34.601z M18.26,6.876H8.429v9.833h9.832V6.876z M18.26,20.87H8.429v9.83h9.832V20.87z",
    selectNone: "M35.272,34.601H4.265V3.591h31.007V34.601z M18.256,6.876h-9.83v9.833h9.83V6.876z   M18.256,20.87h-9.83v9.83h9.83V20.87z",
    calcPlane: "M8.697,29.839c-3.021-3.018-4.537-6.986-4.534-10.938l0,0  C4.16,14.944,5.676,10.975,8.697,7.961l0,0c3.019-3.02,6.985-4.538,10.939-4.535l0,0c3.953-0.001,7.921,1.516,10.942,4.535l0,0  c3.014,3.016,4.53,6.985,4.53,10.939l0,0c0,3.952-1.517,7.92-4.53,10.938l0,0c-3.018,3.015-6.985,4.531-10.937,4.531l0,0  C15.684,34.37,11.715,32.86,8.697,29.839L8.697,29.839z M10.806,10.072c-2.44,2.44-3.655,5.625-3.655,8.83l0,0  c0,3.2,1.215,6.384,3.655,8.825l0,0c2.444,2.441,5.63,3.653,8.833,3.658l0,0c3.198-0.005,6.384-1.217,8.824-3.658l0,0  c2.44-2.44,3.653-5.627,3.656-8.825l0,0c-0.004-3.201-1.22-6.388-3.656-8.83l0,0c-2.44-2.443-5.63-3.659-8.828-3.659l0,0  C16.435,6.417,13.25,7.63,10.806,10.072L10.806,10.072z M29.757,11.574c-0.176-0.24-0.739-0.892-0.739-0.892  c-0.087,4.633-2.067,8.86-5.412,12.209l0,0c-3.245,3.251-7.956,5.392-12.142,5.452c0,0,0.729,0.589,0.938,0.74  c0.259,0.189,0.933,0.609,0.933,0.609c4.1-0.562,8.266-2.698,11.329-5.746l0,0c3.147-3.149,5.186-7.104,5.69-11.436  C30.357,12.509,29.919,11.797,29.757,11.574z M29.89,15.394c-0.79-0.797-2.079-0.797-2.873,0c-0.794,0.795-0.794,2.081,0,2.874  c0.794,0.794,2.079,0.794,2.873,0C30.684,17.475,30.684,16.189,29.89,15.394z M19.871,25.876c-0.791-0.798-2.08-0.798-2.874,0  c-0.794,0.795-0.794,2.08,0,2.873c0.794,0.795,2.079,0.795,2.874,0C20.664,27.956,20.664,26.671,19.871,25.876z",
    calcLine: "M8.697,29.839c-3.021-3.018-4.537-6.986-4.534-10.938l0,0  C4.16,14.944,5.676,10.975,8.697,7.961l0,0c3.019-3.02,6.985-4.538,10.939-4.535l0,0c3.953-0.001,7.921,1.516,10.942,4.535l0,0  c3.014,3.016,4.53,6.985,4.53,10.939l0,0c0,3.952-1.517,7.92-4.53,10.938l0,0c-3.018,3.015-6.985,4.531-10.937,4.531l0,0  C15.684,34.37,11.715,32.86,8.697,29.839L8.697,29.839z M29.757,11.574c-0.176-0.24-0.739-0.892-0.739-0.892  c-0.087,4.633-2.067,8.86-5.412,12.209l0,0c-3.245,3.251-7.956,5.392-12.142,5.452c0,0,0.729,0.589,0.938,0.74  c0.259,0.189,0.933,0.609,0.933,0.609c4.1-0.562,8.266-2.698,11.329-5.746l0,0c3.147-3.149,5.186-7.104,5.69-11.436  C30.357,12.509,29.919,11.797,29.757,11.574z M28.204,18.499c-0.791-0.798-2.079-0.798-2.874,0c-0.793,0.795-0.793,2.079,0,2.872  c0.795,0.795,2.079,0.795,2.874,0C28.998,20.578,28.998,19.294,28.204,18.499z M8.502,24.549c1.562,3.077,4.211,5.222,7.257,6.217  l0,0c3.042,0.994,6.446,0.829,9.524-0.731l0,0c3.08-1.565,5.222-4.217,6.221-7.26l0,0c0.989-3.041,0.827-6.446-0.735-9.523l0,0  c-1.562-3.078-4.213-5.221-7.252-6.217l0,0c-3.044-0.991-6.45-0.825-9.528,0.732l0,0c-3.081,1.561-5.228,4.214-6.221,7.254l0,0  C6.776,18.063,6.94,21.467,8.502,24.549L8.502,24.549z M15.818,7.002c-0.283,0.092-1.078,0.426-1.078,0.426  c4.376,1.522,7.779,4.718,9.924,8.938l0,0c2.082,4.094,2.652,9.237,1.41,13.235c0,0,0.786-0.511,0.994-0.661  c0.261-0.188,0.869-0.697,0.869-0.697c0.74-4.071,0.004-8.695-1.941-12.554l0,0c-2.016-3.97-5.142-7.136-9.102-8.962  C16.893,6.722,16.08,6.917,15.818,7.002z",
    faultLab: "M23.023,26.415H4.366V4.623h6.826 M28.939,34.147h6.371V12.355H17.108"
};
VG.Notify = function(a, b, c) {
    this.text = $("<div>").addClass("notifyText").html(a);
    this.subtext = $("<div>").addClass("notifySubText").html(b);
    this.notify = $("<div>").addClass("notifyBar").append(this.text).append(this.subtext);
    c !== void 0 && this.notify.append(c);
    this.blind = $("<div>").addClass("notifyBlind");
    this.close = $('<div id="notifyCloseIcon">').addClass("closeIcon icon");
    this.notify.append(this.close);
    $("body").append(this.blind).append(this.notify);
    var d = this;
    this.notify.ready(function() {
        d.notify.css("margin-top", -d.notify.height() / 2 - 20)
    });
    new VG.Icon("notifyCloseIcon","cross",30,function() {
        d.destroy()
    }
    )
}
;
VG.Notify.prototype = {
    constructor: VG.Notify,
    destroy: function() {
        this.blind.remove();
        this.notify.remove()
    },
    subTheme: function(a) {
        for (var b = false, c = ["Loading", "Success", "Warn", "Error", "Tray"], d = 0; d < c.length; d++)
            if (a == c[d]) {
                b = true;
                break
            }
        if (!b) {
            console.log(c);
            throw "Notify: subTheme Not supported";
        }
        this.notify.addClass("notifyBar-" + a);
        this.text.addClass("notifyText-" + a);
        this.subtext.addClass("notifySubText-" + a);
        return this
    }
};
VG.Notify.closeAll = function() {
    $(".notifyBar").remove();
    $(".notifyBlind").remove()
}
;
VG.Notify.Error = function() {
    (new VG.Notify("Error","There was an error, please try again.")).subTheme("Error")
}
;
VG.ViewRect = function(a, b) {
    this.nWidth = a;
    this.nHeight = b;
    this.lockAspect = true;
    this.aspect = a / b
}
;
VG.ViewRect.prototype = {
    constructor: VG.ViewRect,
    getCenter: function() {},
    getPercent: function(a, b, c, d, e) {
        a = this.getElement(a);
        b = [(b - a.left) / a.width, (c - a.top) / a.height];
        return !e && (b[0] < 0 || b[1] < 0 || b[0] > 1 || b[1] > 1) ? null : [b, [d / a.width, d / a.height]]
    },
    getPixels: function(a, b, c, d, e, f, g) {
        b = [(b - g.left) / g.width, (g.top - c) / g.height];
        d = [d / g.width, d / g.height];
        a = this.getElement(a);
        return {
            x: a.left + b[0] * a.width,
            y: a.top + b[1] * a.height,
            l: a.width * d[0]
        }
    },
    getUnits: function(a, b, c, d, e) {
        a = this.getPercent(a, b, c, d, true);
        if (a === null)
            return {};
        b = a[0];
        return {
            x: e.left + b[0] * e.width,
            y: e.top - b[1] * e.height,
            l: a[1][0] * e.width
        }
    },
    getViewWindow: function(a, b, c, d) {
        var e = this.getUnits(a, 0, 0, 0, d)
          , a = this.getUnits(a, b, c, 0, d);
        return {
            left: e.x,
            top: e.y,
            width: a.x - e.x,
            height: e.y - a.y
        }
    },
    zoom: function(a, b, c, d) {
        var e = b[0]
          , b = b[1];
        if (c / d <= 1)
            var c = c / (b[0] * 2)
              , d = c / this.aspect
              , f = -c * (e[0] - b[0]);
        else {
            d = d / (b[1] * 2);
            c = d * this.aspect;
            f = -c * (e[0] - b[0])
        }
        b = -d * (e[1] - b[1]);
        this.setElement(a, c, d, f, b);
        return e
    },
    fitInBox: function(a, b, c) {
        if (this.lockAspect)
            if (b / c >= this.aspect) {
                var d = c * this.aspect;
                this.setElement(a, d, c, (b - d) / 2, 0)
            } else {
                d = b / this.aspect;
                this.setElement(a, b, d, 0, (c - d) / 2)
            }
        else
            this.setElement(a, b, c, 0, 0)
    },
    getViewArea: function() {
        var a = this.location.center.x - parseFloat(this.obs.css("left"))
          , b = this.location.center.y - parseFloat(this.obs.css("top"));
        if (a < 0 || b < 0)
            return null;
        var c = this.obs.width()
          , d = this.obs.height()
          , a = [a / c, b / d];
        return a[0] > 1 || a[1] > 1 ? null : a
    },
    setElement: function(a, b, c, d, e) {
        $(a).width(b).height(c).css({
            left: d,
            top: e
        })
    },
    getElement: function(a) {
        return {
            width: $(a).width(),
            height: $(a).height(),
            left: parseFloat($(a).css("left")),
            top: parseFloat($(a).css("top"))
        }
    },
    copyElement: function(a, b) {
        var c = this.getElement(a);
        this.setElement(b, c.width, c.height, c.left, c.top)
    }
};
VG.CellList = function() {
    this.className = "CellList";
    this.panel = $("<div>").addClass(this.className);
    this.toolbar = $("<div>").addClass(this.className + "ToolBar");
    this.scroll = $("<div>").addClass(this.className + "Scroll");
    this.panel.append(this.toolbar);
    this.panel.append(this.scroll);
    this.items = [];
    this.bus = $({});
    this.multiSelect = true;
    this.addEvents()
}
;
VG.CellList.prototype = {
    constructor: VG.CellList,
    addItem: function(a) {
        this.scroll.append(a.panel);
        a.cellList = this;
        this.items.push(a)
    },
    addEvents: function() {
        var a = this;
        this.bus.bind("selectEvent", function(b, c, d) {
            b = c.isSelected;
            if (!a.multiSelect || a.multiSelect && !d.shiftKey) {
                for (d = 0; d < a.items.length; d++)
                    a.items[d].select(false);
                c.select(a.multiSelect ? b : true)
            }
        })
    }
};
VG.CellItem = function(a) {
    this.className = "CellItem";
    this.isSelected = false;
    this.panel = $("<div>").addClass(this.className);
    this.cellList = null;
    var b = this;
    this.panel.click(function(c) {
        var d = b.select();
        b.bus("selectEvent", c);
        a && a(d)
    });
    this.panel.hover(function() {
        b.hover(true)
    }, function() {
        b.hover(false)
    })
}
;
VG.CellItem.prototype = {
    constructor: VG.CellItem,
    addIcon: function(a, b, c) {
        var d = $("<div>").addClass("icon")
          , a = new VG.Icon(d.get(0),a,30,b);
        c !== void 0 && a.addAlt(c);
        this.panel.append(d)
    },
    select: function(a) {
        a = a === void 0 ? !this.isSelected : a;
        this.panel.attr("class", this.className + (a ? " " + this.className + "-Selected" : ""));
        return this.isSelected = a
    },
    hover: function(a) {
        this.isSelected || this.panel.attr("class", this.className + (a ? " " + this.className + "-Hover" : ""))
    },
    bus: function(a, b) {
        this.cellList !== null && $(this.cellList.bus).trigger(a, [this, b])
    }
};
VG.Table = function() {}
;
VG.Table.prototype = {
    constructor: VG.Table,
    init: function(a) {
        this.id = a;
        this.container = $(a);
        this.checkNumbers = [];
        this.checkNoEdits = []
    },
    resize: function(a, b) {
        this.container.width(a).height(b);
        if (this.table !== void 0) {
            var c = this.table.getData();
            this.table.destroy();
            this.container.css({
                overflow: "scroll"
            });
            this.createTable();
            this.loadData(c)
        }
    },
    createTable: function(a) {
        this.table !== void 0 && this.table.destroy();
        var b = this
          , a = a === void 0 ? this.opts : a;
        a.startRows = a.startRows === void 0 ? 0 : a.startRows;
        a.rowHeaders = a.rowHeaders === void 0 ? false : a.rowHeaders;
        a.fillHandle = a.fillHandle === void 0 ? false : a.fillHandle;
        a.minSpareRows = a.minSpareRows === void 0 ? 0 : a.minSpareRows;
        a.multiSelect = a.multiSelect === void 0 ? true : a.multiSelect;
        a.onChange = a.onChange !== void 0 ? a.onChange : function(a) {
            console.log(a)
        }
        ;
        a.onBeforeChange = function(a) {
            for (var d = a.length - 1; d >= 0; d--) {
                var e;
                a: {
                    e = a;
                    for (var f = d, g = 0; g < b.checkNumbers.length; g++)
                        if (e[f][1] === b.checkNumbers[g].id) {
                            if (isNumber(e[f][3])) {
                                if (!b.checkNumbers[g].check(parseFloat(e[f][3]))) {
                                    e.splice(f, 1);
                                    noty({
                                        text: "Input must be " + b.checkNumbers[g].constraint + ".",
                                        type: "error",
                                        modal: false,
                                        timeout: 1500,
                                        layout: "topRight"
                                    });
                                    e = true;
                                    break a
                                }
                            } else {
                                e.splice(f, 1);
                                noty({
                                    text: "Input must be a number.",
                                    type: "error",
                                    modal: false,
                                    timeout: 1500,
                                    layout: "topRight"
                                });
                                e = true;
                                break a
                            }
                            e[f][3] = parseFloat(e[f][3])
                        }
                    e = false
                }
                if (!e) {
                    a: {
                        e = a;
                        f = d;
                        for (g = 0; g < b.checkNoEdits.length; g++)
                            if (e[f][1] === b.checkNoEdits[g].id) {
                                e.splice(f, 1);
                                e = true;
                                break a
                            }
                        e = false
                    }
                    e || a[d][3] === "" && a.splice(d, 1)
                }
            }
        }
        ;
        this.opts = a;
        this.recordChanges = true;
        this.container.handsontable(a);
        this.table = $(b.id).data("handsontable")
    },
    insertData: function(a) {
        if (a !== void 0) {
            var b = this.table.getData();
            b.push(a);
            this.table.render();
            this.table.selectCell(b.length - 1, 1)
        }
    },
    loadData: function(a) {
        this.recordChanges = false;
        this.table.loadData(a);
        this.recordChanges = true
    },
    getData: function() {
        return this.table.getData()
    }
};
VG.FaultLab = function(a, b, c, d) {
    this.fault = d === void 0 ? VG.FaultObject.random() : d;
    this.y = this.x = 50;
    this.z = 25;
    this.context = new VG.ThreePanel(a,b);
    $(c === void 0 ? "body" : "#" + c).append(this.context.panel);
    this.useShaders = Detector.webgl && Detector.ismac;
    this.slipBound = 50;
    this.slipMultiplier = 10;
    this.moveHandlers = []
}
;
VG.FaultLab.prototype = {
    constructor: VG.FaultLab,
    init: function(a) {
        a && this.addControlPanel();
        this.hidePanels = a;
        this.name = $("#faultName");
        this.createModel()
    },
    createModel: function() {
        this.createBox();
        this.createNArrow();
        this.addHandlers();
        this.context.cameraControler.setCameraRadius(230);
        this.context.cameraControler.setCameraTarget(0, 0, 0);
        this.context.cameraControler.setRotationX(-60);
        this.context.cameraControler.setRotationZ(45);
        this.context.start();
        this.updatePosition();
        this.context.render();
        this.nameFault();
        this.setPanelsVisibility(true)
    },
    positionChange: function() {
        this.updatePosition();
        this.context.render();
        this.nameFault()
    },
    cutChange: function() {
        this.fault.update();
        this.createBox();
        this.positionChange()
    },
    strikeChange: function(a) {
        this.fault.strike = a;
        this.cutChange();
        this.positionChange()
    },
    dipChange: function(a) {
        this.fault.dip = a;
        this.cutChange();
        this.positionChange()
    },
    rakeChange: function(a) {
        this.fault.rake = a;
        this.positionChange()
    },
    slipChange: function(a) {
        this.fault.slip = a;
        this.positionChange()
    },
    updateSliders: function() {
        for (var a = this.moveHandlers.length - 1; a >= 0; a--)
            this.moveHandlers[a](this)
    },
    addControlPanel: function() {
        var a = this;
        this.strikeSlider = new VG.Slider("#strikeSlider","Strike",{
            min: 0,
            max: 360,
            value: this.fault.strike,
            change: function(b, c) {
                a.strikeChange(c.value)
            }
        });
        this.dipSlider = new VG.Slider("#dipSlider","Dip",{
            min: 0,
            max: 90,
            value: this.fault.dip,
            change: function(b, c) {
                a.dipChange(c.value)
            }
        });
        this.rakeSlider = new VG.Slider("#rakeSlider","Rake",{
            min: -180,
            max: 180,
            value: this.fault.rake,
            slide: function(b, c) {
                a.movingFault || a.rakeChange(c.value)
            }
        });
        this.slipSlider = new VG.Slider("#slipSlider","Slip",{
            min: 0,
            max: this.slipBound,
            value: this.fault.slip,
            slide: function(b, c) {
                a.movingFault || a.slipChange(c.value)
            }
        });
        this.moveHandlers.push(function() {
            a.rakeSlider.value(a.fault.rake);
            a.slipSlider.value(a.fault.slip)
        })
    },
    nameFault: function() {
        this.name !== void 0 && this.name.html(this.fault.name())
    },
    updatePosition: function() {
        var a = getRakeVector(this.fault.strike, this.fault.dip, -this.fault.rake);
        a.setLength(this.fault.slip * this.slipMultiplier);
        this.boxP.position.copy(a)
    },
    createBox: function() {
        var a = this;
        this.context.removeObject(this.boxM, false);
        this.context.removeObject(this.boxP, false);
        this.boxP = new THREE.Object3D;
        this.boxM = new THREE.Object3D;
        var b = []
          , c = []
          , d = new THREE.Geometry
          , e = new THREE.Geometry
          , f = new THREE.Geometry
          , g = new THREE.Geometry
          , h = new THREE.Geometry
          , i = new THREE.Geometry
          , j = new THREE.Geometry
          , k = new THREE.Geometry
          , n = new THREE.Geometry
          , p = new THREE.Geometry
          , o = new THREE.Geometry
          , r = new THREE.Geometry
          , q = new THREE.Geometry
          , s = new THREE.Geometry
          , t = new THREE.Geometry
          , v = new THREE.Geometry
          , x = new THREE.Geometry
          , u = new THREE.Geometry
          , y = new THREE.Geometry
          , E = new THREE.Geometry
          , z = new THREE.Geometry
          , C = new THREE.Geometry
          , w = new THREE.Geometry
          , H = new THREE.Geometry
          , L = new THREE.Geometry
          , I = new THREE.Geometry
          , P = this.x
          , N = this.y
          , A = this.z
          , J = new THREE.Vector3(0,0,1)
          , F = new THREE.Vector3(-P,-N,+A)
          , l = new THREE.Vector3(-P,+N,+A)
          , Q = new THREE.Vector3(+P,-N,+A)
          , D = new THREE.Vector3(+P,+N,+A)
          , B = new THREE.Vector3(-P,-N,-A)
          , T = new THREE.Vector3(-P,+N,-A)
          , M = new THREE.Vector3(+P,-N,-A)
          , P = new THREE.Vector3(+P,+N,-A)
          , N = function(a, b, c, d, e, f) {
            for (var g = c.length - 1; g >= 0; g--)
                VG.ThreeUtils.cutPatch(a, b, c[g], d, e, f)
        }
          , A = VG.ThreeUtils.cutLine
          , ea = [[F, Q, D], [F, D, l]];
        c.push({
            name: "Top",
            O: F,
            U: l.clone().subSelf(F),
            V: Q.clone().subSelf(F)
        });
        N(d, this.fault.plane, ea, true, J, b);
        N(e, this.fault.plane, ea, false, J, b);
        A(t.vertices, this.fault.plane, [F, l, D, Q, F], true);
        A(v.vertices, this.fault.plane, [F, l, D, Q, F], false);
        J = new THREE.Vector3(0,0,-1);
        ea = [[B, M, P], [B, P, T]];
        c.push({
            name: "Bottom",
            O: B,
            U: T.clone().subSelf(B),
            V: M.clone().subSelf(B)
        });
        N(f, this.fault.plane, ea, true, J, b);
        N(g, this.fault.plane, ea, false, J, b);
        A(x.vertices, this.fault.plane, [B, T, P, M, B], true);
        A(u.vertices, this.fault.plane, [B, T, P, M, B], false);
        J = new THREE.Vector3(0,-1,0);
        ea = [[B, M, Q], [B, Q, F]];
        c.push({
            name: "Front",
            O: B,
            U: F.clone().subSelf(B),
            V: M.clone().subSelf(B)
        });
        N(h, this.fault.plane, ea, true, J, b);
        N(i, this.fault.plane, ea, false, J, b);
        A(y.vertices, this.fault.plane, [B, F, Q, M, B], true);
        A(E.vertices, this.fault.plane, [B, F, Q, M, B], false);
        J = new THREE.Vector3(0,1,0);
        ea = [[T, P, D], [T, D, l]];
        c.push({
            name: "Back",
            O: T,
            U: l.clone().subSelf(T),
            V: P.clone().subSelf(T)
        });
        N(j, this.fault.plane, ea, true, J, b);
        N(k, this.fault.plane, ea, false, J, b);
        A(z.vertices, this.fault.plane, [T, l, D, P, T], true);
        A(C.vertices, this.fault.plane, [T, l, D, P, T], false);
        J = new THREE.Vector3(-1,0,0);
        ea = [[B, T, l], [B, l, F]];
        c.push({
            name: "Left",
            O: B,
            U: F.clone().subSelf(B),
            V: T.clone().subSelf(B)
        });
        N(n, this.fault.plane, ea, true, J, b);
        N(p, this.fault.plane, ea, false, J, b);
        A(w.vertices, this.fault.plane, [B, F, l, T, B], true);
        A(H.vertices, this.fault.plane, [B, F, l, T, B], false);
        J = new THREE.Vector3(1,0,0);
        ea = [[M, P, D], [M, D, Q]];
        c.push({
            name: "Right",
            O: M,
            U: Q.clone().subSelf(M),
            V: P.clone().subSelf(M)
        });
        N(o, this.fault.plane, ea, true, J, b);
        N(r, this.fault.plane, ea, false, J, b);
        A(L.vertices, this.fault.plane, [M, Q, D, P, M], true);
        A(I.vertices, this.fault.plane, [M, Q, D, P, M], false);
        b = unique(b);
        b.sort(function(b, c) {
            var d = getBearingInPlane(a.fault.plane.strike, a.fault.plane.dip, a.fault.plane.centroid.clone().subSelf(b));
            return getBearingInPlane(a.fault.plane.strike, a.fault.plane.dip, a.fault.plane.centroid.clone().subSelf(c)) - d
        });
        q.vertices.push((new THREE.Vector3).copy(this.fault.plane.centroid));
        s.vertices.push((new THREE.Vector3).copy(this.fault.plane.centroid));
        c = q.vertices.length;
        J = s.vertices.length;
        q.vertices.push(b[0].clone());
        s.vertices.push(b[0].clone());
        for (F = 1; F < b.length; F++) {
            q.vertices.push(b[F].clone());
            s.vertices.push(b[F].clone());
            VG.ThreeUtils.pushFace(q.vertices, q.faces, this.fault.plane.normal.clone().negate(), c - 1, c + F - 1, c + F);
            VG.ThreeUtils.pushFace(s.vertices, s.faces, this.fault.plane.normal, J - 1, J + F - 1, J + F)
        }
        VG.ThreeUtils.pushFace(q.vertices, q.faces, this.fault.plane.normal.clone().negate(), c - 1, c + b.length - 1, c);
        VG.ThreeUtils.pushFace(s.vertices, s.faces, this.fault.plane.normal, J - 1, J + b.length - 1, J);
        d.vertices.length > 0 && this.boxP.add(VG.GeologyMaterial(d));
        e.vertices.length > 0 && this.boxM.add(VG.GeologyMaterial(e));
        f.vertices.length > 0 && this.boxP.add(VG.GeologyMaterial(f));
        g.vertices.length > 0 && this.boxM.add(VG.GeologyMaterial(g));
        h.vertices.length > 0 && this.boxP.add(VG.GeologyMaterial(h));
        i.vertices.length > 0 && this.boxM.add(VG.GeologyMaterial(i));
        j.vertices.length > 0 && this.boxP.add(VG.GeologyMaterial(j));
        k.vertices.length > 0 && this.boxM.add(VG.GeologyMaterial(k));
        n.vertices.length > 0 && this.boxP.add(VG.GeologyMaterial(n));
        p.vertices.length > 0 && this.boxM.add(VG.GeologyMaterial(p));
        o.vertices.length > 0 && this.boxP.add(VG.GeologyMaterial(o));
        r.vertices.length > 0 && this.boxM.add(VG.GeologyMaterial(r));
        q.vertices.length > 0 && this.boxP.add(VG.GeologyMaterial(q));
        s.vertices.length > 0 && this.boxM.add(VG.GeologyMaterial(s));
        b = new THREE.LineBasicMaterial({
            color: 0,
            linewidth: 3
        });
        t.vertices.length > 0 && this.boxP.add(new THREE.Line(t,b));
        v.vertices.length > 0 && this.boxM.add(new THREE.Line(v,b));
        x.vertices.length > 0 && this.boxP.add(new THREE.Line(x,b));
        u.vertices.length > 0 && this.boxM.add(new THREE.Line(u,b));
        y.vertices.length > 0 && this.boxP.add(new THREE.Line(y,b));
        E.vertices.length > 0 && this.boxM.add(new THREE.Line(E,b));
        z.vertices.length > 0 && this.boxP.add(new THREE.Line(z,b));
        C.vertices.length > 0 && this.boxM.add(new THREE.Line(C,b));
        w.vertices.length > 0 && this.boxP.add(new THREE.Line(w,b));
        H.vertices.length > 0 && this.boxM.add(new THREE.Line(H,b));
        L.vertices.length > 0 && this.boxP.add(new THREE.Line(L,b));
        I.vertices.length > 0 && this.boxM.add(new THREE.Line(I,b));
        this.context.addObject(this.boxP, false);
        this.context.addObject(this.boxM, false)
    },
    createNArrow: function() {
        this.nArrow = VG.Geometries.NorthArrow(this.x / 25, new THREE.Vector3(this.x * 1.1,0,this.z * 1.1));
        this.context.addObject(this.nArrow, false)
    },
    addHandlers: function() {
        var a = this;
        this.movingFault = false;
        this.context.startHandlers.push(function() {
            a.movingFault = false;
            var b = a.context.getIntersects();
            if (b.length !== 0)
                for (var c = 0; c < a.boxP.children.length; c++)
                    if (b[0].object === a.boxP.children[c]) {
                        a.movingFault = true;
                        return
                    }
            a.setPanelsVisibility(false)
        });
        this.context.endHandlers.push(function() {
            a.movingFault = false;
            a.setPanelsVisibility(true)
        });
        this.context.moveHandlers.push(function(b) {
            if (a.movingFault) {
                var c = a.fault.plane.normal.clone();
                b.subSelf(c.multiplyScalar(c.dot(b)));
                a.boxP.position.addSelf(b);
                a.fault.rake = getBearingInPlane(a.fault.strike, a.fault.dip, a.boxP.position.clone());
                if (a.fault.rake > 180)
                    a.fault.rake = a.fault.rake - 360;
                a.fault.rake = -a.fault.rake;
                a.fault.slip = a.boxP.position.length() / a.slipMultiplier;
                a.updateSliders();
                b = clamp(a.boxP.position.length(), 0, a.slipBound);
                a.boxP.position.setLength(b);
                a.nameFault();
                return false
            }
            return true
        })
    },
    setPanelsVisibility: function(a) {
        this.hidePanels && (a ? $("#sliders").stop(false, true).fadeIn(1E3) : $("#sliders").stop(false, true).fadeOut(1E3))
    }
};
